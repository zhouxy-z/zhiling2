{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/bag/OpenBoxPage.ts"],"names":["OpenBoxPage","Component","Label","Layout","Sprite","SpriteFrame","Toggle","UIOpacity","instantiate","path","CardQuality","CfgMgr","ItemType","ResMgr","folder_quality","Second","Tips","item","isSelect","maxCount","limit","callBack","befor_selects","page_num","$loadSub","complete","hasLoad","onLoad","node","getChildByName","getComponent","getChildByPath","loadSub","thisObj","Promise","resolve","reject","SetData","data","count","is_select","callback","is_card","select_num","removeAllChildren","updateItem","updateCard","index","length","bg","icon","num","mask","maskBg","max_num","id","toggle","on","onSelect","isChecked","std","Getitem","Itemtpye","shard","active","spriteFrame","LoadResAbSub","join","ItemEffect2","string","opacity","interactable","addChild","pos","indexOf","CardID","GetCard","CardName","selects","chidlren","children","console","log","push","getSiblingIndex","splice","Show","setSelectNum","child"],"mappings":"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","sourcesContent":["import { Component, Label, Layout, Node, Sprite, SpriteFrame, Toggle, UIOpacity, instantiate, path } from \"cc\";\r\nimport { CardQuality, CfgMgr, ItemType, StdBattleCardDelivery, StdItem } from \"../../manager/CfgMgr\";\r\nimport { ResMgr, folder_icon, folder_item, folder_quality } from \"../../manager/ResMgr\";\r\nimport { Second } from \"../../utils/Utils\";\r\nimport { Tips } from \"../common/Tips\";\r\nimport proto from \"../../net/Protocol\";\r\n\r\n\r\nexport class OpenBoxPage extends Component {\r\n    private Layout: Layout;\r\n    private item: Node\r\n\r\n    private isSelect: boolean;\r\n    private maxCount: number\r\n    private limit: number;\r\n    private callBack: Function;\r\n    private befor_selects = [];\r\n\r\n\r\n    private page_num:number = 0\r\n    protected $loadSub: Promise<any>;\r\n    protected complete: Function;\r\n    protected hasLoad = false;\r\n\r\n    protected onLoad(): void {\r\n        this.Layout = this.node.getChildByName(\"Layout\").getComponent(Layout);\r\n        this.item = this.node.getChildByPath(\"Layout/item\")\r\n        this.hasLoad = true;\r\n        this.complete?.();\r\n    }\r\n\r\n    protected get loadSub() {\r\n        if (this.$loadSub) return this.$loadSub;\r\n        let thisObj = this;\r\n        this.$loadSub = new Promise((resolve, reject) => {\r\n            thisObj.complete = resolve;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 刷新道具数据\r\n     * @param data \r\n     */\r\n    async SetData(data, count: number, limit, is_select: boolean, callback: Function, is_card: boolean, page_num:number, select_num) {\r\n        if (!this.hasLoad) await this.loadSub;\r\n        this.callBack = callback;\r\n        this.page_num = page_num;\r\n        this.Layout.node.removeAllChildren();\r\n        if(is_card){\r\n            this.updateItem(data);\r\n        }else{\r\n            this.updateCard(data);\r\n        }\r\n        this.befor_selects = select_num;\r\n        this.maxCount = count;\r\n        this.limit = limit;\r\n        this.isSelect = is_select;\r\n    }\r\n\r\n    private async updateItem(data: proto.base.IThing[]) {\r\n        for (let index = 0; index < data.length; index++) {\r\n            let item = instantiate(this.item)\r\n            let bg = item.getChildByName(\"bg\").getComponent(Sprite);\r\n            let icon = item.getChildByPath(\"bg/icon\").getComponent(Sprite);\r\n            let num = item.getChildByPath(\"bg/num\").getComponent(Label);\r\n            let mask = item.getChildByPath(\"mask\").getComponent(UIOpacity);\r\n            let maskBg = item.getChildByPath(\"bg/maskBg\").getComponent(Sprite);\r\n            let max_num = item.getChildByPath(\"mask/max_num\").getComponent(Label);\r\n            let id = item.getChildByName(\"id\").getComponent(Label);\r\n            let toggle = item.getComponent(Toggle);\r\n            toggle.node.on(\"toggle\", this.onSelect, this)\r\n            toggle.isChecked = false;\r\n            // bg.spriteFrame = await ResMgr.LoadResAbSub(data[index].resData.iconBgUrl, SpriteFrame);\r\n            // icon.spriteFrame = await ResMgr.LoadResAbSub(data[index].resData.iconUrl, SpriteFrame);\r\n            if(data[index].item){\r\n                let std: StdItem = CfgMgr.Getitem(data[index].item.id);\r\n                if (std.Itemtpye == ItemType.shard) {\r\n                    maskBg.node.active = true;\r\n                    maskBg.spriteFrame = await ResMgr.LoadResAbSub(path.join(folder_quality, CardQuality[std.ItemEffect2] + \"_bag_mask\", \"spriteFrame\"), SpriteFrame);\r\n                }else{\r\n                    maskBg.node.active = false;\r\n                }\r\n                id.string = data[index].item.id + \"\"\r\n                num.string = (data[index].item.count ? data[index].item.count : \"\") + \"\";\r\n            }else{\r\n                num.string = \"1\";\r\n            }\r\n            id.node.active = false;\r\n            max_num.string = this.maxCount + \"\";\r\n            mask.opacity = this.isSelect ? 0 : 255;\r\n            toggle.interactable = this.isSelect;\r\n            this.Layout.node.addChild(item)\r\n        }\r\n    }\r\n\r\n    private async updateCard(data: StdBattleCardDelivery[]) {\r\n        for (let index = 0; index < data.length; index++) {\r\n            let item = instantiate(this.item)\r\n            let bg = item.getChildByName(\"bg\").getComponent(Sprite);\r\n            let icon = item.getChildByPath(\"bg/icon\").getComponent(Sprite);\r\n            let num = item.getChildByPath(\"bg/num\").getComponent(Label);\r\n            let mask = item.getChildByPath(\"mask\").getComponent(UIOpacity);\r\n            let maskBg = item.getChildByPath(\"bg/maskBg\").getComponent(Sprite);\r\n            let max_num = item.getChildByPath(\"mask/max_num\").getComponent(Label);\r\n            let id = item.getChildByName(\"id\").getComponent(Label);\r\n            let toggle = item.getComponent(Toggle);\r\n           \r\n            toggle.isChecked = false;\r\n            let pos = index + this.page_num * 8\r\n            if(this.befor_selects.indexOf(pos) != -1){\r\n                toggle.isChecked = true;\r\n            }\r\n            toggle.node.on(\"toggle\", this.onSelect, this)\r\n            bg.spriteFrame = await ResMgr.LoadResAbSub(path.join(folder_quality, CardQuality[data[index].CardQuality] + \"_bag_bg\", \"spriteFrame\"), SpriteFrame);\r\n            num.string = \"1\";\r\n            id.string = data[index].CardID + \"_\" + CfgMgr.GetCard(data[index].CardID).CardName\r\n            icon.node.active = false;\r\n            id.node.active = true;\r\n            max_num.string = this.maxCount + \"\";\r\n            mask.opacity = this.isSelect ? 0 : 255;\r\n            toggle.interactable = this.isSelect;\r\n            this.Layout.node.addChild(item)\r\n        }\r\n    }\r\n\r\n    protected async onSelect(toggle: Toggle) {\r\n        if (!this.limit || !this.isSelect) return;\r\n        await Second(0);\r\n        let selects = [];\r\n        let chidlren = this.Layout.node.children;\r\n        let num = 0 + this.befor_selects.length ;  \r\n        console.log(this.befor_selects)\r\n        // for (let child of chidlren) {\r\n            let isSelect = toggle.isChecked;\r\n            if (isSelect) {\r\n                num++;\r\n                if (isSelect){\r\n                    toggle.node.getChildByName(\"mask\").getComponent(UIOpacity).opacity = 255;\r\n                }\r\n                selects.push(toggle.node.getSiblingIndex() + this.page_num * 8);\r\n            }else{\r\n                toggle.node.getChildByName(\"mask\").getComponent(UIOpacity).opacity = 0;\r\n            }\r\n        // }\r\n        if (num > this.limit) {\r\n            toggle.isChecked = false;\r\n            toggle.node.getChildByName(\"mask\").getComponent(UIOpacity).opacity = 0;\r\n            let index = selects.indexOf(toggle.node.getSiblingIndex() + this.page_num * 8);\r\n            if (index != -1) {\r\n                selects.splice(index, 1);\r\n            }\r\n            Tips.Show(\"只能选择\" + this.limit + \"个\");\r\n        }\r\n        this.callBack(selects);\r\n    }\r\n\r\n    public setSelectNum(count, is_select) {\r\n        let chidlren = this.Layout.node.children;\r\n        for (let child of chidlren) {\r\n            let isSelect = child.getComponent(Toggle).isChecked;\r\n            if (isSelect && is_select) { \r\n                child.getChildByName(\"mask\").getComponent(UIOpacity).opacity = 255;       \r\n            }  \r\n            child.getChildByPath(\"mask/max_num\").getComponent(Label).string = count + \"\"\r\n        }\r\n    }\r\n}"]}