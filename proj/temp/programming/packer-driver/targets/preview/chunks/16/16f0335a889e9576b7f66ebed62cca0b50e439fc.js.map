{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_HandToTerrain.ts"],"names":["Out_HandToTerrain","BattleBaseComp","battleDataMgr","actionEnd","start","data","card","cardLocation","isPlayerA","toTerrainPlayerId","creatRoomData","isReplay","getPlayerAreaEmptyCardLocation","toTerrainInstId","scene","AutoPlayHand","areaIdx","cardIdx","isExit","CloseCard","console","log","SendAdCardToArea","error","exit","onUpdate","dt","reset"],"mappings":";;;6DAOaA,iB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AANJC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;AAET;AACA;AACA;mCACaF,iB,GAAN,MAAMA,iBAAN;AAAA;AAAA,4CAA6F;AAAA;AAAA;AAAA,eACxFG,SADwF,GACnE,KADmE;AAAA;;AAEhFC,QAAAA,KAAK,GAAkB;AAAA;;AAAA;AACnC;AACA,gBAAI,KAAI,CAACC,IAAL,IAAa,KAAI,CAACA,IAAL,CAAUC,IAA3B,EAAiC;AAC7B,kBAAIC,YAAJ;;AACA,kBAAI;AAAA;AAAA,kDAAcC,SAAd,CAAwB,KAAI,CAACH,IAAL,CAAUI,iBAAlC,CAAJ,EAA0D;AACtD;AACA,oBAAI;AAAA;AAAA,oDAAcC,aAAd,CAA4BC,QAAhC,EAA0C;AACtCJ,kBAAAA,YAAY,GAAG;AAAA;AAAA,sDAAcK,8BAAd,CAA6C,KAAI,CAACP,IAAL,CAAUI,iBAAvD,EAA0E,KAAI,CAACJ,IAAL,CAAUQ,eAApF,CAAf;AACA,wBAAM,KAAI,CAACC,KAAL,CAAWC,YAAX,CAAwB,KAAI,CAACV,IAAL,CAAUC,IAAlC,EAAwCC,YAAY,CAACS,OAArD,EAA8DT,YAAY,CAACU,OAA3E,CAAN;AACA,sBAAI,KAAI,CAACC,MAAT,EAAiB;AACjB,wBAAM,KAAI,CAACJ,KAAL,CAAWK,SAAX,CAAqB,KAAI,CAACd,IAAL,CAAUC,IAA/B,CAAN;AACA,sBAAI,KAAI,CAACY,MAAT,EAAiB;AACjBE,kBAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACA,kBAAA,KAAI,CAAClB,SAAL,GAAiB,IAAjB;AACH,iBARD,MAQO;AACH,wBAAM,KAAI,CAACW,KAAL,CAAWK,SAAX,CAAqB,KAAI,CAACd,IAAL,CAAUC,IAA/B,CAAN;AACA,sBAAI,KAAI,CAACY,MAAT,EAAiB;AACjBE,kBAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACA,kBAAA,KAAI,CAAClB,SAAL,GAAiB,IAAjB;AACH,iBAfqD,CAgBtD;AAEA;;AAEH,eApBD,MAoBO;AACHI,gBAAAA,YAAY,GAAG;AAAA;AAAA,oDAAcK,8BAAd,CAA6C,KAAI,CAACP,IAAL,CAAUI,iBAAvD,EAA0E,KAAI,CAACJ,IAAL,CAAUQ,eAApF,CAAf;;AACA,oBAAIN,YAAJ,EAAkB;AACd;AACpB;AACA;AACoB,wBAAM,KAAI,CAACO,KAAL,CAAWQ,gBAAX,CAA4B,KAAI,CAACjB,IAAL,CAAUC,IAAtC,EAA4CC,YAAY,CAACS,OAAzD,EAAkET,YAAY,CAACU,OAA/E,CAAN;AACA,sBAAI,KAAI,CAACC,MAAT,EAAiB,OALH,CAMd;;AACA,kBAAA,KAAI,CAACf,SAAL,GAAiB,IAAjB;AACH,iBARD,MAQO;AACHiB,kBAAAA,OAAO,CAACG,KAAR,CAAc,eAAd;;AACA,kBAAA,KAAI,CAACC,IAAL;AACH;AAEJ;AAEJ,aAvCD,MAuCO;AACHJ,cAAAA,OAAO,CAACG,KAAR,CAAc,aAAd;;AACA,cAAA,KAAI,CAACC,IAAL;AACH;AA5CkC;AA6CtC;;AAESC,QAAAA,QAAQ,CAACC,EAAD,EAAmB;AACjC,cAAI,CAAC,KAAKvB,SAAV,EAAqB;AACrB,eAAKqB,IAAL;AACH;;AAESG,QAAAA,KAAK,GAAS;AACpB,eAAKxB,SAAL,GAAiB,KAAjB;AACH;;AAxD+F,O","sourcesContent":["import proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\nimport { CardLocation } from \"../../player/PlayerStruct\";\r\n/**\r\n * 从手牌上场\r\n */\r\nexport class Out_HandToTerrain extends BattleBaseComp<proto.base.IBattleRoomOpOutput_HandToTerrain> {\r\n    private actionEnd: boolean = false;\r\n    protected async start(): Promise<void> {\r\n        // battleDataMgr.getPlayerTerrain(this.data.toTerrainPlayerId)\r\n        if (this.data && this.data.card) {\r\n            let cardLocation: CardLocation;\r\n            if (battleDataMgr.isPlayerA(this.data.toTerrainPlayerId)) {\r\n                //回放模式\r\n                if (battleDataMgr.creatRoomData.isReplay) {\r\n                    cardLocation = battleDataMgr.getPlayerAreaEmptyCardLocation(this.data.toTerrainPlayerId, this.data.toTerrainInstId);\r\n                    await this.scene.AutoPlayHand(this.data.card, cardLocation.areaIdx, cardLocation.cardIdx);\r\n                    if (this.isExit) return;\r\n                    await this.scene.CloseCard(this.data.card);\r\n                    if (this.isExit) return;\r\n                    console.log(\"--------->盖牌完成\");\r\n                    this.actionEnd = true;\r\n                } else {\r\n                    await this.scene.CloseCard(this.data.card);\r\n                    if (this.isExit) return;\r\n                    console.log(\"--------->盖牌完成\");\r\n                    this.actionEnd = true;\r\n                }\r\n                //\r\n                \r\n                // await Second(1);\r\n                \r\n            } else {\r\n                cardLocation = battleDataMgr.getPlayerAreaEmptyCardLocation(this.data.toTerrainPlayerId, this.data.toTerrainInstId);\r\n                if (cardLocation) {\r\n                    /**\r\n                     * TODO 对手卡需要作由 盖着出牌 到区域（卡牌由盖牌到显示要等下个包处理变化）\r\n                     */\r\n                    await this.scene.SendAdCardToArea(this.data.card, cardLocation.areaIdx, cardLocation.cardIdx);\r\n                    if (this.isExit) return;\r\n                    // await Second(1);\r\n                    this.actionEnd = true;\r\n                } else {\r\n                    console.error(\"手牌到地形区域卡牌位置为空\");\r\n                    this.exit();\r\n                }\r\n                \r\n            }\r\n            \r\n        } else {\r\n            console.error(\"手牌到地形区域数据为空\");\r\n            this.exit();\r\n        }\r\n    }\r\n\r\n    protected onUpdate(dt: number): void {\r\n        if (!this.actionEnd) return;\r\n        this.exit();\r\n    }\r\n\r\n    protected reset(): void {\r\n        this.actionEnd = false;\r\n    }\r\n}"]}