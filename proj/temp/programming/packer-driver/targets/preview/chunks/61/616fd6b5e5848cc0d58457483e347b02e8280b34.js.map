{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/display/EffectSet.ts"],"names":["_decorator","CCFloat","CCString","Component","easing","Enum","game","Node","ParticleSystem","sp","Sprite","Tween","tween","v3","Vec3","EaseType","Second","Utils","Bezier","EventMgr","GameObj","ccclass","disallowMultiple","property","EffectType","TargetType","AffectType","EffectState","PathType","EffectSet","type","tooltip","visible","tigger","times","bullet","pathType","curve","bezier","params","attacker","undefined","target","parent","version","par","prevState","ske","spr","lessTimes","duration","status","idle","startTick","cb","tempV","targetSet","onLoad","getComponent","playOnAwake","stop","node","active","Skeleton","i","nextEffects","length","splice","Reset","off","onBuffEvent","seed","stopAllByTarget","e","console","error","name","root","onDestroy","setPosition","v","offset","equals","ZERO","setWorldPosition","x","y","z","isLoop","playDuration","isRunning","playing","Play","callBack","delay","copy","none","playNext","$attacker","worldPosition","attackerType","lockDepth","addChild","setSiblingIndex","children","totalTime","finish","action","card","PlaySkill","buffEvent","on","tiggerType","None","tiggerAffect","emit","merge","enabled","loop","play","getCurrent","animation","GetSkeAciton","setAnimation","sample","$target","targetType","set","distance","speed","update","face","FaceToNode","liner","craeteCurve","curveRatio","create","bezierPath","self","ratio","to","ease","onUpdate","start","autoBullet","prevPlayNext","activeInHierarchy","receive","buff","effect","last","deltaTime","tick","dt","Number","frameRate","MAX_SAFE_INTEGER","event","toString","Array"],"mappings":"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","sourcesContent":["import { _decorator, CCFloat, CCString, Component, easing, Enum, game, Node, ParticleSystem, sp, Sprite, Tween, tween, v3, Vec3 } from 'cc';\r\nimport { EaseType } from './EaseType';\r\nimport { Second, Utils } from '../../../utils/Utils';\r\nimport { Bezier } from '../../../utils/Bezier';\r\nimport { ISceneEntry, SceneCard } from './SceneCard';\r\nimport { EventMgr } from '../../../manager/EventMgr';\r\nimport { GameObj } from '../../../manager/GameRoot';\r\nconst { ccclass, disallowMultiple, property } = _decorator;\r\n\r\n/**效果类型枚举 */\r\nenum EffectType {\r\n    none,\r\n    sample,\r\n    times,\r\n    bullet,\r\n    autoBullet\r\n}\r\n\r\n/**目标枚举 */\r\nexport enum TargetType {\r\n    None,\r\n    all,\r\n    attacker,\r\n    target,\r\n    myArea,\r\n    myDeck,\r\n    myHand,\r\n    myDrop,\r\n    myDel,\r\n    myEnergy,\r\n    adArea,\r\n    adDeck,\r\n    adHand,\r\n    adDrop,\r\n    adDel,\r\n    adEnergy\r\n}\r\nexport type TargetSet = {\r\n    route: string,\r\n    attacker: Node,\r\n    target: ISceneEntry,\r\n    myArea: Node,\r\n    myDeck: Node,\r\n    myHand: Node,\r\n    myDrop: Node,\r\n    myDel: Node,\r\n    myEnergy: Node,\r\n    adArea: Node,\r\n    adDeck: Node,\r\n    adHand: Node,\r\n    adDrop: Node,\r\n    adDel: Node,\r\n    adEnergy: Node\r\n}\r\n\r\n/**效果 */\r\nexport enum AffectType {\r\n    None,\r\n    ChangePower,\t     //增加/翻倍/减少卡牌战力\r\n    ChangeCost,\t         //增加/翻倍/减少卡牌费率\r\n    Copy,\t             //复制卡牌\r\n    CopyPower,\t         //复制卡牌战力\r\n    CopyCost,\t         //复制卡牌费率\r\n    Transform,\t         //转换卡牌\r\n    Nullify,\t         //使卡牌效果无效\r\n    RepeatEffect,\t     //重复卡牌效果\r\n    Protect,\t         //卡牌保护\r\n    Resurrect,\t         //卡牌复活\r\n    Draw,\t             //抽牌\r\n    Dis,\t             //弃牌\r\n    Recycle,\t         //回收手牌\r\n    Peek,\t             //窥视手牌\r\n    ModifyHandCost,\t     //修改手牌费率\r\n    AdjustHandLimit,     //手牌上限调整\r\n    AddToZone,\t         //在区域中添加卡牌\r\n    RemoveZone,\t         //移除区域卡牌\r\n    AdjustZonePower,     //增加/减少区域总战力\r\n    ScaleZonePower,\t     //区域战力翻倍/减半\r\n    ModifyZoneSkill,     //变更区域技能\r\n    MoveBetweenZones,    //将卡牌从一个区域移动到另一个区域\r\n    LockZone,\t         //区域锁定\r\n    ClearZone,\t         //区域清空\r\n    DestroyZone,\t     //摧毁区域\r\n    AdjustAllZonesPower, //区域内所有卡牌战力+X/-X\r\n    GainEnergy,\t         //增加能量\r\n    ExtendTurn,\t         //增加回合数\r\n\r\n\r\n    All // 注意：此字段位于枚举末尾，不能更改\r\n}\r\n\r\n/**特效状态 */\r\nenum EffectState {\r\n    idle,\r\n    playing,\r\n    finish,\r\n    buff\r\n}\r\n\r\n/**路径类型 */\r\nenum PathType {\r\n    liner,\r\n    curve,\r\n    bezier\r\n}\r\n\r\n@ccclass('EffectSet')\r\n@disallowMultiple(true)\r\nexport class EffectSet extends Component {\r\n\r\n    @property({ type: Enum(EffectType), tooltip: \"类型\" })\r\n    type: EffectType = EffectType.sample;\r\n\r\n    @property({ tooltip: \"起始特效\" })\r\n    root: boolean = false;\r\n\r\n    @property({ tooltip: \"触发器\" })\r\n    tigger: boolean = false;\r\n\r\n    @property({\r\n        tooltip: \"结束特效，此特效播放结束将强制回收所有特效\", visible() {\r\n            return this.tigger == true;\r\n        }\r\n    })\r\n    last: boolean = false;\r\n\r\n    @property({\r\n        type: Enum(TargetType), tooltip: \"触发对象\", visible() {\r\n            return this.tigger == true;\r\n        }\r\n    })\r\n    tiggerType: number = 0;\r\n\r\n    @property({\r\n        type: Enum(AffectType), tooltip: \"作用效果,详见battle_card_effect表\", visible() {\r\n            return this.tigger == true;\r\n        }\r\n    })\r\n    tiggerAffect = 0;\r\n\r\n    @property({\r\n        type: CCString, tooltip: \"buff触发播放\", visible() {\r\n            return this.tigger == true;\r\n        }\r\n    })\r\n    buffEvent = \"\";\r\n\r\n    @property({ type: CCFloat, tooltip: \"(可配暂未实装)震屏\" })\r\n    shake: number = 0;\r\n\r\n    @property({ type: CCString, tooltip: \"角色技能动作\" })\r\n    action = \"\";\r\n\r\n    @property({ type: Enum(TargetType), tooltip: \"发起特效的类型,none表示不展示,all表示任意类型\" })\r\n    attackerType: TargetType = TargetType.attacker;\r\n\r\n    @property({ tooltip: \"坐标偏差\" })\r\n    offset: Vec3 = v3();\r\n\r\n    @property({ tooltip: \"锁定层级-1目标下层,0无锁定,1锁定目标上层\" })\r\n    lockDepth = 0;\r\n\r\n    @property({ type: CCFloat, tooltip: \"延迟播放的秒数,支持负数\" })\r\n    delay: number = 0;\r\n\r\n    @property({ type: CCFloat, tooltip: \"播放的次数,0表示循环播放\", visible() { return this.type == EffectType.times; } })\r\n    times: number = 1;\r\n\r\n    @property({\r\n        type: CCFloat, tooltip: \"持续播放秒数\", visible() {\r\n            return this.type == EffectType.times && this.times == 0;\r\n        }\r\n    })\r\n    playDuration: number = 0;\r\n\r\n    @property({\r\n        type: CCFloat, tooltip: \"飞行速度(米/秒)\", visible() {\r\n            return this.type == EffectType.bullet;\r\n        }\r\n    })\r\n    speed: number = 1;\r\n\r\n    @property({\r\n        type: Enum(EaseType), tooltip: \"速度类型,详见EaseType\", visible() {\r\n            return this.type == EffectType.bullet;\r\n        }\r\n    })\r\n    ease = \"\";\r\n\r\n    @property({\r\n        type: Enum(PathType), tooltip: \"(暂未确定)路径类型:\\n  liner(线性)\\n   curve(抛物线)\\n bezier(贝塞尔曲线)\", visible() {\r\n            return this.type == EffectType.bullet;\r\n        }\r\n    })\r\n    pathType: number = 0;\r\n\r\n    @property({ tooltip: \"多发合并,用于合并同时触发多次特效时只播一次的情况\" })\r\n    protected merge: boolean = false;\r\n\r\n    @property({\r\n        tooltip: \"子弹是否实时朝向运动方向\", visible() {\r\n            return this.type == EffectType.bullet;\r\n        }\r\n    })\r\n    face: boolean = false;\r\n\r\n    params: any[] = [];\r\n\r\n    @property({\r\n        type: CCFloat, tooltip: \"抛物线高度和距离比值\", visible() {\r\n            return this.pathType == PathType.curve;\r\n        }\r\n    })\r\n    curveRatio: number = 1;\r\n\r\n    @property({\r\n        type: [Vec3], tooltip: \"多阶贝塞尔\", visible() {\r\n            return this.pathType == PathType.bezier;\r\n        }\r\n    })\r\n    bezierPath: Vec3[] = new Array(3);\r\n\r\n    @property({\r\n        type: Enum(TargetType), tooltip: \"被攻击目标类型\", visible() {\r\n            return this.type == EffectType.bullet;\r\n        }\r\n    })\r\n    targetType: TargetType = TargetType.target;\r\n\r\n    @property({ type: [Node], tooltip: \"此特效播放完后的下一个特效\" })\r\n    nextEffects: Node[] = [];\r\n\r\n    attacker: Node = undefined;\r\n    target: Node = undefined;\r\n    parent: Node;\r\n\r\n    ////////////////////////////////////////////////////////////////////////////////\r\n    protected static seed = 0;\r\n    protected version: number;\r\n    protected par: ParticleSystem; // 粒子特效\r\n    protected prevState: boolean;  // 粒子特效状态记录\r\n    protected ske: sp.Skeleton;    // 骨骼动画\r\n    protected spr: Sprite;\r\n    protected lessTimes: number;   // 剩余播放次数\r\n    protected duration: number;     // 此特效持续时间\r\n    protected status: number = EffectState.idle;    // 特效状态\r\n    protected startTick = 0;            // 记录开始播放时间\r\n    protected cb: Function;        // 结束回调\r\n    protected tempV: Vec3 = v3();  // 位置记录\r\n    protected bezier: Bezier;\r\n\r\n    protected onLoad() {\r\n        this.prevState = false;\r\n        this.par = this.getComponent(ParticleSystem);\r\n        if (this.par) {\r\n            this.par.playOnAwake = false;\r\n            this.par.stop();\r\n            this.par.node.active = false;\r\n        }\r\n        this.ske = this.getComponent(sp.Skeleton);\r\n        if (this.ske) {\r\n            this.ske.node.active = false;\r\n        }\r\n        for (let i = this.nextEffects.length - 1; i >= 0; i--) {\r\n            if (!this.nextEffects[i]) this.nextEffects.splice(i, 1);\r\n        }\r\n        this.spr = this.getComponent(Sprite);\r\n    }\r\n\r\n    Reset() {\r\n        EventMgr.off(\"buff_event\", this.onBuffEvent, this);\r\n        this.version = ++EffectSet.seed;\r\n        this.cb = undefined;\r\n        Tween.stopAllByTarget(this.node);\r\n        this.status = EffectState.idle;\r\n        this.cb = undefined;\r\n        this.startTick = 0;\r\n        this.lessTimes = 0;\r\n        if (this.par && this.par.node) {\r\n            this.par.node.active = false;\r\n            try { this.par.stop(); } catch (e) { }\r\n            this.par.playOnAwake = false;\r\n        }\r\n        if (this.ske) {\r\n            if (this.ske.node) {\r\n                this.ske.node.active = false;\r\n            } else {\r\n                console.error(\"EffectSet.onDestory\", this.node.name);\r\n            }\r\n        }\r\n        if (!this.root) {\r\n            this.node.active = false;\r\n        }\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        this.Reset();\r\n    }\r\n\r\n    /**\r\n     * 设置坐标\r\n     * @param v\r\n     */\r\n    setPosition(v: Vec3) {\r\n        if (this.offset && !this.offset.equals(Vec3.ZERO)) {\r\n            this.node.setWorldPosition(v.x + this.offset.x, v.y + this.offset.y, v.z + this.offset.z);\r\n        } else {\r\n            this.node.setWorldPosition(v.x, v.y, v.z);\r\n        }\r\n        // console.log(this.node.name, v.toString(), this.offset.toString(), this.node.worldPosition.toString());\r\n    }\r\n\r\n    /**\r\n     * 是否循环播放\r\n     */\r\n    get isLoop() {\r\n        // if (this.type == EffectType.bullet) return true;\r\n        if (this.times <= 0 && this.type == EffectType.times && this.playDuration <= 0) return true;\r\n        return false;\r\n    }\r\n\r\n    get isRunning() {\r\n        return this.status == EffectState.playing;\r\n    }\r\n\r\n\r\n    private targetSet: TargetSet;\r\n\r\n    /**\r\n     * 开始播放\r\n     * @param callBack \r\n     * @param targets \r\n     * @returns \r\n     */\r\n    async Play(callBack: Function, targetSet: TargetSet, delay?: number, copy?: boolean) {\r\n        this.Reset();\r\n        if (this.type == EffectType.none) return this.playNext();\r\n        let $attacker = this.attacker?.worldPosition;\r\n        this.targetSet = targetSet;\r\n        if (!$attacker) {\r\n            this.attacker = targetSet[TargetType[this.attackerType]];\r\n            $attacker = this.attacker?.worldPosition || Vec3.ZERO;\r\n        }\r\n        this.cb = callBack;\r\n        this.status = EffectState.playing;\r\n        if (this.lockDepth > 0) {\r\n            if (this.attacker) {\r\n                this.attacker.addChild(this.node);\r\n                this.node.setSiblingIndex(this.attacker.children.length);\r\n            }\r\n        } else if (this.lockDepth < 0) {\r\n            if (this.attacker) {\r\n                this.attacker.addChild(this.node);\r\n                this.node.setSiblingIndex(0);\r\n            }\r\n        }\r\n        this.setPosition($attacker);\r\n        if (!delay) delay = this.delay;\r\n        this.startTick = game.totalTime / 1000 + delay;\r\n        if (delay > 0) {\r\n            await Second(delay);\r\n            if (this.status == EffectState.finish) {\r\n                return this.playNext();\r\n            }\r\n        }\r\n        if (this.action) {\r\n            let card = this.attacker || targetSet[TargetType[TargetType.attacker]];\r\n            if (card as SceneCard) {\r\n                card.PlaySkill(this.action);\r\n            }\r\n        }\r\n\r\n        if (this.buffEvent) {\r\n            EventMgr.on(\"buff_event\", this.onBuffEvent, this);\r\n        }\r\n\r\n        if (this.tigger && this.tiggerType > TargetType.None && this.tiggerAffect > AffectType.None) {\r\n            if (this.parent) {\r\n                this.parent.emit(\"tigger\", this, this.attackerType, this.tiggerAffect);\r\n            } else {\r\n                let parent = this.node.parent;//,skillRoot: TestSkill;\r\n                while (parent) {\r\n                    parent = parent.parent;\r\n                    if (parent) parent.emit(\"tigger\", this, this.attackerType, this.tiggerAffect);\r\n                    if (parent instanceof GameObj) break;\r\n                }\r\n            }\r\n        }\r\n\r\n        this.node.active = true;\r\n        let merge = false;\r\n        if (copy && this.merge) merge = true;\r\n        this.lessTimes = this.times;\r\n        if (this.par) {\r\n            this.par.node.active = true;\r\n            this.par.enabled = !merge;\r\n            this.prevState = true;\r\n            this.par.loop = this.isLoop || this.type == EffectType.bullet;\r\n            this.par.play();\r\n            if (!this.isLoop) {\r\n                this.duration = (this.par.duration || 0) * (this.times || 1);\r\n            } else {\r\n                this.duration = this.par.duration || 0;\r\n            }\r\n            // if(this.smoothIn) {\r\n            // this.par.startColor\r\n            // this.par.startColor.color\r\n            // }\r\n        } else if (this.ske) {\r\n            this.ske.node.active = !merge;\r\n            let name = this.ske.getCurrent(0).animation.name || Utils.GetSkeAciton(this.ske);\r\n            this.ske.setAnimation(0, name, this.isLoop || this.type == EffectType.bullet);\r\n            if (!this.isLoop) {\r\n                this.duration = (this.ske.getCurrent(0)?.animation?.duration || 0) * (this.times || 1);\r\n            } else {\r\n                this.duration = this.ske.getCurrent(0)?.animation?.duration || 0;\r\n            }\r\n        } else if (this.spr) {\r\n            this.spr.node.active = !merge;\r\n        } else {\r\n            this.duration = 0;\r\n        }\r\n\r\n        switch (this.type) {\r\n            case EffectType.sample:\r\n            case EffectType.times:\r\n                break;\r\n\r\n            case EffectType.bullet:\r\n                let $target = this.target?.worldPosition;\r\n                if (!$target) $target = targetSet[TargetType[this.targetType]]?.worldPosition;\r\n                if (!$target) return this.playNext();\r\n                this.tempV.set($target);\r\n                this.duration = Vec3.distance($attacker, this.tempV) / this.speed;\r\n\r\n                // console.log(\"buttle\", this.duration);\r\n                let update: (target: Node, ratio: number) => void = undefined;\r\n                if (this.face) Utils.FaceToNode(this.node, $attacker);\r\n                if (this.pathType != PathType.liner) {\r\n                    if (!this.bezier) {\r\n                        if (this.pathType == PathType.curve) {\r\n                            this.bezier = Bezier.craeteCurve($attacker, $target, this.curveRatio);\r\n                        } else {\r\n                            this.bezier = Bezier.create($attacker, $target, this.bezierPath);\r\n                        }\r\n                    }\r\n                    let self = this;\r\n                    update = (target: Node, ratio: number) => {\r\n                        let v = self.bezier.update(ratio)\r\n                        if (self.face) Utils.FaceToNode(self.node, v);\r\n                        self.bezier && self.setPosition(v);\r\n                    }\r\n                }\r\n                tween(this.node).to(this.duration, { worldPosition: this.tempV }, { easing: easing[EaseType[this.ease]], onUpdate: update }).start();\r\n                break;\r\n\r\n            case EffectType.autoBullet:\r\n                break;\r\n        }\r\n        this.prevPlayNext(this.duration);\r\n    }\r\n\r\n    /**\r\n     * 播放下一个\r\n     */\r\n    protected playNext() {\r\n        if (this.par && this.par.enabled && this.par.node.activeInHierarchy) this.par.stop();\r\n        if (this.ske) this.ske.node.active = false;\r\n        if (this.spr) this.spr.node.active = false;\r\n        this.node.active = false;\r\n        Tween.stopAllByTarget(this.node);\r\n        if (this.bezier) {\r\n            this.bezier.receive();\r\n            this.bezier = undefined;\r\n        }\r\n        if (this.status != EffectState.finish) {\r\n            this.status = EffectState.finish;\r\n        }\r\n        if (this.buffEvent) {\r\n            this.status = EffectState.buff;\r\n        }\r\n        if (this.nextEffects && this.nextEffects.length) {\r\n            for (let i = 0; i < this.nextEffects.length; i++) {\r\n                let effect = this.nextEffects[i];\r\n                if (!effect) continue;\r\n                let set = effect.getComponent(EffectSet);\r\n                if (set && set.status == EffectState.idle) {\r\n                    set.Play(this.cb, this.targetSet);\r\n                }\r\n            }\r\n        } else if (this.tigger && this.last && this.cb) {\r\n            this.cb(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 预播放\r\n     * @param duration \r\n     * @returns \r\n     */\r\n    protected prevPlayNext(duration: number) {\r\n        if (!this.nextEffects) return;\r\n        for (let effect of this.nextEffects) {\r\n            let set = effect.getComponent(EffectSet);\r\n            if (!set) continue;\r\n            if (set.delay < 0) {\r\n                set.Play(this.cb, this.targetSet, duration + set.delay);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 轮训判断持续播放时间是否截止\r\n     * @param deltaTime \r\n     */\r\n    update(deltaTime: number) {\r\n        if (this.status == EffectState.idle) return;\r\n        if (!this.isLoop || this.type == EffectType.bullet) {\r\n            let tick = game.totalTime / 1000;\r\n            if (this.playDuration && tick - this.startTick >= this.playDuration) {\r\n                this.playNext();\r\n                return;\r\n            }\r\n\r\n            let dt = this.duration + 2 / Number(game.frameRate);\r\n            if (tick - this.startTick >= dt) {\r\n                this.playNext();\r\n            }\r\n        } else if (this.isLoop && this.nextEffects.length) {\r\n            let tick = game.totalTime / 1000;\r\n            let dt = this.duration + 1 / Number(game.frameRate);\r\n            if (tick - this.startTick >= dt) {\r\n                this.startTick = Number.MAX_SAFE_INTEGER;\r\n                for (let i = 0; i < this.nextEffects.length; i++) {\r\n                    let effect = this.nextEffects[i];\r\n                    if (!effect) continue;\r\n                    let set = effect.getComponent(EffectSet);\r\n                    if (set && set.status == EffectState.idle) {\r\n                        set.Play(this.cb, this.targetSet);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onBuffEvent(event: string) {\r\n        if (this.buffEvent == event.toString()) {\r\n            this.startTick = game.totalTime / 1000;\r\n            if (this.ske) {\r\n                let name = this.ske.getCurrent(0).animation.name || Utils.GetSkeAciton(this.ske);\r\n                this.ske.node.active = true;\r\n                this.ske.setAnimation(0, name, this.isLoop || this.type == EffectType.bullet);\r\n            }\r\n            if (this.par) {\r\n                this.par.loop = false;\r\n                this.par.node.active = true;\r\n                this.par.play();\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}