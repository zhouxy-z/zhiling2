{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/vs/VSSectionAwardPanel.ts"],"names":["VSSectionAwardPanel","Panel","VList","CfgMgr","PlayerData","EventMgr","Evt_SectionAwardInit","Evt_SectionAwardUpdate","VSSectionAwardItem","Goto","prefab","awardList","stdPvpLevelList","curStdPVPSnatch","seasonData","onLoad","find","updateCell","updateSeasonAwarCell","bind","CloseBy","flush","updateShow","onShow","on","onAwardDataInit","onGetAward","onHide","off","data","things","length","CurSeasonData","GetStdPVPSnatch","currentSeasonId","GetStdPvpLvCfgList","RankGroupID","curStdPvpLv","GetStdPvpLvByPoint","currentRankInfo","rankPoints","defIndex","index","std","LevelID","cellCount","scrollToIndex","cell","cellInfo","cellCom","getComponent","addComponent","SetData"],"mappings":"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","sourcesContent":["import { Panel } from \"../../manager/GameRoot\";\r\nimport { CellInfo, VList } from \"../../component/VList\";\r\nimport { Node} from \"cc\";\r\nimport { CfgMgr, StdPvpLevel, StdPVPSnatch } from \"../../manager/CfgMgr\";\r\nimport proto from \"../../net/Protocol\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { EventMgr, Evt_SectionAwardInit, Evt_SectionAwardUpdate } from \"../../manager/EventMgr\";\r\nimport { VSSectionAwardItem } from \"./VSSectionAwardItem\";\r\nimport { Goto } from \"../../DL\";\r\nexport class VSSectionAwardPanel extends Panel {\r\n    protected prefab: string = \"prefabs/vs/VSSectionAwardPanel\";\r\n    private awardList: VList;\r\n    private stdPvpLevelList: StdPvpLevel[];\r\n    private curStdPVPSnatch: StdPVPSnatch;\r\n    private seasonData: proto.pb.PlayerPvpInfoPush;\r\n    protected onLoad() {\r\n        \r\n        this.awardList = this.find(\"cont/awardList\", VList);\r\n        this.awardList.updateCell = this.updateSeasonAwarCell.bind(this);\r\n        this.CloseBy(\"cont/closeBtn\");\r\n        this.CloseBy(\"mask\");\r\n        \r\n    }\r\n\r\n    public flush(): void {\r\n        this.updateShow();\r\n    }\r\n\r\n    protected onShow(): void {\r\n        EventMgr.on(Evt_SectionAwardInit, this.onAwardDataInit, this);\r\n        EventMgr.on(Evt_SectionAwardUpdate, this.onGetAward, this);\r\n    }\r\n\r\n    protected onHide(): void {\r\n        EventMgr.off(Evt_SectionAwardInit, this.onAwardDataInit, this);\r\n        EventMgr.off(Evt_SectionAwardUpdate, this.onGetAward, this);\r\n    }\r\n\r\n\r\n    private onAwardDataInit(): void {\r\n        this.updateShow();\r\n    }\r\n\r\n    private onGetAward(data: proto.base.IPlayerRankLevelReward): void {\r\n        if (data && data.things && data.things.length) {\r\n            Goto(\"RewardTips\", data.things);\r\n        }\r\n    }\r\n\r\n    private updateShow(): void {\r\n        this.seasonData = PlayerData.CurSeasonData;\r\n        this.curStdPVPSnatch = CfgMgr.GetStdPVPSnatch(this.seasonData.currentSeasonId);\r\n        this.stdPvpLevelList = CfgMgr.GetStdPvpLvCfgList(this.curStdPVPSnatch.RankGroupID);\r\n        let curStdPvpLv = CfgMgr.GetStdPvpLvByPoint(this.curStdPVPSnatch.RankGroupID, this.seasonData.currentRankInfo.rankPoints);\r\n        let defIndex: number = 0;\r\n        for (let index = 0; index < this.stdPvpLevelList.length; index++) {\r\n            let std: StdPvpLevel = this.stdPvpLevelList[index];\r\n            if (std.LevelID == curStdPvpLv.LevelID) {\r\n                defIndex = index;\r\n                break;\r\n            }\r\n        }\r\n        this.awardList.cellCount = this.stdPvpLevelList.length;\r\n        this.awardList.scrollToIndex(defIndex);\r\n    }\r\n\r\n    private updateSeasonAwarCell(cell: Node, cellInfo: CellInfo): void {\r\n        let cellCom: VSSectionAwardItem = cell.getComponent(VSSectionAwardItem) || cell.addComponent(VSSectionAwardItem);\r\n        cellCom.SetData(this.stdPvpLevelList[cellInfo.index]);\r\n    }\r\n}"]}