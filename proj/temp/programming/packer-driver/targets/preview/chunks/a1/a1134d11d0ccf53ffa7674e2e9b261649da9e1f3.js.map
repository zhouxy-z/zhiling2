{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/display/TestSkill.ts"],"names":["EffectTarget","_decorator","CCFloat","Component","find","instantiate","Node","ParticleSystem","Prefab","RenderRoot2D","sp","Sprite","UIMeshRenderer","AffectType","EffectSet","TargetType","Second","ResMgr","ccclass","property","requireComponent","TestSkill","type","tooltip","visible","prefab","undefined","efflist","attacker","eventProxy","hasLoop","lastSet","$targetSet","onLoad","comps","getComponentsInChildren","i","len","length","comp","Skeleton","customMaterial","uuid","depth_material_uuid","getDepthMaterial","node","getComponent","addComponent","on","onTigger","parent","testTargetSet","my","ad","area1","area2","mytag","adtag","push","params","concat","multipleTarget","testEnemys","isLoop","start","GetEffects","Play","attackers","targets","Test","e","skillpool","pop","destroy","queue","skill","copy","loop","addChild","console","log","target","list","set","root","last","times","bind","multipleDelay","sets","Reset","children","hasTigger","forEach","value","lst","nextEffects","shift","k","tigger","tiggerType","all","tiggerAffect","All","error","update","deltaTime","clone","myArea","myDeck","myHand","myDrop","myDel","myEnergy","adArea","adDeck","adHand","adDrop","adDel","adEnergy","constructor","Math","max","min","skillId","route","seed","key","obj","instId","name"],"mappings":"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","sourcesContent":["import { _decorator, CCFloat, Component, find, instantiate, Node, ParticleSystem, Prefab, RenderRoot2D, sp, Sprite, UIMeshRenderer } from 'cc';\r\nimport { AffectType, EffectSet, TargetSet, TargetType } from './EffectSet';\r\nimport { Second } from '../../../utils/Utils';\r\nimport { ResMgr } from '../../../manager/ResMgr';\r\nimport { ISceneEntry } from './SceneCard';\r\nconst { ccclass, property, requireComponent } = _decorator;\r\n\r\n@ccclass('TestSkill')\r\n@requireComponent(RenderRoot2D)\r\nexport class TestSkill extends Component {\r\n\r\n    @property({ type: Prefab, tooltip: \"设置预制体进行多发测试\" })\r\n    prefab: Prefab = undefined;\r\n\r\n    @property({ type: CCFloat, tooltip: \"多发延迟\", visible() { return this.prefab != undefined } })\r\n    multipleDelay: number = 0;\r\n\r\n    @property({ type: [Node], tooltip: \"测试多目标\", visible() { return this.prefab != undefined } })\r\n    multipleTarget: Node[] = [];\r\n\r\n    @property({ tooltip: \"循环测试\" })\r\n    loop = true;\r\n\r\n    protected efflist: EffectSet[];\r\n    protected attacker: Node;\r\n    eventProxy: Node;\r\n\r\n    protected async onLoad() {\r\n\r\n        // 处理2d组件在3d场景的深度渲染问题\r\n        let comps = this.getComponentsInChildren(Component);\r\n        for (let i = 0, len = comps.length; i < len; i++) {\r\n            let comp = comps[i];\r\n            if (comp instanceof sp.Skeleton || comp instanceof Sprite) {\r\n                if (!comp.customMaterial || comp.customMaterial.uuid != ResMgr.depth_material_uuid) {\r\n                    comp.customMaterial = await ResMgr.getDepthMaterial();\r\n                }\r\n                // if(!comp.getComponent(RenderRoot2D))comp.addComponent(RenderRoot2D);\r\n            } else if (comp instanceof ParticleSystem) {\r\n                if (!comp.node.getComponent(UIMeshRenderer)) {\r\n                    comp.node.addComponent(UIMeshRenderer);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.node.on(\"tigger\", this.onTigger, this);\r\n    }\r\n    protected onTigger(...args) {\r\n        if (!this.node.parent) return;\r\n        // this.node.parent.emit(\"tigger\", ...args);\r\n    }\r\n    static testEnemys: Node[];\r\n\r\n    protected hasLoop = false;\r\n    protected lastSet: EffectSet;\r\n    protected $targetSet: EffectTarget;\r\n    protected get testTargetSet() {\r\n        // if (!this.$targetSet || !this.$targetSet.length) {\r\n        const my = [\"FightScene/myDeck\", \"FightScene/myHand\", \"FightScene/myDrop\", \"FightScene/myDel\", \"FightScene/ui/myEnergy\"];\r\n        const ad = [\"FightScene/adDeck\", \"FightScene/adHand\", \"FightScene/adDrop\", \"FightScene/adDel\", \"FightScene/ui/adEnergy\"];\r\n        let area1: Node[] = [find(\"FightScene/area0\")['hitTest1'], find(\"FightScene/area1\")['hitTest1'], find(\"FightScene/area2\")['hitTest1']];\r\n        let area2: Node[] = [find(\"FightScene/area0\")['hitTest2'], find(\"FightScene/area1\")['hitTest2'], find(\"FightScene/area2\")['hitTest2']];\r\n        let mytag: any[] = [area1], adtag: any[] = [area2];\r\n        for (let i = 0; i < my.length; i++) {\r\n            mytag.push(find(my[i]));\r\n            adtag.push(find(ad[i]));\r\n        }\r\n        let params = mytag.concat(adtag);\r\n        if (this.multipleTarget && this.multipleTarget.length) {\r\n            this.$targetSet = new EffectTarget(find(\"attacker\"), this.multipleTarget, ...params);\r\n        } else {\r\n            this.$targetSet = new EffectTarget(find(\"attacker\"), TestSkill.testEnemys.concat(), ...params);\r\n        }\r\n        // }\r\n        return this.$targetSet;\r\n    }\r\n\r\n    get isLoop() {\r\n        return this.hasLoop;\r\n    }\r\n\r\n    start() {\r\n        this.GetEffects();\r\n    }\r\n\r\n    Play(attackers: Node[], targets: Node[]) {\r\n\r\n    }\r\n\r\n    static skillpool: TestSkill[] = [];\r\n    async Test(e?: any) {\r\n        if (e) await Second(0.5);\r\n        while (TestSkill.skillpool.length) {\r\n            TestSkill.skillpool.pop().node.destroy();\r\n        }\r\n        let len = this.testTargetSet.length;\r\n        if (this.prefab && len > 1) {\r\n            let queue: TestSkill[] = [this];\r\n            let parent = this.node.parent;\r\n            for (let i = 0; i < len; i++) {\r\n                let skill = queue.pop();\r\n                let copy = false;\r\n                if (!skill) {\r\n                    copy = true;\r\n                    skill = instantiate(this.prefab).getComponent(TestSkill);\r\n                    TestSkill.skillpool.push(skill);\r\n                    skill.loop = false;\r\n                    parent.addChild(skill.node);\r\n                    console.log(\"instantiate\", skill);\r\n                }\r\n                let target = this.testTargetSet.pop(1);\r\n                let list = skill.GetEffects();\r\n                for (let set of list) {\r\n                    if (set && set.root) {\r\n                        if (set.last) set.times = 1;\r\n                        if (set.last && i == len - 1) {\r\n                            set.Play(this.Test.bind(this), target, 0, copy);\r\n                        } else {\r\n                            set.Play(undefined, target, 0, copy);\r\n                        }\r\n                    }\r\n                }\r\n                if (this.multipleDelay > 0) await Second(this.multipleDelay);\r\n            }\r\n        } else {\r\n            let targets = this.testTargetSet.pop(1);\r\n            this.GetEffects();\r\n            let sets: EffectSet[] = [];\r\n            for (let set of this.efflist) {\r\n                if (set) {\r\n                    set.Reset();\r\n                    if (set.last) set.times = 1;\r\n                    if (set.root) {\r\n                        sets.push(set);\r\n                    }\r\n                }\r\n            }\r\n            for (let set of sets) {\r\n                set.Play(this.Test.bind(this), targets);\r\n            }\r\n        }\r\n    }\r\n\r\n    GetEffects(parent?: Node) {\r\n        if (this.efflist) return this.efflist;\r\n        this.efflist = [];\r\n        let children = this.node.children;\r\n        let hasTigger = false;\r\n        let sets: { [uuid: string]: EffectSet } = {};\r\n        this.lastSet = undefined;\r\n        children.forEach(value => {\r\n            let set: EffectSet = value.getComponent(EffectSet);\r\n            if (parent) set.parent = parent;\r\n            if (set.root) {\r\n                sets[set.node.uuid] = set;\r\n                let lst = set.nextEffects?.concat?.() || [];\r\n                while (lst.length) {\r\n                    set = lst.shift().getComponent(EffectSet);\r\n                    if (set && !sets[set.node.uuid]) {\r\n                        sets[set.node.uuid] = set;\r\n                        if (set?.nextEffects?.length) lst.push(...set.nextEffects);\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        for (let k in sets) {\r\n            let set = sets[k];//child.getComponent(EffectSet);\r\n            if (set) {\r\n                if (set.isLoop) this.hasLoop = true;\r\n                if (set.tigger && set.tiggerType) {\r\n                    hasTigger = true;\r\n                }\r\n                if (!this.lastSet) {\r\n                    this.lastSet = set;\r\n                } else if (!this.lastSet && !set.nextEffects?.length) {\r\n                    this.lastSet = set;\r\n                }\r\n                this.efflist.push(set);\r\n            }\r\n        }\r\n        if (!hasTigger) {\r\n            if (this.lastSet) {\r\n                this.lastSet.tigger = true;\r\n                this.lastSet.tiggerType = TargetType.all;\r\n                this.lastSet.tiggerAffect = AffectType.All;\r\n            } else {\r\n                console.error(\"必须指定结束特效！\");\r\n            }\r\n        }\r\n        // if (!hasTigger && lastSet) {\r\n        //     let node = new Node();\r\n        //     lastSet.node.parent.addChild(node);\r\n        //     let lastSet = node.addComponent(EffectSet);\r\n        //     lastSet.tigger = true;\r\n        //     lastSet.last = true;\r\n        //     if (!lastSet.nextEffects) lastSet.nextEffects = [];\r\n        //     lastSet.nextEffects.push(lastSet.node);\r\n        // }\r\n        return this.efflist;\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * 技能目标定义\r\n */\r\nexport class EffectTarget {\r\n    attacker: Node;\r\n    targets: Node[];\r\n    myArea: Node[];\r\n    myDeck: Node;\r\n    myHand: Node;\r\n    myDrop: Node;\r\n    myDel: Node;\r\n    myEnergy: Node;\r\n    adArea: Node[];\r\n    adDeck: Node;\r\n    adHand: Node;\r\n    adDrop: Node;\r\n    adDel: Node;\r\n    adEnergy: Node;\r\n\r\n    clone() {\r\n        return new EffectTarget(this.attacker, this.targets, this.myArea, this.myDeck, this.myHand, this.myDrop, this.myDel, this.myEnergy, this.adArea, this.adDeck, this.adHand, this.adDrop, this.adDel, this.adEnergy);\r\n    }\r\n\r\n    constructor(attacker?: Node, targets?: Node[], myArea?: Node[], myDeck?: Node, myHand?: Node, myDrop?: Node, myDel?: Node, myEnergy?: Node, adArea?: Node[], adDeck?: Node, adHand?: Node, adDrop?: Node, adDel?: Node, adEnergy?: Node) {\r\n        this.attacker = attacker;\r\n        this.targets = targets;\r\n        this.myArea = myArea;\r\n        this.myDeck = myDeck;\r\n        this.myHand = myHand;\r\n        this.myDrop = myDrop;\r\n        this.myDel = myDel;\r\n        this.myEnergy = myEnergy;\r\n        this.adArea = adArea;\r\n        this.adDeck = adDeck;\r\n        this.adHand = adHand;\r\n        this.adDrop = adDrop;\r\n        this.adDel = adDel;\r\n        this.adEnergy = adEnergy;\r\n    }\r\n\r\n    get length() {\r\n        let len = Math.max(this.targets.length, 0);\r\n        if (len) return len;\r\n        return Math.min(this.myArea.length, this.adArea.length, 1);\r\n    }\r\n\r\n    pop(skillId: number): TargetSet {\r\n        let myArea = this.myArea.length ? this.myArea.shift() : undefined;\r\n        let adArea = this.adArea.length ? this.adArea.shift() : undefined;\r\n        let target = this.targets.length ? this.targets.shift() : undefined;\r\n        return {\r\n            route: this.route(skillId, this.attacker),\r\n            attacker: this.attacker,\r\n            target: <unknown>target as ISceneEntry,\r\n            myArea: myArea,\r\n            myDeck: this.myDeck,\r\n            myHand: this.myHand,\r\n            myDrop: this.myDrop,\r\n            myDel: this.myDel,\r\n            myEnergy: this.myEnergy,\r\n            adArea: adArea,\r\n            adDeck: this.adDeck,\r\n            adHand: this.adHand,\r\n            adDrop: this.adDrop,\r\n            adDel: this.adDel,\r\n            adEnergy: this.adEnergy\r\n        };\r\n    }\r\n    private static seed = 0;\r\n    protected route(...args: any[]) {\r\n        EffectTarget.seed++;\r\n        let key = args[0];\r\n        for (let i = 1; i < args.length; i++) {\r\n            let obj = args[i];\r\n            if (obj != undefined && typeof (obj) == \"object\") {\r\n                key = key + \"_\" + (obj.instId || obj.name);\r\n            } else {\r\n                key = key + \"_\" + obj;\r\n            }\r\n        }\r\n        return key + \"_\" + EffectTarget.seed;\r\n    }\r\n}\r\n"]}