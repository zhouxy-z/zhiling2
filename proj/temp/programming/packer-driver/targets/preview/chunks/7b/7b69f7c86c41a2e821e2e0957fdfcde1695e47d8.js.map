{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/shop/ShopLuckyPage.ts"],"names":["ShopLuckyPage","Input","Label","Layout","Sprite","SpriteFrame","path","AsyncComponent","Req","Route","PlayerData","CfgMgr","ThingType","AutoScroller","ResMgr","BagItem","CostItem","MsgPanel","Session","scroller","bg","awardScroller","titleImg","numLab","btnCont","yetNumLab","oneFree","tenFree","hundredFree","oneCost","tenCost","hundredCost","selectShop","onLoad","node","getChildByPath","getComponent","SetHandle","updateBtn","bind","on","onSelect","updateAwardItem","addComponent","EventType","TOUCH_END","onOne","onTen","onHundred","Show","indexIds","active","hasLoad","loadSub","datas","indexId","content","GetShopByID","stdIndex","GetShopIndexById","shopIndexId","push","UpdateDatas","SelectFirst","getChildByName","Hide","item","data","index","label","string","ShopName","bagItem","setItem","itemType","itemId","count","ID","stdLuck","GetShopLucky","LuckyID","url","join","LuckyBgRes","spriteFrame","LoadResAbSub","stdPool","GetShopLuckyPool","RewardPools","num","rewards","i","Target","length","undefined","RewardType","RewardId","itemNum","RewardNumber","GetNumber","Math","max","lucky","getNumber","doCount","Frequency","LuckyTitleRes","costType","costId","ConsumeX1ItemId","costNum","ConsumeX1Cost","freeX1Count","SetItem","freeX10Count","ConsumeX100Type","updateLayout","frequency","req","convertCount","Send"],"mappings":"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","sourcesContent":["import { Component, Input, Label, Layout, Node, Sprite, SpriteFrame, instantiate, path } from \"cc\";\r\nimport { IPanelPage } from \"../common/IPanelPage\";\r\nimport { AsyncComponent } from \"../common/AsyncComponent\";\r\nimport proto, { Req, Route } from \"../../net/Protocol\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { CfgMgr, ItemType, StdShopIndex, StdShopLuckyPool, ThingType } from \"../../manager/CfgMgr\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\nimport { ItemUtil } from \"../../utils/ItemUtils\";\r\nimport { BagItem } from \"../bag/BagItem\";\r\nimport { ItemTips } from \"../common/ItemTips\";\r\nimport { CostItem } from \"../common/CostItem\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\nimport { Session } from \"../../net/Session\";\r\n\r\n/**将shopitem再次封装，用于动态绑定shopIndexId的语法糖提示 */\r\ninterface IShopItem extends proto.base.IShopItem {\r\n    shopIndexId: number;\r\n}\r\n\r\nexport class ShopLuckyPage extends AsyncComponent implements IPanelPage {\r\n\r\n    protected scroller: AutoScroller;\r\n    protected bg: Sprite;\r\n    protected awardScroller: AutoScroller;\r\n    protected titleImg: Sprite;\r\n    protected numLab: Label;\r\n    protected btnCont: Node;\r\n    protected yetNumLab: Label;\r\n    protected oneFree: Label;\r\n    protected tenFree: Label;\r\n    protected hundredFree: Label;\r\n    protected oneCost: CostItem;\r\n    protected tenCost: CostItem;\r\n    protected hundredCost: CostItem;\r\n\r\n    protected selectShop: proto.base.IShopIndexContent;\r\n\r\n    protected onLoad() {\r\n        this.scroller = this.node.getChildByPath(\"btns\").getComponent(AutoScroller);\r\n        this.scroller.SetHandle(this.updateBtn.bind(this));\r\n        this.scroller.node.on('select', this.onSelect, this);\r\n        this.bg = this.node.getChildByPath(\"bg\").getComponent(Sprite);\r\n        this.awardScroller = this.node.getChildByPath(\"awards\").getComponent(AutoScroller);\r\n        this.awardScroller.SetHandle(this.updateAwardItem.bind(this));\r\n        this.titleImg = this.node.getChildByPath(\"titleImg\").getComponent(Sprite);\r\n        this.numLab = this.node.getChildByPath(\"numLab\").getComponent(Label);\r\n        this.btnCont = this.node.getChildByPath(\"btnCont\");\r\n        this.yetNumLab = this.node.getChildByPath(\"yetNumLab\").getComponent(Label);\r\n        this.oneFree = this.node.getChildByPath(\"btnCont/oneBtn/freeLab\").getComponent(Label);\r\n        this.tenFree = this.node.getChildByPath(\"btnCont/tenBtn/freeLab\").getComponent(Label);\r\n        this.hundredFree = this.node.getChildByPath(\"btnCont/oneHundredBtn/freeLab\").getComponent(Label);\r\n        this.oneCost = this.node.getChildByPath(\"btnCont/oneBtn/costitem\").addComponent(CostItem);\r\n        this.tenCost = this.node.getChildByPath(\"btnCont/tenBtn/costitem\").addComponent(CostItem);\r\n        this.hundredCost = this.node.getChildByPath(\"btnCont/oneHundredBtn/costitem\").addComponent(CostItem);\r\n        this.node.getChildByPath(\"btnCont/oneBtn\").on(Input.EventType.TOUCH_END, this.onOne, this);\r\n        this.node.getChildByPath(\"btnCont/tenBtn\").on(Input.EventType.TOUCH_END, this.onTen, this);\r\n        this.node.getChildByPath(\"btnCont/oneHundredBtn\").on(Input.EventType.TOUCH_END, this.onHundred, this);\r\n        super.onLoad();\r\n    }\r\n\r\n    async Show(indexIds: number[]) {\r\n        this.node.active = true;\r\n        if (!this.hasLoad) await this.loadSub;\r\n        let datas: StdShopIndex[] = [];\r\n        for (let indexId of indexIds) {\r\n            let content = PlayerData.GetShopByID(indexId);\r\n            let stdIndex = CfgMgr.GetShopIndexById(content.shopIndexId);\r\n            datas.push(stdIndex);\r\n        }\r\n        this.scroller.UpdateDatas(datas);\r\n        this.scroller.SelectFirst();\r\n        this.node.getChildByName(\"mask\").active = false;\r\n    }\r\n    Hide(): void {\r\n        this.node.active = false;\r\n    }\r\n\r\n    protected updateBtn(item: Node, data: StdShopIndex, index: number) {\r\n        let label = item.getChildByPath(\"Label\").getComponent(Label);\r\n        label.string = data.ShopName;\r\n    }\r\n\r\n    protected updateAwardItem(item: Node, data: { itemType: number, itemId: number, count: number }) {\r\n        let bagItem: BagItem = item.getChildByName(\"item\").getComponent(BagItem);\r\n        if (!bagItem) bagItem = item.getChildByName(\"item\").addComponent(BagItem);\r\n        bagItem.setItem(data.itemType, data.itemId, data.count);\r\n    }\r\n\r\n    protected async onSelect(index: number, item: Node, data: StdShopIndex) {\r\n        this.selectShop = PlayerData.GetShopByID(data.ID);\r\n        let stdLuck = CfgMgr.GetShopLucky(data.LuckyID);\r\n        let url = path.join(\"sheets/shop\", stdLuck.LuckyBgRes, \"spriteFrame\");\r\n        this.bg.spriteFrame = await ResMgr.LoadResAbSub(url, SpriteFrame);\r\n        let stdPool: StdShopLuckyPool = CfgMgr.GetShopLuckyPool(stdLuck.RewardPools);\r\n        let num: number = 100, rewards = [];\r\n        if (stdPool) {\r\n            for (let i = 0; i < stdPool.Target.length; i++) {\r\n                let index: number = stdPool.Target[i];\r\n                if (index != undefined) {\r\n                    let itemType = stdPool.RewardType[index];\r\n                    let itemId = stdPool.RewardId[index];\r\n                    let itemNum = stdPool.RewardNumber[index];\r\n                    if (itemType == undefined || itemId == undefined || itemNum == undefined) throw \"luckpool表配置错误\";\r\n                    rewards.push({ itemType: itemType, itemId: itemId, count: itemNum });\r\n                }\r\n                // awardList.push(ItemUtil.CreateThing(itemType, itemId, itemNum));\r\n            }\r\n            num = stdPool.GetNumber;\r\n        }\r\n        this.awardScroller.UpdateDatas(rewards);\r\n        this.numLab.string = `${Math.max(num - this.selectShop?.lucky?.getNumber || 0)}`;\r\n        this.yetNumLab.string = `${this.selectShop?.lucky?.doCount || 0}/${stdLuck.Frequency}`;\r\n\r\n        url = path.join(\"sheets/shop\", stdLuck.LuckyTitleRes, \"spriteFrame\");\r\n        this.titleImg.spriteFrame = await ResMgr.LoadResAbSub(url, SpriteFrame);\r\n\r\n        let costType = ThingType.item, costId = stdLuck.ConsumeX1ItemId[0], costNum = stdLuck.ConsumeX1Cost[0];\r\n        // 1次档位状态\r\n        if (this.selectShop.lucky.freeX1Count > 0) {\r\n            this.oneFree.string = \"免费次数:\" + this.selectShop.lucky.freeX1Count;\r\n            this.oneCost.node.active = false;\r\n        } else {\r\n            this.oneFree.string = \"\";\r\n            this.oneCost.node.active = true;\r\n            this.oneCost.SetItem(costType, costId, costNum);\r\n        }\r\n        // 10次档位状态\r\n        if (this.selectShop.lucky.freeX10Count > 0) {\r\n            this.tenFree.string = \"免费次数:\" + this.selectShop.lucky.freeX10Count;\r\n            this.tenCost.node.active = false;\r\n        } else {\r\n            this.tenFree.string = \"\";\r\n            this.tenCost.node.active = true;\r\n            this.tenCost.SetItem(costType, costId, costNum * 10);\r\n        }\r\n        // 100次档位状态\r\n        if (stdLuck.ConsumeX100Type > 0) {\r\n            this.hundredFree.string = \"免费次数:\" + stdLuck.ConsumeX100Type;\r\n            this.hundredCost.node.active = false;\r\n        } else {\r\n            this.hundredCost.node.active = true;\r\n            this.hundredCost.SetItem(costType, costId, costNum * 100);\r\n        }\r\n        this.btnCont.getComponent(Layout).updateLayout();\r\n    }\r\n\r\n    protected onOne() {\r\n        if (!this.selectShop) return MsgPanel.Show(\"商城未开启\");\r\n        if (this.selectShop.lucky.frequency < 0) return MsgPanel.Show(\"抽卡次数不足\");\r\n        let req = new Req[\"shop.protocol.dolucky\"]();\r\n        req.shopIndexId = this.selectShop.shopIndexId;\r\n        req.count = 1;\r\n        req.convertCount = 0;\r\n        this.node.getChildByName(\"mask\").active = false;\r\n        Session.Send(Route[\"shop.protocol.dolucky\"], req);\r\n    }\r\n    protected onTen() {\r\n        if (!this.selectShop) return MsgPanel.Show(\"商城未开启\");\r\n        if (this.selectShop.lucky.frequency < 0) return MsgPanel.Show(\"抽卡次数不足\");\r\n        let req = new Req[\"shop.protocol.dolucky\"]();\r\n        req.shopIndexId = this.selectShop.shopIndexId;\r\n        req.count = 10;\r\n        req.convertCount = 0;\r\n        this.node.getChildByName(\"mask\").active = false;\r\n        Session.Send(Route[\"shop.protocol.dolucky\"], req);\r\n    }\r\n    protected onHundred() {\r\n        if (!this.selectShop) return MsgPanel.Show(\"商城未开启\");\r\n        if (this.selectShop.lucky.frequency < 0) return MsgPanel.Show(\"抽卡次数不足\");\r\n        let req = new Req[\"shop.protocol.dolucky\"]();\r\n        req.shopIndexId = this.selectShop.shopIndexId;\r\n        req.count = 100;\r\n        req.convertCount = 0;\r\n        this.node.getChildByName(\"mask\").active = false;\r\n        Session.Send(Route[\"shop.protocol.dolucky\"], req);\r\n    }\r\n}"]}