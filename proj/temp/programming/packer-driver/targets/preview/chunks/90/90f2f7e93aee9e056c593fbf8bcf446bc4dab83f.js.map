{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_CardTerrainState.ts"],"names":["Out_CardTerrainState","BattleBaseComp","battleDataMgr","BattleRoundOperationState","start","data","card","curRoundRevealPlayerId","scene","FlushRevealPlayer","isPlayerA","FlushRoundBtnStrState","PlaceRound","FlushRound","round","roomData","roundMax","finalValue","ShowCard","isExit","playerId","terrainData","getPlayerTerrainFormIdx","area","addPower","power","cardMul","oldPower","getPlayerTerrainTotalPow","FlushAreaPower","exit","console","error","reset","EndRound"],"mappings":";;;wFAQaA,oB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAPJC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,yB,iBAAAA,yB;;;;;;;AAET;AACA;AACA;sCACaH,oB,GAAN,MAAMA,oBAAN;AAAA;AAAA,4CAAmG;AAEtFI,QAAAA,KAAK,GAAkB;AAAA;;AAAA;AACnC,gBAAI,KAAI,CAACC,IAAL,IAAa,KAAI,CAACA,IAAL,CAAUC,IAA3B,EAAiC;AAC7B,kBAAI;AAAA;AAAA,kDAAcC,sBAAd,IAAwC,EAA5C,EAAgD;AAC5C,gBAAA,KAAI,CAACC,KAAL,CAAWC,iBAAX,CAA6B;AAAA;AAAA,oDAAcC,SAAd,CAAwB;AAAA;AAAA,oDAAcH,sBAAtC,CAA7B;AACH;;AAED,cAAA,KAAI,CAACC,KAAL,CAAWG,qBAAX,CAAiC;AAAA;AAAA,0EAA0BC,UAA3D;;AACA,cAAA,KAAI,CAACJ,KAAL,CAAWK,UAAX,CAAsB,KAAI,CAACC,KAA3B,EAAkC;AAAA;AAAA,kDAAcC,QAAd,CAAuBC,QAAvB,CAAgCC,UAAlE;;AACA,oBAAM,KAAI,CAACT,KAAL,CAAWU,QAAX,CAAoB,KAAI,CAACb,IAAL,CAAUC,IAA9B,CAAN;AACA,kBAAI,KAAI,CAACa,MAAT,EAAiB,OARY,CAS7B;;AACA,kBAAIC,QAAgB,GAAG,KAAI,CAACf,IAAL,CAAUC,IAAV,CAAec,QAAtC;AACA,kBAAIC,WAAoD,GAAG;AAAA;AAAA,kDAAcC,uBAAd,CAAsCF,QAAtC,EAAgD,KAAI,CAACf,IAAL,CAAUC,IAAV,CAAeiB,IAA/D,CAA3D;AACA,kBAAIC,QAAgB,GAAG,KAAI,CAACnB,IAAL,CAAUC,IAAV,CAAemB,KAAf,GAAuB,KAAI,CAACpB,IAAL,CAAUC,IAAV,CAAemB,KAAf,CAAqBR,UAArB,GAAkCI,WAAW,CAACK,OAAZ,CAAoBT,UAA7E,GAAyF,CAAhH,CAZ6B,CAYqF;;AAClH,kBAAIU,QAAgB,GAAG;AAAA;AAAA,kDAAcC,wBAAd,CAAuCR,QAAvC,EAAiD,KAAI,CAACf,IAAL,CAAUC,IAAV,CAAeiB,IAAhE,CAAvB,CAb6B,CAagE;;AAC7F,cAAA,KAAI,CAACf,KAAL,CAAWqB,cAAX,CAA0B;AAAA;AAAA,kDAAcnB,SAAd,CAAwBU,QAAxB,CAA1B,EAA6D,KAAI,CAACf,IAAL,CAAUC,IAAV,CAAeiB,IAA5E,EAAkFI,QAAQ,GAAGH,QAA7F;;AACA,cAAA,KAAI,CAACM,IAAL;AACH,aAhBD,MAgBO;AACHC,cAAAA,OAAO,CAACC,KAAR,CAAc,gBAAd;;AACA,cAAA,KAAI,CAACF,IAAL;AACH;AApBkC;AAqBtC;;AAESG,QAAAA,KAAK,GAAS;AACpB;AAAA;AAAA,8CAAc1B,sBAAd,GAAuC,EAAvC;AACA,eAAKC,KAAL,CAAWC,iBAAX,CAA6B,IAA7B;AACA,eAAKD,KAAL,CAAWG,qBAAX,CAAiC;AAAA;AAAA,sEAA0BuB,QAA3D;AACH;;AA7BqG,O","sourcesContent":["import proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\nimport { BattleRoundOperationState } from \"../../player/PlayerStruct\";\r\n\r\n/**\r\n * 卡牌在地形上的状态改变（由盖牌到显示）\r\n */\r\nexport class Out_CardTerrainState extends BattleBaseComp<proto.base.IBattleRoomOpOutput_CardTerrainState> {\r\n\r\n    protected async start(): Promise<void> {\r\n        if (this.data && this.data.card) {\r\n            if (battleDataMgr.curRoundRevealPlayerId != \"\") {\r\n                this.scene.FlushRevealPlayer(battleDataMgr.isPlayerA(battleDataMgr.curRoundRevealPlayerId));\r\n            }\r\n\r\n            this.scene.FlushRoundBtnStrState(BattleRoundOperationState.PlaceRound);\r\n            this.scene.FlushRound(this.round, battleDataMgr.roomData.roundMax.finalValue);\r\n            await this.scene.ShowCard(this.data.card);\r\n            if (this.isExit) return;\r\n            // await Second(2)\r\n            let playerId: string = this.data.card.playerId;\r\n            let terrainData: proto.base.IBattleRoomTerrainPlayerData = battleDataMgr.getPlayerTerrainFormIdx(playerId, this.data.card.area);\r\n            let addPower: number = this.data.card.power ? this.data.card.power.finalValue * terrainData.cardMul.finalValue: 0;//增加战力\r\n            let oldPower: number = battleDataMgr.getPlayerTerrainTotalPow(playerId, this.data.card.area);//旧战力\r\n            this.scene.FlushAreaPower(battleDataMgr.isPlayerA(playerId), this.data.card.area, oldPower + addPower);\r\n            this.exit();\r\n        } else {\r\n            console.error(\"卡牌在地形上改变状态数据为空\");\r\n            this.exit();\r\n        }\r\n    }\r\n\r\n    protected reset(): void {\r\n        battleDataMgr.curRoundRevealPlayerId = \"\";\r\n        this.scene.FlushRevealPlayer(null);\r\n        this.scene.FlushRoundBtnStrState(BattleRoundOperationState.EndRound);\r\n    }\r\n}"]}