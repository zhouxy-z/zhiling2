{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_AddCard.ts"],"names":["Out_AddCard","proto","BattleBaseComp","battleDataMgr","start","scene","AddCard","isPlayerA","data","card","playerId","isExit","formCard","sourcePlayerId","getPlayerCard","instId","sourceLocation","base","BattleRoomCardLocation","Terrain","isMove","fromCardPower","getPlayerCardPower","fromTerrainData","getPlayerTerrainFormIdx","area","offsetPower","cardMul","finalValue","fromTotalPower","getPlayerTerrainTotalPow","FlushAreaPower","location","toTerrainData","toTotalPower","addCardPower","power","exit","reset"],"mappings":"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","sourcesContent":["\r\nimport proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\n\r\n/**\r\n * 从场上数据选择来源卡牌数据\r\n */\r\nexport class Out_AddCard extends BattleBaseComp<proto.base.IBattleRoomOpOutput_AddCard> {\r\n    protected async start(): Promise<void> {\r\n        await this.scene.AddCard(battleDataMgr.isPlayerA(this.data.card.playerId), this.data);\r\n        if (this.isExit) return;\r\n        let formCard: proto.base.IBattleRoomCardData;\r\n        //来源卡可能是来自系统\r\n        if (this.data.sourcePlayerId != \"\") formCard  = battleDataMgr.getPlayerCard(this.data.sourcePlayerId, this.data.card.instId);\r\n        //此卡如果来自场地则减掉此卡的战力\r\n        if (formCard && this.data.sourceLocation && this.data.sourceLocation == proto.base.BattleRoomCardLocation.Terrain) {\r\n            if (this.data.isMove) {\r\n                //减掉移动来源的卡牌战力\r\n                let fromCardPower: number = battleDataMgr.getPlayerCardPower(this.data.sourcePlayerId, this.data.card.instId);\r\n                let fromTerrainData: proto.base.IBattleRoomTerrainPlayerData = battleDataMgr.getPlayerTerrainFormIdx(this.data.sourcePlayerId, formCard.area);\r\n                let offsetPower: number = fromTerrainData.cardMul.finalValue * fromCardPower;\r\n                let fromTotalPower = battleDataMgr.getPlayerTerrainTotalPow(this.data.sourcePlayerId, formCard.area);\r\n                this.scene.FlushAreaPower(battleDataMgr.isPlayerA(this.data.sourcePlayerId), formCard.area, fromTotalPower - offsetPower);\r\n            }\r\n            \r\n        }\r\n        if (this.data.card.location == proto.base.BattleRoomCardLocation.Terrain) {\r\n            //增加目的区域的战力\r\n            let toTerrainData: proto.base.IBattleRoomTerrainPlayerData = battleDataMgr.getPlayerTerrainFormIdx(this.data.card.playerId, this.data.card.area);\r\n            let toTotalPower: number = battleDataMgr.getPlayerTerrainTotalPow(this.data.card.playerId, this.data.card.area);\r\n            let addCardPower: number = this.data.card.power ? this.data.card.power.finalValue * toTerrainData.cardMul.finalValue : 0;\r\n            this.scene.FlushAreaPower(battleDataMgr.isPlayerA(this.data.card.playerId), this.data.card.area, toTotalPower + addCardPower);\r\n        }\r\n    \r\n        \r\n\r\n\r\n        this.exit();\r\n    }\r\n\r\n    protected reset(): void {\r\n        \r\n    }   \r\n}"]}