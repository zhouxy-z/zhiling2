{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_RetransmissionRound.ts"],"names":["Out_RetransmissionRound","Battle_UpdateTerrain","EventMgr","BattleBaseComp","battleDataMgr","FightData","start","setRoomData","isExit","currentRound","curRound","scene","FlushRound","round","roomData","roundMax","finalValue","exit","reset","onUpdate","dt","playerData","isPlayerA","key","data","gamePlayData","players","terrainMax","playerId","FlushPlayerInfo","totalPower","areaIdx","cardData","terrain","FlushAreaCrads","getPlayerTerrainTotalPow","FlushAreaPower","setHandCard","handCards","curEnergy","roundEnergy","FlushEnergy","FlushTerrain","ownerPlayerId","emit","terrains","cards","FlushHandCard"],"mappings":"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","sourcesContent":["import { Battle_End_Round, Battle_PlayNewRoundEffect, Battle_UpdateTerrain, EventMgr } from \"../../../manager/EventMgr\";\r\nimport proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\nimport { FightData } from \"../FightData\";\r\n\r\n/**\r\n * 重置战斗房间数据\r\n */\r\nexport class Out_RetransmissionRound extends BattleBaseComp<proto.base.IBattleRoomOpOutput_NewRound> {\r\n    protected async start() {\r\n        await this.setRoomData();\r\n        if (this.isExit) return;\r\n        FightData.currentRound = battleDataMgr.curRound;\r\n        this.scene.FlushRound(this.round, battleDataMgr.roomData.roundMax.finalValue);\r\n        this.exit();\r\n    }\r\n\r\n    protected reset(): void {\r\n        \r\n    }\r\n\r\n    protected onUpdate(dt: number): void {\r\n        \r\n    }\r\n    /**\r\n     * 初始化房间数据\r\n     */\r\n    private async setRoomData() {\r\n\r\n        // 刷新场景手牌和卡牌\r\n        let playerData: proto.base.IBattleRoomPlayerData;\r\n        let isPlayerA: boolean;\r\n        for (let key in this.data.gamePlayData.players) {\r\n            playerData = this.data.gamePlayData.players[key];\r\n\r\n            let terrainMax = battleDataMgr.roomData.terrainMax;\r\n            isPlayerA = battleDataMgr.isPlayerA(playerData.playerId);\r\n            this.scene.FlushPlayerInfo(isPlayerA, playerData);\r\n            let totalPower: number;\r\n            for (let areaIdx = 0; areaIdx < terrainMax; areaIdx++) {\r\n                let cardData: proto.base.IBattleRoomTerrainPlayerData = playerData.terrain[areaIdx]\r\n                await this.scene.FlushAreaCrads(isPlayerA, areaIdx, cardData);\r\n                if (this.isExit) return;\r\n                totalPower = battleDataMgr.getPlayerTerrainTotalPow(playerData.playerId, areaIdx);\r\n                this.scene.FlushAreaPower(isPlayerA, areaIdx, totalPower);\r\n            }\r\n\r\n            if (isPlayerA) {\r\n                await this.setHandCard(playerData.handCards);\r\n                if (this.isExit) return;\r\n                let curEnergy: number = playerData.roundEnergy[this.round - 1]?.finalValue;\r\n                this.scene.FlushEnergy(curEnergy);\r\n            }\r\n        }\r\n\r\n        // 初始场景区域\r\n        await this.scene.FlushTerrain(true, this.data.gamePlayData, this.ownerPlayerId);\r\n        if (this.isExit) return;\r\n        EventMgr.emit(Battle_UpdateTerrain, this.data.gamePlayData.terrains, this.data.gamePlayData);\r\n    }\r\n\r\n    /**\r\n     * 设置手卡数据\r\n     */\r\n    private async setHandCard(cards: proto.base.IBattleRoomCardData[]) {\r\n        await this.scene.FlushHandCard(cards);\r\n        \r\n    }\r\n\r\n}"]}