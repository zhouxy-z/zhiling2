{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/resources/bag/OpenBoxPanel.ts"],"names":["OpenBoxPanel","Input","Label","Sprite","SpriteFrame","UITransform","Slider","path","Button","PageView","instantiate","Panel","PlayerData","BoxType","CardQuality","CfgMgr","ResMgr","folder_icon","folder_item","MsgTypeSend","Session","OpenBoxPage","EventMgr","Evt_GetReward","Evt_Item_Change","Evt_OpenBoxGetRewardPanel","Tips","ItemUtil","prefab","iocnBg","icon","itemName","item_num","lbl_tips","consumeNum","hasNum","progress","btn_right","btn_left","okBtn","openBoxItem","page1","itemData","BoxData","curSelectCount","maxItemcount","selectItem","curPageNum","datas","maxPageNum","onLoad","CloseBy","find","on","EventType","TOUCH_END","Hide","node","onOk","onAdd","onDel","onBtnRight","onBtnLeft","onSlide","onShow","ItemChange","resetData","updateBtnState","flush","string","ItemName","count","GetItemCount","Items","active","GetBoxData","Limit","icon_url","join","Icon","spriteFrame","LoadResAbSub","icon_bg_url","Quality","is_select","Boxtype","select","enabled","getComponent","grayscale","str","RewardNum","rewardDataType","Types","rewardData","rewardDataNum","ItemsNum","rewardCount","length","page_num","Math","floor","index","pageData","i","type","id","num","GetRewardRoleById","RoleType","awardList","CreateThing","push","removeAllPages","k","item","itemNode","addComponent","SetData","getSelect","bind","addPage","updateProgress","getRoleReward","cfg","Get","element","RewardID","setCurrentPageIndex","getPages","setSelectNum","onHide","undefined","off","update","dt","size","contentSize","setContentSize","width","e","max","ceil","setItemData","cur","getCurrentPageIndex","data","isClick","Show","Text","lbl","RoleName","GetText","name","callBack","random","OpenBoxRequest","item_id","ItemID","selected_items","Send"],"mappings":"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","sourcesContent":["import { Input, Label, Node, Sprite, SpriteFrame, UITransform, Slider, path, Button, tween, v3, PageView, instantiate, Layout } from \"cc\";\r\nimport { Panel } from \"../../GameRoot\";\r\nimport PlayerData from \"../roleModule/PlayerData\";\r\nimport { BoxType, CardQuality, CfgMgr, RewardBox, StdItem } from \"../../manager/CfgMgr\";\r\nimport { ResMgr, folder_icon, folder_item } from \"../../manager/ResMgr\";\r\nimport { MsgTypeSend } from \"../../MsgType\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { OpenBoxPage } from \"./OpenBoxPage\";\r\nimport { EventMgr, Evt_GetReward, Evt_Item_Change, Evt_OpenBoxGetRewardPanel } from \"../../manager/EventMgr\";\r\nimport { Tips } from \"../login/Tips\";\r\nimport { ItemUtil } from \"../../utils/ItemUtils\";\r\n\r\nexport class OpenBoxPanel extends Panel {\r\n    protected prefab: string = \"prefabs/panel/bag/OpenBoxPanel\";\r\n    private iocnBg: Sprite;\r\n    private icon: Sprite;\r\n    private itemName: Label;\r\n    private item_num: Label;\r\n    private lbl_tips: Label;\r\n    private consumeNum: Label;\r\n    private hasNum: Label;\r\n    private Slider: Slider;\r\n    private progress: Node;\r\n    private btn_right: Button;\r\n    private btn_left: Button;\r\n    private okBtn: Button;\r\n    private PageView: PageView;\r\n    private openBoxItem: Node;\r\n    private page1: Node;\r\n\r\n    private itemData: StdItem;\r\n    private BoxData: RewardBox;\r\n\r\n    private curSelectCount = 1;\r\n    private maxItemcount: number;\r\n    private selectItem: number[];\r\n    private curPageNum: number = 0;\r\n    private datas = []\r\n    private maxPageNum: number = 0;\r\n\r\n    protected onLoad(): void {\r\n        this.CloseBy(\"mask\");\r\n        this.find(\"panel/closeBtn\").on(Input.EventType.TOUCH_END, this.Hide, this);\r\n        this.okBtn = this.find(\"panel/okBtn\", Button);\r\n        this.okBtn.node.on(\"click\", this.onOk, this);\r\n        this.iocnBg = this.find(\"panel/iocnBg\", Sprite);\r\n        this.icon = this.find(\"panel/iocnBg/icon\", Sprite);\r\n        this.itemName = this.find(\"panel/itemName\", Label);\r\n        this.item_num = this.find(\"panel/item_num\", Label);\r\n        this.lbl_tips = this.find(\"panel/lbl_tips\", Label);\r\n        this.page1 = this.find(\"panel/page1\");\r\n        this.consumeNum = this.find(\"panel/page1/consumeNum\", Label);\r\n        this.hasNum = this.find(\"panel/page1/hasNum\", Label);\r\n        this.Slider = this.find(\"panel/page1/Slider\", Slider);\r\n        this.progress = this.find(\"panel/page1/Slider/progress\");\r\n        this.btn_right = this.find(\"panel/btn_right\", Button);\r\n        this.btn_left = this.find(\"panel/btn_left\", Button);\r\n       \r\n       \r\n    \r\n        this.PageView = this.find(\"panel/PageView\", PageView)\r\n        this.openBoxItem = this.find(\"panel/PageView/view/content/OpenBoxItem\")\r\n        this.find(\"panel/page1/right\").on(Input.EventType.TOUCH_END, this.onAdd, this);\r\n        this.find(\"panel/page1/left\").on(Input.EventType.TOUCH_END, this.onDel, this);\r\n        this.btn_right.node.on(\"click\", this.onBtnRight, this)\r\n        this.btn_left.node.on(\"click\", this.onBtnLeft, this)\r\n        this.Slider.node.on('slide', this.onSlide, this);\r\n        // EventMgr.on(Evt_Item_Change, this.onItemChange, this);\r\n        // EventMgr.on(Evt_GetReward, this.resetData, this);\r\n        // EventMgr.on(Evt_OpenBoxGetRewardPanel, this.updateBtnState, this);\r\n    }\r\n\r\n    protected onShow(): void {\r\n        EventMgr.on(Evt_Item_Change, this.ItemChange, this);\r\n        EventMgr.on(Evt_GetReward, this.resetData, this);\r\n        EventMgr.on(Evt_OpenBoxGetRewardPanel, this.updateBtnState, this);\r\n    }\r\n\r\n    async flush(...args: any[]) {\r\n        this.itemData = args[0];\r\n        // this.itemData = CfgMgr.Getitem(1202)\r\n        if (!this.itemData) return;\r\n        this.itemName.string = this.itemData.ItemName;\r\n        let count = PlayerData.GetItemCount(this.itemData.Items);\r\n        this.page1.active = true;\r\n        if (count <= 1) {\r\n            this.page1.active = false;\r\n        }\r\n        this.item_num.string = \"\" + count;\r\n        this.BoxData = CfgMgr.GetBoxData(this.itemData.Items);\r\n\r\n        this.maxItemcount = count > this.BoxData.Limit ? this.BoxData.Limit : count;\r\n        this.hasNum.string = \"/\" + this.maxItemcount;\r\n        let icon_url = path.join(folder_item, this.itemData.Icon, \"spriteFrame\");\r\n        this.icon.spriteFrame = await ResMgr.LoadResAbSub(icon_url, SpriteFrame);\r\n        let icon_bg_url = path.join(folder_icon, \"quality\", CardQuality[this.itemData.Quality] + \"_bag_bg\", \"spriteFrame\");\r\n        this.iocnBg.spriteFrame = await ResMgr.LoadResAbSub(icon_bg_url, SpriteFrame);\r\n\r\n        \r\n        // this.BoxData = CfgMgr.GetBoxData(1200);\r\n        let is_select = this.BoxData.Boxtype == BoxType.select\r\n        this.okBtn.enabled = !is_select;\r\n        this.okBtn.node.getComponent(Sprite).grayscale = is_select;\r\n        let str = [\"可随机获得以下道具\" , \"选择获得以下道具0/\", \"可获得以下道具\"]\r\n        this.lbl_tips.string = is_select ? str[this.BoxData.Boxtype - 1] + this.BoxData.RewardNum : str[this.BoxData.Boxtype - 1];\r\n        let rewardDataType = this.BoxData.Types;\r\n        let rewardData = this.BoxData.Items;\r\n        let rewardDataNum = this.BoxData.ItemsNum;\r\n        let rewardCount = this.BoxData.Items.length < 8 ? this.BoxData.Items.length : 8;\r\n\r\n        let page_num = Math.floor(rewardData.length / 8) + (rewardData.length % 8 == 0 ? 0 : 1);\r\n\r\n        this.maxPageNum = page_num;\r\n        this.datas = [];\r\n        for (let index = 0; index < page_num; index++) {\r\n            let pageData = [];\r\n            for (let i = 0; i < rewardCount; i++) {\r\n                let type = rewardDataType[i + (index * rewardCount)]\r\n                let id = rewardData[i + (index * rewardCount)];\r\n                let num = rewardDataNum[i + (index * rewardCount)]\r\n                if (!num) {\r\n                    break;\r\n                }\r\n                if(type == 5){\r\n                  id = CfgMgr.GetRewardRoleById(id).RoleType;\r\n                }\r\n                let awardList = ItemUtil.CreateThing(type, id, num);\r\n                pageData.push(awardList)\r\n            }\r\n            this.datas.push(pageData);\r\n        }\r\n\r\n        this.PageView.removeAllPages();\r\n        for (let k = 0; k < page_num; k++) {\r\n            let item = instantiate(this.openBoxItem)\r\n            let itemNode = item.getComponent(OpenBoxPage);\r\n            if (!itemNode) itemNode = item.addComponent(OpenBoxPage);\r\n            itemNode.SetData(this.datas[k], this.curSelectCount, this.BoxData.RewardNum, is_select, this.getSelect.bind(this))\r\n            this.PageView.addPage(item)\r\n        }\r\n        this.updateProgress();\r\n    }\r\n\r\n    private getRoleReward(type:number){\r\n        let cfg = CfgMgr.Get(\"RewardRole\");\r\n        for (let index = 0; index < cfg.length; index++) {\r\n            const element = cfg[index];\r\n            if(type == element.RewardID){\r\n                return element.RoleType;\r\n            } \r\n        }\r\n        return null;\r\n    }\r\n\r\n    private ItemChange() {\r\n        let count = PlayerData.GetItemCount(this.itemData.Items);\r\n        this.item_num.string = \"\" + count;\r\n        this.maxItemcount = count > this.BoxData.Limit ? this.BoxData.Limit : count;;\r\n        this.hasNum.string = \"/\" + this.maxItemcount;\r\n    }\r\n\r\n    private resetData() {\r\n        if (this.maxItemcount <= 0) {\r\n            this.Hide();\r\n            return;\r\n        }\r\n        if (this.maxItemcount <= 1) {\r\n            this.page1.active = false;\r\n        }\r\n        this.curSelectCount = 1;\r\n        this.curPageNum = 0;\r\n        if (this.BoxData.Boxtype == BoxType.select) {\r\n            this.selectItem = [];\r\n            this.lbl_tips.string = \"选择获得以下道具\" + this.selectItem.length + \"/\" + this.BoxData.RewardNum;\r\n            this.PageView.setCurrentPageIndex(this.curPageNum);\r\n            let item = this.PageView.getPages()[this.curPageNum].getComponent(OpenBoxPage)\r\n            item.SetData(this.datas[this.curPageNum], this.curSelectCount, this.BoxData.RewardNum, this.BoxData.Boxtype == BoxType.select, this.getSelect.bind(this))\r\n            this.okBtn.enabled = false;\r\n            this.okBtn.node.getComponent(Sprite).grayscale = true;\r\n        }\r\n        this.updateProgress();\r\n    }\r\n\r\n    private updateProgress() {\r\n        this.Slider.progress = this.curSelectCount / this.maxItemcount;\r\n        this.consumeNum.string = this.curSelectCount + \"\";\r\n        let item = this.PageView.getPages()[this.curPageNum].getComponent(OpenBoxPage)\r\n        item.setSelectNum(this.curSelectCount, this.BoxData.Boxtype == BoxType.select)\r\n    }\r\n\r\n    private updateBtnState(){\r\n        this.okBtn.enabled = true;\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n        this.curSelectCount = 1;\r\n        this.curPageNum = 0;\r\n        this.selectItem = undefined;\r\n        this.PageView.removeAllPages();\r\n        EventMgr.off(Evt_Item_Change, this.ItemChange, this);\r\n        EventMgr.off(Evt_GetReward, this.resetData, this);\r\n        EventMgr.off(Evt_OpenBoxGetRewardPanel, this.updateBtnState, this);\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        let size = this.Slider.node.getComponent(UITransform).contentSize;\r\n        this.progress.getComponent(UITransform).setContentSize(this.Slider.progress * size.width, 28);\r\n    }\r\n\r\n    private onAdd(e?: any) {\r\n        if (this.curSelectCount >= this.maxItemcount) return;\r\n        this.curSelectCount++;\r\n        //超出拥有数量\r\n        if (this.curSelectCount > this.maxItemcount) {\r\n            this.curSelectCount = this.maxItemcount\r\n        }\r\n        this.updateProgress();\r\n    }\r\n\r\n    private onDel(e?: any) {\r\n        if (this.curSelectCount < 1) return;\r\n        this.curSelectCount--;\r\n        if (this.curSelectCount < 1) {\r\n            this.curSelectCount = 1;\r\n        }\r\n        this.updateProgress();\r\n    }\r\n\r\n    private onSlide(e?: Slider) {\r\n        this.curSelectCount = Math.max(Math.ceil(this.maxItemcount * this.Slider.progress), 1);\r\n        this.updateProgress();\r\n    }\r\n\r\n\r\n    private onBtnRight() {\r\n        this.curPageNum++;\r\n        if (this.curPageNum >= this.maxPageNum) {\r\n            this.curPageNum = this.maxPageNum - 1;\r\n            return;\r\n        }\r\n        this.setItemData();\r\n    }\r\n\r\n    private onBtnLeft() {\r\n        this.curPageNum--;\r\n        if (this.curPageNum < 0) {\r\n            this.curPageNum = 0;\r\n            return;\r\n        }\r\n        this.setItemData();\r\n    }\r\n\r\n    private setItemData() {\r\n        this.PageView.setCurrentPageIndex(this.curPageNum);\r\n        let cur = this.PageView.getCurrentPageIndex();\r\n        let item = this.PageView.getPages()[cur].getComponent(OpenBoxPage)\r\n        item.SetData(this.datas[cur], this.curSelectCount, this.BoxData.RewardNum, this.BoxData.Boxtype == BoxType.select, this.getSelect.bind(this))\r\n    }\r\n\r\n    private getSelect(data: number[]) {\r\n        this.selectItem = data\r\n        this.lbl_tips.string = \"选择获得以下道具\" + data.length + \"/\" + this.BoxData.RewardNum;\r\n        let isClick = data.length == this.BoxData.RewardNum;\r\n        this.okBtn.enabled = isClick\r\n        this.okBtn.node.getComponent(Sprite).grayscale = !isClick;\r\n    }\r\n\r\n    protected onOk() {\r\n        if (this.BoxData.Boxtype == BoxType.select && (!this.selectItem || this.selectItem.length < this.BoxData.RewardNum)) {\r\n            Tips.Show(\"请选择道具\")\r\n            return;\r\n        }\r\n        if(this.curSelectCount >= 2 && this.BoxData.Text && this.BoxData.Text != \"\"){\r\n            let id = this.BoxData.Items[this.selectItem[0]]\r\n            let lbl = CfgMgr.GetRewardRoleById(id).RoleName\r\n            let str = CfgMgr.GetText(this.BoxData.Text, {name: lbl})\r\n            Tips.Show(str, this.callBack.bind(this))\r\n        }else{\r\n            this.callBack();\r\n        }\r\n    }\r\n\r\n    private callBack(){\r\n        if (this.BoxData.Boxtype == BoxType.random) {\r\n            let data = {\r\n                type: MsgTypeSend.OpenBoxRequest,\r\n                data: {\r\n                    item_id: this.BoxData.ItemID,\r\n                    count: this.curSelectCount,\r\n                    selected_items: [],\r\n                }\r\n            }\r\n            Session.Send(data)\r\n        } else if(this.BoxData.Boxtype == BoxType.select) {\r\n            let data = {\r\n                type: MsgTypeSend.OpenBoxRequest,\r\n                data: {\r\n                    item_id: this.BoxData.ItemID,\r\n                    count: this.curSelectCount,\r\n                    selected_items: this.selectItem,\r\n                }\r\n            }\r\n            Session.Send(data)\r\n        }else{\r\n            let data = {\r\n                type: MsgTypeSend.OpenBoxRequest,\r\n                data: {\r\n                    item_id: this.BoxData.ItemID,\r\n                    count: this.curSelectCount,\r\n                }\r\n            }\r\n            Session.Send(data)\r\n        }\r\n        this.okBtn.enabled = false;\r\n    }\r\n\r\n\r\n\r\n\r\n}"]}