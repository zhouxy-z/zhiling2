{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/manager/ConditionMgr.ts"],"names":["ConditionMgr","find","PlayerData","LocalStorage","EventMgr","battleDataMgr","init","AddChan","Check","ConditionId","values","undefined","length","Condition","Lock","HasCard","cards","GetCardDataByCfgId","quality","count","card","Collect","Level","player","level","Item","GetItemCount","Guide","GetNumber","UI","String","target","toString","activeInHierarchy","UNUI","target1","Round","roomData","curRound","Number"],"mappings":"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","sourcesContent":["import { find } from \"cc\";\r\nimport { PlayerData } from \"../module/player/PlayerData\";\r\nimport LocalStorage from \"../utils/LocalStorage\";\r\nimport { EventMgr } from \"./EventMgr\";\r\nimport { battleDataMgr } from \"../module/battle/BattleDataMgr\";\r\n\r\nexport class ConditionMgr {\r\n\r\n    static init() {\r\n        EventMgr.AddChan('condition_check', this.Check, this);\r\n    }\r\n\r\n    /**\r\n     * 检测条件\r\n     * @param ConditionId \r\n     * @param values \r\n     * @returns \r\n     */\r\n    static Check(ConditionId: number, ...values: any[]) {\r\n        if (ConditionId == undefined || !values?.length) return false;\r\n        switch (ConditionId) {\r\n            case Condition.Lock:\r\n                return \"未开放\";\r\n\r\n            case Condition.HasCard:// 判断是否有指定品质的卡\r\n                let cards = PlayerData.GetCardDataByCfgId(values[0])\r\n                if (cards?.length) {\r\n                    let quality = values[1] || 0, count = values[2] || 1;\r\n                    for (let card of cards) {\r\n                        if (card && (!quality || card.quality >= quality)) {\r\n                            count--;\r\n                        }\r\n                    }\r\n                    return count <= 0;\r\n                }\r\n                return false;\r\n\r\n            case Condition.Collect:\r\n                break;\r\n\r\n            case Condition.Level:\r\n                if (PlayerData.player.level < values[0]) return false;\r\n                break;\r\n\r\n            case Condition.Item:\r\n                if (PlayerData.GetItemCount(values[0]) < (values[1] || 1)) return false;\r\n                break;\r\n\r\n            case Condition.Guide:\r\n                if (!LocalStorage.GetNumber(\"guide\" + values[0], 0)) return false;\r\n                break;\r\n\r\n            case Condition.UI:\r\n                if (!values[0] || !String(values[0])) return false;\r\n                let target = find(values[0].toString());\r\n                if (!target || !target.activeInHierarchy) return false;\r\n                break;\r\n\r\n            case Condition.UNUI:\r\n                if (!values[0] || !String(values[0])) return false;\r\n                let target1 = find(values[0].toString());\r\n                if (target1 && target1.activeInHierarchy) return false;\r\n                break;\r\n\r\n            case Condition.Round:\r\n                if (!battleDataMgr.roomData || battleDataMgr.curRound != Number(values[0])) return false;\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\n/**\r\n * 条件枚举\r\n */\r\nexport enum Condition {\r\n    Lock,             //不可用\r\n    HasCard,          //是否拥有指定卡，如果配置的value为数组，value:[卡id，品质不小于的值，卡数量(不填默认0)]\r\n    Collect,          //收藏星数不小于指定值\r\n    Level,            //玩家等级不小于指定值\r\n    Item,             //是否拥有指定道具,如果配置的value为数组，value:[道具id，数量不小于的值]\r\n    Guide,            //指定的引导已完成\r\n    UI,               //指定ui是否出现\r\n    UNUI,             //指定ui是否隐藏\r\n    Round,            //指定回合触发\r\n    Settlement,       //战斗结算\r\n}"]}