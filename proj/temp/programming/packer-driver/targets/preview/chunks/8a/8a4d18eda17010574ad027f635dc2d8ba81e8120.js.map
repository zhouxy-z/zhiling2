{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/common/HeadItem.ts"],"names":["HeadItem","Component","Sprite","path","SpriteFrame","folder_head_round","ResMgr","EventMgr","Evt_UserInfoChange","CfgMgr","headBg","icon","favorite","use","isInit","_data","onLoad","node","getChildByName","getChildByPath","getComponent","updateShow","on","onUserInfoChange","data","activeInHierarchy","playerId","SetData","active","std","Getitem","Number","avatarUrl","headUrl","join","Icon","LoadResAbSub","res","spriteFrame"],"mappings":";;;sLAQaA,Q;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AARJC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,M,OAAAA,M;AAAcC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;;AAClBC,MAAAA,iB,iBAAAA,iB;AAAmBC,MAAAA,M,iBAAAA,M;;AAChCC,MAAAA,Q,iBAAAA,Q;AAAUC,MAAAA,kB,iBAAAA,kB;;AAGVC,MAAAA,M,iBAAAA,M;;;;;;;;;0BAGIT,Q,GAAN,MAAMA,QAAN,SAAuBC,SAAvB,CAAiC;AAAA;AAAA;AAAA,eAC5BS,MAD4B;AAAA,eAE5BC,IAF4B;AAAA,eAG5BC,QAH4B;AAAA,eAI5BC,GAJ4B;AAAA,eAK5BC,MAL4B,GAKX,KALW;AAAA,eAM5BC,KAN4B;AAAA;;AAO1BC,QAAAA,MAAM,GAAS;AACrB,eAAKN,MAAL,GAAc,KAAKO,IAAL,CAAUC,cAAV,CAAyB,QAAzB,CAAd;AACA,eAAKP,IAAL,GAAY,KAAKM,IAAL,CAAUE,cAAV,CAAyB,WAAzB,EAAsCC,YAAtC,CAAmDlB,MAAnD,CAAZ;AACA,eAAKU,QAAL,GAAgB,KAAKK,IAAL,CAAUC,cAAV,CAAyB,UAAzB,CAAhB;AACA,eAAKL,GAAL,GAAW,KAAKI,IAAL,CAAUC,cAAV,CAAyB,KAAzB,CAAX;AACA,eAAKJ,MAAL,GAAc,IAAd;AACA,eAAKO,UAAL;AACA;AAAA;AAAA,oCAASC,EAAT;AAAA;AAAA,wDAAgC,KAAKC,gBAArC,EAAuD,IAAvD;AACH;;AAEOA,QAAAA,gBAAgB,CAACC,IAAD,EAAsC;AAC1D,cAAG,CAAC,KAAKP,IAAL,CAAUQ,iBAAd,EAAiC;AACjC,cAAG,KAAKV,KAAL,CAAWW,QAAX,IAAuBF,IAAI,CAACE,QAA/B,EAAyC;AACzC,eAAKX,KAAL,GAAaS,IAAb;AACA,eAAKH,UAAL;AACH;;AAEDM,QAAAA,OAAO,CAACH,IAAD,EAAkC;AACrC,eAAKT,KAAL,GAAaS,IAAb;AACA,eAAKH,UAAL;AACH;;AAEOA,QAAAA,UAAU,GAAO;AACrB,cAAG,CAAC,KAAKP,MAAN,IAAgB,CAAC,KAAKC,KAAzB,EAAgC;AAChC,eAAKH,QAAL,CAAcgB,MAAd,GAAuB,KAAvB;AACA,eAAKf,GAAL,CAASe,MAAT,GAAkB,KAAlB;AACA,cAAIC,GAAW,GAAG;AAAA;AAAA,gCAAOC,OAAP,CAAeC,MAAM,CAAC,KAAKhB,KAAL,CAAWiB,SAAX,GAAuB,KAAKjB,KAAL,CAAWiB,SAAlC,GAA8C,CAA/C,CAAN,IAA2D,CAA1E,CAAlB;;AACA,cAAGH,GAAH,EAAO;AACH,gBAAII,OAAO,GAAG9B,IAAI,CAAC+B,IAAL;AAAA;AAAA,wDAA6BL,GAAG,CAACM,IAAjC,EAAuC,aAAvC,CAAd;AACA;AAAA;AAAA,kCAAOC,YAAP,CAAoBH,OAApB,EAA6B7B,WAA7B,EAA0CiC,GAAG,IAAI;AAC7C,mBAAK1B,IAAL,CAAU2B,WAAV,GAAwBD,GAAxB;AACH,aAFD;AAGH;AACJ;;AAEO,YAAJb,IAAI,GAA6B;AACjC,iBAAO,KAAKT,KAAZ;AACH;;AA5CmC,O","sourcesContent":["import { Component, Sprite, Node, path, SpriteFrame, Button} from \"cc\";\r\nimport { folder_head, folder_head_round, ResMgr } from \"../../manager/ResMgr\";\r\nimport { EventMgr, Evt_UserInfoChange } from \"../../manager/EventMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { CfgMgr, StdHead, StdItem } from \"../../manager/CfgMgr\";\r\nimport proto from \"../../net/Protocol\";\r\n\r\nexport class HeadItem extends Component {\r\n    private headBg:Node;\r\n    private icon:Sprite;\r\n    private favorite:Node;\r\n    private use:Node;\r\n    private isInit:boolean = false;\r\n    private _data:proto.base.IPlayerShowInfo;\r\n    protected onLoad(): void {\r\n        this.headBg = this.node.getChildByName(\"headBg\");\r\n        this.icon = this.node.getChildByPath(\"Mask/icon\").getComponent(Sprite);\r\n        this.favorite = this.node.getChildByName(\"favorite\");\r\n        this.use = this.node.getChildByName(\"use\");\r\n        this.isInit = true;\r\n        this.updateShow();\r\n        EventMgr.on(Evt_UserInfoChange, this.onUserInfoChange, this);\r\n    }\r\n\r\n    private onUserInfoChange(data:proto.base.IPlayerShowInfo):void{\r\n        if(!this.node.activeInHierarchy) return;\r\n        if(this._data.playerId != data.playerId) return;\r\n        this._data = data;\r\n        this.updateShow();\r\n    }\r\n\r\n    SetData(data:proto.base.IPlayerShowInfo) {\r\n        this._data = data;\r\n        this.updateShow();\r\n    }\r\n\r\n    private updateShow():void{\r\n        if(!this.isInit || !this._data) return;\r\n        this.favorite.active = false;\r\n        this.use.active = false;\r\n        let std:StdItem = CfgMgr.Getitem(Number(this._data.avatarUrl ? this._data.avatarUrl : 1) || 4);\r\n        if(std){\r\n            let headUrl = path.join(folder_head_round, std.Icon, \"spriteFrame\");\r\n            ResMgr.LoadResAbSub(headUrl, SpriteFrame, res => {\r\n                this.icon.spriteFrame = res;\r\n            });\r\n        }\r\n    }\r\n\r\n    get data():proto.base.IPlayerShowInfo{\r\n        return this._data;\r\n    }\r\n}"]}