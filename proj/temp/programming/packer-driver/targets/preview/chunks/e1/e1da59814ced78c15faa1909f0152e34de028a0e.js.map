{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/manager/App.ts"],"names":["App","find","AudioDefine","BagModule","BattleModule","CardsMode","GameScene","FrienModule","LoginModule","MailModule","PlayerModule","ShopModule","AudioMgr","CfgMgr","FightUI","TradeModule","DEV","HTML5","Session","Guide","PointTo","Req","TaskModule","RegisterClass","CheckCondition","DL","ConditionMgr","EventMgr","LocalStorage","Shake","RightsModule","constructor","instance","init","window","route","data","Send","cfgs","Get","cfg","RemoveItem","ID","Call","url","msg","angle","modal","offset","msgAngle","msgOffset","msgSize","duration","btn","pointer","Create","Target","undefined","on","receive","conditionId","values","console","log","Clear","guides","guide","SetNumber","Start","bind","Channels","load","prevLoad"],"mappings":"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","sourcesContent":["import { AudioDefine } from \"../define/AudioDefine\";\r\nimport { BagModule } from \"../module/bag/BagModule\";\r\nimport { BattleModule } from \"../module/battle/BattleModule\";\r\nimport { CardsMode } from \"../module/cards/CardsMode\";\r\nimport { GameScene } from \"../module/fight/GameScene\";\r\nimport { FrienModule } from \"../module/friend/FriendModule\";\r\nimport { LoginModule } from \"../module/login/LoginModule\";\r\nimport { MailModule } from \"../module/mail/MailModule\";\r\nimport { PlayerModule } from \"../module/player/PlayerModule\";\r\nimport { ShopModule } from \"../module/shop/ShopModule\";\r\nimport { AudioMgr } from \"./AudioMgr\";\r\nimport { CfgMgr, StdGuide } from \"./CfgMgr\";\r\nimport { FightUI } from \"../module/fight/FightUI\";\r\nimport { TradeModule } from \"../module/trade/TradeModule\";\r\nimport { DEV, HTML5 } from \"cc/env\";\r\nimport { Session } from \"../net/Session\";\r\nimport { Guide, GuideSub, PointTo } from \"./Guide\";\r\nimport { Req } from \"../net/Protocol\";\r\nimport { TaskModule } from \"../module/task/TaskModule\";\r\nimport { RegisterClass } from \"../RegisterClass\";\r\nimport { CheckCondition, DL } from \"../DL\";\r\nimport { ConditionMgr } from \"./ConditionMgr\";\r\nimport { EventMgr } from \"./EventMgr\";\r\nimport { Layers, find } from \"cc\";\r\nimport { GameSet } from \"./GameSet\";\r\nimport LocalStorage from \"../utils/LocalStorage\";\r\nimport { Shake } from \"../utils/Shake\";\r\nimport { RightsModule } from \"../module/rights/RightsModule\";\r\n\r\nexport class App {\r\n    private static instance: App;\r\n    constructor() {\r\n        if (App.instance) throw \"App只允许一个实例！\";\r\n        App.instance = this;\r\n        this.init();\r\n        if (DEV && HTML5) {\r\n            window['proto'] = Req;\r\n            window['send'] = function (route: string, data: any) {\r\n                Session.Send(route, data);\r\n            }\r\n            window['resetGuide'] = function () {\r\n                let cfgs: StdGuide[] = CfgMgr.Get('guide');\r\n                for (let cfg of cfgs) {\r\n                    LocalStorage.RemoveItem(\"guide\" + cfg.ID);\r\n                }\r\n                EventMgr.Call(\"reset_guide\");\r\n            }\r\n            window['testStep'] = function (url: string, msg: string = \"\", angle = 90, modal = true, offset = [0, 0], msgAngle?: number, msgOffset = [0, 0], msgSize?: number[], duration?: number) {\r\n                let btn = find(url);\r\n                if (!btn) return;\r\n                let pointer: PointTo = PointTo.Create();\r\n                pointer.Target(btn, angle, msg, modal, offset, msgAngle, msgOffset, msgSize, duration ? duration : undefined);\r\n                pointer.on('end', () => {\r\n                    pointer.receive();\r\n                }, this);\r\n            }\r\n            window['testCondition'] = function (conditionId: number, ...values) {\r\n                console.log(CheckCondition(conditionId, ...values));\r\n            }\r\n            window['cleanLocal'] = function () {\r\n                LocalStorage.Clear();\r\n            }\r\n            window['cleanGuide'] = function () {\r\n                let guides = CfgMgr.Get('guide');\r\n                for (let guide of guides) {\r\n                    LocalStorage.SetNumber(\"guide\" + guide.ID, 1);\r\n                }\r\n            }\r\n            window['shake'] = Shake.Start.bind(Shake);\r\n        }\r\n    }\r\n    async init() {\r\n        AudioMgr.init(AudioDefine.Channels);\r\n        await CfgMgr.load();\r\n        await FightUI.load();\r\n        await GameScene.prevLoad();\r\n\r\n        new RegisterClass();\r\n        new Guide();// 系统开启和引导系统\r\n        new DL();\r\n        new LoginModule();\r\n        new PlayerModule();\r\n        new MailModule();\r\n        new FrienModule();\r\n        new BattleModule();\r\n        new BagModule();\r\n        new ShopModule();\r\n        new CardsMode();\r\n        new TradeModule();\r\n        new TaskModule();\r\n        new RightsModule()\r\n\r\n        ConditionMgr.init();\r\n    }\r\n\r\n\r\n}"]}