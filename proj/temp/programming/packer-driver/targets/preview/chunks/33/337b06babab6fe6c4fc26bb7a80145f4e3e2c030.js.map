{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/trade/TradePanel.ts"],"names":["TradePanel","Button","EditBox","Input","Label","Layout","ScrollView","Sprite","SpriteFrame","Toggle","Widget","instantiate","js","Session","TradePanelItem","EventMgr","Evt_Hide_Scene","Evt_Show_Scene","MsgPanel","Panel","AutoScroller","PlayerData","CfgMgr","ThingTypeName","SOrderType","Req","Route","ResMgr","Goto","GroupType","prefab","tradeBanner","localNode","toggleOrder","btnSort","scrollItem","scrollOrder","toggleGroup","selectType","BUY","selectGroup","pageLabel","left","right","heleBtn","noneListCont","orderAdd","combox_item_bg","content","combox_item1","combox_item2","item_3","serch","pageSize","curPage","maxPage","start_id","select_thing_type","clone_item","is_can_change","time","sortType","groupType","select_id","searchCardData","max_order_num","my_order_num","ins","$instance","onLoad","CloseBy","find","onBtnEvent","getChildByName","on","EventType","EDITING_DID_ENDED","onEditEnd","TOUCH_END","children","forEach","node","index","getComponent","isChecked","onSetScrollGroupData","onSetScrollItemData","startId","SendSortOrSerch","Show","AddOrder","SetHandle","updateOrderItem","bind","onShow","emit","getClassName","flush","initSortListData","onEditBegan","reset","removeAllChildren","UpdateDatas","string","active","Order","parent","LoadResAbSub","res","spriteFrame","Item","removeFiltrateOrSort","setScrollView","i","SendOrderType","SendBuyOrSellType","orderType","item_data","itemId","itemType","limit","playerId","player","status","start","Send","card_data","playerDig","data","sort","BattleCard","card_rarity","quality","cardId","group","cardRarity","onHide","getClassByName","onGetViewData","total","Math","ceil","datas","tradeViewData","tradeCardViewData","length","item_num","updateConten","no_num","item","updateItem","addChild","delet_item_list","slice","element","removeChild","scrollToLeft","updateMyOrderData","my_order_list","concat","icon","ScrollToHead","itemScropt","addComponent","SetData","SetOrderData","all_tag_name","all_tag_data","bourseData","GetTradeAllCfgData","tag","tagData","tagName","push","name","setPosition","getChildByPath","icon1","icon2","off","CLICK","openOneTag","first","e","target","closeGroupList","type","updateLayout","group_id","group_list_data","no_group_list_data","Group","indexOf","item3","tag_item3","Name","setectItemName","tag_item2","GroupName","callBack","console","log","openTwoTag","_combox_item2","closeTag","cur_combox_item2","ItemId","CardID","item_content","cur_combox_item","updateAlignment","getComponentInChildren","str","item_cfg","Get","iterator","card_cfg","onFiltrateOrSort","filtrat_data","sort_type","Type","update","dt"],"mappings":"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","sourcesContent":["import { Button, EditBox, EventTouch, Input, Label, Layout, Node, ScrollView, Sprite, SpriteFrame, Toggle, UITransform, Widget, instantiate, js} from \"cc\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { TradePanelItem } from \"./item/TradePanelItem\";\r\nimport { EventMgr, Evt_Hide_Scene, Evt_Show_Scene } from \"../../manager/EventMgr\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { CfgMgr, ItemType, StdMarketCard, StdMarketChoose, StdMarketItem, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { SOrderType} from \"../player/PlayerStruct\";\r\nimport proto, { Req, Route } from \"../../net/Protocol\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\nimport { Goto } from \"../../DL\";\r\n\r\n\r\n/*功能页面类型  buy兑换大厅， sell求购大厅， order 上架管理*/\r\nexport enum GroupType {\r\n    Buy = 0,\r\n    Sell = 1,\r\n    Order = 2\r\n}\r\n\r\nexport class TradePanel extends Panel {\r\n    protected prefab: string = \"prefabs/Trade/TradePanel\";\r\n\r\n    static get ins(): TradePanel { return this.$instance; }\r\n    private tradeBanner: Sprite;\r\n    private localNode: Node;\r\n    private toggleOrder: Node = null;\r\n    private btnSort: Node = null;\r\n    private scrollItem: ScrollView = null;\r\n    private scrollOrder: AutoScroller = null;\r\n    private toggleGroup: Node = null;\r\n  \r\n    private selectType: SOrderType = SOrderType.BUY;\r\n    /**selectGroup 代表不同的功能页0交易大厅，1求购大厅，2上架管理 */\r\n    private selectGroup: number = 0;\r\n    private pageLabel: Label = null;\r\n    private left: Node = null;\r\n    private right: Node = null;\r\n    private heleBtn: Node;\r\n    private noneListCont: Node;\r\n  \r\n    private orderAdd:Node\r\n\r\n    private combox_item_bg: Node;\r\n    private content: Node;\r\n    private combox_item1: Node;\r\n    private combox_item2: Node;\r\n    private item_3: Node;\r\n    private serch: Node = null;\r\n\r\n    private pageSize = 20;\r\n    private curPage = 1;\r\n    private maxPage = 1;\r\n\r\n    private start_id = \"\";\r\n\r\n    private select_thing_type:ThingTypeName;\r\n    private clone_item:Node;\r\n\r\n    /**能否切换道具（道具有刷新时间限制3是） */\r\n    private is_can_change: boolean = true;\r\n    private time = 0;\r\n    /**卡牌排序类型 */\r\n    private sortType:string = \"\";\r\n    /**道具卡牌分组类型 */\r\n    private groupType:number;\r\n    /**选择的道具或卡牌id */\r\n    private select_id:number;\r\n    /**卡牌筛选的参数 */\r\n    private searchCardData:{card_rarity:number, quality:number};\r\n    /**订单最大数量 */\r\n    private max_order_num = 20;\r\n    /**自己的订单数量 */\r\n    private my_order_num = 0;\r\n\r\n    protected onLoad() {\r\n        this.CloseBy(\"closeBtn\");\r\n\r\n        this.tradeBanner = this.find(\"tradeBanner\", Sprite)\r\n        this.noneListCont = this.find(\"noneListCont\")\r\n        this.localNode = this.find(`Main/localNode`);\r\n        this.toggleOrder = this.find(`Main/localNode/ToggleOrder`);\r\n        this.btnSort = this.find(`Main/btnSort`);\r\n        this.scrollItem = this.find(`Main/ScrollView`, ScrollView);\r\n        this.scrollOrder = this.find(`Main/ScrollViewOrder`, AutoScroller);\r\n        this.toggleGroup = this.find(`Main/ToggleGroup`);\r\n        this.pageLabel = this.find(`Main/pageBg/Label`, Label);\r\n        this.left = this.find(`Main/pageBg/left`);\r\n        this.right = this.find(`Main/pageBg/right`);\r\n        this.heleBtn = this.find(\"Bg/heleBtn\");\r\n        this.clone_item = this.find(\"Main/ScrollView/view/content/item\");\r\n\r\n        this.combox_item_bg = this.find(\"combox_item/combox_item_bg\");\r\n        this.content = this.find(\"combox_item/combox_item_bg/ScrollView/view/content\");\r\n        this.combox_item1 = this.find(\"combox_item/combox_item1\");\r\n        this.combox_item2 = this.find(\"combox_item/combox_item2\");\r\n        this.item_3 = this.find(\"combox_item/item_3\");\r\n        this.serch = this.find(`Main/serch`);\r\n\r\n        this.orderAdd = this.find(\"Main/orderAdd\")\r\n        this.onBtnEvent();\r\n    }\r\n\r\n    private onBtnEvent() {\r\n        this.serch.getChildByName(`EditBox`).on(EditBox.EventType.EDITING_DID_ENDED, this.onEditEnd, this)\r\n        this.btnSort.on(Input.EventType.TOUCH_END, ()=>{Goto(\"SortPanel\", this.select_thing_type, this.sortType, this.searchCardData)}, this)\r\n        //功能单选\r\n        this.toggleGroup.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                node.getComponent(Toggle).isChecked = true;\r\n                this.onSetScrollGroupData(index);\r\n            })\r\n        })\r\n        //订单单选\r\n        this.toggleOrder.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                node.getComponent(Toggle).isChecked = true;\r\n                this.onSetScrollItemData(index);\r\n            })\r\n        })\r\n        this.left.on(Input.EventType.TOUCH_END, () => {\r\n            if (this.curPage > 1) {\r\n                this.curPage--;\r\n                this.start_id = PlayerData.startId[this.curPage - 1];\r\n                this.SendSortOrSerch()\r\n            } else {\r\n                MsgPanel.Show(\"已是第一页\")\r\n            }\r\n        })\r\n        this.right.on(Input.EventType.TOUCH_END, () => {\r\n            if (this.curPage < this.maxPage) {\r\n                this.curPage++;\r\n                this.start_id = PlayerData.startId[this.curPage - 1];\r\n                this.SendSortOrSerch()\r\n            } else {\r\n                MsgPanel.Show(\"已是最后一页\")\r\n            }\r\n        })\r\n        this.orderAdd.on(Input.EventType.TOUCH_END, this.AddOrder, this);\r\n        this.scrollOrder.SetHandle(this.updateOrderItem.bind(this));\r\n    }\r\n\r\n    protected onShow(): void {\r\n        EventMgr.emit(Evt_Hide_Scene, js.getClassName(this));\r\n    }\r\n\r\n    flush(...args: any[]) {  \r\n        this.selectType = 0;\r\n        this.initSortListData();\r\n        this.onEditBegan();\r\n        this.reset();\r\n    }\r\n    \r\n\r\n    /**重置UI和数据 */\r\n    public reset() {\r\n        this.scrollItem.content.removeAllChildren();\r\n        this.scrollOrder.UpdateDatas([]);\r\n        this.onSetScrollGroupData(0)\r\n    }\r\n\r\n    /**\r\n     * 页面 交易大厅\", \"求购大厅\", \"上架管理 页签切换\r\n     * @param index \r\n     */\r\n    private onSetScrollGroupData(index) {\r\n        this.pageLabel.string = `1/1`;\r\n        this.curPage = 1;\r\n        this.maxPage = 1;\r\n        PlayerData.startId = [\"\"];\r\n        this.start_id = \"\";\r\n        this.noneListCont.active = false;\r\n        this.selectGroup = index;\r\n        this.selectType = index != GroupType.Order ? index : 0;\r\n        this.btnSort.active = this.selectGroup != GroupType.Order\r\n        this.combox_item_bg.active = this.selectGroup != GroupType.Order;\r\n        this.serch.active = this.selectGroup != GroupType.Order;\r\n        this.left.parent.active = this.selectGroup != GroupType.Order;\r\n        this.localNode.active = this.selectGroup == GroupType.Order;\r\n        this.orderAdd.active = this.selectGroup == GroupType.Order;\r\n        ResMgr.LoadResAbSub(\"sheets/bg/trade_banner_\" + index + \"/spriteFrame\", SpriteFrame, res=>{\r\n            this.tradeBanner.spriteFrame = res;\r\n        })\r\n        this.select_thing_type = ThingTypeName.Item\r\n        this.select_id = null;\r\n        this.groupType = null;\r\n        this.removeFiltrateOrSort();\r\n        this.setScrollView();\r\n        this.SendSortOrSerch();\r\n    }\r\n\r\n    /**设置当前展示的列表以及页签状态 */\r\n    private setScrollView() {\r\n        if (this.selectGroup == 2) {//订单页面\r\n            this.scrollOrder.node.active = true;\r\n            this.scrollItem.node.active = false;\r\n\r\n            this.toggleOrder.children.forEach((node, index) => {\r\n                if (index == this.selectType) {\r\n                    node.getComponent(Toggle).isChecked = true;\r\n                }\r\n            })\r\n        } else {//求购购买页面\r\n            this.scrollOrder.node.active = false;\r\n            this.scrollItem.node.active = true;\r\n        }\r\n        this.toggleGroup.children.forEach((node, i) => {\r\n            if (i == this.selectGroup) {\r\n                node.getComponent(Toggle).isChecked = true;\r\n            }\r\n        })\r\n    }\r\n\r\n    /**筛选排序 */\r\n    public SendSortOrSerch() {       \r\n        if (this.selectGroup == GroupType.Order) {\r\n            this.SendOrderType();\r\n        } else {\r\n            this.SendBuyOrSellType();\r\n        }\r\n    }\r\n\r\n    /**查询自己的卖或买的订单 */\r\n    public SendOrderType() {\r\n        let orderType =  this.selectType == 0 ? \"sell\" : \"buy\";\r\n    \r\n        let item_data = new Req[\"market.protocol.getmakeritemorders\"]();\r\n        item_data.orderType = orderType;\r\n        item_data.itemId = null;\r\n        item_data.itemType = null;\r\n        item_data.limit = this.max_order_num;\r\n        item_data.playerId = PlayerData.player.playerId;\r\n        item_data.status = \"active\";\r\n        item_data.start = \"\";\r\n        Session.Send(Route[\"market.protocol.getmakeritemorders\"], item_data)\r\n\r\n        let card_data = new Req[\"market.protocol.getcardorders\"]();\r\n        card_data.orderType = orderType;\r\n        card_data.playerDig = 0\r\n        card_data.limit = this.max_order_num;\r\n        card_data.playerId = PlayerData.player.playerId;\r\n        card_data.status = \"active\";\r\n        card_data.start = \"\";\r\n        Session.Send(Route[\"market.protocol.getcardorders\"], card_data)\r\n    }\r\n\r\n    /**查询所有的买或卖以及筛选订单 */\r\n    public SendBuyOrSellType(searchCardData?:{card_rarity:number, quality:number}) {\r\n        if(this.select_thing_type == ThingTypeName.Item){\r\n            let orderType =  this.selectType == 0 ? \"sell\" : \"buy\";\r\n            let data = new Req[\"market.protocol.searchitemorders\"]();\r\n            data.orderType = orderType;\r\n            data.itemId = this.select_id;\r\n            data.itemType = this.groupType;\r\n            data.limit = this.pageSize;\r\n            data.sort = this.sortType;\r\n            data.start = this.start_id;\r\n            Session.Send(Route[\"market.protocol.searchitemorders\"], data)\r\n        }else if(this.select_thing_type == ThingTypeName.BattleCard){\r\n            let card_rarity = null;\r\n            let quality = null;\r\n            if(searchCardData){\r\n                card_rarity = searchCardData.card_rarity;\r\n                quality = searchCardData.quality;\r\n            }\r\n            let orderType =  this.selectType == 0 ? \"sell\" : \"buy\";\r\n            let data = new Req[\"market.protocol.searchcardorders\"]();\r\n            data.orderType = orderType;\r\n            data.cardId = this.select_id;\r\n            data.group = this.groupType;\r\n            data.cardRarity = card_rarity;\r\n            data.quality = quality;\r\n            data.limit = this.pageSize;\r\n            data.sort = this.sortType;\r\n            data.start = this.start_id;\r\n            Session.Send(Route[\"market.protocol.searchcardorders\"], data)\r\n        }\r\n    }\r\n\r\n    /** 在上架管理中代表订单种类 （头顶小页签）*/\r\n    private onSetScrollItemData(index) {\r\n        this.selectType = index;\r\n        this.SendSortOrSerch()\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n        EventMgr.emit(Evt_Show_Scene, js.getClassByName(this));\r\n    }\r\n\r\n    /**刷新数据 */\r\n    onGetViewData() {\r\n        //计算当前页是否是最后一页\r\n        if (PlayerData.total) {\r\n            this.maxPage = Math.ceil(PlayerData.total / this.pageSize);\r\n        }\r\n        this.pageLabel.string = `${this.curPage}/${this.maxPage || 1}`;\r\n        let datas = [];\r\n        datas = this.select_thing_type == ThingTypeName.Item ? PlayerData.tradeViewData : PlayerData.tradeCardViewData \r\n        this.noneListCont.active = false;\r\n        this.scrollItem.node.active = true;\r\n        if (!datas || datas.length == 0) {\r\n            this.noneListCont.active = true;\r\n            this.scrollItem.node.active = false\r\n            return;\r\n        }\r\n\r\n        let item_num = this.scrollItem.content.children.length\r\n        if(datas.length > item_num){\r\n            this.updateConten(datas)\r\n            let no_num = datas.length - item_num\r\n            for (let index = 0; index < no_num; index++) {\r\n                let item = instantiate(this.clone_item);\r\n                this.updateItem(item, datas[item_num + index])\r\n                this.scrollItem.content.addChild(item)\r\n            }\r\n        } else if(datas.length < item_num){\r\n            let delet_item_list = this.scrollItem.content.children.slice(datas.length - 1, item_num-1)\r\n            for (let index = 0; index < delet_item_list.length; index++) {\r\n                const element = delet_item_list[index];\r\n                this.scrollItem.content.removeChild(element)\r\n            }\r\n            this.updateConten(datas)\r\n        }else{\r\n            this.updateConten(datas)\r\n        }\r\n        this.scrollItem.scrollToLeft();\r\n    }\r\n\r\n    private updateConten(datas){\r\n        this.scrollItem.content.children.forEach((item, index)=>{\r\n            this.updateItem(item, datas[index])\r\n        })\r\n    }\r\n    \r\n    /**刷新自己的订单数据 */\r\n    updateMyOrderData() {\r\n        let my_order_list:(proto.base.IMarketItemOrder | proto.base.IMarketCardOrder)[] = []\r\n        my_order_list = my_order_list.concat(...PlayerData.tradeCardViewData)\r\n        my_order_list = my_order_list.concat(...PlayerData.tradeViewData)\r\n        this.my_order_num = my_order_list.length;\r\n        let icon = this.selectType == 0 ? \"sellOrderBtn\" : \"buyOrderBtn\";\r\n        ResMgr.LoadResAbSub(\"sheets/trade/\" + icon + \"/spriteFrame\", SpriteFrame, res=>{\r\n            this.orderAdd.getComponent(Sprite).spriteFrame = res\r\n        })\r\n        this.scrollOrder.UpdateDatas(my_order_list);\r\n        this.scrollOrder.ScrollToHead();\r\n    }\r\n\r\n    /**\r\n     * 交易道具角色item\r\n     * @param item \r\n     * @param data \r\n     */\r\n    private updateItem(item: Node, data: proto.base.IMarketItemOrder, index?: number) {\r\n        let itemScropt = item.getComponent(TradePanelItem);\r\n        itemScropt = itemScropt ? itemScropt : item.addComponent(TradePanelItem);\r\n        itemScropt.SetData(data, this.selectType, this.select_thing_type);\r\n    }\r\n\r\n    /**\r\n     * 订单道具角色item\r\n     * @param item \r\n     * @param data \r\n     */\r\n    private updateOrderItem(item: Node, data: proto.base.IMarketItemOrder) {\r\n        let itemScropt = item.getComponent(TradePanelItem);\r\n        itemScropt = itemScropt ? itemScropt : item.addComponent(TradePanelItem);\r\n        itemScropt.SetOrderData(data, this.selectType);\r\n    }\r\n\r\n    private AddOrder(){\r\n        if(this.my_order_num >= this.max_order_num){\r\n            MsgPanel.Show(\"已到达上架上限\")\r\n        }\r\n        Goto(\"TradeCreateOrderPanel\", this.selectType);\r\n    }\r\n\r\n    //-------------------------------------物品查询筛选相关----------------------\r\n\r\n    //初始化筛选列表数据\r\n    private initSortListData() {\r\n        //获取商品种类\r\n        this.content.removeAllChildren();\r\n        let all_tag_name = [\"道具\", \"卡牌\"];\r\n        let all_tag_data = []\r\n        for (let index = 0; index < all_tag_name.length; index++) {\r\n            let bourseData: StdMarketItem[] | StdMarketCard[] = CfgMgr.GetTradeAllCfgData(index);\r\n            let data = {\r\n                tag: index,\r\n                tagData: bourseData,\r\n                tagName: all_tag_name[index]\r\n            }\r\n            all_tag_data.push(data);\r\n            let item = instantiate(this.combox_item1);\r\n            item.name = \"item\" + index;\r\n            item.setPosition(0, 0);\r\n            item[\"bourseData\"] = bourseData;\r\n            item[\"type\"] = index;\r\n            item.getChildByPath(\"layout/input/frame/label\").getComponent(Label).string = all_tag_name[index];\r\n            item.getChildByPath(\"layout/input/frame_select/label\").getComponent(Label).string = all_tag_name[index];\r\n            let icon1 = \"sheets/trade/icon_\" + index + \"_1\" + \"/spriteFrame\";\r\n            let icon2 = \"sheets/trade/icon_\" + index + \"_2\" + \"/spriteFrame\";\r\n            ResMgr.LoadResAbSub(icon1, SpriteFrame, res=>{\r\n                item.getChildByPath(\"layout/input/frame/icon\").getComponent(Sprite).spriteFrame = res;\r\n            })\r\n            ResMgr.LoadResAbSub(icon2, SpriteFrame, res=>{\r\n                item.getChildByPath(\"layout/input/frame_select/icon\").getComponent(Sprite).spriteFrame = res;\r\n            })\r\n            item.off(Button.EventType.CLICK, this.openOneTag.bind(this), this)\r\n            item.on(Button.EventType.CLICK, this.openOneTag.bind(this), this)\r\n            this.content.addChild(item);\r\n        }\r\n        let first = this.content.children[0].getComponent(Button)\r\n        this.openOneTag(first)\r\n    }\r\n\r\n    //打开1级列表\r\n    private openOneTag(e: Button) {\r\n        let item: Node = e.target;\r\n        this.closeGroupList(item);\r\n        let content = item.getChildByPath(\"layout/content\")\r\n        let type = item[\"type\"]\r\n        this.select_id = null;\r\n        this.groupType = null;\r\n        if(type == 0){\r\n            //道具\r\n            this.select_thing_type = ThingTypeName.Item;\r\n            this.removeFiltrateOrSort()\r\n            this.SendSortOrSerch();\r\n        }else if(type == 1){\r\n            //卡牌\r\n            this.select_thing_type = ThingTypeName.BattleCard;\r\n            this.removeFiltrateOrSort()\r\n            this.SendSortOrSerch();\r\n        }\r\n        if (content.children.length > 0) {\r\n            content.removeAllChildren();\r\n            item.children.forEach(element => {\r\n                element.getComponent(Layout).updateLayout(true);\r\n            })\r\n            item.getChildByPath(\"layout/input/frame\").active = true;\r\n            item.getChildByPath(\"layout/input/frame_select\").active = false;\r\n            return\r\n        }\r\n        content.removeAllChildren();\r\n\r\n        let bourseData = item[\"bourseData\"];\r\n        //根据物品的类别细分到不同的组\r\n        let group_id = [];\r\n        let group_list_data = [];\r\n\r\n        //一级页签下未分组的物品 加到最后\r\n        let no_group_list_data = []\r\n     \r\n        for (let index = 0; index < bourseData.length; index++) {\r\n            const element = bourseData[index];\r\n            if (group_id.length > 0) {\r\n                if (element.Group != 0) {\r\n                    let i = group_id.indexOf(element.Group);\r\n                    if (i == -1) {\r\n                        group_id.push(element.Group)\r\n                        group_list_data.push([])\r\n                        group_list_data[group_id.length - 1].push(element)\r\n                    } else {\r\n                        group_list_data[i].push(element)\r\n                    }\r\n                } else {\r\n                    no_group_list_data.push(element)\r\n                }\r\n            } else {\r\n                if (element.Group != 0) {\r\n                    group_id.push(element.Group)\r\n                    group_list_data.push([])\r\n                    group_list_data[group_id.length - 1].push(element)\r\n                } else {\r\n                    no_group_list_data.push(element)\r\n                }\r\n            }\r\n        }\r\n       \r\n        if (no_group_list_data.length > 0) {\r\n            group_list_data.push(no_group_list_data)\r\n        }\r\n     \r\n\r\n        for (let index = 0; index < group_list_data.length; index++) {\r\n            const element = group_list_data[index];\r\n            if (element[0].Group == 0) {\r\n                for (let index = 0; index < element.length; index++) {\r\n                    const item3 = element[index];\r\n                    let tag_item3 = instantiate(this.item_3);\r\n                    tag_item3.name = \"item3\" + index;\r\n                    tag_item3.setPosition(0, 0);\r\n                    tag_item3[\"bourseData3\"] = item3;\r\n                    tag_item3[\"type\"] = type;\r\n                    tag_item3.getChildByName(\"item_name\").getComponent(Label).string = item3.Name;\r\n                    tag_item3.getChildByPath(\"item_select/item_name\").getComponent(Label).string = item3.Name;\r\n                    tag_item3.off(Button.EventType.CLICK, this.setectItemName.bind(this), this);\r\n                    tag_item3.on(Button.EventType.CLICK, this.setectItemName.bind(this), this);\r\n                    content.addChild(tag_item3);\r\n                }\r\n            } else {\r\n                let tag_item2 = instantiate(this.combox_item2);\r\n                tag_item2.name = \"item2\" + index;\r\n                tag_item2.setPosition(0, 0);\r\n                tag_item2[\"bourseData2\"] = element;\r\n                tag_item2[\"type\"] = type;\r\n                tag_item2.getChildByPath(\"layout/input/frame/label\").getComponent(Label).string = element[0].GroupName;\r\n                tag_item2.getChildByPath(\"layout/input/frame_select/label\").getComponent(Label).string = element[0].GroupName;\r\n                let callBack = (item) => {\r\n                    console.log(this.is_can_change)\r\n                    if (!this.is_can_change) {\r\n                        return MsgPanel.Show(\"点击过快\");\r\n                    }\r\n                    this.openTwoTag(item);\r\n                }\r\n                tag_item2.off(Button.EventType.CLICK, callBack, this);\r\n                tag_item2.on(Button.EventType.CLICK, callBack, this);\r\n                content.addChild(tag_item2);\r\n            }\r\n        }\r\n        item.children.forEach(element => {\r\n            element.getComponent(Layout).updateLayout(true);\r\n        });\r\n    }\r\n\r\n    //打开2级列表\r\n    private openTwoTag(e: Button) {\r\n        let item = e.target;\r\n        this.closeGroupList(item, 2);\r\n        let content = item.getChildByPath(\"layout/content\")\r\n        let bourseData = item[\"bourseData2\"];\r\n        let type = item[\"type\"]\r\n        this.select_id = null;\r\n        this.groupType = bourseData[0].Group\r\n        if(type == 0){\r\n            //道具\r\n            this.select_thing_type = ThingTypeName.Item;\r\n            this.removeFiltrateOrSort()\r\n            this.SendBuyOrSellType();\r\n        }else if(type == 1){\r\n            //卡牌\r\n            this.select_thing_type = ThingTypeName.BattleCard;\r\n            this.removeFiltrateOrSort()\r\n            this.SendBuyOrSellType();\r\n            console.log(\"卡牌\")\r\n        }\r\n        \r\n        if (content.children.length > 0) {\r\n            content.removeAllChildren();\r\n            item.children.forEach(element => {\r\n                element.getComponent(Layout).updateLayout(true);\r\n            })\r\n            item.getChildByPath(\"layout/input/frame\").active = true;\r\n            item.getChildByPath(\"layout/input/frame_select\").active = false;\r\n            return\r\n        }\r\n        content.removeAllChildren();\r\n        for (let index = 0; index < bourseData.length; index++) {\r\n            const element = bourseData[index];\r\n            let tag_item3 = instantiate(this.item_3);\r\n            tag_item3.setPosition(0, 0);\r\n            tag_item3[\"bourseData3\"] = element;\r\n            tag_item3[\"type\"] = type;\r\n            tag_item3.getChildByName(\"item_name\").getComponent(Label).string = element.Name;\r\n            tag_item3.getChildByPath(\"item_select/item_name\").getComponent(Label).string = element.Name;\r\n            let callBack = (item) => {\r\n                console.log(this.is_can_change)\r\n                if (!this.is_can_change) {\r\n                    return MsgPanel.Show(\"点击过快\");\r\n                }\r\n                this.setectItemName(item);\r\n            }\r\n            tag_item3.off(Input.EventType.TOUCH_END, callBack, this);\r\n            tag_item3.on(Input.EventType.TOUCH_END, callBack, this);\r\n            content.addChild(tag_item3);\r\n        }\r\n        console.log(content.children, content.children.length)\r\n        item.children.forEach(element => {\r\n            element.getComponent(Layout).updateLayout(true);\r\n        });\r\n    }\r\n\r\n    /**选中某个物品 */\r\n    private setectItemName(e: Button) {\r\n        let item = e.target;\r\n        item.parent.parent.getChildByPath(\"input/frame_select\").active = false;\r\n        item.parent.parent.getChildByPath(\"input/frame\").active = true;\r\n        let content = item.parent.children;\r\n        for (let index = 0; index < content.length; index++) {\r\n            const element = content[index];\r\n            let _combox_item2 = element.getChildByPath(\"layout/input/frame_select\");\r\n            if (_combox_item2) {\r\n                element.getChildByPath(\"layout/input/frame_select\").active = false;\r\n                element.getChildByPath(\"layout/input/frame\").active = true;\r\n                this.closeTag(element)\r\n            } else {\r\n                element.getChildByName(\"item_select\").active = false;\r\n            }\r\n        }\r\n\r\n        let cur_combox_item2 = item.getChildByPath(\"layout/input/frame_select\");\r\n        if (cur_combox_item2) {\r\n            item.getChildByPath(\"layout/input/frame_select\").active = true;\r\n        } else {\r\n            item.getChildByName(\"item_select\").active = true;\r\n        }\r\n        let type = item[\"type\"]\r\n        if(type == 0){\r\n            //道具\r\n            let bourseData: StdMarketItem = item[\"bourseData3\"];\r\n    \r\n            //筛选道具\r\n            this.groupType = bourseData.Group;\r\n            this.select_id = bourseData.ItemId;\r\n            this.removeFiltrateOrSort()\r\n            this.SendBuyOrSellType()\r\n        }else if(type == 1){\r\n            //卡牌\r\n            let bourseData: StdMarketCard = item[\"bourseData3\"];\r\n            this.groupType = null;\r\n            this.select_id = bourseData.CardID;\r\n            console.log(\"卡牌\", bourseData)\r\n            this.removeFiltrateOrSort()\r\n            this.SendBuyOrSellType()\r\n        }\r\n       \r\n    }\r\n\r\n    //收起列表\r\n    private closeTag(node) {\r\n        let item: Node = node;\r\n        let content = item.getChildByPath(\"layout/content\")\r\n        content.removeAllChildren();\r\n    }\r\n\r\n    /**关闭同组下的其它列表 */\r\n    private closeGroupList(item: Node, tag?: number) {\r\n        if (tag == 2) {\r\n            //该组的上级标签置灰\r\n            item.parent.parent.getChildByPath(\"input/frame_select\").active = false;\r\n            item.parent.parent.getChildByPath(\"input/frame\").active = true;\r\n        }\r\n        //关闭同组下的其它列表\r\n        let item_content = item.parent.children\r\n        for (let index = 0; index < item_content.length; index++) {\r\n            const element = item_content[index];\r\n            let _combox_item2 = element.getChildByPath(\"layout/input/frame_select\");\r\n            if (_combox_item2) {\r\n                element.getChildByPath(\"layout/input/frame_select\").active = false;\r\n                element.getChildByPath(\"layout/input/frame\").active = true;\r\n                if (element.name != item.name) {\r\n                    this.closeTag(element)\r\n                }\r\n            } else {\r\n                element.getChildByName(\"item_select\").active = false;\r\n            }\r\n        }\r\n        //点亮当前标签页\r\n        let cur_combox_item = item.getChildByPath(\"layout/input/frame_select\");\r\n        if (cur_combox_item) {\r\n            item.getChildByPath(\"layout/input/frame\").active = false;\r\n            item.getChildByPath(\"layout/input/frame_select\").active = true;\r\n        } else {\r\n            item.getChildByName(\"item_select\").active = true;\r\n        }\r\n    }\r\n\r\n    private onEditBegan() {\r\n        //编辑时文本会发生偏移在输入时刷新一次对齐\r\n        this.serch.children.forEach((node) => {\r\n            if (node.getComponent(Widget)) {\r\n                node.getComponent(Widget).updateAlignment();\r\n            }\r\n        })\r\n    }\r\n\r\n    /**搜索栏事件 */\r\n    private onEditEnd() {\r\n        if (this.serch.getComponentInChildren(EditBox).string) {   \r\n            let str = this.serch.getComponentInChildren(EditBox).string;\r\n            let item_cfg: StdMarketItem[] = CfgMgr.Get(\"market_item\")\r\n            for (const iterator of item_cfg) {\r\n                if (iterator.Name == str) {\r\n                    this.groupType = null;  \r\n                    this.select_id = iterator.ItemId  \r\n                    this.select_thing_type = ThingTypeName.Item;            \r\n                    this.SendBuyOrSellType()              \r\n                    this.serch.getComponentInChildren(EditBox).string = ``;\r\n                    return;\r\n                }\r\n            }\r\n\r\n            let card_cfg: StdMarketCard[] = CfgMgr.Get(\"market_card\")\r\n            for (const iterator of card_cfg) {\r\n                if (iterator.Name == str) {\r\n                    this.groupType = null;  \r\n                    this.select_id = iterator.CardID  \r\n                    this.select_thing_type = ThingTypeName.BattleCard;            \r\n                    this.SendBuyOrSellType()              \r\n                    this.serch.getComponentInChildren(EditBox).string = ``;\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**筛选排序条件 */\r\n    public onFiltrateOrSort(filtrat_data:StdMarketChoose[], sort_type){    \r\n        this.sortType = sort_type;\r\n        let card_rarity = null;\r\n        let quality = null;\r\n        for (let index = 0; index < filtrat_data.length; index++) {\r\n            const element = filtrat_data[index];\r\n            if(element.Group == 1){\r\n                card_rarity = element.Type;\r\n            }else if(element.Group == 2){\r\n                quality = element.Type;\r\n            }\r\n        }\r\n        this.searchCardData = { card_rarity:card_rarity, quality:quality}\r\n        this.SendBuyOrSellType(this.searchCardData)\r\n    }\r\n\r\n    private removeFiltrateOrSort(){\r\n        this.searchCardData = {card_rarity:null, quality:null}\r\n        this.sortType = \"\";\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if (!this.is_can_change) {\r\n            this.time += dt;\r\n            if (this.time >= 2) {\r\n                this.is_can_change = true;\r\n                this.time = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n}"]}