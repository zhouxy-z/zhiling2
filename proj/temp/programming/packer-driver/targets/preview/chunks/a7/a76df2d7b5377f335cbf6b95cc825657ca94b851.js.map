{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/login/ServerPanel.ts"],"names":["ServerPanel","EditBox","Input","Label","Panel","Selector","LocalStorage","CfgMgr","GameSet","prefab","selector","input","loginHost","loginServer","loginPort","callback","onLoad","find","on","EventType","TOUCH_END","onLogin","GetString","GetNumber","serverlist","Get","list","server","push","string","Login","Init","item","data","desc","Desc","label","getComponent","node","onSelect","str","src","Server","Port","SetString","onShow","flush","callBack","onHide","globalCfg","Host","userCode","SetNumber","window"],"mappings":"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","sourcesContent":["import { director, EditBox, Input, Label, Node } from \"cc\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { Selector } from \"../../component/Selector\";\r\nimport LocalStorage from \"../../utils/LocalStorage\";\r\nimport { CfgMgr } from \"../../manager/CfgMgr\";\r\nimport { GameSet } from \"../../manager/GameSet\";\r\n\r\nexport class ServerPanel extends Panel {\r\n    protected prefab: string = \"prefabs/login/ServerPanel\";\r\n\r\n    private selector: Selector;\r\n    private input: EditBox;\r\n    private loginHost: string;\r\n    private loginServer: string;\r\n    private loginPort: number;\r\n    private callback: Function;\r\n    protected async onLoad() {\r\n        this.selector = this.find(\"frame/Selector\", Selector);\r\n        this.input = this.find(\"frame/input\", EditBox);\r\n        this.find(\"enter\").on(Input.EventType.TOUCH_END, this.onLogin, this);\r\n\r\n        this.loginHost = LocalStorage.GetString(\"loginHost\", \"http://192.168.0.103:8002/user/v1/login/wec\");\r\n        this.loginServer = LocalStorage.GetString(\"loginServer\", \"192.168.0.103\");\r\n        this.loginPort = LocalStorage.GetNumber(\"loginPort\", 7000);\r\n        let serverlist = CfgMgr.Get(\"server_list\");\r\n        let list = [];\r\n        for (let server of serverlist) {\r\n            list.push(server);\r\n        }\r\n        this.selector.string = this.loginHost || list[0]?.Login;\r\n        this.selector.Init(list, (item: Node, data: any) => {\r\n            let desc = data.Login;\r\n            if (data.Desc) desc = \"(\" + data.Desc + \")\" + data.Login;\r\n            let label = item.getComponent(Label);\r\n            if (!label) {\r\n                item.getComponent(EditBox).string = desc;\r\n            } else {\r\n                label.string = desc;\r\n            }\r\n        });\r\n        this.selector.node.on('select', this.onSelect, this);\r\n\r\n        let str = LocalStorage.GetString(\"userCode\");\r\n        if (str) {\r\n            this.input.string = str;\r\n        }\r\n\r\n    }\r\n\r\n    protected onSelect(src: any, data: any) {\r\n        this.loginHost = data.Login;\r\n        this.loginServer = data.Server;\r\n        this.loginPort = data.Port;\r\n        LocalStorage.SetString(\"loginHost\", this.loginHost);\r\n        LocalStorage.SetString(\"loginServer\", this.loginServer);\r\n    }\r\n\r\n    protected onShow(): void {\r\n\r\n\r\n    }\r\n    public flush(callBack: Function): void {\r\n        this.callback = callBack;\r\n    }\r\n    protected onHide(...args: any[]): void {\r\n\r\n    }\r\n\r\n    onLogin() {\r\n\r\n        if(GameSet.globalCfg) {\r\n            GameSet.globalCfg.Host\r\n        }\r\n\r\n        let userCode = this.input.string;\r\n        if (!userCode) {\r\n\r\n        } else {\r\n            LocalStorage.SetString(\"userCode\", userCode);\r\n            LocalStorage.SetString(\"loginServer\", this.loginServer);\r\n            LocalStorage.SetNumber(\"loginPort\", this.loginPort);\r\n            window['usercode'] = userCode;\r\n            this.callback(this.loginHost, this.loginServer, this.loginPort, userCode);\r\n        }\r\n    }\r\n}"]}