{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/battle/BattleCardGrid.ts"],"names":["BattleCardGrid","Component","Label","base","CfgMgr","idLab","card","cardBg","energy","energyLab","power","powerLab","cardIdLab","back","_areaIdx","_gridIdx","_terrainInstId","_cardData","_cardCfg","isInit","onLoad","node","getChildByName","getComponent","getChildByPath","updateShow","setData","cardData","GetCard","configId","active","string","instId","terrainState","BattleRoomInCardState","CardStateHide","Cost","toString","Power","areaIdx","setTerrainInstId","terrainInstId","setGridIdx","gridIdx","toBack","toShow"],"mappings":"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","sourcesContent":["import { Node, Component, Label, Sprite, instantiate, v3 } from \"cc\";\r\nimport base from \"../../net/proto/BaseUtils\";\r\nimport { battleLogicMgr } from \"./BattleLogicMgr\";\r\nimport { battleCompMgr } from \"./BattleCompMgr\";\r\nimport { BattleCard } from \"./BattleCard\";\r\nimport { CfgMgr, StdCard } from \"../../manager/CfgMgr\";\r\n/**\r\n * 卡牌格子\r\n */\r\nexport class BattleCardGrid extends Component {\r\n    private idLab: Label;\r\n    public card: Node;\r\n    private cardBg: Sprite;\r\n    private energy: Node;\r\n    private energyLab: Label;\r\n    private power: Node;\r\n    private powerLab: Label;\r\n    private cardIdLab: Label;\r\n    private back: Node;\r\n    private _areaIdx: number;\r\n    private _gridIdx: number;\r\n    private _terrainInstId: string;\r\n    private _cardData:base.IBattleRoomCardData;\r\n    private _cardCfg: StdCard;\r\n    private isInit: boolean = false;\r\n    protected onLoad(): void {\r\n        this.idLab = this.node.getChildByName(\"idLab\").getComponent(Label);\r\n        this.card = this.node.getChildByName(\"card\");\r\n        this.energy = this.node.getChildByPath(\"card/energy\");\r\n        this.energyLab = this.node.getChildByPath(\"card/energy/energyLab\").getComponent(Label);\r\n        this.power = this.node.getChildByPath(\"card/power\");\r\n        this.powerLab = this.node.getChildByPath(\"card/power/powerLab\").getComponent(Label);\r\n        this.cardIdLab = this.node.getChildByPath(\"card/cardIdLab\").getComponent(Label);\r\n        this.back = this.node.getChildByPath(\"card/back\");\r\n        this.isInit = true;\r\n        this.updateShow();\r\n    }\r\n\r\n    public setData(cardData: base.IBattleRoomCardData): void {\r\n        this._cardData = cardData;\r\n        this._cardCfg = CfgMgr.GetCard(this._cardData?.configId);\r\n        this.updateShow();\r\n    }\r\n    \r\n    private updateShow(): void {\r\n        if (!this.isInit) return;\r\n        this.node.active = true;\r\n        if (this._cardData) {\r\n            this.cardIdLab.string = this._cardData.instId;\r\n            this.card.active = true;\r\n            this.back.active = this._cardData.terrainState == base.BattleRoomInCardState.CardStateHide;\r\n            if (this._cardCfg) {\r\n                this.energy.active = true;\r\n                this.power.active = true;\r\n                \r\n                this.energyLab.string = this._cardCfg.Cost.toString();\r\n                this.powerLab.string = this._cardCfg.Power.toString();\r\n            } else {\r\n                this.energy.active = false;\r\n                this.power.active = false;\r\n                this.cardIdLab.node.active = false;\r\n            }\r\n        } else {\r\n            if (this.areaIdx < 0) {\r\n                this.node.active = false;\r\n            }\r\n            this.card.active = false;\r\n        }\r\n        \r\n    }\r\n\r\n    public get cardData(): base.IBattleRoomCardData {\r\n        return this._cardData;\r\n    }\r\n\r\n    public setTerrainInstId(instId: string): void {\r\n        this._terrainInstId = instId;\r\n    }\r\n\r\n    public get terrainInstId(): string {\r\n        return this._terrainInstId;\r\n    }\r\n\r\n    public setGridIdx(gridIdx: number, areaIdx: number = -1): void {\r\n        this._gridIdx = gridIdx;\r\n        this._areaIdx = areaIdx;\r\n        this.idLab.string = `${this._areaIdx}_${this._gridIdx}`;\r\n    }\r\n    public toBack(): void {\r\n        this.back.active = false;\r\n    }\r\n\r\n    public toShow(): void {\r\n        this.back.active = true;\r\n    }\r\n    public get areaIdx(): number {\r\n        return this._areaIdx;\r\n    }\r\n\r\n    public get gridIdx(): number {\r\n        return this._gridIdx;\r\n    }\r\n}"]}