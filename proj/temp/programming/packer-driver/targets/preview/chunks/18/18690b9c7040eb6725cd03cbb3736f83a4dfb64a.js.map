{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/season/SectionBattleLogItem.ts"],"names":["SectionBattleLogItem","Component","Label","path","Sprite","SpriteFrame","proto","folder_icon","ResMgr","CfgMgr","PlayerData","DateUtils","head","resultImg","timeLab","pointLab","data","isInit","onLoad","node","getChildByPath","getComponent","updateShow","SetData","dates","TimestampToDate","timestamp","string","playerData","battlePlayers","UserInfo","playerId","cfg","GetHead","deckAttrs","avatarId","headIconUrl","icon","LoadResAbSub","join","res","spriteFrame","imgStr","result","base","PvpResult","PvpResultWin","PvpResultLost","PvpResultTie","pointChange"],"mappings":"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","sourcesContent":["import { Component, Label, path, Sprite, SpriteFrame } from \"cc\";\r\nimport proto from \"../../net/Protocol\";\r\nimport { folder_icon, ResMgr } from \"../../manager/ResMgr\";\r\nimport { CfgMgr } from \"../../manager/CfgMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { DateUtils } from \"../../utils/DateUtils\";\r\n\r\nexport class SectionBattleLogItem extends Component {\r\n    private head: Sprite;\r\n    private resultImg: Sprite;\r\n    private timeLab: Label;\r\n    private pointLab: Label;\r\n    private data: proto.base.IPlayerPvpRankRecord;\r\n    private isInit: boolean = false;\r\n    protected onLoad(): void {\r\n        this.head = this.node.getChildByPath(\"head\").getComponent(Sprite);\r\n        this.resultImg = this.node.getChildByPath(\"resultImg\").getComponent(Sprite);\r\n        this.timeLab = this.node.getChildByPath(\"timeLab\").getComponent(Label);\r\n        this.pointLab = this.node.getChildByPath(\"pointLab\").getComponent(Label);\r\n       this.isInit = true;\r\n       if (this.data) this.updateShow();\r\n    }\r\n\r\n    \r\n    SetData(data: proto.base.IPlayerPvpRankRecord): void {\r\n        this.data = data;\r\n        this.updateShow();\r\n    }\r\n\r\n    private updateShow(): void {\r\n        if (!this.isInit || !this.data) return;\r\n        let dates: string[] = DateUtils.TimestampToDate(this.data.timestamp * 1000, true);\r\n        this.timeLab.string = `${dates[0]}-${dates[1]}-${dates[2]}  ${dates[3]}:${dates[4]}:${dates[5]}`;\r\n        let playerData: proto.base.IPlayerBattleContext = this.data.battlePlayers[PlayerData.UserInfo.playerId];\r\n        let cfg = CfgMgr.GetHead(playerData.deckAttrs.avatarId);\r\n        if(cfg){\r\n            let headIconUrl = cfg.icon\r\n            ResMgr.LoadResAbSub(path.join(folder_icon, \"head/\", headIconUrl, \"spriteFrame\"), SpriteFrame, res => {\r\n                this.head.spriteFrame =  res;\r\n            });\r\n        }\r\n\r\n        let imgStr: string;\r\n        if (this.data.result == proto.base.PvpResult.PvpResultWin) {\r\n            imgStr = \"win\";\r\n        } else if (this.data.result == proto.base.PvpResult.PvpResultLost) {\r\n            imgStr = \"lost\";\r\n        }else if (this.data.result == proto.base.PvpResult.PvpResultTie) {\r\n            imgStr = \"draw\";\r\n        }\r\n        ResMgr.LoadResAbSub(path.join(\"sheets/season\", imgStr, \"spriteFrame\"), SpriteFrame, (res: SpriteFrame) => {\r\n            this.resultImg.spriteFrame = res;\r\n        });\r\n        this.pointLab.string = this.data.pointChange >= 0 ? `+${this.data.pointChange}` : `-${this.data.pointChange}`;\r\n    }\r\n    \r\n}"]}