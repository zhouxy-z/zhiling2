{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/rights/RightsPanel.ts"],"names":["RightsPanel","Button","Label","Sprite","SpriteFrame","Toggle","Panel","AutoScroller","GatePass","RightsConvert","CfgMgr","PlayerData","ResMgr","prefab","bg","help","scroller","tab_list","onLoad","CloseBy","find","SetHandle","updateItem","bind","node","on","onSelect","addComponent","EventType","CLICK","onHelp","onShow","flush","seaid","CurSeasonData","currentSeasonId","_tab_list_1","getPlayerHasEuqityList","_tab_list_2","getEquityOpenCfg","element","index","delete_index","findIndex","data","EquityCardID","splice","length","UpdateDatas","SelectFirst","onPage","page","console","log","active","CardType","Show","item","icon1","getChildByName","getComponent","name1","icon2","getChildByPath","name2","LoadResAbSub","TabIcon","res","spriteFrame","string","TabName","isChecked","onHide"],"mappings":"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","sourcesContent":["import {Button, Input, Label, Node, Sprite, SpriteFrame, Toggle } from \"cc\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { GatePass } from \"./GatePass\";\r\nimport { RightsConvert } from \"./RightsConvert\";\r\nimport { CfgMgr, StdEquityCard } from \"../../manager/CfgMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\n\r\nexport class RightsPanel extends Panel {\r\n    protected prefab: string = \"prefabs/rights/RightsPanel\";\r\n\r\n  \r\n    private bg:Sprite;\r\n    private help:Button;\r\n    protected scroller: AutoScroller;\r\n    private GatePass:GatePass;\r\n    private RightsConvert:RightsConvert\r\n   \r\n\r\n    private tab_list:StdEquityCard[]\r\n    protected async onLoad() {\r\n        this.CloseBy(\"backBtn\");\r\n        this.help = this.find(\"help\", Button);\r\n        this.scroller = this.find(\"ScrollView\", AutoScroller);\r\n        this.scroller.SetHandle(this.updateItem.bind(this));\r\n        this.scroller.node.on('select', this.onSelect, this);\r\n        this.GatePass = this.find(\"content/GatePass\").addComponent(GatePass);\r\n        this.RightsConvert = this.find(\"content/RightsConvert\").addComponent(RightsConvert);\r\n\r\n        this.help.node.on(Button.EventType.CLICK, this.onHelp, this)\r\n    }\r\n\r\n    protected onShow(): void {\r\n     \r\n    }\r\n\r\n    public flush(...args: any[]): void {\r\n        let seaid = PlayerData.CurSeasonData.currentSeasonId\r\n        let _tab_list_1 = PlayerData.getPlayerHasEuqityList();\r\n        let _tab_list_2 =  CfgMgr.getEquityOpenCfg(seaid);\r\n        for (let index = 0; index < _tab_list_2.length; index++) {\r\n            const element = _tab_list_2[index];\r\n            let delete_index = _tab_list_1.findIndex(data=>data.EquityCardID == element.EquityCardID) \r\n            if(delete_index != -1){\r\n                _tab_list_1.splice(delete_index, 1)\r\n            }\r\n        }\r\n        this.tab_list = [..._tab_list_1, ..._tab_list_2]\r\n        this.scroller.UpdateDatas(this.tab_list)\r\n        this.scroller.SelectFirst()\r\n    }\r\n\r\n \r\n\r\n  \r\n    onPage(page: number) {\r\n        console.log(page)\r\n        this.GatePass.node.active = false;\r\n        this.RightsConvert.node.active = false;\r\n        let data = this.tab_list[page]\r\n        switch (data.CardType) {\r\n            case 1:\r\n                this.GatePass.node.active = true;\r\n                this.GatePass.Show(data)\r\n                break;\r\n            case 2:\r\n                this.RightsConvert.node.active = true;\r\n                this.RightsConvert.Show(data)\r\n                break;\r\n        \r\n            default:\r\n                break;\r\n        }\r\n       \r\n    }\r\n    private updateItem(item: Node, data: StdEquityCard, index: number) {\r\n        let icon1 = item.getChildByName(\"icon\").getComponent(Sprite)\r\n        let name1 = item.getChildByName(\"name\").getComponent(Label)\r\n        let icon2 = item.getChildByPath(\"Checkmark/icon\").getComponent(Sprite)\r\n        let name2 = item.getChildByPath(\"Checkmark/name\").getComponent(Label)\r\n        \r\n        ResMgr.LoadResAbSub(\"sheets/rights/icon/\" + data.TabIcon + \"/spriteFrame\", SpriteFrame, res=>{\r\n            icon1.spriteFrame = icon2.spriteFrame = res\r\n        })\r\n\r\n        name1.string = name2.string = data.TabName;\r\n\r\n    }\r\n    private onSelect(index: number, item: Node, data: any) {\r\n        console.log(data)\r\n        item.getComponent(Toggle).isChecked = true;\r\n        this.onPage(index);\r\n    }\r\n\r\n\r\n    private onHelp(){\r\n\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n\r\n    }\r\n\r\n}\r\n"]}