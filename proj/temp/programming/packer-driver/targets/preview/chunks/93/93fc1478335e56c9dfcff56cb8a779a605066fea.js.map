{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/friend/FriendHelpPanel.ts"],"names":["FriendHelpPanel","Input","Label","Slider","Sprite","SpriteFrame","Toggle","UITransform","Vec3","instantiate","path","Panel","PlayerData","STaskType","STaskState","STaskShowType","FriendHelpItem","CfgMgr","StdCommonType","Session","MsgTypeRet","MsgTypeSend","EventMgr","Evt_GetIncommons","Evt_SetAssistRole","Evt_TaskChange","GameSet","Convert","ToFixed","AutoScroller","BagItem","Tips","ResMgr","prefab","assistNode","Layout","item","left","right","page_lbl","navBtns","page1","itemNode","item0","help_num","rewardBtn","reward_num","fanyuNode","reward_items","scroller","progress","maxPage","curPage","pageSize","page","datas","canGetId","assistIncom","is_show","info","onLoad","CloseBy","find","node","getChildByPath","getComponent","on","EventType","TOUCH_END","onScroller","children","concat","btn","onPage","steItemData","getReward","updateItem","SetAssistRoleUsageFeeRet","SetAssistRoleUsageFee","updateFanyuPage","CollectAssistIncomeRet","updateAssistIncom","flush","onShow","spr_path","GetServerMark","spriteFrame","LoadResAbSub","join","seRoletAssistData","setFanyuAssistData","updateAssistLabelCoun","SetPage","assistHelpData","cfg","GetCommon","Friend","lock","FieldUnlock","i","length","data","islock","lockCost","all_unlock_coun","assistInfo","role","assist_roles_slots","index","assist_roles","slot","role_data_list","role_id","player_id","usage_fee","battle_power","daily_assist_count","daily_income","push","fanyuHelpData","task_data","roleInfo","tasks","key","Object","prototype","hasOwnProperty","call","element","stdTask","GetTaskById","id","Show","friend","TaskType","fanyuHelp","v","CompletionNum","s","unFinsh","$hasLoad","initSub","undefined","isChecked","toggle","indexOf","active","maxCount","Math","ceil","string","SpacingX","width","removeAllChildren","count","unlock_num","box","position","getChildByName","item_unlock","item_get","Finsh","addChild","setContentSize","off","onItem","type","CollectAssistIncomeRequest","amount","Send","unshift","item_node","addComponent","setData","pos","fee","GetRoleById","event","currentTarget","getSiblingIndex","p","x","y","parent","setPosition","height","getTaskRewardThings","itemLayout","SetHandle","UpdateBagItem","bind","UpdateDatas","CompleteTask","task_id","CompleteTaskRet","bagItem","SetData","setIsShowSelect","setIsShowTips","enabled","total_assist_income","shownum","onHide","clearTime"],"mappings":"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","sourcesContent":["import { Button, EventTouch, Input, Label, Layout, Node, Prefab, SH, ScrollView, Slider, Sprite, SpriteFrame, Toggle, UIOpacity, UITransform, Vec3, instantiate, path, v3 } from \"cc\";\r\nimport { Panel } from \"../../GameRoot\";\r\nimport PlayerData from \"../roleModule/PlayerData\"\r\n import {STaskType,SGetAgentInfo,SGetIncomes,SIncomesInfo,SPlayerDataItem,SPlayerDataTask,STaskState,STaskShowType,SThing} from \"../roleModule/PlayerStruct\";\r\nimport { FriendHelpItem } from \"./FriendHelpItem\";\r\nimport { CfgMgr, StdCommonType, StdRole } from \"../../manager/CfgMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { MsgTypeRet, MsgTypeSend } from \"../../MsgType\";\r\nimport { EventMgr, Evt_GetIncommons, Evt_SetAssistRole, Evt_TaskChange } from \"../../manager/EventMgr\";\r\nimport { GameSet } from \"../GameSet\";\r\nimport { Convert, ToFixed } from \"../../utils/Utils\";\r\nimport { AutoScroller } from \"../../utils/AutoScroller\";\r\nimport { BagItem } from \"../bag/BagItem\";\r\nimport { Tips } from \"../login/Tips\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\n\r\nexport class FriendHelpPanel extends Panel {\r\n    protected prefab: string = \"prefabs/panel/friend/FriendHelpPanel\";\r\n\r\n    private assistNode: Node;\r\n    private Layout: Node;\r\n    private item: Node;\r\n    private left: Node;\r\n    private right: Node;\r\n    private page_lbl: Label;\r\n    private navBtns: Node[];\r\n    private page1: Node;\r\n    private Slider: Slider;\r\n    private itemNode: Node;\r\n    private item0: Node;\r\n    private help_num: Label;\r\n    private rewardBtn: Node;\r\n    private reward_num: Label;\r\n    \r\n    private fanyuNode: Node;\r\n    private reward_items:Node;\r\n    protected scroller: ScrollView;\r\n    private progress:Node;\r\n    \r\n    private maxPage: number = 1\r\n    private curPage: number = 1;\r\n    private pageSize: number = 2;\r\n    private page: number\r\n    private datas = [];\r\n    private canGetId = [];\r\n    private assistIncom: number = 0;\r\n    private is_show = false;\r\n    private info: SGetAgentInfo;\r\n\r\n\r\n\r\n\r\n    protected onLoad(): void {\r\n        this.CloseBy(\"mask\");\r\n        this.CloseBy(\"frame/closeBtn\");\r\n        this.rewardBtn = this.find(\"frame/assistNode/banner/rewardBtn\");\r\n        this.reward_num = this.node.getChildByPath(\"frame/assistNode/banner/rewardBtn/reward_num\").getComponent(Label);\r\n        this.assistNode = this.find(\"frame/assistNode\");\r\n        this.Layout = this.find(\"frame/assistNode/Layout\");\r\n        this.item = this.find(\"frame/assistNode/Layout/FriendHelpItem\");\r\n        this.left = this.node.getChildByPath(\"frame/assistNode/pageBg/left\");\r\n        this.right = this.node.getChildByPath(\"frame/assistNode/pageBg/right\");\r\n        this.page_lbl = this.node.getChildByPath(\"frame/assistNode/pageBg/page_lbl\").getComponent(Label);\r\n        this.help_num = this.node.getChildByPath(\"frame/fanyuNode/banner/lblNode/help_num\").getComponent(Label);\r\n        this.page1 = this.node.getChildByPath(\"frame/fanyuNode/ScrollView/view/content/page1\")\r\n        this.Slider = this.find(\"frame/fanyuNode/ScrollView/view/content/page1/Slider\",Slider)\r\n        this.progress = this.node.getChildByPath(\"frame/fanyuNode/ScrollView/view/content/page1/Slider/progress\")\r\n        \r\n\r\n        this.fanyuNode = this.find(\"frame/fanyuNode\");\r\n        this.itemNode = this.node.getChildByPath(\"frame/fanyuNode/ScrollView/view/content/page1/itemNode\");\r\n        this.item0 = this.node.getChildByPath(\"frame/fanyuNode/ScrollView/view/content/page1/itemNode/item0\");\r\n        this.reward_items = this.node.getChildByPath(\"frame/fanyuNode/reward_items\");\r\n        this.reward_items.on(Input.EventType.TOUCH_END,this.onScroller, this);  \r\n        \r\n        this.navBtns = this.find(\"frame/nav\").children.concat();\r\n        for (let btn of this.navBtns) {\r\n            btn.on('toggle', this.onPage, this);\r\n        }\r\n        this.left.on(Input.EventType.TOUCH_END, () => {\r\n            if (this.curPage > 1) {\r\n                this.curPage--;\r\n                this.steItemData();\r\n            }\r\n        })\r\n\r\n        this.right.on(Input.EventType.TOUCH_END, () => {\r\n            this.curPage++;\r\n            if (this.curPage <= this.maxPage) {\r\n                this.steItemData();\r\n            } else {\r\n                this.curPage--;\r\n            }\r\n        })\r\n\r\n        this.rewardBtn.on(Input.EventType.TOUCH_END, this.getReward, this)\r\n        EventMgr.on(Evt_SetAssistRole, this.updateItem, this);\r\n        // Session.on(MsgTypeRet.UnlockAssistRoleSlotRet, this.unlockPos, this);\r\n        Session.on(MsgTypeRet.SetAssistRoleUsageFeeRet, this.SetAssistRoleUsageFee, this);\r\n        EventMgr.on(Evt_TaskChange, this.updateFanyuPage, this);\r\n        Session.on(MsgTypeRet.CollectAssistIncomeRet, this.updateAssistIncom, this);\r\n        EventMgr.on(Evt_GetIncommons, this.flush, this)\r\n    }\r\n\r\n    protected onShow(): void {\r\n    }\r\n\r\n    async flush(info: SGetAgentInfo) {\r\n        this.info = info;\r\n        let spr_path = \"qi_pao\";\r\n        if(GameSet.GetServerMark() == \"hc\"){\r\n            spr_path = \"qi_pao_hc\";\r\n        }\r\n        this.rewardBtn.getComponent(Sprite).spriteFrame = await ResMgr.LoadResAbSub(path.join(\"sheets/friend\", spr_path, \"spriteFrame\"), SpriteFrame);\r\n        this.seRoletAssistData();\r\n        this.setFanyuAssistData();\r\n        this.updateAssistLabelCoun();\r\n        this.SetPage(0);\r\n    }\r\n\r\n    \r\n    private seRoletAssistData(){\r\n        let info = this.info;\r\n        let assistHelpData = []\r\n        let cfg = CfgMgr.GetCommon(StdCommonType.Friend);\r\n        let lock = cfg.FieldUnlock\r\n        for (let i = 0; i < lock.length; i++) {\r\n            let data = { islock: false, lockCost: 0, all_unlock_coun: 0, assistInfo: null, role: null };\r\n            data.all_unlock_coun = i;\r\n            //解锁\r\n            if (info && info.assist_roles_slots && i < info.assist_roles_slots) {\r\n                for (let index = 0; index < info.assist_roles_slots; index++) {\r\n                    //有解锁的数量          \r\n                    data.islock = true;\r\n                    if (info.assist_roles && info.assist_roles[index] && i == info.assist_roles[index].slot) {\r\n                        //已解锁有角色\r\n                        data.assistInfo = info.assist_roles[index];\r\n                        data.role = info.role_data_list[index];\r\n                        break;\r\n                    } else {\r\n                        //已解锁未有角色\r\n                        data.role = null;\r\n                        data.assistInfo = {\r\n                            role_id: \"\",\r\n                            player_id: \"\",\r\n                            slot: i,\r\n                            usage_fee: 0,\r\n                            battle_power: 0,\r\n                            daily_assist_count: 0,\r\n                            daily_income: 0,\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                //未解锁\r\n                data.islock = false;\r\n                data.lockCost = lock[i];\r\n                data.role = null;\r\n                data.assistInfo = {\r\n                    role_id: \"\",\r\n                    player_id: \"\",\r\n                    slot: i,\r\n                    usage_fee: 0,\r\n                    battle_power: 0,\r\n                    daily_assist_count: 0,\r\n                    daily_income: 0,\r\n                }\r\n            }\r\n            assistHelpData.push(data);\r\n        }\r\n        if(!this.datas[0]){\r\n            this.datas.push(assistHelpData);\r\n        }else{\r\n            this.datas[0] = assistHelpData;\r\n        }\r\n    }\r\n\r\n    private setFanyuAssistData(){\r\n        let info = this.info;\r\n        let fanyuHelpData = []\r\n        let task_data = PlayerData.roleInfo.tasks;\r\n        for (const key in task_data) {\r\n            if (Object.prototype.hasOwnProperty.call(task_data, key)) {\r\n                const element = task_data[key];\r\n                let stdTask = CfgMgr.GetTaskById(element.id);\r\n                if (stdTask && stdTask.Show == STaskShowType.friend) {\r\n                    if (stdTask.TaskType == STaskType.fanyuHelp) {\r\n                        fanyuHelpData.push(element);\r\n                        if (element.v >= stdTask.CompletionNum && element.s == STaskState.unFinsh) {\r\n                            this.canGetId.push(element.id)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(!this.datas[1]){\r\n            this.datas.push(fanyuHelpData);\r\n        }else{\r\n            this.datas[1] = fanyuHelpData;\r\n        }\r\n    }\r\n\r\n    async SetPage(page: number) {\r\n        if (!this.$hasLoad) await this.initSub;\r\n        if (!this.navBtns[page]) return;\r\n        this.page = undefined;\r\n        this.navBtns[page].getComponent(Toggle).isChecked = true;\r\n        this.onPage(this.navBtns[page].getComponent(Toggle));\r\n    }\r\n\r\n    private onPage(toggle: Toggle) {\r\n        let page = this.navBtns.indexOf(toggle.node);\r\n        if (page < 0 || page == this.page) return;\r\n        this.page = page;\r\n        this.assistNode.active = false;\r\n        this.fanyuNode.active = false;\r\n        switch (this.page) {\r\n            case 0:\r\n                this.assistNode.active = true;\r\n                let maxCount = this.datas[0].length;\r\n                this.maxPage = Math.ceil(maxCount / this.pageSize)\r\n                this.page_lbl.string = this.curPage + \"/\" + (this.maxPage == 0 ? 1 : this.maxPage);\r\n                this.steItemData();\r\n                break;\r\n            case 1:\r\n                this.reward_items.active = this.is_show;\r\n                let SpacingX = 240\r\n                let data = this.datas[1];\r\n                this.fanyuNode.active = true;\r\n                this.page1.getComponent(UITransform).width = data.length * SpacingX;\r\n                this.Slider.node.getComponent(UITransform).width = data.length * SpacingX;\r\n                if(!data || data.length == 0) return;\r\n                this.help_num.string = data[0].v + \"\"\r\n                this.itemNode.removeAllChildren();\r\n                let count = data.length;\r\n                let unlock_num = 0;\r\n                for (let index = 0; index < count; index++) {\r\n                    let box = instantiate(this.item0);\r\n                    box.position = new Vec3(SpacingX * (index + 1) - 20, -80, 0);\r\n                    let cfg = CfgMgr.GetTaskById(data[index].id);\r\n                    let CompletionNum = box.getChildByName(\"CompletionNum\").getComponent(Label);\r\n                    CompletionNum.string = \"已协作\" + cfg.CompletionNum + \"次\";\r\n\r\n                    let item_unlock = box.getChildByName(\"unlock\");\r\n                    let item_get = box.getChildByName(\"get\");\r\n                    item_unlock.active = cfg.CompletionNum > data[index].v;\r\n                    if(cfg.CompletionNum <= data[index].v){\r\n                        unlock_num++;\r\n                    }\r\n                    item_get.active = data[index].s == STaskState.Finsh\r\n                    this.itemNode.addChild(box);\r\n                }\r\n                // let size = this.Slider.getComponent(UITransform).contentSize;\r\n                this.progress.getComponent(UITransform).setContentSize(unlock_num * SpacingX, 28);\r\n                for (let index = 0; index < this.itemNode.children.length; index++) {\r\n                    const element = this.itemNode.children[index];\r\n                    element.off(Input.EventType.TOUCH_END)\r\n                    element.on(Input.EventType.TOUCH_END, this.onItem, this);   \r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n    //---------------------------角色助战相关-------------------------------------\r\n    private getReward() {\r\n        if(this.assistIncom){\r\n            let info = {\r\n                type: MsgTypeSend.CollectAssistIncomeRequest,\r\n                data: { amount: this.assistIncom }\r\n            }\r\n            Session.Send(info);\r\n        }else{\r\n            Tips.Show(\"暂无奖励领取\")\r\n        }\r\n    }\r\n\r\n    private steItemData() {\r\n        this.page_lbl.string = this.curPage + \"/\" + (this.maxPage == 0 ? 1 : this.maxPage);\r\n        let data = [];\r\n        let i = this.curPage * this.pageSize;\r\n        for (let index = 0; index < this.pageSize; index++) {\r\n            const element = this.datas[0][--i]\r\n            if (element) {\r\n                data.unshift(element)\r\n            }\r\n        }\r\n        if (data.length > 0) {\r\n            this.Layout.removeAllChildren();\r\n            for (let index = 0; index < data.length; index++) {\r\n                let node = instantiate(this.item)\r\n                let item_node = node.getComponent(FriendHelpItem);\r\n                if (!item_node) item_node = node.addComponent(FriendHelpItem);\r\n                item_node.setData(data[index], this.info);\r\n                this.Layout.addChild(node);\r\n            }\r\n        }\r\n    }\r\n\r\n    //助战或者取消助战后刷新数据\r\n    private updateItem(data: { fee: number, role_id: string, slot: number }) {\r\n        if(!this.datas || !this.datas[0]) return;\r\n        let pos = (data.slot % 2 == 0) ? 0 : 1\r\n        for (let index = 0; index < this.datas[0].length; index++) {\r\n            const element = this.datas[0][index];\r\n            if (index == data.slot && element) {\r\n                element.assistInfo.usage_fee = data.fee;\r\n                element.assistInfo.slot = data.slot;\r\n                if (data.role_id) {\r\n                    element.role = PlayerData.GetRoleById(data.role_id);\r\n                } else {\r\n                    element.role = null;\r\n                }\r\n                let node = this.Layout.children[pos];\r\n                let item_node = node.getComponent(FriendHelpItem);\r\n                if (!item_node) item_node = node.addComponent(FriendHelpItem);\r\n                item_node.setData(element, this.info);\r\n            }\r\n        }\r\n    }\r\n\r\n    // //解锁刷新数据\r\n    // private unlockPos(data: { new_slot_count: number }) {\r\n    //     //解锁数量比位置少一\r\n    //     let pos = (data.new_slot_count % 2 == 0) ? 1 : 0\r\n    //     let slot = data.new_slot_count - 1;\r\n    //     for (let index = 0; index < this.datas[0].length; index++) {\r\n    //         const element = this.datas[0][index];\r\n    //         if (element && element.assistInfo.slot == slot) {\r\n    //             element.islock = true;\r\n\r\n    //             let node = this.Layout.children[pos];\r\n    //             let item_node = node.getComponent(FriendHelpItem);\r\n    //             if (!item_node) item_node = node.addComponent(FriendHelpItem);\r\n    //             item_node.setData(element);\r\n    //         }\r\n    //     }\r\n    // }\r\n\r\n    /**设置助战费用后刷新数据 */\r\n    private SetAssistRoleUsageFee(data:{role_id:string, usage_fee:number}) {\r\n        for (let index = 0; index < this.datas[0].length; index++) {\r\n            const element = this.datas[0][index];\r\n            if (element && element.assistInfo && element.assistInfo.role_id == data.role_id) {\r\n                element.assistInfo.usage_fee = data.usage_fee;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    //---------------------------------\r\n    //-----------------------------繁育相关--------------------------- /\r\n    private onItem(event:EventTouch){\r\n        let node = event.currentTarget;\r\n        let index = node.getSiblingIndex();  \r\n        if(node.getChildByName(\"unlock\").active){\r\n            let p = node.position;\r\n            let [x, y] = Convert(p.x, p.y, node.parent, this.fanyuNode);\r\n            this.reward_items.active = true\r\n            this.reward_items.setPosition(x, y + node.getComponent(UITransform).height / 2);\r\n            \r\n\r\n            let datas = CfgMgr.getTaskRewardThings(this.datas[1][index].id);\r\n            let itemLayout = this.reward_items.getChildByPath(`Node/ScrollView`).getComponent(AutoScroller);\r\n            itemLayout.SetHandle(this.UpdateBagItem.bind(this));\r\n            itemLayout.UpdateDatas(datas);\r\n        }else{\r\n            if(this.datas[1][index].s == STaskState.unFinsh){\r\n                let info = {\r\n                    type: MsgTypeSend.CompleteTask,\r\n                    data: {\r\n                        task_id: this.datas[1][index].id\r\n                    }\r\n                }\r\n                Session.Send(info, MsgTypeRet.CompleteTaskRet);\r\n            }else{\r\n                Tips.Show(\"已领取\")\r\n            }\r\n        }\r\n    }\r\n\r\n    private UpdateBagItem(item: Node, data: SThing) {\r\n        let bagItem = item.getComponent(BagItem);\r\n        if (!bagItem) bagItem = item.addComponent(BagItem);\r\n        bagItem.SetData(data);\r\n        bagItem.setIsShowSelect(false);\r\n        bagItem.setIsShowTips(true);\r\n        item.getComponent(Toggle).enabled = false;\r\n        // item.getChildByName(`name`).active = false;\r\n    }\r\n\r\n    private onScroller(){\r\n        this.reward_items.active = false;\r\n    }\r\n\r\n    private updateFanyuPage(){\r\n        this.setFanyuAssistData();\r\n        this.SetPage(1);\r\n    }\r\n\r\n    private updateAssistLabelCoun(){\r\n        if (this.info && this.info.total_assist_income){\r\n            this.assistIncom = this.info.total_assist_income;\r\n        }else{\r\n            this.assistIncom = 0;\r\n        }\r\n        let shownum = ToFixed(this.assistIncom, 2);\r\n        this.reward_num.string = shownum;\r\n    }\r\n\r\n    private updateAssistIncom(){   \r\n        this.assistIncom = 0;\r\n        let shownum = ToFixed(this.assistIncom, 2);\r\n        this.reward_num.string = shownum;\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n        this.datas = [];\r\n        this.canGetId = [];\r\n        EventMgr.off(Evt_TaskChange, this.updateFanyuPage, this);\r\n        for (let index = 0; index < this.Layout.children.length; index++) {\r\n            const element = this.Layout.children[index];\r\n            let item_node = element.getComponent(FriendHelpItem);\r\n            item_node.clearTime();\r\n        }\r\n    }\r\n}"]}