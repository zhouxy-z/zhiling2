{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/battle/opOutput/Out_HandToDrop_2d.ts"],"names":["Out_HandToDrop_2d","tween","UITransform","v3","BattleBaseComp","battleLogicMgr","BattleCard","battleDataMgr","start","showCardLayer","active","data","card","creatCard","console","error","exit","reset","targetPos","startPos","layerTrans","getComponent","isPlayerA","ownerPlayerId","grid","handGridList","cardData","instId","node","worldPosition","setData","convertToWorldSpaceAR","width","height","cardNode","fromPoolCard","cardCom","addComponent","parent","layer","to","easing","call","putCardToPool"],"mappings":"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","sourcesContent":["import { Node, tween, UITransform, v3, Vec3 } from \"cc\";\r\nimport { base } from \"../../../net/proto/proto\";\r\nimport { BattleBaseComp } from \"../BattleBaseComp\";\r\nimport { battleLogicMgr } from \"../BattleLogicMgr\";\r\nimport { BattleCard } from \"../BattleCard\";\r\nimport { battleDataMgr } from \"../BattleDataMgr\";\r\n/**\r\n * 从手卡区到弃卡区\r\n */\r\nexport class Out_HandToDrop_2d extends BattleBaseComp<base.IBattleRoomOpOutput_HandToDrop> {\r\n    protected start(): void {\r\n        battleLogicMgr.showCardLayer.active = true;\r\n        if (this.data.card) {\r\n            this.creatCard();\r\n        } else {\r\n            console.error(\"弃卡数据为空\");\r\n            this.exit();\r\n        }\r\n    }\r\n\r\n    protected reset(): void {\r\n        battleLogicMgr.showCardLayer.active = false;\r\n    }\r\n\r\n    private creatCard(): void {\r\n        let targetPos: Vec3;\r\n        let startPos: Vec3;\r\n        let layerTrans: UITransform = battleLogicMgr.showCardLayer.getComponent(UITransform);\r\n        //第一视觉补牌\r\n        if (battleDataMgr.isPlayerA(this.ownerPlayerId)) {\r\n            for (let grid of battleLogicMgr.handGridList) {\r\n                if (grid.cardData && grid.cardData.instId == this.data.card.instId) {\r\n                    startPos = grid.node.worldPosition;\r\n                    grid.setData(null);\r\n                    break;\r\n                }\r\n            }\r\n            targetPos = layerTrans.convertToWorldSpaceAR(v3(-layerTrans.width * 0.5, 0, 0));\r\n        } else {\r\n            startPos = layerTrans.convertToWorldSpaceAR(v3(0, layerTrans.height * 0.5, 0));\r\n            targetPos = layerTrans.convertToWorldSpaceAR(v3(-layerTrans.width * 0.5, 0, 0));\r\n        }\r\n\r\n        let cardNode: Node = battleLogicMgr.fromPoolCard;\r\n        let cardCom: BattleCard = cardNode.getComponent(BattleCard) || cardNode.addComponent(BattleCard);\r\n        cardCom.setData(this.data.card);\r\n        cardNode.parent = battleLogicMgr.showCardLayer;\r\n        cardNode.layer = cardNode.parent.layer;\r\n        cardNode.worldPosition = startPos;\r\n        cardNode.active = true;\r\n        \r\n        tween(cardCom.node)\r\n        .to(0.5, { worldPosition: targetPos }, { easing: 'cubicIn' })\r\n        .call(()=>{\r\n            battleLogicMgr.putCardToPool(cardNode);\r\n            this.exit();\r\n        })\r\n        .start();\r\n    }\r\n\r\n    \r\n}"]}