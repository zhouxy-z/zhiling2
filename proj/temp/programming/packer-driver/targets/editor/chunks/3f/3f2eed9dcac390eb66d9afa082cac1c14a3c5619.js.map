{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/utils/Selector.ts"],"names":["_decorator","Canvas","Component","EditBox","Input","Node","UITransform","AutoScroller","Utils","ccclass","property","Selector","datas","layout","onLoad","scroller","node","parent","open","on","EventType","TOUCH_END","onOpen","onSelect","input","onInput","size","getComponent","contentSize","h","height","setContentSize","width","start","update","deltaTime","Init","updateItem","craeteItem","UpdateList","SetHandle","Select","index","data","string","value","HideList","onHide","UpdateDatas","current","undefined","emit","editbox","e","active","onShow","getRoot","root","p","position","x","y","Convert","addChild","setPosition"],"mappings":"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","sourcesContent":["import { _decorator, Canvas, Component, EditBox, EventTouch, find, Input, Node, ScrollView, UITransform } from 'cc';\r\nimport { AutoScroller } from '../component/AutoScroller';\r\nimport { Utils } from './Utils';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Selector')\r\nexport class Selector extends Component {\r\n\r\n    @property(EditBox)\r\n    private input: EditBox;\r\n\r\n    @property(Node)\r\n    private open: Node;\r\n\r\n    @property(AutoScroller)\r\n    private scroller: AutoScroller;\r\n\r\n    private static current: Selector;\r\n\r\n    private datas: any[] = [];\r\n    private layout: Node;\r\n\r\n    protected onLoad(): void {\r\n        this.layout = this.scroller.node.parent;\r\n        this.open.on(Input.EventType.TOUCH_END, this.onOpen, this);\r\n        this.scroller.node.on(\"select\", this.onSelect, this);\r\n        this.input.node.on(\"editing-did-ended\", this.onInput, this);\r\n\r\n        let size = this.getComponent(UITransform).contentSize;\r\n        let h = this.scroller.node.getComponent(UITransform).contentSize.height;\r\n        this.scroller.node.getComponent(UITransform).setContentSize(size.width, h);\r\n    }\r\n\r\n    start() {\r\n\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    /**\r\n     * 更新\r\n     * @param updateItem \r\n     * @param craeteItem \r\n     */\r\n    Init(datas: any[], updateItem: (item: Node, data: any) => void, craeteItem?: () => Node) {\r\n        this.UpdateList(datas);\r\n        this.scroller.SetHandle(updateItem, craeteItem);\r\n    }\r\n\r\n    Select(index: number) {\r\n        let data = this.datas[index];\r\n        this.scroller.updateItem(this.input.node, data, index);\r\n        return this.input.string;\r\n    }\r\n\r\n    get string() {\r\n        return this.input.string;\r\n    }\r\n    set string(value: string) {\r\n        this.input.string = value;\r\n    }\r\n\r\n    HideList() {\r\n        this.onHide();\r\n    }\r\n\r\n    UpdateList(datas: any[]) {\r\n        this.datas = datas;\r\n        this.scroller.UpdateDatas(datas);\r\n    }\r\n\r\n    private onSelect(index: number) {\r\n        if (Selector.current != this) Selector.current = undefined;\r\n        this.onHide();\r\n        let data = this.Select(index);\r\n        if (data == \"\" || data == undefined) return;\r\n        this.node.emit(\"select\", data, this.datas[index]);\r\n    }\r\n    private onInput(editbox: EditBox) {\r\n        let value = editbox.string;\r\n        if (value == \"\" || value == undefined) return;\r\n        this.node.emit(\"select\", value);\r\n    }\r\n    private onOpen(e: EventTouch) {\r\n        if (Selector.current && Selector.current != this) {\r\n            Selector.current.onHide();\r\n        }\r\n        if (this.scroller.node.active) {\r\n            if (Selector.current != this) Selector.current = undefined;\r\n            this.onHide();\r\n        } else {\r\n            Selector.current = this;\r\n            this.onShow();\r\n            this.scroller.UpdateDatas(this.datas);\r\n        }\r\n        this.node.emit(\"open\");\r\n    }\r\n\r\n    protected getRoot(node: Node) {\r\n        let parent: Node = node.parent;\r\n        while (parent && !parent.getComponent(Canvas)) {\r\n            if (parent.parent) {\r\n                parent = parent.parent;\r\n            } else {\r\n                break;\r\n            }\r\n        }\r\n        return parent;\r\n    }\r\n\r\n    private onShow() {\r\n        let root = this.getRoot(this.scroller.node);\r\n        let p = this.scroller.node.position;\r\n        let [x, y] = Utils.Convert(p.x, p.y, this.layout, root);\r\n        this.scroller.node.active = true;\r\n        root.addChild(this.scroller.node);\r\n        this.scroller.node.setPosition(x, y);\r\n    }\r\n    private onHide() {\r\n        let root = this.scroller.node.parent\r\n        let p = this.scroller.node.position;\r\n        let [x, y] = Utils.Convert(p.x, p.y, root, this.layout);\r\n        this.layout.addChild(this.scroller.node);\r\n        this.scroller.node.setPosition(x, y);\r\n        this.scroller.node.active = false;\r\n    }\r\n}\r\n\r\n\r\n"]}