{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/debug/wyc/TestCard.ts"],"names":["_decorator","Camera","Component","find","geometry","Input","v3","view","Card","ccclass","property","TestCard","canvas","card","touch","mainCamera","uiCamera","plane","start","on","EventType","TOUCH_START","onStart","TOUCH_END","onEnd","getComponent","Create","Plane","create","e","onMove","TOUCH_MOVE","undefined","parent","removeChild","off","p","rayHit","size","getVisibleSize","pos","getUILocation","x","width","y","height","update","deltaTime","addChild","Reset","Drag","getLocation","ray","screenPointToRay","len","intersect","rayPlane","result","computeHit"],"mappings":"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","sourcesContent":["import { _decorator, Camera, Canvas, Component, EventTouch, find, geometry, Input, math, Node, UITransform, v3, view } from 'cc';\r\nimport { Card } from '../../module/fight/display/Card';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('TestCard')\r\nexport class TestCard extends Component {\r\n    protected canvas: Node;\r\n    protected card: Card;\r\n    protected touch: any;\r\n    protected mainCamera: Camera;\r\n    protected uiCamera: Camera;\r\n    protected plane: geometry.Plane;\r\n\r\n    start() {\r\n        this.canvas = find(\"Canvas\");\r\n        this.canvas.on(Input.EventType.TOUCH_START, this.onStart, this);\r\n        this.canvas.on(Input.EventType.TOUCH_END, this.onEnd, this);\r\n        this.mainCamera = find(\"Main Camera\").getComponent(Camera);\r\n        this.uiCamera = find(\"Canvas/Camera\").getComponent(Camera);\r\n\r\n        this.card = Card.Create();\r\n        this.plane = geometry.Plane.create(0, 0, 1, 0.1);\r\n    }\r\n\r\n    onStart(e) {\r\n        this.onMove(e);\r\n        this.canvas.on(Input.EventType.TOUCH_MOVE, this.onMove, this);\r\n    }\r\n    onEnd(e) {\r\n        this.touch = undefined;\r\n        this.card.parent && this.card.parent.removeChild(this.card);\r\n        this.canvas.off(Input.EventType.TOUCH_MOVE, this.onMove, this);\r\n        let p = this.rayHit(e);\r\n    }\r\n    onMove(e: EventTouch) {\r\n        let size = view.getVisibleSize();\r\n        let pos = e.getUILocation();\r\n        this.touch = { x: pos.x - size.width / 2, y: pos.y - size.height / 2 };\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n        if (this.touch) {\r\n            if (!this.card.parent) {\r\n                this.canvas.addChild(this.card);\r\n                this.card.Reset(this.touch.x, this.touch.y);\r\n            } else {\r\n                this.card.Drag(this.touch.x, this.touch.y);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected rayHit(e: EventTouch) {\r\n        let pos = e.getLocation();\r\n        let ray = this.mainCamera.screenPointToRay(pos.x, pos.y);\r\n        let len = geometry.intersect.rayPlane(ray, this.plane);\r\n        let result = v3();\r\n        ray.computeHit(result, len);\r\n        return result;\r\n    }\r\n}\r\n\r\n\r\n"]}