{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/GameScene.ts"],"names":["cardLoca","node","isMy","area","cardData","card","index","TouchInstId","data","fromInstId","undefined","_decorator","Component","director","find","Input","instantiate","Label","math","Node","ParticleSystem","path","Rect","sp","Sprite","SpriteFrame","tween","UITransform","v3","Vec3","view","GameSet","CardState","SceneCard","PlaneView","Second","TimeStamp","Utils","folder_icon","ResMgr","Skill","Battle_End_Round","EventMgr","Evt_BattleDoubleUpdate","Evt_ShowBattleDoubleEffect","Session","proto","Req","Ret","Route","PlayerData","battleDataMgr","BattleRoundOperationState","SkillUtils","CfgMgr","EffectTarget","MsgPanel","ShowArea","FightData","GameObj","SpriteLabel","AudioMgr","AudioDefine","ccclass","property","GameScene","handCenter","handRotation","myCardEnterV","adCardEnterV","PeekHandV","handQuat","areaList","areaSize","adTeamLayout","myTeamLayout","cardMap","selectEffects","handCards","selectedCard","areaTarget","canvas","areaCardLay","handCardLay","peekCardLay","uiView","handView","ui","myDeck","myHand","myDrop","myDel","myEnergy","adDeck","adHand","adDrop","adDel","adEnergy","revealCard","showArea","myhead","myNameLab","myRevealEffect","adhead","adNameLab","adRevealEffect","ruondBtn","roundBtnLab","progress","jshhEffect","qxjshhEffect","notTimeEffect","roundBtnMaskBg","exitBtn","energyLab","doubleBtn","doubleLab","isWaitInput","mask","zero","dropToHand","canMove","canDrop","operateHandle","roundProgress","roundState","isntance","_instance","prevLoad","loadSub","Promise","resolve","reject","GetResources","prefab","addComponent","Show","getScene","addChild","active","hasLoad","sub","onShow","Hide","RemoveAll","Reset","onHide","parent","removeChild","StopChannel","Channels","channel","Play","FlushRoundBtnStrState","EndRound","FlushRevealPlayer","AddTouchEffect","e","w","h","TestSize","checkTouch","PixelSize","emit","clickEffect","getChildByName","getComponent","Skeleton","clearAnimation","setAnimation","setCompleteListener","roomData","getPlayerDoubleResidue","getPlayerId","server","pb","Server","create","id","creatRoomData","serverId","roomId","Send","console","log","on","onBattleroomping","onBattleDoubleUpdate","hideViewCard","debug","off","DelTouchEffect","addCont","isUpdate","num","getRoomDoubleNum","oldNum","Number","string","worldPosition","Settlement","myPower","adPower","mywin","adwin","result","decode","res","code","onBattleroomdouble","onLoad","SceneHight","mainCamera","position","y","ls","s","k","split","pop","getChildByPath","forward","negative","rx","ry","rz","EulerAngles","setWorldRotationFromEuler","child","children","UNIT_Y","HandPlane","plane","getWorldRotation","v","localRightDown","set","x","z","CardHide","transformMat4","mat","getEulerAngles","getWorldPosition","i","frameSelect","p","clone","setPosition","setSiblingIndex","push","layout","concat","sk","CheckAnimation","getCurrent","animation","name","hitTest1","hitTest2","hitSize","contentSize","rect","width","p1","p2","setWorldPosition","ScreenToPlane","viewSize","height","setLocalLeftDown","setLocalRightUp","toString","setLocalRightDown","font","size","getVisibleSizeInPixel","ShowPoint","ScenePlane","ScreamRotation","quat","out","Quat","fromEuler","forEach","value","destroy","removeAllChildren","Create","loadHandle","skillTarget","attacker","targets","myarea","adarea","myAreas","adAreas","idx","loca","EndAllAction","EndAll","action","end","obj","running","StartOperate","playHandCard","EventType","TOUCH_START","onTouchStart","TOUCH_END","onTouchEnd","TOUCH_CANCEL","EndOperate","UnSelect","TOUCH_MOVE","onTouchMove","StopDrag","LayoutAllHandCards","LayoutAllArea","pt","getLocation","State","Handing","HitTest","msg","instId","flushSelectEffect","Drag","length","Math","abs","invertMat","Id","isDragging","viewCard","failType","state","pos","EndViewCard","filed","sd","skeletonData","desc","View","InitData","ViewCard","isFull","FlushPlayerInfo","isPlayerA","cfg","GetHead","deckAttr","avatarId","headName","icon","LoadResAbSub","join","spriteFrame","FlushRound","curRoundNum","maxRound","color","fillRange","PlaceRound","CancelRound","FlushRoundTime","time","isHaveEnergy","totalTime","rote","b","FlushEnergy","Energy","tt","fromSkillId","findCard","target","tag","update","dt","sorts","getSiblingIndex","sort","a","AddHandCard","cards","findIndex","FlushData","splice","total","CardWide","LayoutHands","promises","newCard","promise","SendToHand","all","ps","CopyCardToUnVisible","fromData","fromCard","fileLocation","location","MoveTo","receive","FlushHandCard","datas","max","SendMyCardToArea","error","PlayToMyArea","rotation","SendAdCardToArea","PlayToAdArea","FlushTerrain","ispLayerA","ownerPlayerId","terrainDatas","Reveal","TerrainInstIds","base","BattleRoomGamePlayData","terrains","levelData","reveal","players","player","playerId","terrain","my","ad","selfInstId","instId1","instId2","destory","std","Get","configId","filedUrl","AreaIcon","ainmName","loop","terrainState","BattleRoomInTerrainState","TerrainStateUnknown","TerrainStateHide","peek","indexOf","AffectText","currentRound","TerrainStateShow","scale","to","start","TerrainStateDestroy","SkeletonData","LockTerrain","toInstId","FlushAreaPower","power","areaNode","apower","bpower","aeffect","beffect","old","FlushAreaCrads","CheckMatrix","LayoutArea","CloseCard","TurnBack","ShowCard","Open","BattleRoomCardLocation","Hand","Deck","Drop","Del","Terrain","areaName","PlaySkill","count","curRound","self","TryToFindTarget","output","skillId","RemoveSkill","Stop","toPlayerId","toSkillId","CardDataChange","changeCard","RmoveCardFormArea","removeTag","delLoca","RemoveCardFormHand","locaNode","warn","setWorldRotation","CardBackToArea","formIsPlayerA","toIsPlayerA","areaIdx","cardIdx","fromNode","fromLocation","AddCard","sourceInstId","sourceLocation","tager","sourceCard","isMove","AddCardToArea","targetIdx","Showing","AutoPlayHand","RemoveDeckToUnVisible","delNode","tagNode","AddCardToDeck","targetPlayer","head","tagObj","fromPlayerId","AddCardToHand","fromLoca","CardAreaMove","targetNode","PeekTerrain","isplayerA","playerIdA","terrainData","areas","PeekHandCards"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, director, EventTouch, find, geometry, Input, instantiate, Label, math, MeshRenderer, Node, ParticleSystem, path, Prefab, Rect, Scene, sp, Sprite, SpriteFrame, Terrain, tween, UITransform, v3, Vec3, view } from 'cc';\r\nimport { GameSet } from '../../manager/GameSet';\r\nimport { CardState, SceneCard } from './display/SceneCard';\r\nimport { PlaneView, Second, TimeStamp, Utils } from '../../utils/Utils';\r\nimport { folder_icon, ResMgr } from '../../manager/ResMgr';\r\nimport { Skill } from './display/Skill';\r\nimport { Battle_End_Round, EventMgr, Evt_BattleDoubleUpdate, Evt_ShowBattleDoubleEffect } from '../../manager/EventMgr';\r\nimport { Session } from '../../net/Session';\r\nimport proto, { Req, Ret, Route } from '../../net/Protocol';\r\nimport { PlayerData } from '../player/PlayerData';\r\nimport { battleDataMgr } from '../battle/BattleDataMgr';\r\nimport { BattleRoundOperationState } from '../player/PlayerStruct';\r\nimport { SkillUtils } from './SkillUtils';\r\nimport { CfgMgr } from '../../manager/CfgMgr';\r\nimport { EffectTarget } from './display/TestSkill';\r\nimport { MsgPanel } from '../common/MsgPanel';\r\nimport { Tips } from '../common/Tips';\r\nimport { ShowArea } from './display/ShowArea';\r\nimport { FightData } from './FightData';\r\nimport { GameObj } from '../../manager/GameRoot';\r\nimport { SpriteLabel } from '../../component/SpriteLabel';\r\nimport { AudioMgr } from '../../manager/AudioMgr';\r\nimport { AudioDefine } from '../../define/AudioDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\ntype OutStruct = {\r\n    fromInstId?: (string | null);\r\n    card?: (proto.base.IBattleRoomCardData | null);\r\n    fromSkillId?: (number | null);\r\n}\r\n\r\ntype CardLoca = {\r\n    isMy: boolean, card: SceneCard, area: number, index: number\r\n}\r\n\r\nfunction cardLoca(node: Node, isMy: boolean): CardLoca {\r\n    let area = -1;\r\n    if (node instanceof SceneCard) area = node.cardData.area;\r\n    return {\r\n        isMy: isMy,\r\n        card: <unknown>node as SceneCard,\r\n        area: area,\r\n        index: -1,\r\n    }\r\n}\r\n\r\nfunction TouchInstId(data: any) {\r\n    if (data.fromInstId && data['touchInstId'] && data.fromInstId != data['touchInstId']) return data['touchInstId'];\r\n    return undefined;\r\n}\r\n\r\n@ccclass('GameScene')\r\nexport class GameScene extends Component {\r\n    protected static _instance: GameScene;\r\n    static get isntance() {\r\n        return this._instance;\r\n    }\r\n    private static hasLoad = false;\r\n    private static loadHandle: Function;\r\n    private static sub: Promise<any> = new Promise((resolve, reject) => { GameScene.loadHandle = resolve });\r\n\r\n    static async prevLoad() {\r\n        if (!this._instance) {\r\n            let loadSub = new Promise((resolve, reject) => {\r\n                ResMgr.GetResources(\"prefabs/fight/FightScene\", (prefab: Prefab) => {\r\n                    let node: Node = instantiate(prefab);\r\n                    GameScene._instance = node.addComponent(GameScene);\r\n                    resolve(GameScene._instance);\r\n                })\r\n            });\r\n            return loadSub;\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n\r\n    static async Show() {\r\n        if (!this._instance) await this.prevLoad();\r\n        director.getScene().addChild(this._instance.node);\r\n        this._instance.node.active = true;\r\n        if (!this.hasLoad) await this.sub;\r\n        this._instance.onShow();\r\n    }\r\n    static async Hide() {\r\n        if (!this.hasLoad) await this.sub;\r\n        Skill.RemoveAll();\r\n        this._instance.Reset();\r\n        this._instance.onHide();\r\n        this._instance.node.parent && this._instance.node.parent.removeChild(this._instance.node);\r\n    }\r\n\r\n    private async onShow() {\r\n        AudioMgr.StopChannel(AudioDefine.Channels[\"audio/bgm/*\"].channel);\r\n        AudioMgr.Play(\"audio/bgm/MainTheme\", 0, 0.3);\r\n\r\n        this.Reset();\r\n        this.FlushRoundBtnStrState(BattleRoundOperationState.EndRound);\r\n        this.FlushRevealPlayer(null);\r\n\r\n        Utils.AddTouchEffect(this.ruondBtn, (e) => {\r\n            if (this.selectedCard || this.areaTarget) return false;\r\n            let [w, h] = Utils.TestSize(this.ruondBtn, true);\r\n            if (!this.uiView.checkTouch(e, this.ruondBtn, w * GameSet.PixelSize, h * GameSet.PixelSize)) return false;\r\n            if (!this.isWaitInput) return false;\r\n            EventMgr.emit(Battle_End_Round);\r\n            let clickEffect: sp.Skeleton = this.ruondBtn.getChildByName(\"clickEffect\").getComponent(sp.Skeleton);\r\n            clickEffect.node.active = true;\r\n            clickEffect.clearAnimation();\r\n            clickEffect.setAnimation(0, \"animation\", false);\r\n            clickEffect.setCompleteListener(() => {\r\n                clickEffect.node.active = false;\r\n            });\r\n            return true;\r\n        }, this, this.canvas);\r\n\r\n        Utils.AddTouchEffect(this.doubleBtn, (e) => {\r\n            if (this.selectedCard || this.areaTarget) return false;\r\n            let [w, h] = Utils.TestSize(this.doubleBtn, true);\r\n            w -= 300, h -= 450;\r\n            if (!this.uiView.checkTouch(e, this.doubleBtn, w * GameSet.PixelSize, h * GameSet.PixelSize)) return false;\r\n            if (!battleDataMgr.roomData) {\r\n                MsgPanel.Show(\"房间不存在了\")\r\n                return;\r\n            }\r\n            if (battleDataMgr.getPlayerDoubleResidue(battleDataMgr.getPlayerId(true))) {\r\n                MsgPanel.Show(\"加倍次数不足\")\r\n                return;\r\n            }\r\n            let server: proto.pb.IServer = proto.pb.Server.create();\r\n            server.id = battleDataMgr?.creatRoomData?.serverId || \"\";\r\n            let data = new Req['battle.protocol.battleroomdouble']();\r\n            data.server = server;\r\n            data.roomId = battleDataMgr.roomData.roomId;\r\n            Session.Send(Route['battle.protocol.battleroomdouble'], data);\r\n            console.log(\"发送加倍---->\");\r\n            return true;\r\n        }, this, this.canvas);\r\n\r\n        Utils.AddTouchEffect(this.exitBtn, (e) => {\r\n            if (this.selectedCard || this.areaTarget) return false;\r\n            let [w, h] = Utils.TestSize(this.exitBtn, true);\r\n            if (!this.uiView.checkTouch(e, this.exitBtn, w * GameSet.PixelSize, h * GameSet.PixelSize)) return false;\r\n            let server: proto.pb.IServer = proto.pb.Server.create();\r\n            server.id = battleDataMgr?.creatRoomData?.serverId || \"\";\r\n            let data = new Req['battle.protocol.battleroomleave']();\r\n            data.server = PlayerData.server;\r\n            data.roomId = battleDataMgr?.roomData?.roomId || battleDataMgr?.creatRoomData?.roomId;\r\n            Session.Send(Route['battle.protocol.battleroomleave'], data);\r\n            console.log(\"发送离开房间---->\")\r\n            return true;\r\n        }, this, this.canvas);\r\n        \r\n        Session.on(Route['battle.protocol.battleroomping'], this.onBattleroomping, this);\r\n        EventMgr.on(Evt_BattleDoubleUpdate, this.onBattleDoubleUpdate, this);\r\n        EventMgr.on(\"op_start\", this.hideViewCard, this);\r\n        this.onBattleDoubleUpdate(0, false);\r\n    }\r\n\r\n    private onHide() {\r\n        AudioMgr.StopChannel(AudioDefine.Channels[\"audio/bgm/*\"].channel);\r\n        GameSet.debug = false;\r\n        Session.off(Route['battle.protocol.battleroomping'], this.onBattleroomping, this);\r\n        EventMgr.off(Evt_BattleDoubleUpdate, this.onBattleDoubleUpdate, this);\r\n        Utils.DelTouchEffect(this.ruondBtn, this.canvas);\r\n        Utils.DelTouchEffect(this.doubleBtn, this.canvas);\r\n    }\r\n    private onBattleDoubleUpdate(addCont: number = 0, isUpdate: boolean = true): void {\r\n        let num: number = battleDataMgr.getRoomDoubleNum(addCont);\r\n        let oldNum: number = Number(this.doubleLab.string);\r\n        this.doubleLab.string = `${num}`;\r\n        if (isUpdate && num > oldNum) {\r\n            EventMgr.emit(Evt_ShowBattleDoubleEffect, this.doubleBtn.worldPosition);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 结算区域战力\r\n     */\r\n    async Settlement() {\r\n        for (let area of this.areaList) {\r\n            let myPower = Number(area.getChildByName(\"power1\").getComponent(Label).string);\r\n            let adPower = Number(area.getChildByName(\"power2\").getComponent(Label).string);\r\n            area.getChildByName(\"mywin01\").active = false;\r\n            area.getChildByName(\"adwin01\").active = false;\r\n            let mywin = area.getChildByName(\"mywin02\");\r\n            let adwin = area.getChildByName(\"adwin02\");\r\n            if (myPower > adPower) {\r\n                mywin.active = true;\r\n                adwin.active = false;\r\n                await Second(0.5);\r\n            } else if (myPower < adPower) {\r\n                mywin.active = false;\r\n                adwin.active = true;\r\n                await Second(0.5);\r\n            } else {\r\n                mywin.active = false;\r\n                adwin.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    //房间ping结果返回\r\n    private onBattleroomping(data: any): void {\r\n        return;\r\n        let result = Ret['battle.protocol.battleroomping'].decode(data);\r\n        if (result.res.code !== 200) {\r\n            //房间不存在了\r\n        }\r\n    }\r\n\r\n    private onBattleroomdouble(): void {\r\n\r\n    }\r\n    // 参数相关\r\n    public handCenter = v3();     //手卡中点\r\n    public handRotation = v3();   //手卡角度\r\n    public myCardEnterV = v3();   //自己飞入手卡的起始位置\r\n    public adCardEnterV = v3();   //对手飞入手卡的起始位置\r\n    public PeekHandV: Vec3;\r\n    public handQuat: math.Quat;   //手牌角度\r\n\r\n    // 布局节点相关\r\n    public areaList: Node[] = [];       //区域节点列表\r\n    public areaSize: Rect[] = [];       //区域碰撞检测数据\r\n    public adTeamLayout: Node[][] = []; //对方布局\r\n    public myTeamLayout: Node[][] = []; //自己布局\r\n    private cardMap: { [id: string]: CardLoca } = {};// 场景中所有卡的相对路由\r\n    protected selectEffects: Node[] = [];\r\n\r\n    // 操作相关\r\n    public handCards: SceneCard[] = []; //自己手卡列表\r\n    public selectedCard: SceneCard;     //选中的手牌或自己区域里的牌\r\n    public areaTarget: number;          //操作过程选中放置卡牌的目标区域\r\n    public canvas: Node;                //2d画布\r\n    protected areaCardLay: Node;\r\n    protected handCardLay: Node;\r\n    protected peekCardLay: Node; //窥视卡显示层\r\n    protected uiView: PlaneView;\r\n    protected handView: PlaneView;\r\n    protected ui: Node;\r\n    protected myDeck: Node;\r\n    protected myHand: Node;\r\n    protected myDrop: Node;\r\n    protected myDel: Node;\r\n    protected myEnergy: Node;\r\n    protected adDeck: Node;\r\n    protected adHand: Node;\r\n    protected adDrop: Node;\r\n    protected adDel: Node;\r\n    protected adEnergy: Node;\r\n    protected revealCard: SceneCard;\r\n    protected showArea: ShowArea;\r\n\r\n    //ui\r\n    public myhead: Sprite;\r\n    public myNameLab: Label;\r\n    public myRevealEffect: sp.Skeleton;\r\n    public adhead: Sprite;\r\n    public adNameLab: Label;\r\n    public adRevealEffect: sp.Skeleton;\r\n\r\n    public ruondBtn: Node;\r\n    public roundBtnLab: Label;\r\n    progress: Sprite;\r\n    public jshhEffect: Node;\r\n    public qxjshhEffect: Node;\r\n    public notTimeEffect: Node;\r\n    private roundBtnMaskBg: Node;\r\n    public exitBtn: Node;\r\n\r\n    public energyLab: SpriteLabel;\r\n    public doubleBtn: Node;\r\n    public doubleLab: SpriteLabel;\r\n    public isWaitInput: boolean = false;\r\n    protected mask: Node;\r\n    protected zero: Vec3;\r\n\r\n    protected dropToHand: boolean;\r\n    protected canMove: (instId: string, area?: number) => boolean;\r\n    protected canDrop: (instId: string, area?: number) => number;\r\n    protected operateHandle: (instId: string, targetArea: number, cardState?: number) => number;\r\n    protected async onLoad() {\r\n        await Second(0);\r\n        this.areaCardLay = this.node.getChildByName(\"areaCardLay\");\r\n        this.handCardLay = this.node.getChildByName(\"myHand\");\r\n        this.peekCardLay = this.node.getChildByName(\"peekCardLay\");\r\n        this.mask = this.node.getChildByName(\"mask\");\r\n\r\n        GameSet.SceneHight = GameSet.mainCamera.node.position.y;\r\n\r\n        const ls = [\"ui\", \"myDeck\", \"myHand\", \"myDrop\", \"myDel\", \"costmodel/myEnergy\", \"adDeck\", \"adHand\", \"adDrop\", \"adDel\", \"ui/adEnergy\"];\r\n        for (let s of ls) {\r\n            let k = s.split(\"/\").pop();\r\n            this[k] = this.node.getChildByPath(s);\r\n            this[k].active = true;\r\n        }\r\n\r\n        this.canvas = find(\"Canvas\");\r\n        let forward = GameSet.mainCamera.node.forward.negative();\r\n        let [rx, ry, rz] = Utils.EulerAngles(v3(0, 1, 0), forward);\r\n        this.myHand.setWorldRotationFromEuler(rx, ry, rz);\r\n        this.ui.setWorldRotationFromEuler(rx, ry, rz);\r\n\r\n        let child = this.myHand.children[0];\r\n        this.handView = new PlaneView(GameSet.mainCamera, this.myHand, Vec3.UNIT_Y);\r\n        GameSet.HandPlane = this.handView.plane;\r\n        this.handQuat = child.getWorldRotation();\r\n        let v = this.handView.localRightDown, handCenter = v3();\r\n        handCenter.set(v.x - 1, v.y, v.z - GameSet.CardHide / 4);\r\n        Vec3.transformMat4(this.handCenter, handCenter, this.handView.mat);\r\n\r\n        this.myHand.getWorldRotation().getEulerAngles(this.handRotation);\r\n        this.myDeck.getWorldPosition(this.myCardEnterV);\r\n        this.adDeck.getWorldPosition(this.adCardEnterV);\r\n\r\n        for (let i = 0; i < 3; i++) {\r\n            let area = this.node.getChildByName(\"area\" + i);\r\n            let frameSelect = area.getChildByName(\"frame_select\");\r\n            let p = frameSelect.worldPosition.clone();\r\n            this.node.addChild(frameSelect);\r\n            frameSelect.setPosition(p.x, p.y, p.z);\r\n            frameSelect.setSiblingIndex(3);\r\n            this.selectEffects.push(frameSelect);\r\n            this.areaList.push(area);\r\n            let layout = [];\r\n            let children = area.getChildByPath(\"team1\").children.concat();\r\n            for (let child of children) {\r\n                layout.push(child);\r\n            }\r\n            let sk = area.getChildByName(\"filed\").getComponent(sp.Skeleton);\r\n            sk.setCompleteListener(() => {\r\n                if (Utils.CheckAnimation(sk, \"idle\") && sk?.getCurrent(0)?.animation.name != \"idle\") sk.setAnimation(0, \"idle\", true);\r\n            });\r\n\r\n            let hitTest1 = area.getChildByName(\"hitTest1\");\r\n            let hitTest2 = area.getChildByName(\"hitTest2\");\r\n            hitTest1.name = hitTest1.name + \"_\" + area.name;\r\n            hitTest2.name = hitTest2.name + \"_\" + area.name;\r\n            let hitSize = hitTest1.getComponent(UITransform).contentSize;\r\n            let rect = new Rect(hitTest1.worldPosition.x, 5, hitSize.width, 20);\r\n            this.areaSize[i] = rect;\r\n            this.myTeamLayout[i] = layout;\r\n            area['hitTest1'] = hitTest1;\r\n            area['hitTest2'] = hitTest2;\r\n            let p1 = hitTest1.worldPosition.clone();\r\n            let p2 = hitTest2.worldPosition.clone();\r\n            this.node.addChild(hitTest1);\r\n            this.node.addChild(hitTest2);\r\n            hitTest1.setSiblingIndex(4);\r\n            hitTest2.setSiblingIndex(4);\r\n            hitTest1.setWorldPosition(p1);\r\n            hitTest2.setWorldPosition(p2);\r\n\r\n            layout = [];\r\n            children = area.getChildByPath(\"team2\").children.concat();\r\n            for (let child of children) {\r\n                layout.push(child);\r\n            }\r\n            this.adTeamLayout[i] = layout;\r\n\r\n        }\r\n\r\n        this.PeekHandV = v3(...Utils.ScreenToPlane(GameSet.viewSize.width / 2, GameSet.viewSize.height / 2, GameSet.mainCamera, GameSet.HandPlane));\r\n\r\n        this.uiView = new PlaneView(GameSet.mainCamera, this.ui, Vec3.UNIT_Y);\r\n        this.uiView.setLocalLeftDown(this.ui.getChildByName(\"my\"), 2.5, 4);\r\n        this.uiView.setLocalRightUp(this.ui.getChildByName(\"ad\"), 2.7, 2.5);\r\n        // this.uiView.setLocalLeftUp(this.ui.getChildByName(\"double\"), 9, 5);\r\n        console.log(\"**************\", this.ui.getChildByName(\"double\").position.toString())\r\n        // this.uiView.setLocalRightDown(this.ui.getChildByName(\"myEnergy\"), 10, 13);\r\n\r\n        this.ruondBtn = this.ui.getChildByName(\"roundBtn\");\r\n        this.roundBtnLab = this.ui.getChildByPath(\"roundBtn/btnLab\").getComponent(Label);\r\n        this.jshhEffect = this.ui.getChildByPath(\"roundBtn/jshhEffect\");\r\n        this.qxjshhEffect = this.ui.getChildByPath(\"roundBtn/qxjshhEffect\");\r\n        this.notTimeEffect = this.ui.getChildByPath(\"roundBtn/notTimeEffect\");\r\n        this.roundBtnMaskBg = this.ui.getChildByPath(\"roundBtn/maskBg\");\r\n        this.progress = this.ui.getChildByPath(\"roundBtn/progress\").getComponent(Sprite);\r\n        this.uiView.setLocalRightDown(this.ruondBtn, 2, 8.5);\r\n\r\n        this.exitBtn = this.ui.getChildByPath(\"exitBtn\");\r\n        this.uiView.setLocalLeftDown(this.exitBtn, 2, 8.5);\r\n\r\n        this.myhead = this.ui.getChildByPath(\"my/myhead\").getComponent(Sprite);\r\n        this.myNameLab = this.ui.getChildByPath(\"my/myNameLab\").getComponent(Label);\r\n        this.myRevealEffect = this.ui.getChildByPath(\"my/revealEffect\").getComponent(sp.Skeleton);\r\n        this.adhead = this.ui.getChildByPath(\"ad/adhead\").getComponent(Sprite);\r\n        this.adNameLab = this.ui.getChildByPath(\"ad/adNameLab\").getComponent(Label);\r\n        this.adRevealEffect = this.ui.getChildByPath(\"ad/revealEffect\").getComponent(sp.Skeleton);\r\n\r\n        this.doubleBtn = this.ui.getChildByPath(\"double\");\r\n        this.doubleLab = this.ui.getChildByPath(\"double/effect/doubleLab\").addComponent(SpriteLabel);\r\n        this.doubleLab.font = \"sheets/numberImg/num2\";\r\n        this.energyLab = this.node.getChildByPath(\"costmodel/myEnergy\").addComponent(SpriteLabel);\r\n        this.energyLab.font = \"sheets/numberImg/num3\";\r\n\r\n        let size = view.getVisibleSizeInPixel();\r\n        GameSet.ShowPoint = v3(...Utils.ScreenToPlane(size.width / 2, size.height / 2, GameSet.mainCamera, GameSet.ScenePlane, 22));\r\n\r\n        GameSet.ScreamRotation = math.quat();\r\n        let out = v3();\r\n        this.myHand.getWorldRotation().getEulerAngles(out)\r\n        math.Quat.fromEuler(GameSet.ScreamRotation, out.x, 0, 0);\r\n\r\n        this.myHand.children.forEach(value => {\r\n            value.parent.removeChild(value);\r\n            value.destroy();\r\n        })\r\n        this.myHand.removeAllChildren();\r\n\r\n        this.zero = this.node.worldPosition.clone();\r\n        this.zero.y += 6;\r\n\r\n        this.revealCard = SceneCard.Create();\r\n        this.showArea = ShowArea.Create();\r\n\r\n        if (!GameScene._instance) GameScene._instance = this;\r\n        GameScene.hasLoad = true;\r\n        if (GameScene.loadHandle) GameScene.loadHandle();\r\n    }\r\n\r\n    protected skillTarget(isMy: boolean, attacker: Node, targets: Node[], myarea: number[] = [0, 1, 2], adarea: number[] = [0, 1, 2]) {\r\n        let myAreas = [], adAreas = [];\r\n        for (let idx of myarea) {\r\n            let area = this.areaList[idx];\r\n            if (idx >= 0 && area != undefined) myAreas.push(area['hitTest1']);//area.getChildByName(\"hitTest1_\" + area.name));\r\n        }\r\n        for (let idx of adarea) {\r\n            let area = this.areaList[idx];\r\n            if (idx >= 0 && area != undefined) adAreas.push(area['hitTest2']);//area.getChildByName(\"hitTest2_\" + area.name));\r\n        }\r\n        let loca = [];\r\n        if (isMy) {\r\n            loca = [myAreas, this.myDeck, this.myHand, this.myDrop, this.myDel, this.myEnergy, adAreas, this.adDeck, this.adHand, this.adDrop, this.adDel, this.adEnergy];\r\n        } else {\r\n            loca = [adAreas, this.adDeck, this.adHand, this.adDrop, this.adDel, this.adEnergy, myAreas, this.myDeck, this.myHand, this.myDrop, this.myDel, this.myEnergy];\r\n        }\r\n        return new EffectTarget(attacker, targets, ...loca);\r\n    }\r\n\r\n    /**\r\n     * 停止所有动作\r\n     */\r\n    EndAllAction() {\r\n        Skill.EndAll();\r\n        for (let card of this.handCards) {\r\n            card?.action?.end();\r\n        }\r\n        for (let k in this.cardMap) {\r\n            let obj = this.cardMap[k];\r\n            if (obj?.card?.action?.running) obj?.card?.action?.end();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 开始操作\r\n     * @param canMove \r\n     * @param canDrop \r\n     * @param playHandCard \r\n     */\r\n    StartOperate(canMove: (instId: string) => boolean, canDrop: (instId: string, area?: number) => number, playHandCard: (instId: string, targetArea: number) => number) {\r\n        this.canMove = canMove;\r\n        this.canDrop = canDrop;\r\n        this.operateHandle = playHandCard;\r\n        this.canvas.on(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.canvas.on(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.canvas.on(Input.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n    /**\r\n     * 结束操作\r\n     */\r\n    EndOperate() {\r\n        this.UnSelect();\r\n        this.canvas.off(Input.EventType.TOUCH_START, this.onTouchStart, this);\r\n        this.canvas.off(Input.EventType.TOUCH_END, this.onTouchEnd, this);\r\n        this.canvas.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.canvas.off(Input.EventType.TOUCH_CANCEL, this.onTouchEnd, this);\r\n    }\r\n    /**\r\n     * 中断选卡操作\r\n     */\r\n    UnSelect() {\r\n        if (this.selectedCard) {\r\n            this.selectedCard.StopDrag();\r\n            this.LayoutAllHandCards();\r\n            this.LayoutAllArea();\r\n            this.selectedCard = undefined;\r\n        }\r\n    }\r\n    /**点击 */\r\n    protected onTouchStart(e: EventTouch) {\r\n        if (this.mask.active) return;\r\n        let pt = e.getLocation();\r\n        //先计算是否点击到手牌\r\n        let [x, y, z] = Utils.ScreenToPlane(pt.x, pt.y, GameSet.mainCamera, GameSet.HandPlane);\r\n        for (let card of this.handCards) {\r\n            if (card.State == CardState.Handing && card.HitTest(x, y, z)) {\r\n                let msg = this.canMove(card.instId);\r\n                if (msg) {\r\n                    // MsgPanel.Show(msg);\r\n                    continue;\r\n                }\r\n                //if (this.selectedCard == undefined) this.flushSelectEffect(true);\r\n                this.selectedCard = card;\r\n                this.selectedCard['isHandCard'] = true;\r\n                this.flushSelectEffect(true);\r\n                // this.selectedCard.parent.removeChild(this.selectedCard);\r\n                // this.node.addChild(this.selectedCard);\r\n                this.canvas.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n                return;\r\n            }\r\n        }\r\n        //再计算是否点击到自己的区域牌\r\n        [x, y, z] = Utils.ScreenToPlane(pt.x, pt.y, GameSet.mainCamera, GameSet.ScenePlane);\r\n        for (let k in this.cardMap) {\r\n            let obj = this.cardMap[k];\r\n            let card = obj?.card;\r\n            if (obj?.isMy && card && card.HitTest && card.HitTest(x, y, z)) {\r\n                let area = obj?.area;\r\n                let msg = this.canMove(card.instId, area);\r\n                if (msg) {\r\n                    // MsgPanel.Show(msg);\r\n                    continue;\r\n                }\r\n                this.selectedCard = card;\r\n                this.selectedCard['isHandCard'] = false;\r\n                this.node.addChild(this.selectedCard);\r\n                this.canvas.on(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    /**拖动操作 */\r\n    protected onTouchMove(e?: EventTouch) {\r\n        let p = e.getLocation();\r\n        if (this.selectedCard) {\r\n            // 拖动中\r\n            this.selectedCard.Drag(p.x, p.y);\r\n\r\n            let x: number, y: number, z: number;\r\n            this.dropToHand = false;\r\n            this.areaTarget = undefined;\r\n\r\n            if (this.selectedCard['isHandCard']) {\r\n                // 拖动的是手牌\r\n                [x, y, z] = Utils.ScreenToPlane(p.x, p.y, GameSet.mainCamera, GameSet.ScenePlane);\r\n                for (let i = 0; i < this.areaSize.length; i++) {\r\n                    let rect = this.areaSize[i];\r\n                    if (Math.abs(x - rect.x) <= rect.width / 2 && Math.abs(z - rect.y) <= rect.height / 2) {\r\n                        // this.flushSelectEffect(i);\r\n                        if (!this.canDrop(this.selectedCard.instId, i)) {\r\n                            this.areaTarget = i;\r\n                        } else {\r\n                            // console.log(\"cannotDrop\", this.canDrop(this.selectedCard.instId, i));\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (this.areaTarget == undefined) {\r\n                    // this.flushSelectEffect();\r\n                } else return;\r\n            }\r\n\r\n            // 计算是否触碰到手牌区域\r\n            [x, y, z] = Utils.ScreenToPlane(p.x, p.y, GameSet.mainCamera, GameSet.HandPlane);\r\n            let out = v3();\r\n            Vec3.transformMat4(out, v3(x, y, z), this.handView.invertMat);\r\n            if (Math.abs(out.z) >= 9.8) {\r\n                this.dropToHand = true;\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**松手后的计算 */\r\n    protected onTouchEnd(e: EventTouch) {\r\n        this.canvas.off(Input.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.flushSelectEffect();\r\n        if (this.selectedCard != undefined) {\r\n            let instId = this.selectedCard.Id;\r\n            if (!this.selectedCard.isDragging && this.selectedCard.cardData) {\r\n                this.viewCard(this.selectedCard.cardData, this.selectedCard.getWorldPosition());\r\n            }\r\n            this.selectedCard.StopDrag();\r\n\r\n            // 处理场景区域操作\r\n            if (this.areaTarget != undefined) {\r\n                let failType = this.operateHandle(instId, this.areaTarget, this?.selectedCard?.state);\r\n                this.areaTarget = undefined;\r\n                this.selectedCard = undefined;\r\n                if (failType) {\r\n\r\n                }\r\n            } else if (this.dropToHand) {\r\n                this.dropToHand = undefined;\r\n                let failType = this.operateHandle(instId, undefined, this?.selectedCard?.state);\r\n                this.selectedCard = undefined;\r\n                this.areaTarget = undefined;\r\n                if (failType) {\r\n\r\n                }\r\n            } else {\r\n                this.LayoutAllHandCards();\r\n                this.LayoutAllArea();\r\n                this.selectedCard = undefined;\r\n                this.areaTarget = undefined;\r\n            }\r\n        } else if (this.mask.active) {\r\n            this.hideViewCard();\r\n        } else {\r\n            let pt = e.getLocation();\r\n            let [x, y, z] = Utils.ScreenToPlane(pt.x, pt.y, GameSet.mainCamera, GameSet.HandPlane);\r\n            for (let card of this.handCards) {\r\n                if (card.cardData && card.HitTest(x, y, z)) {\r\n                    this.viewCard(card.cardData, card.getWorldPosition());\r\n                    return;\r\n                }\r\n            }\r\n            //再计算是否点击到自己的区域牌\r\n            [x, y, z] = Utils.ScreenToPlane(pt.x, pt.y, GameSet.mainCamera, GameSet.ScenePlane);\r\n            for (let k in this.cardMap) {\r\n                let obj = this.cardMap[k];\r\n                let card = obj?.card;\r\n                if (card?.cardData && card?.HitTest(x, y, z)) {\r\n                    this.viewCard(card.cardData, card.getWorldPosition());\r\n                    return;\r\n                }\r\n            }\r\n\r\n            //计算是否触碰地形区域\r\n            // for (let area of this.areaList) {\r\n            //     let icon = area.getChildByName(\"hitTest\");\r\n            //     let p = icon.worldPosition;\r\n            //     let size = icon.getComponent(UITransform).contentSize;\r\n            //     // console.log(\"hitTest\", Math.abs(p.x - x), size.width * icon.scale.x, Math.abs(p.z - z), size.height * icon.scale.y);\r\n            //     if (Math.abs(p.x - x) < size.width * icon.scale.x && Math.abs(p.z - z) <= size.height * icon.scale.y) {\r\n            //         this.viewCard(area);\r\n            //         return;\r\n            //     }\r\n            // }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 展示详细信息\r\n     * @param data \r\n     * @param pos \r\n     */\r\n    protected async viewCard(data: proto.base.IBattleRoomCardData | Node, pos?: Vec3) {\r\n        if (data instanceof Node) {\r\n            let area = data;\r\n            this.revealCard.EndViewCard();\r\n            this.mask.active = true;\r\n            this.node.addChild(this.showArea);\r\n            let filed = area.getChildByName(\"filed\");\r\n            let sd = filed.active ? filed.getComponent(sp.Skeleton).skeletonData : undefined;\r\n            let desc = area.getChildByName(\"desc\").getComponent(Label).string;\r\n            let myPower = area.getChildByName(\"power1\").getComponent(Label).string;\r\n            let adPower = area.getChildByName(\"power2\").getComponent(Label).string;\r\n            this.showArea.View(sd, desc, myPower, adPower, area.worldPosition);\r\n        } else {\r\n            this.showArea.Hide();\r\n            let cardData: proto.base.IBattleRoomCardData = data;\r\n            this.node.addChild(this.revealCard);\r\n            this.revealCard.active = true;\r\n            await this.revealCard.InitData(true, cardData);\r\n            if (!this.mask.active) {\r\n                this.mask.active = true;\r\n                if (!pos) pos = this.zero;\r\n                this.revealCard.setWorldPosition(pos);\r\n                this.revealCard.ViewCard();\r\n            }\r\n        }\r\n    }\r\n    protected hideViewCard() {\r\n        this.mask.active = false;\r\n        this.showArea.Hide();\r\n        this.revealCard.EndViewCard();\r\n        this.revealCard.active = false;\r\n    }\r\n\r\n    /**区域选中效果 */\r\n    protected flushSelectEffect(value: boolean = false) {//,area?: number) {\r\n        for (let i = 0; i < this.areaList.length; i++) {\r\n            let isFull = !this.canDrop(this.selectedCard?.instId, i);\r\n            // this.areaList[i].getChildByName(\"frame_select\").active = value && isFull;//i == area;\r\n            this.selectEffects[i].active = value && isFull;\r\n        }\r\n    }\r\n    /**刷新对战玩家信息 */\r\n    FlushPlayerInfo(isPlayerA: boolean, data: proto.base.IBattleRoomPlayerData) {\r\n        let cfg = CfgMgr.GetHead(data?.deckAttr?.avatarId);\r\n        let headName: string = \"\";\r\n        if (cfg) {\r\n            headName = cfg.icon;\r\n        } else {\r\n            this.myhead.node.active = false;\r\n        }\r\n        this.myhead.node.active = true;\r\n        if (isPlayerA) {\r\n            this.myNameLab.string = data.name;\r\n            ResMgr.LoadResAbSub(path.join(folder_icon, \"head/\", headName, \"spriteFrame\"), SpriteFrame, res => {\r\n                this.myhead.spriteFrame = res;\r\n            });\r\n        } else {\r\n            ResMgr.LoadResAbSub(path.join(folder_icon, \"head/\", headName, \"spriteFrame\"), SpriteFrame, res => {\r\n                this.adhead.spriteFrame = res;\r\n            });\r\n            this.adNameLab.string = data.name;\r\n        }\r\n    }\r\n    /**刷新回合数 */\r\n    FlushRound(curRoundNum: number, maxRound: number) {\r\n        this.progress.color.set(192, 40, 255, 140);\r\n        this.progress.fillRange = 0;\r\n        this.progress.node.active = false;\r\n        this.roundProgress = `  ${curRoundNum}/${maxRound}`;\r\n        this.roundBtnLab.string = this.roundState + \"\\n\" + this.roundProgress;\r\n    }\r\n    protected roundProgress = \"\";\r\n    protected roundState = \"\";\r\n    /**刷新回合按钮文本状态 */\r\n    FlushRoundBtnStrState(state: BattleRoundOperationState) {\r\n        switch (state) {\r\n            case BattleRoundOperationState.EndRound:\r\n                this.roundState = `结束回合...`;\r\n                this.roundBtnLab.string = this.roundState + \"\\n\" + this.roundProgress;\r\n                break;\r\n            case BattleRoundOperationState.PlaceRound:\r\n                this.roundState = `放置中...`;\r\n                break;\r\n            case BattleRoundOperationState.CancelRound:\r\n                this.roundState = `取消结束回合`;\r\n                this.roundBtnLab.string = this.roundState;\r\n                break;\r\n        }\r\n    }\r\n    /**\r\n     * 刷新优先揭示卡牌玩家特效\r\n     * @param isPlayerA \r\n     */\r\n    FlushRevealPlayer(isPlayerA: boolean): void {\r\n        if (isPlayerA == null) {\r\n            this.myRevealEffect.node.active = false;\r\n            this.adRevealEffect.node.active = false;\r\n            return;\r\n        }\r\n        if (isPlayerA) {\r\n            this.myRevealEffect.node.active = true;\r\n            this.myRevealEffect.clearAnimation();\r\n            this.myRevealEffect.setAnimation(0, \"blue\", false);\r\n            this.myRevealEffect.setCompleteListener(() => {\r\n                this.myRevealEffect.node.active = false;\r\n            })\r\n            this.adRevealEffect.node.active = false;\r\n        } else {\r\n            this.myRevealEffect.node.active = false;\r\n            this.adRevealEffect.node.active = true;\r\n            this.adRevealEffect.clearAnimation();\r\n            this.adRevealEffect.setAnimation(0, \"red\", false);\r\n            this.adRevealEffect.setCompleteListener(() => {\r\n                this.adRevealEffect.node.active = false;\r\n            })\r\n        }\r\n\r\n    }\r\n\r\n    /**刷新回合按钮文本 */\r\n    FlushRoundTime(time: number, isHaveEnergy: boolean, roundState: BattleRoundOperationState, totalTime: number = 30) {\r\n        this.progress.node.active = true;\r\n        let rote: number = time / totalTime;\r\n        this.progress.fillRange = rote;\r\n        let b: number = rote * 255;\r\n        this.progress.color.set(192, 40, b, 140);\r\n        this.roundBtnMaskBg.active = false;\r\n        //出牌阶段\r\n        if (roundState == BattleRoundOperationState.EndRound) {\r\n            this.qxjshhEffect.active = false;\r\n            //出牌能量不足只出强制结束回合特效\r\n            if (!isHaveEnergy) {\r\n                this.jshhEffect.active = true;\r\n                this.notTimeEffect.active = false;\r\n            } else {\r\n                this.jshhEffect.active = false;\r\n                if (time > 0 && time <= 5) {\r\n                    this.notTimeEffect.active = true;\r\n                } else {\r\n                    this.notTimeEffect.active = false;\r\n                }\r\n            }\r\n            return;\r\n        }\r\n        //可取消阶段\r\n        if (roundState == BattleRoundOperationState.CancelRound) {\r\n            this.qxjshhEffect.active = true;\r\n            this.jshhEffect.active = false;\r\n            this.notTimeEffect.active = false;\r\n            return;\r\n        }\r\n        //放置阶段\r\n        if (roundState == BattleRoundOperationState.PlaceRound) {\r\n            this.qxjshhEffect.active = false;\r\n            this.jshhEffect.active = false;\r\n            this.notTimeEffect.active = false;\r\n            this.roundBtnMaskBg.active = true;\r\n            return;\r\n        }\r\n    }\r\n\r\n    /**刷新能量 */\r\n    async FlushEnergy(num: number, data?: OutStruct) {\r\n        FightData.Energy = num;\r\n        let tt = TimeStamp();\r\n        if (data && data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);\r\n            let target = this.findCard(TouchInstId(data));\r\n            let tag = this.skillTarget(true, attacker?.card, [target?.card]);\r\n            await Skill.Play(data, tag, true);\r\n        }\r\n        this.energyLab.string = `${num}`;\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if (!GameScene.hasLoad) return;\r\n        let sorts = [];\r\n        let children = this.areaCardLay.children;\r\n        for (let child of children) {\r\n            sorts.push({ index: child.getSiblingIndex(), node: child });\r\n        }\r\n        sorts.sort((a, b) => a.node.position.z - b.node.position.z);\r\n        for (let i = 0; i < sorts.length; i++) {\r\n            let obj = sorts[i];\r\n            if (obj.index != i) {\r\n                obj.node.setSiblingIndex(i);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 从卡组发牌到手卡\r\n     * @param data \r\n     * @returns \r\n     */\r\n    async AddHandCard(data: proto.base.IBattleRoomOpOutput_CardDeckTopToHandTail) {\r\n        let tt = TimeStamp();\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);\r\n            let target = this.findCard(TouchInstId(data)) || attacker;\r\n            await Skill.Play(data, this.skillTarget(true, attacker?.card, [target?.card]));\r\n        }\r\n\r\n        let cards = data.cards;\r\n        // 排除相同的\r\n        for (let card of this.handCards) {\r\n            let index = cards.findIndex(value => value.instId == card.instId);\r\n            if (index != -1) {\r\n                card.FlushData(true, cards[index]);\r\n                cards.splice(index, 1);\r\n            }\r\n        }\r\n        // 刷新一下已有手牌的布局，为飞进来的卡牌让出位置\r\n        let p = Vec3.clone(this.handCenter);\r\n        let total = (this.handCards.length + cards.length - 1) * GameSet.CardWide;\r\n        p.x = this.handCenter.x - total - GameSet.CardWide / 2;\r\n        for (let i = 0; i < this.handCards.length; i++) {\r\n            let card = this.handCards[i];\r\n            this.handCardLay.addChild(card);\r\n            card.LayoutHands(p, this.handQuat);\r\n            p.x += GameSet.CardWide;\r\n        }\r\n\r\n        // 开始飞入\r\n        let promises = [];\r\n        for (let i = 0; i < cards.length; i++) {\r\n            let cardData: proto.base.IBattleRoomCardData = cards[i];\r\n            let newCard: SceneCard = SceneCard.Create();\r\n            newCard.InitData(true, cardData, this.handRotation);\r\n            // this.node.addChild(newCard);\r\n            this.handCards.push(newCard);\r\n            let promise = newCard.SendToHand(this.myCardEnterV, p, this.handQuat);\r\n            this.handCardLay.addChild(newCard);\r\n            promises.push(promise);\r\n            // this.handCards.push(newCard);\r\n            p.x += GameSet.CardWide;\r\n        }\r\n        await Promise.all(promises);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 刷新所有手牌布局\r\n     * @returns \r\n     */\r\n    async LayoutAllHandCards() {\r\n        // 刷新一下已有手牌的布局，为飞进来的卡牌让出位置\r\n        let p = Vec3.clone(this.handCenter);\r\n        let total = (this.handCards.length - 1) * GameSet.CardWide;\r\n        p.x = this.handCenter.x - total - GameSet.CardWide / 2;\r\n        let tt = TimeStamp();\r\n        let ps = [];\r\n        for (let i = 0; i < this.handCards.length; i++) {\r\n            let card = this.handCards[i];\r\n            ps.push(card.LayoutHands(p, this.handQuat));\r\n            p.x += GameSet.CardWide;\r\n        }\r\n        await Promise.all(ps);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 从任意位置飞到不可视位置\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @param fromData \r\n     */\r\n    async CopyCardToUnVisible(isPlayerA: boolean, data: OutStruct, fromData: proto.base.IBattleRoomCardData) {\r\n        let tt = TimeStamp();\r\n        let fromCard = this.findCard(fromData.instId);\r\n        if (!fromCard && data['fromLocation']) fromCard = cardLoca(this.fileLocation(isPlayerA, data['fromLocation']), isPlayerA);\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);\r\n            let target = this.findCard(TouchInstId(data)) || fromCard;\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker.area], [target?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n\r\n        let card: SceneCard = SceneCard.Create();\r\n        card.InitData(isPlayerA, data.card, this.zero);\r\n        let target = this.fileLocation(isPlayerA, data.card.location, data.card.area);\r\n        this.handCardLay.addChild(card);\r\n        card.setWorldPosition(fromCard?.card.worldPosition || this.zero);\r\n        await card.MoveTo(target.worldPosition);\r\n        card.receive();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n\r\n    /**\r\n     * 更新手牌\r\n     */\r\n    async FlushHandCard(datas: proto.base.IBattleRoomCardData[]) {\r\n        let ls = {};\r\n        this.handCards.forEach(value => ls[value.instId] = value);\r\n        this.handCards.length = 0;\r\n        for (let i = 0; i < datas.length; i++) {\r\n            let data = datas[i];\r\n            if (ls[data.instId]) {\r\n                ls[data.instId].FlushData(true, datas[i]);\r\n                this.handCards.push(ls[data.instId]);\r\n                delete ls[data.instId];\r\n            } else {\r\n                let card = SceneCard.Create();\r\n                card.InitData(true, data, this.handRotation);\r\n                this.handCardLay.addChild(card);\r\n                if (this.selectedCard) card.setWorldPosition(this.selectedCard.worldPosition);\r\n                this.handCards.push(card);\r\n            }\r\n        }\r\n        for (let k in ls) {\r\n            ls[k].receive();\r\n            delete ls[k];\r\n        }\r\n        let tt = TimeStamp();\r\n        let ps = [];\r\n        let p = Vec3.clone(this.handCenter);\r\n        let total = Math.max(0, this.handCards.length - 1) * GameSet.CardWide;\r\n        p.x = this.handCenter.x - total - GameSet.CardWide / 2;\r\n        for (let i = 0; i < this.handCards.length; i++) {\r\n            let card = this.handCards[i];\r\n            ps.push(card.LayoutHands(p, this.handQuat));\r\n            p.x += GameSet.CardWide;\r\n        }\r\n        await Promise.all(ps);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 出牌到区域\r\n     * @param cardData \r\n     * @param area \r\n     * @param index \r\n     */\r\n    async SendMyCardToArea(cardData: proto.base.IBattleRoomCardData, area: number, index: number) {\r\n        if (this.cardMap[cardData.instId]) {\r\n            let obj = this.cardMap[cardData.instId];\r\n            console.error(\"场景中已有相同id的卡 area:\" + obj.area + \" index:\" + obj.index);\r\n            obj.card?.receive?.();\r\n            delete this.cardMap[cardData.instId];\r\n        }\r\n        let newCard: SceneCard = SceneCard.Create();\r\n        if (this.selectedCard) newCard.setWorldPosition(this.selectedCard.worldPosition);\r\n        // this.node.addChild(newCard);\r\n        this.areaCardLay.addChild(newCard);\r\n        this.cardMap[cardData.instId] = { isMy: true, card: newCard, area: area, index: index };\r\n        newCard.InitData(true, cardData, this.handRotation);\r\n        let set = this.myTeamLayout[area][index];\r\n        let tt = TimeStamp();\r\n        await newCard.PlayToMyArea(set.worldPosition, set.rotation);\r\n        // this.areaCardLay.addChild(newCard);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 添加对手牌\r\n     * @param cardData \r\n     * @param area \r\n     * @param index \r\n     */\r\n    async SendAdCardToArea(cardData: proto.base.IBattleRoomCardData, area: number, index: number) {\r\n        if (this.cardMap[cardData.instId]) {\r\n            let obj = this.cardMap[cardData.instId];\r\n            console.error(\"场景中已有相同id的卡 area:\" + obj.area + \" index:\" + obj.index);\r\n            obj.card?.receive?.();\r\n            delete this.cardMap[cardData.instId];\r\n        }\r\n        let tt = TimeStamp();\r\n        let newCard: SceneCard = SceneCard.Create();\r\n        // this.node.addChild(newCard);\r\n        this.areaCardLay.addChild(newCard);\r\n        newCard.setWorldPosition(this.adCardEnterV.x, this.adCardEnterV.y, this.adCardEnterV.z);\r\n        this.cardMap[cardData.instId] = { isMy: false, card: newCard, area: area, index: index };\r\n        newCard.InitData(false, cardData, this.handRotation);\r\n        let set = this.adTeamLayout[area][index];\r\n        await newCard.PlayToAdArea(set.worldPosition);\r\n        // this.areaCardLay.addChild(newCard);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 刷新区域状态\r\n     * @param data \r\n     */\r\n    async FlushTerrain(ispLayerA: boolean, data: proto.base.IBattleRoomGamePlayData | (proto.base.IBattleRoomTerrainData[]), ownerPlayerId: string) {\r\n        let terrainDatas: proto.base.IBattleRoomTerrainData[];\r\n        let Reveal = [];//第几回合开启\r\n        let TerrainInstIds = [];//地形实际的instId\r\n        if (data instanceof proto.base.BattleRoomGamePlayData) {\r\n            terrainDatas = data.terrains;\r\n            Reveal = data.levelData.reveal;\r\n            for (let k in data.players) {\r\n                let player = data.players[k];\r\n                let isMy = player.playerId == ownerPlayerId;\r\n                for (let i = 0; i < player.terrain.length; i++) {\r\n                    if (!TerrainInstIds[i]) TerrainInstIds[i] = { my: \"\", ad: \"\" };\r\n                    if (isMy) {\r\n                        TerrainInstIds[i].my = player.terrain[i].selfInstId;\r\n                    } else {\r\n                        TerrainInstIds[i].ad = player.terrain[i].selfInstId;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            terrainDatas = data as proto.base.IBattleRoomTerrainData[];\r\n        }\r\n        for (let i = 0; i < terrainDatas.length; i++) {\r\n            let terrain = terrainDatas[i];\r\n            let area = this.areaList[terrain.area];\r\n            if (!this.cardMap[terrain.instId]) {\r\n                let card = area.getChildByName(\"hitTest\");\r\n                card['instId'] = terrain.instId;\r\n                this.cardMap[terrain.instId] = { isMy: true, card: <unknown>card as SceneCard, area: undefined, index: undefined };\r\n            }\r\n            if (TerrainInstIds[i]) {\r\n                let instId1 = TerrainInstIds[i].my, instId2 = TerrainInstIds[i].ad;\r\n                if (!this.cardMap[instId1]) {\r\n                    let card = area['hitTest1'];//area.getChildByName(\"hitTest1_area\" + i);\r\n                    card['instId'] = instId1;\r\n                    this.cardMap[instId1] = { isMy: true, card: <unknown>card as SceneCard, area: i, index: undefined };\r\n                }\r\n                if (!this.cardMap[instId2]) {\r\n                    let card = area['hitTest2'];//area.getChildByName(\"hitTest2_area\" + i);\r\n                    card['instId'] = instId2;\r\n                    this.cardMap[instId2] = { isMy: false, card: <unknown>card as SceneCard, area: i, index: undefined };\r\n                }\r\n            }\r\n\r\n            area[\"instId\"] = terrain.instId;\r\n            let desc = area.getChildByName('desc').getComponent(Label), mask = area.getChildByName('mask'), destory = area.getChildByName('destory'), filed = area.getChildByName(\"filed\").getComponent(sp.Skeleton);\r\n            desc.node.active = false;\r\n            mask.active = false;\r\n            destory.active = false;\r\n            let std = CfgMgr.Get(\"Area\")[terrain.configId];\r\n            let filedUrl = std ? `spine/${std.AreaIcon}/${std.AreaIcon}` : \"spine/filed_0000/filed_0000\";\r\n            let ainmName: string, loop = false;\r\n            desc.node.active = false;\r\n            switch (terrain.terrainState) {\r\n                case proto.base.BattleRoomInTerrainState.TerrainStateUnknown:\r\n                    // area.getChildByName('mask').active = true;\r\n                    desc.string = \"未知\";\r\n                    break;\r\n                case proto.base.BattleRoomInTerrainState.TerrainStateHide:\r\n                    if (terrain.peek && terrain.peek.indexOf(ownerPlayerId) > -1) {\r\n                        ainmName = \"idle\";\r\n                        loop = true;\r\n                        // desc.node.active = true;\r\n                        desc.string = std.AffectText;\r\n                    } else {\r\n                        ainmName = \"idle\";\r\n                        loop = true;\r\n                        // desc.node.active = true;\r\n                        if (Reveal[i]) {\r\n                            if (Reveal[i] - FightData.currentRound == 1) {\r\n                                desc.string = \"下回合揭示\";\r\n                            } else {\r\n                                desc.string = \"第\" + Reveal[i] + \"回合揭示\";\r\n                            }\r\n                            desc.node.active = true;\r\n                        } else {\r\n                            desc.string = \"未揭示\";\r\n                        }\r\n                    }\r\n                    break;\r\n                case proto.base.BattleRoomInTerrainState.TerrainStateShow:\r\n                    ainmName = \"show\";\r\n                    if (desc.string != std.AffectText) {\r\n                        // desc.node.active = true;\r\n                        desc.string = std.AffectText;\r\n                        let scale = desc.node.scale.x;\r\n                        tween(desc.node).to(0.1, { scale: v3(scale * 1.5, scale * 1.5, scale * 1.5) }).to(0.1, { scale: v3(scale, scale, scale) }).start();\r\n                        await Second(0.2);\r\n                        // for (let k in this.cardMap) {\r\n                        //     let obj = this.cardMap[k];\r\n                        //     if (obj.area == terrain.area) {\r\n                        //         obj.card.Shake(2.5);\r\n                        //     }\r\n                        // }\r\n                    }\r\n                    break;\r\n                case proto.base.BattleRoomInTerrainState.TerrainStateDestroy:\r\n                    area.getChildByName('destory').active = true;\r\n                    break\r\n            }\r\n            if (ainmName) {\r\n                filed.node.active = true;\r\n                if (filedUrl && filed['filedUrl'] != filedUrl) {\r\n                    filed['filedUrl'] = filedUrl;\r\n                    filed.skeletonData = await ResMgr.LoadResAbSub(filedUrl, sp.SkeletonData);\r\n                    filed.setAnimation(0, ainmName, loop);\r\n                }\r\n            } else {\r\n                filed.node.active = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 锁定\r\n     * @param isPlayerA \r\n     * @param data \r\n     */\r\n    async LockTerrain(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_LockZone) {\r\n        let attacker = this.findCard(data.fromInstId);\r\n        let cardLoca: CardLoca = this.findCard(data.toInstId);\r\n        if (data.fromSkillId) {\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [cardLoca?.card], [cardLoca?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 刷新战力\r\n     * @param isPlayerA \r\n     * @param area \r\n     * @param power \r\n     */\r\n    FlushAreaPower(isPlayerA: boolean, area: number, power: number) {\r\n        let areaNode = this.areaList[area];\r\n        let apower: Label, bpower: Label, aeffect: ParticleSystem, beffect: ParticleSystem;\r\n        if (isPlayerA) {\r\n            apower = areaNode.getChildByName(\"power1\").getComponent(Label);\r\n            bpower = areaNode.getChildByName(\"power2\").getComponent(Label);\r\n            aeffect = areaNode.getChildByName(\"mywin01\").getComponent(ParticleSystem);\r\n            beffect = areaNode.getChildByName(\"adwin01\").getComponent(ParticleSystem);\r\n        } else {\r\n            apower = areaNode.getChildByName(\"power2\").getComponent(Label);\r\n            bpower = areaNode.getChildByName(\"power1\").getComponent(Label);\r\n            aeffect = areaNode.getChildByName(\"adwin01\").getComponent(ParticleSystem);\r\n            beffect = areaNode.getChildByName(\"mywin01\").getComponent(ParticleSystem);\r\n        }\r\n        if (apower.string) {\r\n            let old = Number(apower.string);\r\n            if (old < power) {\r\n            }\r\n        }\r\n        apower.string = power + \"\";\r\n\r\n        if (power > Number(bpower.string) || 0) {\r\n            aeffect.node.active = true;\r\n            beffect.node.active = false;\r\n        } else if (power < Number(bpower.string) || 0) {\r\n            aeffect.node.active = false;\r\n            beffect.node.active = true;\r\n        } else {\r\n            aeffect.node.active = false;\r\n            beffect.node.active = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 刷新指定阵营状态\r\n     * @param isPlayerA \r\n     * @param area \r\n     * @param terrains \r\n     */\r\n    async FlushAreaCrads(isPlayerA: boolean, area: number, terrains: proto.base.IBattleRoomTerrainPlayerData) {\r\n        let datas = terrains.cards;\r\n\r\n        //先清理数据不同步的卡牌\r\n        for (let k in this.cardMap) {\r\n            let obj = this.cardMap[k];\r\n            if (obj.card instanceof GameObj && obj.area == area && obj.isMy == isPlayerA && datas.findIndex(value => value.instId == obj.card.instId) == -1) {\r\n                obj.card?.receive?.();\r\n                obj.card = undefined;\r\n                delete this.cardMap[k];\r\n            }\r\n        }\r\n        for (let i = 0; i < datas.length; i++) {\r\n            let data = datas[i];\r\n            let obj = this.cardMap[data.instId];\r\n\r\n            if (!obj) {\r\n                let newCard: SceneCard = SceneCard.Create();\r\n                this.areaCardLay.addChild(newCard);\r\n                obj = {\r\n                    isMy: isPlayerA,\r\n                    card: newCard,\r\n                    area: area,\r\n                    index: i\r\n                }\r\n                this.cardMap[data.instId] = obj;\r\n                obj.card?.InitData?.(isPlayerA, data, this.handRotation);\r\n            } else {\r\n                obj.area = area;\r\n                obj.index = i;\r\n                obj.card?.FlushData?.(isPlayerA, data);\r\n            }\r\n        }\r\n        let tt = TimeStamp();\r\n        await this.LayoutAllArea();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 刷新布局\r\n     */\r\n    async LayoutAllArea() {\r\n        for (let k in this.cardMap) {\r\n            let obj = this.cardMap[k];\r\n            if (obj.card as SceneCard && obj.area != undefined && obj.index != undefined) {\r\n                let layout = obj.isMy ? this.myTeamLayout[obj.area][obj.index] : this.adTeamLayout[obj.area][obj.index];\r\n                if (!layout) {\r\n                    console.error(\"找不到地形上的卡片：\" + obj?.area + \",\" + obj?.index);\r\n                }\r\n                if (obj.card && obj.card.parent != this.areaCardLay) this.areaCardLay.addChild(obj.card);\r\n                if (!obj.card?.CheckMatrix?.(layout.worldPosition)) {\r\n                    await obj.card?.LayoutArea?.(layout.worldPosition);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 盖牌\r\n     * @param datas \r\n     */\r\n    async CloseCard(data: proto.base.IBattleRoomCardData) {\r\n        let obj = this.cardMap[data.instId];\r\n        if (obj) {\r\n            await obj.card?.TurnBack?.();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示卡\r\n     * @param datas \r\n     */\r\n    async ShowCard(data: proto.base.IBattleRoomCardData) {\r\n        let obj = this.cardMap[data.instId];\r\n        if (!obj) return 0;\r\n        // if (obj.card.parent) obj.card.setSiblingIndex(obj.card.parent.children.length - 1)\r\n        // this.node.addChild(obj.card);\r\n        let tt = TimeStamp();\r\n        obj.card?.FlushData?.(obj.isMy, data);\r\n        await obj.card?.Open?.();\r\n        this.areaCardLay.addChild(obj.card);\r\n        // for (let k in this.cardMap) {\r\n        //     let other = this.cardMap[k];\r\n        //     if (other != obj && other.card.state == CardState.Fightting && other.card.isMy != obj.card.isMy && other.area == obj.area) {\r\n        //         other.card.Shake(2.5);\r\n        //     }\r\n        // }\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**获取位置 */\r\n    protected fileLocation(isPlayerA: boolean, location: number, area: number = 0, idx?: number) {\r\n        switch (location) {\r\n            case proto.base.BattleRoomCardLocation.Hand:\r\n                return isPlayerA ? this.myHand : this.adHand;\r\n            case proto.base.BattleRoomCardLocation.Deck:\r\n                return isPlayerA ? this.myDeck : this.adDeck;\r\n            case proto.base.BattleRoomCardLocation.Drop:\r\n                return isPlayerA ? this.myDrop : this.adDrop;\r\n            case proto.base.BattleRoomCardLocation.Del:\r\n                return isPlayerA ? this.myDel : this.adDel;\r\n            case proto.base.BattleRoomCardLocation.Terrain:\r\n                if (idx != undefined) {\r\n                    return isPlayerA ? this.myTeamLayout[area][idx] : this.myTeamLayout[area][idx];\r\n                }\r\n                let areaName = isPlayerA ? \"hitTest1\" : \"hitTest2\";\r\n                let areaNode = this.areaList[area];\r\n                if (areaNode) return area[areaName];//areaNode.getChildByName(areaName + \"_\" + areaNode.name);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    /**\r\n     * 播放技能\r\n     * @param isPlayerA \r\n     * @param data \r\n     */\r\n    async PlaySkill(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_EffectSkill) {\r\n        // 如果当前回合已起效则跳过,count<0表示未起效\r\n        if (!data.instId || !data.count.length || data.count[battleDataMgr.curRound] == undefined) return;\r\n        if (data.count[battleDataMgr.curRound] == -1 || data.count[battleDataMgr.curRound] < -2) return;\r\n        let attacker = this.cardMap[data.instId];\r\n        if (!attacker) this.handCards.find(value => value.Id == data.instId);\r\n        let targets = [], self = this, myAreas = [], adAreas = [];\r\n        data.targets.forEach(value => {\r\n            targets.push(this.findCard(value.instId) || self.fileLocation(isPlayerA, value.location));\r\n            if (battleDataMgr.isPlayerA(value.playerId)) {\r\n                myAreas.push(value.area);\r\n            } else {\r\n                adAreas.push(value.area);\r\n            }\r\n        });\r\n        let tag: EffectTarget;\r\n        if (!targets.length && attacker) {\r\n            tag = this.skillTarget(isPlayerA, attacker?.card, targets);\r\n            if (!SkillUtils.TryToFindTarget(isPlayerA, attacker?.card, tag, data)) {\r\n                tag = this.skillTarget(isPlayerA, attacker?.card, targets, [attacker.area]);\r\n            }\r\n        } else if (attacker) {\r\n            tag = this.skillTarget(isPlayerA, attacker?.card, targets, [attacker.area]);\r\n        } else {\r\n            return;\r\n        }\r\n        let output = { fromInstId: data.instId, fromSkillId: data.skillId };\r\n        let tt = TimeStamp();\r\n        await Skill.Play(output, tag, isPlayerA, undefined, true);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 删除技能\r\n     * @param isPlayerA \r\n     * @param data \r\n     */\r\n    RemoveSkill(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_Nullify) {\r\n        Skill.Stop(data.toPlayerId, data.toSkillId, data.toInstId);\r\n    }\r\n\r\n    /**\r\n     * 卡数据变更\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @returns \r\n     */\r\n    async CardDataChange(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_CardDataChange) {\r\n        let tt = TimeStamp();\r\n        let attacker = this.findCard(data.fromInstId);\r\n        let changeCard = this.findCard(data.card.instId);\r\n        let target = this.findCard(TouchInstId(data)) || changeCard;\r\n        if (data.fromSkillId) {\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n        changeCard?.card?.FlushData?.(isPlayerA, data.card);\r\n        await Second(0.25);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 查找卡\r\n     * @param instId \r\n     * @returns \r\n     */\r\n    protected findCard(instId: string): CardLoca {\r\n        if (!instId) return undefined;\r\n        let card = this.handCards.find(value => value.instId == instId);\r\n        if (card) {\r\n            return { isMy: true, card: card, area: -1, index: -1 };\r\n        } else {\r\n            return this.cardMap[instId];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 从场景移除一张卡片到指定区域\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @param loca \r\n     * @returns \r\n     */\r\n    async RmoveCardFormArea(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_TerrainToDrop | proto.base.IBattleRoomOpOutput_TerrainToDel, loca: number) {\r\n        let tt = TimeStamp();\r\n\r\n        let removeTag = this.cardMap[data.card.instId];\r\n        let attacker = this.findCard(data.fromInstId);\r\n        let target = this.findCard(TouchInstId(data)) || removeTag;\r\n        if (removeTag) {\r\n            if (data.fromSkillId) {\r\n                let tag = this.skillTarget(isPlayerA, attacker?.card, [target.card], [attacker?.area], [target.area]);\r\n                await Skill.Play(data, tag, isPlayerA);\r\n            }\r\n            delete this.cardMap[data.card.instId];\r\n            let delLoca = this.fileLocation(isPlayerA, loca);\r\n            if (delLoca) await removeTag.card?.MoveTo?.(delLoca.worldPosition);\r\n            removeTag.card?.receive?.();\r\n        }\r\n        this.LayoutAllArea();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 移除手牌上的一张卡到指定位置\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @param loca \r\n     * @returns \r\n     */\r\n    async RemoveCardFormHand(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_HandToDel, loca: number) {\r\n        let tt = TimeStamp();\r\n        let obj: Node;\r\n        if (isPlayerA) {\r\n            let index = this.handCards.findIndex(value => value.instId == data.card.instId);\r\n            obj = this.handCards[index];\r\n            this.handCards.splice(index, 1);\r\n        } else {\r\n            obj = this.adHand;\r\n        }\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);\r\n            let target = this.findCard(TouchInstId(data)) || cardLoca(obj, isPlayerA);\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n        let locaNode = this.fileLocation(isPlayerA, loca);\r\n        if (isPlayerA) {\r\n            if (obj instanceof SceneCard) {\r\n                await obj.MoveTo(locaNode.worldPosition);\r\n                obj.receive();\r\n            } else {\r\n                console.warn(\"找不到可移除的手牌\" + data.card.instId);\r\n            }\r\n        } else {\r\n            let card = SceneCard.Create();\r\n            card.InitData(isPlayerA, data.card);\r\n            card.setWorldRotation(this.handQuat);\r\n            this.handCardLay.addChild(card);\r\n            card.setWorldPosition(this.adHand.worldPosition);\r\n            await card.MoveTo(locaNode.worldPosition, this.handQuat);\r\n            card.receive();\r\n        }\r\n        this.LayoutAllHandCards();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 非可视区域的卡牌飞到场景区域上\r\n     * @param formIsPlayerA 卡牌来源是否第一视觉玩家\r\n     * @param toIsPlayerA 卡牌目标是否第一视觉玩家\r\n     * @param areaIdx 添加卡牌的目标区域下标\r\n     * @param cardIdx 添加卡牌的目标下标\r\n     * @param data 添加卡牌数据\r\n     */\r\n    async CardBackToArea(isPlayerA: boolean, formIsPlayerA: boolean, toIsPlayerA: boolean, areaIdx: number, cardIdx: number, data: proto.base.IBattleRoomOpOutput_AddCardToTerrain) {\r\n        let tt = TimeStamp();\r\n        let fromNode: Node = this.fileLocation(formIsPlayerA, data.fromLocation);\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);//定位此技能的发起卡牌\r\n            let target = this.findCard(TouchInstId(data));\r\n            if (!fromNode) fromNode = target?.card;\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n        let layout = (toIsPlayerA ? this.myTeamLayout : this.adTeamLayout)[areaIdx][cardIdx];\r\n        let obj = this.cardMap[data.card.instId];\r\n        if (!obj) {\r\n            let card = SceneCard.Create();\r\n            card.InitData(isPlayerA, data.card, this.zero);\r\n            this.areaCardLay.addChild(card);\r\n            obj = { isMy: toIsPlayerA, card: card, area: areaIdx, index: cardIdx };\r\n            this.cardMap[data.card.instId] = obj;\r\n        }\r\n        obj.card.setWorldPosition(fromNode?.worldPosition || this.zero);\r\n        await obj.card?.MoveTo?.(layout.worldPosition);\r\n        //await obj.card?.Open?.();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 复制对方的卡或者把对方的卡挪过来用\r\n     * @param isPlayerA 是否自己\r\n     * @param data \r\n     */\r\n    async AddCard(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_AddCard) {\r\n        let tt = TimeStamp();\r\n        let fromCard: CardLoca = this.findCard(data.sourceInstId);\r\n        if (!fromCard) fromCard = cardLoca(this.fileLocation(isPlayerA, data.sourceLocation), isPlayerA);\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);// this.cardMap[data.fromInstId];\r\n            let tager = this.findCard(TouchInstId(data)) || fromCard;\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [tager?.card], [attacker?.area], [fromCard?.area]);\r\n            await Skill.Play(data, tag);\r\n        }\r\n\r\n        let sourceCard: SceneCard, target: SceneCard;\r\n        // 处理来源\r\n        if (data.sourceLocation == proto.base.BattleRoomCardLocation.Hand) {\r\n            // 来源卡位于自己手牌\r\n            let index = this.handCards.findIndex(value => value.instId == data.sourceInstId);\r\n            if (index != -1) {\r\n                sourceCard = this.handCards[index];\r\n                if (data.isMove) {\r\n                    this.handCards.splice(index, 1);\r\n                    this.LayoutAllHandCards();\r\n                }\r\n            }\r\n        } else if (data.sourceLocation == proto.base.BattleRoomCardLocation.Terrain) {\r\n            // 来源卡位于场景上\r\n            fromCard = this.cardMap[data.sourceInstId];\r\n            if (fromCard) {\r\n                if (data.isMove) delete this.cardMap[data.sourceInstId];\r\n                sourceCard = fromCard.card;\r\n            }\r\n        }\r\n        if (data.isMove) target = sourceCard;\r\n        if (!target) {\r\n            target = SceneCard.Create();\r\n            target.InitData(isPlayerA, data.card);\r\n            target.setWorldPosition(target.worldPosition);\r\n        }\r\n        switch (data.card.location) {\r\n            case proto.base.BattleRoomCardLocation.Hand:\r\n                if (isPlayerA) {\r\n                    this.handCardLay.addChild(target);\r\n                    this.handCards.push(target);\r\n                    await this.LayoutAllHandCards();\r\n                } else {\r\n                    await target.MoveTo(this.adHand.worldPosition, this.handQuat);\r\n                }\r\n                break;\r\n\r\n            case proto.base.BattleRoomCardLocation.Terrain:\r\n                this.areaCardLay.addChild(target);\r\n                let idx = 0;\r\n                for (let k in this.cardMap) {\r\n                    if (this.cardMap[k].area == data.card.area && this.cardMap[k].isMy == isPlayerA) {\r\n                        if (this.cardMap[k].index != undefined) {\r\n                            idx = Math.max(this.cardMap[k].index + 1, idx);\r\n                        }\r\n                    }\r\n                }\r\n                this.cardMap[data.card.instId] = {\r\n                    isMy: isPlayerA,\r\n                    card: target,\r\n                    area: data.card.area,\r\n                    index: idx\r\n                }\r\n                await this.LayoutAllArea();\r\n                await target.Open();\r\n                break;\r\n\r\n            default:\r\n                this.areaCardLay.addChild(target);\r\n                let loca = this.fileLocation(isPlayerA, proto.base.BattleRoomCardLocation.Deck);\r\n                await target.MoveTo(loca.worldPosition);\r\n                target.receive();\r\n        }\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 从各个地方飞向指定区域\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @param fromData \r\n     * @param targetIdx \r\n     */\r\n    async AddCardToArea(isPlayerA: boolean, data: OutStruct, fromData: proto.base.IBattleRoomCardData, area: number, targetIdx: number) {\r\n        let tt = TimeStamp();\r\n        let fromCard: CardLoca = this.findCard(fromData?.instId);\r\n        if (!fromCard && data['fromLocation'] != undefined) fromCard = cardLoca(this.fileLocation(isPlayerA, data['fromLocation']), isPlayerA);\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);// this.cardMap[data.fromInstId];\r\n            let target = this.findCard(TouchInstId(data)) || fromCard;\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [area || fromCard?.area]);\r\n            await Skill.Play(data, tag);\r\n        }\r\n\r\n        let obj = this.cardMap[data.card.instId];\r\n        if (obj) {\r\n            obj.area = data.card.area;\r\n            obj.index = targetIdx;\r\n            obj.isMy = isPlayerA;\r\n        } else {\r\n            let card = SceneCard.Create();\r\n            card.InitData(data.card, v3());\r\n            this.handCardLay.addChild(card);\r\n            obj = {\r\n                isMy: isPlayerA,\r\n                card: card,\r\n                area: data.card.area,\r\n                index: targetIdx\r\n            };\r\n            this.cardMap[data.card.instId] = obj;\r\n        }\r\n        let target = this.fileLocation(isPlayerA, proto.base.BattleRoomCardLocation.Terrain, data.card.area, targetIdx);\r\n        obj.card?.setWorldPosition(fromCard?.card?.worldPosition || this.zero);\r\n        await obj.card?.MoveTo?.(target.worldPosition);\r\n        if (obj.card.state != CardState.Showing) await obj.card?.Open?.();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 手牌自动出牌\r\n     * @param cardData \r\n     * @param area \r\n     * @param cardIdx \r\n     * @returns \r\n     */\r\n    async AutoPlayHand(cardData: proto.base.IBattleRoomCardData, area: number, cardIdx: number) {\r\n        let tt = TimeStamp();\r\n        let card: SceneCard;\r\n        for (let index = 0; index < this.handCards.length; index++) {\r\n            if (this.handCards[index].instId == cardData.instId) {\r\n                card = this.handCards[index];\r\n                this.handCards.splice(index, 1);\r\n            }\r\n        }\r\n        if (card) {\r\n            let obj = {\r\n                isMy: true,\r\n                card: card,\r\n                area: area,\r\n                index: cardIdx\r\n            };\r\n            this.cardMap[cardData.instId] = obj;\r\n            card.parent = this.areaCardLay;\r\n            let target = this.fileLocation(true, proto.base.BattleRoomCardLocation.Terrain, cardData.area, cardIdx);\r\n            await card.MoveTo(target.worldPosition);\r\n            await card.PlayToMyArea(target.worldPosition, target.rotation);\r\n        }\r\n        this.LayoutAllHandCards();\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 非可视区域卡牌转变\r\n     * （例：弃牌区到删除区、卡组区到弃牌区）\r\n     * @param isPlayerA 是否第一视觉玩家\r\n     * @param data 卡牌数据\r\n     */\r\n    async RemoveDeckToUnVisible(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_DeckToDel, loca: number) {\r\n        let tt = TimeStamp();\r\n        let attacker = this.findCard(data.fromInstId);//定位发起技能的卡牌\r\n        let delNode = isPlayerA ? this.myDeck : this.adDeck;\r\n        let target = this.findCard(TouchInstId(data)) || cardLoca(delNode, isPlayerA);\r\n        let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], []);\r\n        if (data.fromSkillId) await Skill.Play(data, tag, isPlayerA);\r\n        let card: SceneCard = SceneCard.Create();\r\n        card.InitData(isPlayerA, data.card);\r\n        this.node.addChild(card);\r\n        let tagNode = this.fileLocation(isPlayerA, loca);\r\n        if (tagNode) {\r\n            card.setWorldPosition(tagNode.worldPosition.x, tagNode.worldPosition.y, tagNode.worldPosition.z);\r\n        } else {\r\n            card.setWorldPosition(this.zero);\r\n        }\r\n        await card.MoveTo(delNode.worldPosition);\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 非可视区域添加卡牌\r\n     * （例：复制一张卡到卡组区域、系统发卡牌到卡组区域）\r\n     * @param isPlayerA 是否第一视觉玩家\r\n     * @param data 卡牌数据\r\n     */\r\n    async AddCardToDeck(isPlayerA: boolean, targetPlayer: boolean, data: proto.base.IBattleRoomOpOutput_AddCardToDeck) {\r\n        let attacker = this.findCard(data.fromInstId);//尝试定位发起技能的卡牌\r\n        // let head = data.card.area ? this.node.getChildByPath(\"ui/my\") : this.node.getChildByPath(\"ui/ad\");\r\n        let head = this.fileLocation(targetPlayer, data.card.location);\r\n        let tag = this.skillTarget(isPlayerA, attacker?.card, [head]);\r\n        if (data.fromSkillId) await Skill.Play(data, tag);\r\n        if (data.card.location == proto.base.BattleRoomCardLocation.Deck) return;//不可见的地方用特效\r\n        let card: SceneCard = SceneCard.Create();\r\n        card.InitData(isPlayerA, data.card);\r\n        this.node.addChild(card);\r\n        let tagObj = this.findCard(data.fromPlayerId);//this.fileLocation(isPlayerA, proto.base.BattleRoomCardLocation.Drop);\r\n        if (tagObj) {\r\n            card.setWorldPosition(tagObj.card.worldPosition);\r\n        } else {\r\n            let tagNode = this.fileLocation(isPlayerA, data.fromLocation);\r\n            if (tagNode) {\r\n                card.setWorldPosition(tagNode.worldPosition);\r\n            } else {\r\n                card.setWorldPosition(this.zero);\r\n            }\r\n        }\r\n        await card.MoveTo(head.worldPosition);\r\n        card.receive();\r\n    }\r\n\r\n    /**\r\n     * 从各个方向添加卡牌到手牌上\r\n     * @param isPlayerA \r\n     * @param data \r\n     * @param fromLocation \r\n     * @param fromCard \r\n     */\r\n    async AddCardToHand(isPlayerA: boolean, data: proto.base.IBattleRoomOpOutput_AddCardToHand, fromLocation?: number, fromCard?: proto.base.IBattleRoomCardData) {\r\n        let tt = TimeStamp();\r\n        let fromLoca: CardLoca;\r\n        if (fromCard) fromLoca = this.findCard(fromCard.instId);\r\n        if (!fromLoca) fromLoca = cardLoca(this.fileLocation(isPlayerA, data['fromLocation'] || fromLocation), isPlayerA);\r\n        // if (!fromNode) fromNode = this.findCard(TouchInstId(data));\r\n        let target = this.findCard(TouchInstId(data)) || fromLoca;\r\n\r\n        if (data.fromSkillId) {\r\n            let attacker = this.findCard(data.fromInstId);//this.cardMap[data.fromInstId];\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag);\r\n        }\r\n\r\n        if (isPlayerA) {\r\n            if (!this.handCards.find(value => value.instId == data.card.instId)) {\r\n                let card: SceneCard = SceneCard.Create();\r\n                card.InitData(isPlayerA, data.card, v3());\r\n                this.handCards.push(card);\r\n                this.handCardLay.addChild(card);\r\n                card.setWorldPosition(fromLoca?.card?.worldPosition || this.zero);\r\n                let v = Vec3.clone(this.handCenter);\r\n                let total = this.handCards.length * GameSet.CardWide;\r\n                v.x = this.handCenter.x - total - GameSet.CardWide / 2;\r\n                v.x += (GameSet.CardWide * this.handCards.length);\r\n                await card.MoveTo(v, this.handQuat);\r\n            }\r\n        } else {\r\n            let card: SceneCard = SceneCard.Create();\r\n            card.InitData(isPlayerA, data.card, v3());\r\n            card.setWorldPosition(this.zero);\r\n            await card.MoveTo(this.adHand.worldPosition, this.handQuat);\r\n        }\r\n\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 卡牌在区域上移动\r\n     * @param isPlayerA 移动目的地的玩家是否第一视觉玩家\r\n     * @param areaIdx 移动目的地的区域下标\r\n     * @param cardIdx 移动目的地的卡牌下标\r\n     * @param data \r\n     */\r\n    async CardAreaMove(isPlayerA: boolean, areaIdx: number, cardIdx: number, data: proto.base.IBattleRoomOpOutput_TerrainToTerrain) {\r\n        let tt = TimeStamp();\r\n        let attacker = this.findCard(data.fromInstId);\r\n        let obj = this.cardMap[data.card.instId];\r\n        let target = this.findCard(TouchInstId(data)) || obj;\r\n        if (data.fromSkillId) {\r\n            let tag = this.skillTarget(isPlayerA, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag, isPlayerA);\r\n        }\r\n\r\n        if (obj) {\r\n            obj.isMy = isPlayerA;\r\n            obj.area = areaIdx;\r\n            obj.index = cardIdx;\r\n            let targetNode: Node = isPlayerA ? this.myTeamLayout[areaIdx][cardIdx] : this.adTeamLayout[areaIdx][cardIdx];\r\n            obj.card?.FlushData?.(isPlayerA, data.card);\r\n            await obj.card?.MoveTo?.(targetNode.worldPosition)\r\n        } else {\r\n            this.AddCardToArea(isPlayerA, data, undefined, areaIdx, cardIdx)\r\n        }\r\n        return TimeStamp(tt);\r\n    }\r\n\r\n    /**\r\n     * 窥视区域\r\n     * @param data \r\n     */\r\n    async PeekTerrain(isplayerA: boolean, data: proto.base.IBattleRoomOpOutput_Peek, playerIdA: string) {\r\n        let attacker = this.findCard(data.fromInstId);\r\n        let target = this.findCard(TouchInstId(data)) || attacker;\r\n        let terrains: proto.base.IBattleRoomTerrainData[] = [];\r\n        for (let k in data.terrainData) {\r\n            terrains.push(data.terrainData[k])\r\n        }\r\n        if (data.fromSkillId) {\r\n            let areas = [];\r\n            for (let k in data.terrainData) {\r\n                let terrain = data.terrainData[k];\r\n                // let target = this.fileLocation(false, proto.base.BattleRoomCardLocation.Terrain, terrain.area);\r\n                // if (target) areas.push(target);\r\n                areas.push(terrain.area);\r\n            }\r\n            let tag = this.skillTarget(true, attacker?.card, [target?.card], [attacker?.area], areas);\r\n            await Skill.Play(data, tag);\r\n        }\r\n        await this.FlushTerrain(isplayerA, terrains, playerIdA);\r\n    }\r\n\r\n    /**\r\n     * 窥视卡片\r\n     * @param data \r\n     * @param loca \r\n     */\r\n    async PeekHandCards(data: proto.base.IBattleRoomOpOutput_Peek, loca: number = proto.base.BattleRoomCardLocation.Hand) {\r\n        let attacker = this.findCard(data.fromInstId);\r\n        if (data.fromSkillId) {\r\n            // let target = this.fileLocation(false, loca);\r\n            let target = this.findCard(TouchInstId(data)) || cardLoca(this.fileLocation(false, loca), true);\r\n            let tag = this.skillTarget(true, attacker?.card, [target?.card], [attacker?.area], [target?.area]);\r\n            await Skill.Play(data, tag);\r\n        }\r\n        let head = this.node.getChildByPath(\"ui/ad\");\r\n        let cards = [];\r\n        for (let k in data.handCards) {\r\n            let cardData = data.handCards[k];\r\n            let card = SceneCard.Create();\r\n            card.InitData(false, cardData, this.handQuat);\r\n            this.handCardLay.addChild(card);\r\n            card.setWorldPosition(head.worldPosition.x, head.worldPosition.y, head.worldPosition.z);\r\n            cards.push(card);\r\n        }\r\n        let ps = [];\r\n        let v = Vec3.clone(this.PeekHandV);\r\n        let total = Math.max(0, cards.length - 1) * GameSet.CardWide;\r\n        v.x = this.handCenter.x - total - GameSet.CardWide / 2;\r\n        for (let i = 0; i < cards.length; i++) {\r\n            let card = cards[i];\r\n            ps.push(card.LayoutHands(v, this.handQuat));\r\n            v.x += GameSet.CardWide;\r\n        }\r\n        await Promise.all(ps);\r\n        await Second(3);\r\n        ps.length = 0;\r\n        for (let i = 0; i < cards.length; i++) {\r\n            let card = cards[i];\r\n            ps.push(card.MoveTo(this.adHand.worldPosition, this.handQuat));\r\n        }\r\n        await Promise.all(ps);\r\n        while (cards.length) {\r\n            cards.pop().receive();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 重置\r\n     */\r\n    Reset() {\r\n\r\n        if (this.myNameLab) {\r\n            this.myNameLab.string = \"\";\r\n            this.adNameLab.string = \"\";\r\n            // this.roundLab.string = \"\";\r\n        }\r\n        this.doubleLab.string = `1`;\r\n        this.roundBtnMaskBg.active = true;\r\n        this.progress.fillRange = 0;\r\n        this.isWaitInput = false;\r\n        this.qxjshhEffect.active = false;\r\n        this.notTimeEffect.active = false;\r\n        this.jshhEffect.active = false;\r\n        for (let k in this.cardMap) {\r\n            let obj = this.cardMap[k];\r\n            obj.card?.receive && obj.card?.receive();\r\n        }\r\n        this.cardMap = {};\r\n\r\n        for (let area of this.areaList) {\r\n            area.getChildByName(\"mywin01\").active = false;\r\n            area.getChildByName(\"mywin02\").active = false;\r\n            area.getChildByName(\"adwin01\").active = false;\r\n            area.getChildByName(\"adwin02\").active = false;\r\n            area.getChildByName(\"desc\").getComponent(Label).string = \"\";\r\n            area.getChildByName(\"power1\").getComponent(Label).string = \"\";\r\n            area.getChildByName(\"power2\").getComponent(Label).string = \"\";\r\n        }\r\n\r\n        while (this.handCards.length) {\r\n            let card = this.handCards.pop();\r\n            card.receive();\r\n        }\r\n\r\n    }\r\n}\r\n\r\n\r\n"]}