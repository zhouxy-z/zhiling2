{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/cards/CardGroupItem.ts"],"names":["CardGroupItem","Button","Component","Label","path","Sprite","SpriteFrame","CfgMgr","cardBack","folder_icon","ResMgr","PlayerData","Route","Session","add","cardNode","bg","cardSpr","warning","nameLab","useLab","headIcon","getBtn","data","$loadSub","complete","hasLoad","onLoad","node","getChildByName","getChildByPath","getComponent","on","EventType","CLICK","onGet","active","loadSub","thisObj","Promise","resolve","reject","SetData","is_hide_use","string","name","size","url","join","LoadResAbSub","res","spriteFrame","id","CurFightCardGroup","avatarId","GetLogic","HeadID","cfg","GetHead","headIconUrl","icon","console","log","cardBackcfg","GetCardBackCfgById","cardBackId","callBackIcon","Send","getData"],"mappings":"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","sourcesContent":["import { Button, Component, Input, Label, Node, path, sp, Sprite, SpriteFrame } from \"cc\";\r\nimport { CfgMgr } from \"../../manager/CfgMgr\";\r\nimport { cardBack, folder_icon, ResMgr } from \"../../manager/ResMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport proto, { Req, Route } from \"../../net/Protocol\";\r\nimport { Session } from \"../../net/Session\";\r\n\r\nexport class CardGroupItem extends Component {\r\n    private add: Node;\r\n    private cardNode: Node;\r\n    private bg: Sprite;\r\n    private cardSpr: Sprite;\r\n    private warning: Node;\r\n    private nameLab: Label;\r\n    private useLab:Node;\r\n    private headIcon: Sprite;\r\n    private getBtn: Button;\r\n  \r\n\r\n    private data:any\r\n    protected $loadSub: Promise<any>;\r\n    protected complete: Function;\r\n    protected hasLoad = false;\r\n\r\n\r\n    protected onLoad(): void {\r\n        this.add = this.node.getChildByName(\"add\");\r\n        this.cardNode = this.node.getChildByName(\"cardNode\");\r\n        this.bg = this.node.getChildByPath(\"cardNode/bg\").getComponent(Sprite);\r\n        this.cardSpr = this.node.getChildByPath(\"cardNode/cardSpr\").getComponent(Sprite);\r\n        this.warning = this.node.getChildByPath(\"cardNode/warning\")\r\n        this.nameLab = this.node.getChildByPath(\"cardNode/nameLab\").getComponent(Label);\r\n        this.useLab = this.node.getChildByPath(\"cardNode/useLab\");\r\n        this.headIcon = this.node.getChildByPath(\"cardNode/headIcon\").getComponent(Sprite);\r\n        this.getBtn = this.node.getChildByPath(\"cardNode/getBtn\").getComponent(Button);\r\n        this.getBtn.node.on(Button.EventType.CLICK, this.onGet, this)\r\n        this.getBtn.node.active = false;\r\n        this.hasLoad = true;\r\n        this.complete?.();\r\n    }\r\n\r\n    protected get loadSub() {\r\n        if (this.$loadSub) return this.$loadSub;\r\n        let thisObj = this;\r\n        this.$loadSub = new Promise((resolve, reject) => {\r\n            thisObj.complete = resolve;\r\n        });\r\n        return this.$loadSub;\r\n    }\r\n\r\n\r\n    /**\r\n     * 设置角色数据\r\n     * @param data \r\n     */\r\n    async SetData(data: proto.base.IDeckAttrs, is_hide_use?:boolean) {\r\n        if (!this.hasLoad) await this.loadSub;\r\n        this.data = data;\r\n        this.add.active = false ;\r\n        this.cardNode.active = true; \r\n        if(typeof data == \"string\"){\r\n            this.add.active = true ;\r\n            this.cardNode.active = false;\r\n            return\r\n        }\r\n        if(!data)return;\r\n        this.nameLab.string = data.name;\r\n        this.warning.active = !data.size || data.size < 12;\r\n        let url = !data.size || data.size < 12 ? path.join(\"sheets/cards/red\", \"spriteFrame\") : path.join(\"sheets/cards/blue\", \"spriteFrame\")\r\n        ResMgr.LoadResAbSub(url, SpriteFrame, res => {\r\n            this.bg.spriteFrame = res;\r\n        });\r\n        this.getBtn.node.active = data.id == \"\";\r\n        this.useLab.active = !is_hide_use && PlayerData.CurFightCardGroup && data.id == PlayerData.CurFightCardGroup.id;\r\n       \r\n        let avatarId = data.avatarId ? data.avatarId :  CfgMgr.GetLogic(\"InitDeck\").HeadID\r\n        let cfg = CfgMgr.GetHead(avatarId)\r\n        if(cfg){\r\n            let headIconUrl = cfg.icon\r\n            ResMgr.LoadResAbSub(path.join(folder_icon, \"head/\", headIconUrl, \"spriteFrame\"), SpriteFrame, res => {\r\n                this.headIcon.spriteFrame =  res;\r\n            });\r\n        }else{\r\n            console.log(\"配置错误\")\r\n        }\r\n\r\n        let cardBackcfg = CfgMgr.GetCardBackCfgById(data.cardBackId)\r\n        if(cardBackcfg){\r\n            let callBackIcon = cardBackcfg.icon\r\n            ResMgr.LoadResAbSub(path.join(cardBack, \"card_back_\" + callBackIcon, \"spriteFrame\"), SpriteFrame, res => {\r\n                this.cardSpr.spriteFrame =  res;\r\n            });\r\n        }else{\r\n            console.log(\"配置错误\")\r\n        }\r\n    }\r\n\r\n    private onGet(){\r\n        Session.Send(Route[\"logic.protocol.noobcardsclaim\"])\r\n    }\r\n\r\n    getData(){\r\n        return this.data\r\n    }\r\n\r\n  \r\n}"]}