{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/bag/BagModule.ts"],"names":["BagModule","CfgMgr","ItemType","EventMgr","Evt_GetReward","Evt_Item_Change","Session","RewardTips","PlayerData","Ret","Route","constructor","on","PlayerItemsChangedPush","onItemsChange","getOpenBoxReward","data","item_data","decode","console","log","changeMap","item","list","countAfter","type","Getitem","itemId","Itemtpye","money","items","count","emit","open_box_data","things","Show"],"mappings":";;;uIAUaA,S;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AATJC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,Q,iBAAAA,Q;;AACRC,MAAAA,Q,iBAAAA,Q;AAAuBC,MAAAA,a,iBAAAA,a;AAAeC,MAAAA,e,iBAAAA,e;;AACtCC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,G,iBAAAA,G;AAAKC,MAAAA,K,iBAAAA,K;;;;;;;2BAIDV,S,GAAN,MAAMA,SAAN,CAAgB;AACnBW,QAAAA,WAAW,GAAG;AACV;AAAA;AAAA,kCAAQC,EAAR,CAAW;AAAA;AAAA,8BAAMC,sBAAjB,EAAyC,KAAKC,aAA9C,EAA6D,IAA7D;AACA;AAAA;AAAA,kCAAQF,EAAR,CAAW;AAAA;AAAA,8BAAM,yBAAN,CAAX,EAA6C,KAAKG,gBAAlD,EAAoE,IAApE;AACH;;AAGDD,QAAAA,aAAa,CAACE,IAAD,EAAY;AACrB,cAAIC,SAAS,GAAG;AAAA;AAAA,0BAAIJ,sBAAJ,CAA2BK,MAA3B,CAAkCF,IAAlC,CAAhB;AACAG,UAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAAyBH,SAAzB;AACA,cAAII,SAAkC,GAAG,EAAzC;;AACA,eAAK,MAAMC,IAAX,IAAmBL,SAAS,CAACM,IAA7B,EAAmC;AAC/B,gBAAID,IAAI,CAACE,UAAL,GAAkB,CAAtB,EAAyB;AACrB,kBAAIC,IAAI,GAAG;AAAA;AAAA,oCAAOC,OAAP,CAAeJ,IAAI,CAACK,MAApB,EAA4BC,QAAvC;;AACA,kBAAGH,IAAI,IAAI;AAAA;AAAA,wCAASI,KAApB,EAA0B;AACtB;AAAA;AAAA,8CAAWC,KAAX,CAAiBR,IAAI,CAACK,MAAtB,IAAgCL,IAAI,CAACE,UAAL,GAAkB,KAAlD;AACH,eAFD,MAEK;AACD;AAAA;AAAA,8CAAWM,KAAX,CAAiBR,IAAI,CAACK,MAAtB,IAAgCL,IAAI,CAACE,UAArC;AACH;AACJ,aAPD,MAOO;AACH,qBAAO;AAAA;AAAA,4CAAWM,KAAX,CAAiBR,IAAI,CAACK,MAAtB,CAAP;AACH;;AAED,gBAAI,CAACN,SAAS,CAACC,IAAI,CAACK,MAAN,CAAd,EAA6B;AACzBN,cAAAA,SAAS,CAACC,IAAI,CAACK,MAAN,CAAT,GAAyBL,IAAI,CAACS,KAA9B;AACH;AACJ;;AACDZ,UAAAA,OAAO,CAACC,GAAR,CAAY;AAAA;AAAA,wCAAWU,KAAvB;AACA;AAAA;AAAA,oCAASE,IAAT;AAAA;AAAA,kDAA+BX,SAA/B;AACH;;AAEDN,QAAAA,gBAAgB,CAACC,IAAD,EAAY;AACxB,cAAIiB,aAAa,GAAG;AAAA;AAAA,0BAAI,yBAAJ,EAA+Bf,MAA/B,CAAsCF,IAAtC,CAApB;AACAG,UAAAA,OAAO,CAACC,GAAR,CAAYa,aAAZ;;AACA,cAAIA,aAAa,CAACC,MAAd,IAAwBD,aAAa,CAACC,MAA1C,EAAkD;AAC9C;AAAA;AAAA,0CAAWC,IAAX,CAAgBF,aAAa,CAACC,MAA9B;AACA;AAAA;AAAA,sCAASF,IAAT;AAAA;AAAA,gDAA6BhB,IAA7B;AACH;AACJ;;AAtCkB,O","sourcesContent":["\r\nimport { CfgMgr, ItemType, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { EventMgr, Evt_Compose, Evt_GetReward, Evt_Item_Change } from \"../../manager/EventMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { RewardTips } from \"../common/RewardTips\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { Ret, Route } from \"../../net/Protocol\";\r\n\r\n\r\n\r\nexport class BagModule {\r\n    constructor() {\r\n        Session.on(Route.PlayerItemsChangedPush, this.onItemsChange, this);\r\n        Session.on(Route[\"player.protocol.openbox\"], this.getOpenBoxReward, this);  \r\n    }\r\n\r\n\r\n    onItemsChange(data: any) {\r\n        let item_data = Ret.PlayerItemsChangedPush.decode(data);\r\n        console.log(\"道具变更后端数据推送\",item_data);\r\n        let changeMap: {[key: number]: number} = {};\r\n        for (const item of item_data.list) {\r\n            if (item.countAfter > 0) {  \r\n                let type = CfgMgr.Getitem(item.itemId).Itemtpye\r\n                if(type == ItemType.money){\r\n                    PlayerData.items[item.itemId] = item.countAfter / 10000;\r\n                }else{\r\n                    PlayerData.items[item.itemId] = item.countAfter;\r\n                }\r\n            } else {\r\n                delete PlayerData.items[item.itemId];\r\n            }\r\n            \r\n            if (!changeMap[item.itemId]) {\r\n                changeMap[item.itemId] = item.count;\r\n            } \r\n        }\r\n        console.log(PlayerData.items)\r\n        EventMgr.emit(Evt_Item_Change, changeMap);\r\n    }\r\n\r\n    getOpenBoxReward(data: any) {\r\n        let open_box_data = Ret[\"player.protocol.openbox\"].decode(data);\r\n        console.log(open_box_data)\r\n        if (open_box_data.things && open_box_data.things) {\r\n            RewardTips.Show(open_box_data.things)\r\n            EventMgr.emit(Evt_GetReward, data);\r\n        }\r\n    }\r\n}"]}