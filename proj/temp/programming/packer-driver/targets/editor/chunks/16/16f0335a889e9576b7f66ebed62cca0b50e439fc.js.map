{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_HandToTerrain.ts"],"names":["Out_HandToTerrain","BattleBaseComp","battleDataMgr","actionEnd","start","data","card","cardLocation","isPlayerA","toTerrainPlayerId","creatRoomData","isReplay","getPlayerAreaEmptyCardLocation","toTerrainInstId","scene","AutoPlayHand","areaIdx","cardIdx","isExit","CloseCard","console","log","SendAdCardToArea","error","exit","onUpdate","dt","reset"],"mappings":";;;6DAOaA,iB;;;;;;;;;;;;;;;;;;;;;;;;;;AANJC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;AAET;AACA;AACA;mCACaF,iB,GAAN,MAAMA,iBAAN;AAAA;AAAA,4CAA6F;AAAA;AAAA;AAAA,eACxFG,SADwF,GACnE,KADmE;AAAA;;AAE3E,cAALC,KAAK,GAAkB;AACnC;AACA,cAAI,KAAKC,IAAL,IAAa,KAAKA,IAAL,CAAUC,IAA3B,EAAiC;AAC7B,gBAAIC,YAAJ;;AACA,gBAAI;AAAA;AAAA,gDAAcC,SAAd,CAAwB,KAAKH,IAAL,CAAUI,iBAAlC,CAAJ,EAA0D;AACtD;AACA,kBAAI;AAAA;AAAA,kDAAcC,aAAd,CAA4BC,QAAhC,EAA0C;AACtCJ,gBAAAA,YAAY,GAAG;AAAA;AAAA,oDAAcK,8BAAd,CAA6C,KAAKP,IAAL,CAAUI,iBAAvD,EAA0E,KAAKJ,IAAL,CAAUQ,eAApF,CAAf;AACA,sBAAM,KAAKC,KAAL,CAAWC,YAAX,CAAwB,KAAKV,IAAL,CAAUC,IAAlC,EAAwCC,YAAY,CAACS,OAArD,EAA8DT,YAAY,CAACU,OAA3E,CAAN;AACA,oBAAI,KAAKC,MAAT,EAAiB;AACjB,sBAAM,KAAKJ,KAAL,CAAWK,SAAX,CAAqB,KAAKd,IAAL,CAAUC,IAA/B,CAAN;AACA,oBAAI,KAAKY,MAAT,EAAiB;AACjBE,gBAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACA,qBAAKlB,SAAL,GAAiB,IAAjB;AACH,eARD,MAQO;AACH,sBAAM,KAAKW,KAAL,CAAWK,SAAX,CAAqB,KAAKd,IAAL,CAAUC,IAA/B,CAAN;AACA,oBAAI,KAAKY,MAAT,EAAiB;AACjBE,gBAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACA,qBAAKlB,SAAL,GAAiB,IAAjB;AACH,eAfqD,CAgBtD;AAEA;;AAEH,aApBD,MAoBO;AACHI,cAAAA,YAAY,GAAG;AAAA;AAAA,kDAAcK,8BAAd,CAA6C,KAAKP,IAAL,CAAUI,iBAAvD,EAA0E,KAAKJ,IAAL,CAAUQ,eAApF,CAAf;;AACA,kBAAIN,YAAJ,EAAkB;AACd;AACpB;AACA;AACoB,sBAAM,KAAKO,KAAL,CAAWQ,gBAAX,CAA4B,KAAKjB,IAAL,CAAUC,IAAtC,EAA4CC,YAAY,CAACS,OAAzD,EAAkET,YAAY,CAACU,OAA/E,CAAN;AACA,oBAAI,KAAKC,MAAT,EAAiB,OALH,CAMd;;AACA,qBAAKf,SAAL,GAAiB,IAAjB;AACH,eARD,MAQO;AACHiB,gBAAAA,OAAO,CAACG,KAAR,CAAc,eAAd;AACA,qBAAKC,IAAL;AACH;AAEJ;AAEJ,WAvCD,MAuCO;AACHJ,YAAAA,OAAO,CAACG,KAAR,CAAc,aAAd;AACA,iBAAKC,IAAL;AACH;AACJ;;AAESC,QAAAA,QAAQ,CAACC,EAAD,EAAmB;AACjC,cAAI,CAAC,KAAKvB,SAAV,EAAqB;AACrB,eAAKqB,IAAL;AACH;;AAESG,QAAAA,KAAK,GAAS;AACpB,eAAKxB,SAAL,GAAiB,KAAjB;AACH;;AAxD+F,O","sourcesContent":["import proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\nimport { CardLocation } from \"../../player/PlayerStruct\";\r\n/**\r\n * 从手牌上场\r\n */\r\nexport class Out_HandToTerrain extends BattleBaseComp<proto.base.IBattleRoomOpOutput_HandToTerrain> {\r\n    private actionEnd: boolean = false;\r\n    protected async start(): Promise<void> {\r\n        // battleDataMgr.getPlayerTerrain(this.data.toTerrainPlayerId)\r\n        if (this.data && this.data.card) {\r\n            let cardLocation: CardLocation;\r\n            if (battleDataMgr.isPlayerA(this.data.toTerrainPlayerId)) {\r\n                //回放模式\r\n                if (battleDataMgr.creatRoomData.isReplay) {\r\n                    cardLocation = battleDataMgr.getPlayerAreaEmptyCardLocation(this.data.toTerrainPlayerId, this.data.toTerrainInstId);\r\n                    await this.scene.AutoPlayHand(this.data.card, cardLocation.areaIdx, cardLocation.cardIdx);\r\n                    if (this.isExit) return;\r\n                    await this.scene.CloseCard(this.data.card);\r\n                    if (this.isExit) return;\r\n                    console.log(\"--------->盖牌完成\");\r\n                    this.actionEnd = true;\r\n                } else {\r\n                    await this.scene.CloseCard(this.data.card);\r\n                    if (this.isExit) return;\r\n                    console.log(\"--------->盖牌完成\");\r\n                    this.actionEnd = true;\r\n                }\r\n                //\r\n                \r\n                // await Second(1);\r\n                \r\n            } else {\r\n                cardLocation = battleDataMgr.getPlayerAreaEmptyCardLocation(this.data.toTerrainPlayerId, this.data.toTerrainInstId);\r\n                if (cardLocation) {\r\n                    /**\r\n                     * TODO 对手卡需要作由 盖着出牌 到区域（卡牌由盖牌到显示要等下个包处理变化）\r\n                     */\r\n                    await this.scene.SendAdCardToArea(this.data.card, cardLocation.areaIdx, cardLocation.cardIdx);\r\n                    if (this.isExit) return;\r\n                    // await Second(1);\r\n                    this.actionEnd = true;\r\n                } else {\r\n                    console.error(\"手牌到地形区域卡牌位置为空\");\r\n                    this.exit();\r\n                }\r\n                \r\n            }\r\n            \r\n        } else {\r\n            console.error(\"手牌到地形区域数据为空\");\r\n            this.exit();\r\n        }\r\n    }\r\n\r\n    protected onUpdate(dt: number): void {\r\n        if (!this.actionEnd) return;\r\n        this.exit();\r\n    }\r\n\r\n    protected reset(): void {\r\n        this.actionEnd = false;\r\n    }\r\n}"]}