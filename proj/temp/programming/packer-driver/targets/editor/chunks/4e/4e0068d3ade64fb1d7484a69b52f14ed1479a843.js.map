{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/display/Effect.ts"],"names":["Effect","SampleEffect","ParticleSystem","director","GameObj","GameSet","$prefab","p","prevState","onLoad","layer","Lay_Scene","getComponent","isPlaying","Play","x","y","z","getScene","addChild","$hasLoad","loadSub","play","setWorldPosition","PlayOnce","loop","PlayLoop","Stop","stop","update","dt","emit","Event_Play_End","parent","removeChild"],"mappings":";;;2HAMaA,M,EAqDAC,Y;;;;;;;;;;;;;;;;;;;;;;AA3DOC,MAAAA,c,OAAAA,c;AAAgBC,MAAAA,Q,OAAAA,Q;;AAC3BC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,O,iBAAAA,O;;;;;;;;;wBAIIL,M,GAAN,MAAMA,MAAN;AAAA;AAAA,8BAA6B;AAAA;AAAA;AAAA,eAGtBM,OAHsB,GAGJ,wBAHI;AAAA,eAKtBC,CALsB;AAAA,eAMtBC,SANsB;AAAA;;AAOtBC,QAAAA,MAAM,GAAS;AACrB,eAAKC,KAAL,GAAa;AAAA;AAAA,kCAAQC,SAArB;AACA,eAAKJ,CAAL,GAAS,KAAKK,YAAL,CAAkBV,cAAlB,CAAT;AACA,eAAKM,SAAL,GAAiB,KAAKD,CAAL,CAAOM,SAAxB;AACH;;AAES,cAAJC,IAAI,CAACC,CAAD,EAAYC,CAAZ,EAAuBC,CAAvB,EAAkC;AACxCd,UAAAA,QAAQ,CAACe,QAAT,GAAoBC,QAApB,CAA6B,IAA7B;AACA,cAAI,CAAC,KAAKC,QAAV,EAAoB,MAAM,KAAKC,OAAX;AACpB,eAAKd,CAAL,CAAOe,IAAP;AACA,eAAKd,SAAL,GAAiB,IAAjB;AACA,eAAKe,gBAAL,CAAsBR,CAAtB,EAAyBC,CAAzB,EAA4BC,CAA5B;AACH;;AAEa,cAARO,QAAQ,CAACT,CAAD,EAAYC,CAAZ,EAAuBC,CAAvB,EAAkC;AAC5Cd,UAAAA,QAAQ,CAACe,QAAT,GAAoBC,QAApB,CAA6B,IAA7B;AACA,cAAI,CAAC,KAAKC,QAAV,EAAoB,MAAM,KAAKC,OAAX;AACpB,eAAKd,CAAL,CAAOkB,IAAP,GAAc,KAAd;AACA,eAAKlB,CAAL,CAAOe,IAAP;AACA,eAAKd,SAAL,GAAiB,IAAjB;AACA,eAAKe,gBAAL,CAAsBR,CAAtB,EAAyBC,CAAzB,EAA4BC,CAA5B;AACH;;AAEa,cAARS,QAAQ,CAACX,CAAD,EAAYC,CAAZ,EAAuBC,CAAvB,EAAkC;AAC5Cd,UAAAA,QAAQ,CAACe,QAAT,GAAoBC,QAApB,CAA6B,IAA7B;AACA,cAAI,CAAC,KAAKC,QAAV,EAAoB,MAAM,KAAKC,OAAX;AACpB,eAAKd,CAAL,CAAOkB,IAAP,GAAc,IAAd;AACA,eAAKlB,CAAL,CAAOe,IAAP;AACA,eAAKd,SAAL,GAAiB,IAAjB;AACA,eAAKe,gBAAL,CAAsBR,CAAtB,EAAyBC,CAAzB,EAA4BC,CAA5B;AACH;;AAES,cAAJU,IAAI,GAAG;AACT,cAAI,CAAC,KAAKP,QAAV,EAAoB,MAAM,KAAKC,OAAX;AACpB,eAAKd,CAAL,CAAOqB,IAAP;AACH;;AAESC,QAAAA,MAAM,CAACC,EAAD,EAAmB;AAC/B,cAAI,KAAKtB,SAAL,IAAkB,CAAC,KAAKD,CAAL,CAAOM,SAA9B,EAAyC;AACrC,iBAAKL,SAAL,GAAiB,KAAjB;AACA,iBAAKuB,IAAL,CAAU/B,MAAM,CAACgC,cAAjB;AACH;AACJ;;AAjD+B,O;;AAAvBhC,MAAAA,M,CACOgC,c,GAAyB,gB;;8BAoDhC/B,Y,GAAN,MAAMA,YAAN,SAA2BD,MAA3B,CAAkC;AAC3B6B,QAAAA,MAAM,CAACC,EAAD,EAAmB;AAC/B,cAAI,KAAKtB,SAAL,IAAkB,CAAC,KAAKD,CAAL,CAAOM,SAA9B,EAAyC;AACrC,iBAAKL,SAAL,GAAiB,KAAjB;AACA,iBAAKuB,IAAL,CAAU/B,MAAM,CAACgC,cAAjB;AACA,gBAAI,KAAKC,MAAT,EAAiB,KAAKA,MAAL,CAAYC,WAAZ,CAAwB,IAAxB;AACpB;AACJ;;AAPoC,O","sourcesContent":["import { IVec3Like, ParticleSystem, director } from \"cc\";\r\nimport { GameObj } from \"../../../manager/GameRoot\";\r\nimport { GameSet } from \"../../../manager/GameSet\";\r\nimport { EffectSet } from \"./EffectSet\";\r\nimport { DEBUG, DEV, EDITOR, PREVIEW, TEST } from \"cc/env\";\r\n\r\nexport class Effect extends GameObj {\r\n    static readonly Event_Play_End: string = \"Event_Play_End\";\r\n\r\n    protected $prefab: string = \"prefabs/fight/ShowArea\";\r\n\r\n    protected p: ParticleSystem;\r\n    protected prevState: boolean;\r\n    protected onLoad(): void {\r\n        this.layer = GameSet.Lay_Scene;\r\n        this.p = this.getComponent(ParticleSystem);\r\n        this.prevState = this.p.isPlaying;\r\n    }\r\n\r\n    async Play(x: number, y: number, z: number) {\r\n        director.getScene().addChild(this);\r\n        if (!this.$hasLoad) await this.loadSub;\r\n        this.p.play();\r\n        this.prevState = true;\r\n        this.setWorldPosition(x, y, z);\r\n    }\r\n\r\n    async PlayOnce(x: number, y: number, z: number) {\r\n        director.getScene().addChild(this);\r\n        if (!this.$hasLoad) await this.loadSub;\r\n        this.p.loop = false;\r\n        this.p.play();\r\n        this.prevState = true;\r\n        this.setWorldPosition(x, y, z);\r\n    }\r\n\r\n    async PlayLoop(x: number, y: number, z: number) {\r\n        director.getScene().addChild(this);\r\n        if (!this.$hasLoad) await this.loadSub;\r\n        this.p.loop = true;\r\n        this.p.play();\r\n        this.prevState = true;\r\n        this.setWorldPosition(x, y, z);\r\n    }\r\n\r\n    async Stop() {\r\n        if (!this.$hasLoad) await this.loadSub;\r\n        this.p.stop();\r\n    }\r\n\r\n    protected update(dt: number): void {\r\n        if (this.prevState && !this.p.isPlaying) {\r\n            this.prevState = false;\r\n            this.emit(Effect.Event_Play_End);\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport class SampleEffect extends Effect {\r\n    protected update(dt: number): void {\r\n        if (this.prevState && !this.p.isPlaying) {\r\n            this.prevState = false;\r\n            this.emit(Effect.Event_Play_End);\r\n            if (this.parent) this.parent.removeChild(this);\r\n        }\r\n    }\r\n}"]}