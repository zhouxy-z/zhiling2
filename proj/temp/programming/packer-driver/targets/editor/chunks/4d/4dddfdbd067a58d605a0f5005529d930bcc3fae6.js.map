{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/userInfo/UserEditInfoPanel.ts"],"names":["UserEditInfoPanel","Button","EditBox","Label","LocalStorage","MsgPanel","Panel","PlayerData","EditType","prefab","titleLab","editBox","btn","btnLab","curType","onLoad","find","CloseBy","node","on","EventType","CLICK","onBtnClick","flush","type","updateView","onShow","onHide","args","inputStr","string","Edit_Name","length","Show","Edit_WeChat","reg","RegExp","test","Edit_QQ","qqReg","user","info","nickName","placeholder","myWeChat","GetPlayerData","player","playerId","toString","myQQ"],"mappings":"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","sourcesContent":["import { Button, EditBox, Label } from \"cc\";\r\nimport LocalStorage from \"../../utils/LocalStorage\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\n\r\nenum EditType {\r\n    Edit_Name = 1,//编辑名字\r\n    Edit_WeChat,//编辑微信\r\n    Edit_QQ,//编辑QQ\r\n};\r\nexport class UserEditInfoPanel extends Panel {\r\n    protected prefab: string = \"prefabs/userInfo/UserEditInfoPanel\";\r\n    private titleLab:Label;\r\n    private editBox: EditBox;\r\n    private btn:Button;\r\n    private btnLab:Label;\r\n    // private consumeItem:ConsumeItem;\r\n    private curType:EditType;\r\n    // private stdPlayerChangeName:StdPlayerChangeName;\r\n    protected onLoad(): void {\r\n        this.titleLab = this.find(\"titleLab\", Label);\r\n        this.editBox = this.find(\"editBox\", EditBox);\r\n        this.btn = this.find(\"btn\", Button);\r\n        this.btnLab = this.find(\"btn/cont/btnLab\", Label);\r\n        // this.consumeItem = this.find(\"btn/cont/consumeItem\").addComponent(ConsumeItem);\r\n        this.CloseBy(\"mask\");\r\n        this.CloseBy(\"closeBtn\");\r\n        this.btn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        \r\n    }\r\n    public flush(type:number): void {\r\n        this.curType = type;\r\n        this.updateView();\r\n    }\r\n    \r\n    protected onShow(): void {\r\n        \r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n\r\n    }\r\n    private onBtnClick(btn:Button):void{\r\n        let inputStr:string = this.editBox.string;\r\n        if(this.curType == EditType.Edit_Name){\r\n            if(inputStr.length > 7 || inputStr.length< 2){\r\n                MsgPanel.Show(\"请输入2-7字符的名字\");\r\n                return;\r\n            }\r\n            // if (!ItemUtil.CheckThingConsumes(this.stdPlayerChangeName.CostType, this.stdPlayerChangeName.CostID, this.stdPlayerChangeName.CostCount, true)) {\r\n            //     return;\r\n            // }\r\n            // Session.Send({type: MsgTypeSend.ChangeName, data: {name:inputStr}});\r\n        }else if(this.curType == EditType.Edit_WeChat){\r\n            let reg = new RegExp(\"[\\\\u4E00-\\\\u9FFF]+\",\"g\");\r\n            if(reg.test(inputStr)){     \r\n                MsgPanel.Show(\"微信号输入有误\");\r\n                return;        \r\n            }\r\n            // Session.Send({type: MsgTypeSend.ChangeContactWechat, data: {contact_wechat:inputStr}});\r\n        }else if(this.curType == EditType.Edit_QQ){\r\n            let qqReg = new RegExp(/^[1-9]\\d{4,9}$/);\r\n            if(!qqReg.test(inputStr)){\r\n                MsgPanel.Show(\"QQ号输入有误\");\r\n                return;\r\n            }\r\n            // Session.Send({type: MsgTypeSend.ChangeContactQQ, data: {contact_qq:inputStr}});\r\n        }\r\n        \r\n    }\r\n    \r\n    private updateView():void{\r\n        // this.consumeItem.node.active = false;\r\n        if(this.curType == EditType.Edit_Name){\r\n            // let num:number = (PlayerData.roleInfo.name_changed_times || 0) + 1;\r\n            // this.stdPlayerChangeName = CfgMgr.GetPlayerChangeName(num);\r\n            // let consumeList:SThing[] = ItemUtil.GetSThingList(this.stdPlayerChangeName.CostType, this.stdPlayerChangeName.CostID, this.stdPlayerChangeName.CostCount);\r\n            // if(consumeList && consumeList.length > 0){\r\n            //     this.consumeItem.node.active = true;\r\n            //     this.consumeItem.SetData(consumeList[0]);\r\n            // }\r\n            this.titleLab.string = \"改名\";\r\n            this.editBox.string = PlayerData.user.info.nickName;\r\n        }else if(this.curType == EditType.Edit_WeChat){\r\n            this.titleLab.string = \"编辑微信号\";\r\n            this.editBox.placeholder = \"请输入微信号\";\r\n            let myWeChat:number = LocalStorage.GetPlayerData(`Player_${PlayerData.player.playerId}`, \"UserWeChat\");\r\n            if(myWeChat){\r\n                this.editBox.string = myWeChat.toString();\r\n            }else{\r\n                this.editBox.string = \"\";\r\n            }\r\n        }else if(this.curType == EditType.Edit_QQ){\r\n            this.titleLab.string = \"编辑QQ号\";\r\n            this.editBox.placeholder = \"请输入QQ号\";\r\n            let myQQ:string = LocalStorage.GetPlayerData(`Player_${PlayerData.player.playerId}`, \"UserQQ\");\r\n            if(myQQ){\r\n                this.editBox.string = myQQ;\r\n            }else{\r\n                this.editBox.string = \"\";\r\n            }\r\n        }\r\n    }\r\n    \r\n}"]}