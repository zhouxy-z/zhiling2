{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/login/PlayerData.ts"],"names":["PlayerData","js","CfgMgr","items","player","itemCounts","Setplayer","battleCards","benefitCard","itemProductions","tasks","GetItem","id","key","Object","hasOwnProperty","call","toString","GetItemCount","GetitemBySubType","subType","element","_id","parseInt","std","Getitem","SubType","item","type","Items","count","push","resetMail","mails","mailmap","getMailReward","data","datas","index","length","resource","SetShopData","shopMap","createMap","shopData","shop_index_id","GetShopData","shopId","GetCommShopData","shop","GetShopLuckyData","lucky","user","server","mails_log"],"mappings":"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","sourcesContent":["import { js } from 'cc';\r\nimport { CfgMgr, ThingType } from '../../manager/CfgMgr';\r\nimport proto from '../../net/proto/proto';\r\nimport { BeforeGameUtils } from '../../utils/BeforeGameUtils';\r\nimport { SLuckyContent, SMailPlayerData, SPlayerData, SPlayerMailData, SShopContent, SShopIndexContent, SThing } from '../player/PlayerStruct';\r\nexport class PlayerData {\r\n    static user: proto.pb.IGetUserInfoRes;\r\n    static server:proto.pb.IServer;\r\n    static player: SPlayerData;\r\n    // 道具列表\r\n    public static get items() { return this.player.itemCounts;}\r\n\r\n    /**\r\n     * 初始玩家数据\r\n     * @param player \r\n     */\r\n    public static Setplayer(player: SPlayerData) {\r\n        player.battleCards = player.battleCards || [];\r\n        player.benefitCard = player.benefitCard || {};\r\n        player.itemProductions = player.itemProductions || [];\r\n        player.tasks = player.tasks || {};\r\n        player.itemCounts = player.itemCounts || {};\r\n        this.player = player;\r\n    }\r\n\r\n    /**\r\n     * 获取道具id\r\n     * @param id \r\n     * @returns \r\n     */\r\n    static GetItem(id: number) {\r\n        let items = this.items;\r\n        for (const key in items) {\r\n            if (Object.hasOwnProperty.call(items, key)) {\r\n                if(key == id.toString()){\r\n                    return items\r\n                }       \r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * 获取道具数量\r\n     * @param id \r\n     * @returns \r\n     */\r\n    static GetItemCount(id: number) {\r\n        let items = this.items;\r\n        for (const key in items) {\r\n            if (Object.hasOwnProperty.call(items, key)) {\r\n                if(key == id.toString()){\r\n                    return items[key]\r\n                }       \r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n     /**\r\n     * 根据页签获取道具列表\r\n     * @param subType \r\n     * @returns \r\n     */\r\n     static GetitemBySubType(subType: number) {\r\n        let items: SThing[] = [];\r\n        for (const key in this.items) {\r\n            const element = this.items[key];\r\n            const _id:number = parseInt(key)\r\n            if (element > 0) {\r\n                let std = CfgMgr.Getitem(_id);\r\n                if (std && std.SubType == subType) {\r\n                    let item = {type:\"item\", item:{id:std.Items,count:element}}\r\n                    items.push(item);\r\n                }\r\n            }\r\n        }\r\n        return items;\r\n    }\r\n\r\n\r\n\r\n    /**当前页邮件列表 */\r\n    static mails: SPlayerMailData[] = [];\r\n    static mailmap: { [id: string]: SPlayerMailData } = {};\r\n    static mails_log: SPlayerMailData[] = [];\r\n\r\n    static resetMail() {\r\n        this.mails = []\r\n        this.mailmap = {}\r\n    }\r\n\r\n    static getMailReward(data: SThing[]): SThing[] {\r\n        let datas: SThing[] = []\r\n        for (let index = 0; index < data.length; index++) {\r\n            const element = data[index];\r\n            if (!element.resource) {\r\n                datas.push(element);\r\n            }\r\n        }\r\n        return datas;\r\n    }\r\n\r\n    private static shopMap: { [key: string]: SShopIndexContent };\r\n    /**\r\n     * 设置商店数据\r\n     * @param datas \r\n     */\r\n    static SetShopData(datas: SShopIndexContent[]): void {\r\n        if (!this.shopMap) this.shopMap = js.createMap();\r\n        for (const shopData of datas) {\r\n            this.shopMap[shopData.shop_index_id] = shopData;\r\n        }\r\n\r\n    }\r\n    /**\r\n     * 获取商店数据\r\n     * @param shopId 商店id\r\n     * @returns \r\n     */\r\n    static GetShopData(shopId: number): SShopIndexContent {\r\n        return this.shopMap ? this.shopMap[shopId] : null;\r\n    }\r\n    /**\r\n     * 获取通用商品数据\r\n     * @param shopId \r\n     * @param shopItemId \r\n     * @returns \r\n     */\r\n    static GetCommShopData(shopId: number): SShopContent {\r\n        let shopData = this.GetShopData(shopId);\r\n        return shopData ? shopData.shop : null;\r\n    }\r\n    /**\r\n     * 获取抽奖商店数据\r\n     * @param shopId 商店id\r\n     * @returns \r\n     */\r\n    static GetShopLuckyData(shopId: number): SLuckyContent {\r\n        let shopData = this.GetShopData(shopId);\r\n        return shopData?.lucky;\r\n    }\r\n\r\n}"]}