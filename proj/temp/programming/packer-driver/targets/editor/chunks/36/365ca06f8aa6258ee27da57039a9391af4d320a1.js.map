{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/task/TaskActiveBoxItem.ts"],"names":["TaskActiveBoxItem","Button","Color","Component","Label","Sprite","SpriteFrame","UIOpacity","Vec3","CfgMgr","Session","EventMgr","Evt_TaskShowBoxTips","Req","Route","ResMgr","PlayerData","activeNumLab","btn","geted","box","isInit","data","std","index","onLoad","node","getComponent","getChildByName","on","EventType","CLICK","onBtnClick","updateShow","SetData","value","CompletionNum","end","start","send_task","taskId","TaskId","server","Send","tipsW","itemPos","worldPosition","clone","showPos","offset","x","y","emit","GetTaskByData","string","toString","LoadResAbSub","res","spriteFrame","active","opacity","enableOutline","color","fromHEX","outlineColor"],"mappings":"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","sourcesContent":["import { Button, Color, Component, instantiate, Label, Node, ProgressBar, sp, Sprite, SpriteFrame, UIOpacity, Vec3 } from \"cc\";\r\nimport { CfgMgr, StdTask } from \"../../manager/CfgMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { EventMgr, Evt_TaskShowBoxTips } from \"../../manager/EventMgr\";\r\nimport { SPlayerDataTask, STaskState } from \"../player/PlayerStruct\";\r\nimport { Req, Route } from \"../../net/Protocol\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\n\r\nexport class TaskActiveBoxItem extends Component {\r\n    private activeNumLab: Label;\r\n    private btn: Button;\r\n    private geted:Node;\r\n    private box:Sprite;\r\n    private isInit: boolean;\r\n    private data: SPlayerDataTask;\r\n    private std: StdTask;\r\n    private index: number;\r\n    protected onLoad(): void {\r\n        this.btn = this.node.getComponent(Button);\r\n        this.geted = this.node.getChildByName(\"geted\");\r\n        this.box = this.node.getChildByName(\"box\").getComponent(Sprite);\r\n        this.activeNumLab = this.node.getChildByName(\"activeNumLab\").getComponent(Label);\r\n        this.btn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.isInit = true;\r\n        this.updateShow();\r\n    }\r\n    SetData(data: SPlayerDataTask, index) {\r\n        this.data = data;\r\n        this.index = index;\r\n        this.updateShow();\r\n    }\r\n    private onBtnClick(): void {\r\n        if (!this.data || !this.std) return;\r\n        if (this.data.value >= this.std.CompletionNum && (!this.data.end || this.data.start != this.data.end)) {\r\n            let send_task = new Req[\"player.protocol.completetask\"]();\r\n            send_task.taskId = this.std.TaskId;\r\n            send_task.server = PlayerData.server;\r\n            Session.Send(Route[\"player.protocol.completetask\"], send_task);\r\n        } else {\r\n            let tipsW: number = 382;\r\n            let itemPos = this.btn.node.worldPosition.clone();\r\n            let showPos: Vec3;\r\n            let offset: number = tipsW / 2 + itemPos.x;\r\n            if (offset > 1450) {\r\n                offset = 1450 - tipsW / 2;\r\n            } else {\r\n                offset = itemPos.x;\r\n            }\r\n            showPos = new Vec3(offset, itemPos.y - 197, 0);\r\n            EventMgr.emit(Evt_TaskShowBoxTips, this.std, showPos, this.btn.node);\r\n        }\r\n\r\n    }\r\n    private updateShow(): void {\r\n        if (!this.isInit || !this.data) return;\r\n        this.std = CfgMgr.GetTaskByData(this.data);\r\n        this.activeNumLab.string = this.std.CompletionNum.toString();\r\n        let index = this.index + 1 > 5 ? 5 : this.index + 1;\r\n        ResMgr.LoadResAbSub(\"sheets/task/box_\" + index + \"/spriteFrame\", SpriteFrame, res=>{\r\n            this.box.spriteFrame = res;\r\n        })\r\n       \r\n        this.geted.active = false;\r\n        if (this.data.value >= this.std.CompletionNum) {\r\n            this.box.node.getComponent(UIOpacity).opacity = 255;\r\n            this.activeNumLab.enableOutline = true;\r\n            this.activeNumLab.color = new Color().fromHEX(\"#55FFF9\");\r\n            this.activeNumLab.outlineColor = new Color().fromHEX(\"#007A8C\");\r\n            if (this.data.start == this.data.end) {\r\n                this.geted.active = true\r\n                ResMgr.LoadResAbSub(\"sheets/task/box_open/spriteFrame\", SpriteFrame, res=>{\r\n                    this.box.spriteFrame = res;\r\n                })\r\n            }\r\n        }else{\r\n            this.box.node.getComponent(UIOpacity).opacity = 180;\r\n            this.activeNumLab.color = new Color().fromHEX(\"#000000\");\r\n            this.activeNumLab.enableOutline = false;\r\n        }\r\n    }\r\n}\r\n"]}