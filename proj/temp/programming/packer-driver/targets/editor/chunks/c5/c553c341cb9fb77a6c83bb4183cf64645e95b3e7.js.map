{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/cards/CardFiltratePanel.ts"],"names":["CardFiltratePanel","Button","Component","EditBox","Input","Label","Toggle","skillType","Second","PlayerData","CardsSortOrFiltrate","Tips2","filtrateNode","searchNode","editBox","completeBtn","cancelBtn","skillEffNode","costNode","diyNode","filtrateClose","help","card_list","callBack1","callBack2","selectSkillType","costType","showType","selectSkillList","costTypeList","showTypeList","searchStrList","search_card_list","$loadSub","complete","hasLoad","onLoad","node","getChildByPath","getComponent","on","EventType","EDITING_DID_ENDED","onEditEnd","TOUCH_END","Show","CLICK","resetSearchState","children","forEach","index","string","skillSearch","costSearch","showSearch","loadSub","thisObj","Promise","resolve","reject","setData","data","list","undefined","isChecked","cards"],"mappings":";;;4LAUaA,iB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAVJC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,O,OAAAA,O;AAASC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,K,OAAAA,K;AAA4CC,MAAAA,M,OAAAA,M;;AACvEC,MAAAA,S,iBAAAA,S;;AAGRC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,mB,iBAAAA,mB;;AACAC,MAAAA,K,iBAAAA,K;;;;;;;;;mCAGIX,iB,GAAN,MAAMA,iBAAN,SAAgCE,SAAhC,CAA0C;AAAA;AAAA;AAAA,eACrCU,YADqC;AAAA,eAErCC,UAFqC;AAAA,eAGrCC,OAHqC;AAAA,eAIrCC,WAJqC;AAAA,eAKrCC,SALqC;AAAA,eAMrCC,YANqC;AAAA,eAOrCC,QAPqC;AAAA,eAQrCC,OARqC;AAAA,eASrCC,aATqC;AAAA,eAUrCC,IAVqC;AAAA,eAYrCC,SAZqC;AAAA,eAarCC,SAbqC;AAAA,eAcrCC,SAdqC;AAAA,eAerCC,eAfqC,GAeR,CAfQ;AAAA,eAgBrCC,QAhBqC,GAgBhB,EAhBgB;AAAA,eAiBrCC,QAjBqC,GAiBjB,KAjBiB;AAAA,eAmBrCC,eAnBqC,GAmBO,EAnBP;AAAA,eAoBrCC,YApBqC,GAoBI,EApBJ;AAAA,eAqBrCC,YArBqC,GAqBI,EArBJ;AAAA,eAsBrCC,aAtBqC,GAsBX,EAtBW;AAAA,eAuBrCC,gBAvBqC,GAuBQ,EAvBR;AAAA,eAyBnCC,QAzBmC;AAAA,eA0BnCC,QA1BmC;AAAA,eA2BnCC,OA3BmC,GA2BzB,KA3ByB;AAAA;;AA8BnCC,QAAAA,MAAM,GAAS;AAAA;;AACrB;AACA,eAAKvB,UAAL,GAAkB,KAAKwB,IAAL,CAAUC,cAAV,CAAyB,eAAzB,CAAlB;AACA,eAAKxB,OAAL,GAAe,KAAKuB,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,YAAvC,CAAoDpC,OAApD,CAAf;AACA,eAAKW,OAAL,CAAauB,IAAb,CAAkBG,EAAlB,CAAqBrC,OAAO,CAACsC,SAAR,CAAkBC,iBAAvC,EAA0D,KAAKC,SAA/D,EAA0E,IAA1E;AACA,eAAK1B,YAAL,GAAoB,KAAKoB,IAAL,CAAUC,cAAV,CAAyB,iBAAzB,CAApB;AACA,eAAKpB,QAAL,GAAgB,KAAKmB,IAAL,CAAUC,cAAV,CAAyB,aAAzB,CAAhB;AACA,eAAKnB,OAAL,GAAe,KAAKkB,IAAL,CAAUC,cAAV,CAAyB,YAAzB,CAAf;AACA,eAAKjB,IAAL,GAAY,KAAKgB,IAAL,CAAUC,cAAV,CAAyB,SAAzB,CAAZ;AACA,eAAKjB,IAAL,CAAUmB,EAAV,CAAapC,KAAK,CAACqC,SAAN,CAAgBG,SAA7B,EAAwC,MAAM;AAAE;AAAA;AAAA,gCAAMC,IAAN,CAAW,CAAX;AAAe,WAA/D,EAAiE,IAAjE;AACA,eAAK7B,SAAL,GAAiB,KAAKqB,IAAL,CAAUC,cAAV,CAAyB,WAAzB,EAAsCC,YAAtC,CAAmDtC,MAAnD,CAAjB;AACA,eAAKe,SAAL,CAAeqB,IAAf,CAAoBG,EAApB,CAAuBvC,MAAM,CAACwC,SAAP,CAAiBK,KAAxC,EAA+C,KAAKC,gBAApD,EAAsE,IAAtE;AACA,eAAKlC,UAAL,CAAgBmC,QAAhB,CAAyBC,OAAzB,CAAiC,CAACZ,IAAD,EAAOa,KAAP,KAAiB;AAC9Cb,YAAAA,IAAI,CAACG,EAAL,CAAQpC,KAAK,CAACqC,SAAN,CAAgBG,SAAxB,EAAmC,MAAM;AACrC,mBAAK9B,OAAL,CAAaqC,MAAb,GAAsBd,IAAI,CAACW,QAAL,CAAc,CAAd,EAAiBT,YAAjB,CAA8BlC,KAA9B,EAAqC8C,MAA3D;AACA,mBAAKR,SAAL;AACH,aAHD,EAGG,IAHH;AAIH,WALD;AAMA,eAAK1B,YAAL,CAAkB+B,QAAlB,CAA2BC,OAA3B,CAAmC,CAACZ,IAAD,EAAOa,KAAP,KAAiB;AAChDb,YAAAA,IAAI,CAACG,EAAL,CAAQpC,KAAK,CAACqC,SAAN,CAAgBG,SAAxB,EAAmC,MAAM;AACrC,mBAAKQ,WAAL;AACH,aAFD,EAEG,IAFH;AAGH,WAJD;AAMA,eAAKlC,QAAL,CAAc8B,QAAd,CAAuBC,OAAvB,CAA+B,CAACZ,IAAD,EAAOa,KAAP,KAAiB;AAC5Cb,YAAAA,IAAI,CAACG,EAAL,CAAQpC,KAAK,CAACqC,SAAN,CAAgBG,SAAxB,EAAmC,MAAM;AACrC,mBAAKS,UAAL;AACH,aAFD,EAEG,IAFH;AAGH,WAJD;AAMA,eAAKlC,OAAL,CAAa6B,QAAb,CAAsBC,OAAtB,CAA8B,CAACZ,IAAD,EAAOa,KAAP,KAAiB;AAC3Cb,YAAAA,IAAI,CAACG,EAAL,CAAQpC,KAAK,CAACqC,SAAN,CAAgBG,SAAxB,EAAmC,MAAM;AACrC,mBAAKU,UAAL;AACH,aAFD,EAEG,IAFH;AAGH,WAJD;AAKA,eAAKnB,OAAL,GAAe,IAAf;AACA,iCAAKD,QAAL;AACH;;AAEoB,YAAPqB,OAAO,GAAG;AACpB,cAAI,KAAKtB,QAAT,EAAmB,OAAO,KAAKA,QAAZ;AACnB,cAAIuB,OAAO,GAAG,IAAd;AACA,eAAKvB,QAAL,GAAgB,IAAIwB,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC7CH,YAAAA,OAAO,CAACtB,QAAR,GAAmBwB,OAAnB;AACH,WAFe,CAAhB;AAGA,iBAAO,KAAKzB,QAAZ;AACH;;AAED2B,QAAAA,OAAO,CAACrC,SAAD,EAAqBC,SAArB,EAAyCqC,IAAzC,EAA+C9B,aAA/C,EAA8DC,gBAA9D,EAAgFP,eAAhF,EAAiGC,QAAjG,EAA2GC,QAA3G,EAAoH;AACvH,eAAKJ,SAAL,GAAiBA,SAAjB;AACA,eAAKC,SAAL,GAAiBA,SAAjB;AACA,eAAKF,SAAL,GAAiBuC,IAAjB;AACA,eAAK9B,aAAL,GAAqBA,aAArB;AACA,eAAKC,gBAAL,GAAwBA,gBAAxB;AACA,eAAKP,eAAL,GAAuBA,eAAvB;AACA,eAAKC,QAAL,GAAgBA,QAAhB;AACA,eAAKC,QAAL,GAAgBA,QAAhB;AACH,SAvF4C,CA2F7C;;;AACQgB,QAAAA,SAAS,GAAG;AAChB,cAAImB,IAAI,GAAG;AAAA;AAAA,0DAAoBnB,SAApB,CAA8B,KAAK7B,OAAnC,EAA4C,KAAKiB,aAAjD,EAAgE,KAAKlB,UAArE,EAAiF,KAAKmB,gBAAtF,EAAwG,KAAKP,eAA7G,EAA8H,KAAKC,QAAnI,EAA6I,KAAKC,QAAlJ,CAAX;AACA,eAAKJ,SAAL,CAAeuC,IAAf;AACA,eAAKxC,SAAL,GAAiBwC,IAAjB;AACH,SAhG4C,CAkG7C;;;AACyB,cAAXV,WAAW,GAAG;AACxB,gBAAM;AAAA;AAAA,gCAAO,CAAP,CAAN;AACA,eAAK3B,eAAL,GAAuB;AAAA;AAAA,sCAAUsC,SAAjC;AACA,cAAIF,IAAI,GAAG;AAAA;AAAA,0DAAoBT,WAApB,CAAgC,KAAKtC,OAArC,EAA8C,KAAKG,YAAnD,EAAiE,KAAKW,eAAtE,EAAuF,KAAKH,eAA5F,EAA6G,KAAKC,QAAlH,EAA4H,KAAKC,QAAjI,CAAX;AACA,eAAKC,eAAL,GAAuBiC,IAAI,CAAC,CAAD,CAA3B;AACA,eAAKpC,eAAL,GAAuBoC,IAAI,CAAC,CAAD,CAA3B;AACA,eAAKtC,SAAL,CAAe,KAAKK,eAApB;AACA,eAAKN,SAAL,GAAiB,KAAKM,eAAtB;AACH,SA3G4C,CA6G7C;;;AACwB,cAAVyB,UAAU,GAAG;AACvB,gBAAM;AAAA;AAAA,gCAAO,CAAP,CAAN;AACA,eAAK3B,QAAL,GAAgB,EAAhB;AACA,cAAImC,IAAI,GAAG;AAAA;AAAA,0DAAoBR,UAApB,CAA+B,KAAKvC,OAApC,EAA6C,KAAKI,QAAlD,EAA4D,KAAKW,YAAjE,EAA+E,KAAKJ,eAApF,EAAqG,KAAKC,QAA1G,EAAoH,KAAKC,QAAzH,CAAX;AACA,eAAKE,YAAL,GAAoBgC,IAAI,CAAC,CAAD,CAAxB;AACA,eAAKnC,QAAL,GAAgBmC,IAAI,CAAC,CAAD,CAApB;AACA,eAAKtC,SAAL,CAAe,KAAKM,YAApB;AACA,eAAKP,SAAL,GAAiB,KAAKO,YAAtB;AACH,SAtH4C,CAwH7C;;;AACwB,cAAVyB,UAAU,GAAG;AACvB,gBAAM;AAAA;AAAA,gCAAO,CAAP,CAAN;AACA,eAAK3B,QAAL,GAAgB,KAAhB;AACA,cAAIkC,IAAI,GAAG;AAAA;AAAA,0DAAoBP,UAApB,CAA+B,KAAKxC,OAApC,EAA6C,KAAKK,OAAlD,EAA2D,KAAKW,YAAhE,EAA8E,KAAKL,eAAnF,EAAoG,KAAKC,QAAzG,EAAmH,KAAKC,QAAxH,CAAX;AACA,eAAKG,YAAL,GAAoB+B,IAAI,CAAC,CAAD,CAAxB;AACA,eAAKlC,QAAL,GAAgBkC,IAAI,CAAC,CAAD,CAApB;AACA,eAAKtC,SAAL,CAAe,KAAKO,YAApB;AACA,eAAKR,SAAL,GAAiB,KAAKQ,YAAtB;AACH;AAGD;;;AACQiB,QAAAA,gBAAgB,GAAG;AACvB,eAAKjC,OAAL,CAAaqC,MAAb,GAAsB,EAAtB;AACA,eAAKjC,QAAL,CAAc8B,QAAd,CAAuBC,OAAvB,CAA+BZ,IAAI,IAAI;AACnCA,YAAAA,IAAI,CAACE,YAAL,CAAkBjC,MAAlB,EAA0B0D,SAA1B,GAAsC,KAAtC;AACH,WAFD;AAIA,eAAK/C,YAAL,CAAkB+B,QAAlB,CAA2BC,OAA3B,CAAmCZ,IAAI,IAAI;AACvCA,YAAAA,IAAI,CAACE,YAAL,CAAkBjC,MAAlB,EAA0B0D,SAA1B,GAAsC,KAAtC;AACH,WAFD;AAIA,eAAK7C,OAAL,CAAa6B,QAAb,CAAsBC,OAAtB,CAA8BZ,IAAI,IAAI;AAClCA,YAAAA,IAAI,CAACE,YAAL,CAAkBjC,MAAlB,EAA0B0D,SAA1B,GAAsC,KAAtC;AACH,WAFD;AAGA,eAAK1C,SAAL,GAAiB;AAAA;AAAA,wCAAW2C,KAA5B;AAEA,eAAKxC,eAAL,GAAuB;AAAA;AAAA,sCAAUsC,SAAjC;AACA,eAAKrC,QAAL,GAAgB,EAAhB;AACA,eAAKC,QAAL,GAAgB,KAAhB;AACA,eAAKH,SAAL;AACH;;AAxJ4C,O","sourcesContent":["import { Button, Component, EditBox, Input, Label, Node, path, sp, Sprite, SpriteFrame, Toggle } from \"cc\";\r\nimport { CfgMgr, skillType } from \"../../manager/CfgMgr\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\nimport { CardsPanel } from \"./CardsPanel\";\r\nimport { Second } from \"../../utils/Utils\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { CardsSortOrFiltrate } from \"./CardsSortOrFiltrate\";\r\nimport { Tips2 } from \"../common/Tips2\";\r\nimport proto from \"../../net/Protocol\";\r\n\r\nexport class CardFiltratePanel extends Component {\r\n    private filtrateNode: Node;\r\n    private searchNode: Node;\r\n    private editBox: EditBox;\r\n    private completeBtn: Button;\r\n    private cancelBtn: Button;\r\n    private skillEffNode: Node;\r\n    private costNode: Node;\r\n    private diyNode: Node;\r\n    private filtrateClose: Node;\r\n    private help: Node;\r\n\r\n    private card_list:any\r\n    private callBack1:Function\r\n    private callBack2:Function\r\n    private selectSkillType: skillType = 0;\r\n    private costType: number[] = [];\r\n    private showType: boolean = false;\r\n\r\n    private selectSkillList: proto.base.IBattleCard[] = [];\r\n    private costTypeList: proto.base.IBattleCard[] = [];\r\n    private showTypeList: proto.base.IBattleCard[] = [];\r\n    private searchStrList: string[] = [];\r\n    private search_card_list: proto.base.IBattleCard[] = [];\r\n\r\n    protected $loadSub: Promise<any>;\r\n    protected complete: Function;\r\n    protected hasLoad = false;\r\n\r\n\r\n    protected onLoad(): void {\r\n        // this.filtrateNode = this.node.getChildByName(\"filtrateNode\");\r\n        this.searchNode = this.node.getChildByPath(\"bg/searchNode\");\r\n        this.editBox = this.node.getChildByPath(\"bg/EditBox\").getComponent(EditBox)\r\n        this.editBox.node.on(EditBox.EventType.EDITING_DID_ENDED, this.onEditEnd, this)\r\n        this.skillEffNode = this.node.getChildByPath(\"bg/skillEffNode\");\r\n        this.costNode = this.node.getChildByPath(\"bg/costNode\");\r\n        this.diyNode = this.node.getChildByPath(\"bg/diyNode\");\r\n        this.help = this.node.getChildByPath(\"bg/help\");\r\n        this.help.on(Input.EventType.TOUCH_END, () => { Tips2.Show(1) }, this)\r\n        this.cancelBtn = this.node.getChildByPath(\"bg/cancel\").getComponent(Button);\r\n        this.cancelBtn.node.on(Button.EventType.CLICK, this.resetSearchState, this)\r\n        this.searchNode.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                this.editBox.string = node.children[0].getComponent(Label).string;\r\n                this.onEditEnd();\r\n            }, this)\r\n        })\r\n        this.skillEffNode.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                this.skillSearch()\r\n            }, this)\r\n        })\r\n\r\n        this.costNode.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                this.costSearch()\r\n            }, this)\r\n        })\r\n\r\n        this.diyNode.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => {\r\n                this.showSearch()\r\n            }, this)\r\n        })\r\n        this.hasLoad = true;\r\n        this.complete?.();\r\n    }\r\n\r\n    protected get loadSub() {\r\n        if (this.$loadSub) return this.$loadSub;\r\n        let thisObj = this;\r\n        this.$loadSub = new Promise((resolve, reject) => {\r\n            thisObj.complete = resolve;\r\n        });\r\n        return this.$loadSub;\r\n    }\r\n\r\n    setData(callBack1:Function, callBack2:Function, data, searchStrList, search_card_list, selectSkillType, costType, showType){\r\n        this.callBack1 = callBack1;\r\n        this.callBack2 = callBack2;\r\n        this.card_list = data;\r\n        this.searchStrList = searchStrList;\r\n        this.search_card_list = search_card_list;\r\n        this.selectSkillType = selectSkillType;\r\n        this.costType = costType;\r\n        this.showType = showType;\r\n    }\r\n\r\n\r\n\r\n    //搜索后的卡牌\r\n    private onEditEnd() {\r\n        let list = CardsSortOrFiltrate.onEditEnd(this.editBox, this.searchStrList, this.searchNode, this.search_card_list, this.selectSkillType, this.costType, this.showType);\r\n        this.callBack1(list);\r\n        this.card_list = list;\r\n    }\r\n\r\n    //筛选特殊技能效果的卡牌\r\n    private async skillSearch() {\r\n        await Second(0);\r\n        this.selectSkillType = skillType.undefined\r\n        let data = CardsSortOrFiltrate.skillSearch(this.editBox, this.skillEffNode, this.selectSkillList, this.selectSkillType, this.costType, this.showType);\r\n        this.selectSkillList = data[0];\r\n        this.selectSkillType = data[1];\r\n        this.callBack1(this.selectSkillList)\r\n        this.card_list = this.selectSkillList;\r\n    }\r\n\r\n    //筛选能量消耗的卡牌\r\n    private async costSearch() {\r\n        await Second(0);\r\n        this.costType = [];\r\n        let data = CardsSortOrFiltrate.costSearch(this.editBox, this.costNode, this.costTypeList, this.selectSkillType, this.costType, this.showType);\r\n        this.costTypeList = data[0];\r\n        this.costType = data[1];\r\n        this.callBack1(this.costTypeList)\r\n        this.card_list = this.costTypeList;\r\n    }\r\n\r\n    //筛选自定义展示的卡牌\r\n    private async showSearch() {\r\n        await Second(0);\r\n        this.showType = false;\r\n        let data = CardsSortOrFiltrate.showSearch(this.editBox, this.diyNode, this.showTypeList, this.selectSkillType, this.costType, this.showType);\r\n        this.showTypeList = data[0]\r\n        this.showType = data[1]\r\n        this.callBack1(this.showTypeList)\r\n        this.card_list = this.showTypeList;\r\n    }\r\n\r\n\r\n    /**重置筛选状态 */\r\n    private resetSearchState() {\r\n        this.editBox.string = \"\";\r\n        this.costNode.children.forEach(node => {\r\n            node.getComponent(Toggle).isChecked = false;\r\n        })\r\n\r\n        this.skillEffNode.children.forEach(node => {\r\n            node.getComponent(Toggle).isChecked = false;\r\n        })\r\n\r\n        this.diyNode.children.forEach(node => {\r\n            node.getComponent(Toggle).isChecked = false;\r\n        })\r\n        this.card_list = PlayerData.cards;\r\n\r\n        this.selectSkillType = skillType.undefined;\r\n        this.costType = [];\r\n        this.showType = false;\r\n        this.callBack2();\r\n    }\r\n\r\n\r\n  \r\n}"]}