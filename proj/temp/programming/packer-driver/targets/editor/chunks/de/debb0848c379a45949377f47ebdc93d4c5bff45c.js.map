{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/mail/MailPanel.ts"],"names":["MailPanel","Button","Color","EditBox","Input","Label","ScrollView","Sprite","SpriteFrame","Toggle","instantiate","js","path","AutoScroller","ResMgr","folder_mail","EventMgr","Evt_DelMail","Evt_Get_Mail_Log_Updata","Evt_Hide_Scene","Evt_Mail_Add","Evt_Mail_Update","Evt_PlayerDataInfo_Update","Evt_ReadMail","Evt_Show_Scene","Session","DateUtils","Panel","PlayerData","Tips","MailSendContent","MailContent","Req","Route","BagItem","CfgMgr","ItemType","ThingTypeName","ItemUtil","prefab","nav","layout","leftNode","leftContentNode","scroller","deletBtn","getAwardBtn","leftEmpty","sendMail","send","editBox","playerNode","icon","playerName","playerGuide","lv","uid","giftBtn","clone_item","serchBtn","playerInfo","pageSize","seleteIndex","systemList","playerList","logNode","logScroller","mailLogDatas","sortType","onLoad","CloseBy","find","addComponent","SetHandle","updateMailLogItem","bind","onBntEvent","children","forEach","node","index","on","EventType","TOUCH_END","onTouchNav","CLICK","onSendGift","onSerch","onDeleteAll","onClaimAll","updatePlayerData","flush","updateMailLogList","onShow","content","removeAllChildren","onRefershItem","updateLeftMailsList","updateMailContent","emit","getClassName","args","datas","mails_log","data","senderPlayerId","length","push","sort","a","b","time","UpdateDatas","mail_start_id","getComponent","isChecked","active","mails","mailmap","getmails","readFlag","start","limit","containsMode","Send","getitem","fromId","itemId","server","sources","a_reward","attachments","b_reward","a_read","isRead","b_read","a_num","isAttachmentClaimed","b_num","a_sort","b_sort","iterator","item","updateMailItem","addChild","title","slice","getChildByName","string","timeElapsedSince","str","days","hours","minutes","seconds","id","mailIcon","state","mask","url","join","color","fromHEX","spriteFrame","LoadResAbSub","off","onSelect","checkPage","info","mailId","mail_content","delet_data","mailIds","get_mail","list","is_last","console","log","nickName","playerId","res","mail_send_panel","close_back","player","Show","bag_item","is_get","source","incom","datetime","TimestampToDate","m","parseInt","d","h","min","s","cfg_item","Getitem","rate","Itemtpye","money","is_Add","count","icon_name","itemData","CreateThing","Item","Items","bagItem","setThing","onHide","getClassByName"],"mappings":"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","sourcesContent":["import { Button, Color, Component, EditBox, EventTouch, Input, Label, Node, ScrollView, Sprite, SpriteFrame, Toggle, find, instantiate, js, path, sp, tween } from \"cc\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { ResMgr, folder_mail } from \"../../manager/ResMgr\";\r\nimport { EventMgr, Evt_DelMail, Evt_Get_Mail_Log_Updata, Evt_Get_Mail_Reward_Updata, Evt_Hide_Scene, Evt_Mail_Add, Evt_Mail_Update, Evt_PlayerDataInfo_Update, Evt_ReadMail, Evt_Show_Scene } from \"../../manager/EventMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { DateUtils } from \"../../utils/DateUtils\";\r\nimport LocalStorage from \"../../utils/LocalStorage\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { SPlayerMailData } from \"../player/PlayerStruct\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { Tips } from \"../common/Tips\";\r\nimport { MailSendContent } from \"./MailSendContent\";\r\nimport { MailContent } from \"./MailContent\";\r\nimport proto, { Req, Route } from \"../../net/Protocol\";\r\nimport { BagItem } from \"../bag/BagItem\";\r\nimport { CfgMgr, ItemType, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { ItemUtil } from \"../../utils/ItemUtils\";\r\nexport class MailPanel extends Panel {\r\n    protected prefab: string = \"prefabs/mail/MailPanel\";\r\n\r\n    private nav: Node;\r\n    private layout: Node;\r\n    private leftNode: Node;\r\n    private MailContent: Node;\r\n    private leftContentNode: Node;\r\n    protected scroller: ScrollView;\r\n    private deletBtn: Node;\r\n    private getAwardBtn: Node;\r\n    private leftEmpty: Node;\r\n\r\n    private sendMail: Node;\r\n    private send: Node;\r\n    private editBox: EditBox;\r\n    private playerNode: Node;\r\n    private icon: Sprite;\r\n    private playerName: Label;\r\n    private playerGuide: Label\r\n    private lv: Label;\r\n    private uid: Label;\r\n    private giftBtn: Button;\r\n    private clone_item: Node\r\n    private serchBtn: Node;\r\n    \r\n    private MailSendContent: MailSendContent;\r\n    private playerInfo: proto.base.IPlayerShowInfo;\r\n    protected pageSize = 100;\r\n    private seleteIndex: number = 0;\r\n    private systemList: SPlayerMailData[] = []\r\n    private playerList: SPlayerMailData[] = []\r\n    private logNode: Node;\r\n    private logScroller: AutoScroller;\r\n    private mailLogDatas: SPlayerMailData[] = [];\r\n    private sortType: number;\r\n\r\n    protected onLoad() {\r\n        this.CloseBy(\"closeBtn\");\r\n        this.nav = this.find(`nav`);\r\n        this.leftNode = this.find(\"layout/leftNode\");\r\n        this.MailContent = this.find(\"layout/MailContent\");\r\n        this.leftContentNode = this.find(\"layout/leftNode/leftContentNode\");\r\n        this.scroller = this.find(\"layout/leftNode/leftContentNode/ScrollView\", ScrollView);\r\n        this.clone_item = this.find(\"layout/leftNode/leftContentNode/ScrollView/view/content/item\");\r\n        this.deletBtn = this.find(\"layout/leftNode/leftContentNode/deletBtn\");\r\n        this.getAwardBtn = this.find(\"layout/leftNode/leftContentNode/getAwardBtn\");\r\n        this.leftEmpty = this.find(\"layout/leftNode/leftEmpty\");\r\n        this.sendMail = this.find(\"layout/sendMail\");\r\n        this.send = this.find(\"layout/sendMail/send\");\r\n        this.editBox = this.find(\"layout/sendMail/send/editboxBg/EditBox\", EditBox);\r\n        // this.editBox.node.on(EditBox.EventType.EDITING_DID_ENDED, this.onSerch, this)\r\n        this.playerNode = this.find(\"layout/sendMail/send/playerNode\");\r\n        this.icon = this.find(\"layout/sendMail/send/icon\", Sprite);\r\n        this.playerName = this.find(\"layout/sendMail/send/playerNode/infoUp/playerName\", Label);\r\n        this.playerGuide = this.find(\"layout/sendMail/send/playerNode/infoUp/playerGuide\", Label);\r\n        this.lv = this.find(\"layout/sendMail/send/playerNode/infoDown/lv\", Label);\r\n        this.uid = this.find(\"layout/sendMail/send/playerNode/infoDown/uid\", Label);\r\n        this.giftBtn = this.find(`layout/sendMail/send/playerNode/infoDown/giftBtn`, Button);\r\n\r\n        this.MailSendContent = this.find(\"layout/sendMail/MailSendContent\").addComponent(MailSendContent);\r\n        this.serchBtn = this.find(\"layout/sendMail/send/serchBtn\");\r\n\r\n\r\n        this.logNode = this.find(\"logNode\");\r\n        this.layout = this.find(\"layout\");\r\n        this.logScroller = this.find(\"logNode/logScrollView\", AutoScroller);\r\n        this.logScroller.SetHandle(this.updateMailLogItem.bind(this));\r\n        this.onBntEvent()\r\n    }\r\n\r\n    private onBntEvent() {\r\n        this.nav.children.forEach((node, index) => {\r\n            node.on(Input.EventType.TOUCH_END, () => { this.onTouchNav(index) }, this);\r\n        })\r\n        this.giftBtn.node.on(Button.EventType.CLICK, this.onSendGift, this);\r\n        this.serchBtn.on(Input.EventType.TOUCH_END, this.onSerch, this);\r\n        this.deletBtn.on(Input.EventType.TOUCH_END, this.onDeleteAll, this);\r\n        this.getAwardBtn.on(Input.EventType.TOUCH_END, this.onClaimAll, this);\r\n\r\n        EventMgr.on(Evt_PlayerDataInfo_Update, this.updatePlayerData, this)\r\n        EventMgr.on(Evt_DelMail, this.flush, this)\r\n        EventMgr.on(Evt_Get_Mail_Log_Updata, this.updateMailLogList, this);\r\n    }\r\n\r\n\r\n    protected onShow(): void {\r\n        this.scroller.content.removeAllChildren();\r\n        this.sortType = 2;\r\n        this.onTouchNav(0);\r\n        EventMgr.on(Evt_Mail_Add, this.onRefershItem, this);\r\n        EventMgr.on(Evt_Mail_Update, this.updateLeftMailsList, this);\r\n        EventMgr.on(Evt_ReadMail, this.updateMailContent, this)\r\n        EventMgr.emit(Evt_Hide_Scene, js.getClassName(this));\r\n    }\r\n\r\n    public flush(...args: any[]): void {\r\n        this.mailLogDatas = [];\r\n        let datas = [];\r\n        if (this.seleteIndex != 3) {\r\n            this.updateLeftMailsList();\r\n            this.updateMailContent(null);\r\n        } else {\r\n            PlayerData.mails_log.forEach((data) => {\r\n                if (data.senderPlayerId && data.senderPlayerId.length >= 1) {\r\n                    datas.push(data)\r\n                    this.mailLogDatas.push(data);\r\n                }\r\n            })\r\n            datas.sort((a: SPlayerMailData, b: SPlayerMailData) => {\r\n                return b.time - a.time;\r\n            })\r\n            this.logScroller.UpdateDatas(datas);\r\n        }\r\n\r\n    }\r\n\r\n    private onTouchNav(index) {\r\n        PlayerData.mail_start_id = [\"\"]\r\n        this.seleteIndex = index;\r\n        this.nav.children[index].getComponent(Toggle).isChecked = true;\r\n        this.logNode.active = false;\r\n        this.layout.active = true;\r\n        if (index == 3) {//转赠记录\r\n            this.logNode.active = true;\r\n            this.layout.active = false;\r\n            this.onRefershItem();\r\n        } else if (index == 2) {//发件\r\n            this.leftNode.active = false\r\n            this.MailContent.active = false;\r\n            this.scroller.node.active = false;\r\n            this.sendMail.active = true;\r\n            this.send.active = true;\r\n            this.playerNode.active = false;\r\n            this.MailSendContent.node.active = false;\r\n        } else {//个人和系统邮件\r\n            this.leftNode.active = true\r\n            this.MailContent.active = true;\r\n            this.updateMailContent(null);\r\n            this.scroller.node.active = true;\r\n            this.scroller.content.children.forEach((node) => {\r\n                node.getComponent(Toggle).isChecked = false;\r\n            })\r\n            this.sendMail.active = false;\r\n            PlayerData.mails = [];\r\n            PlayerData.mailmap = {};\r\n            this.onRefershItem();\r\n        }\r\n    }\r\n\r\n\r\n    private onRefershItem() {\r\n        if (this.seleteIndex != 3) {\r\n            let getmails = new Req[\"mail.protocol.getmails\"]();\r\n            getmails.readFlag = 0;\r\n            getmails.start = PlayerData.mail_start_id[PlayerData.mail_start_id.length - 1];\r\n            getmails.limit = this.pageSize;\r\n            getmails.containsMode = 0\r\n            Session.Send(Route[\"mail.protocol.getmails\"], getmails);\r\n        } else {\r\n            let getitem = new Req[\"player.protocol.getitemrecords\"]();\r\n            getitem.fromId = \"\";\r\n            getitem.itemId = \"\";\r\n            getitem.limit = 100;\r\n            getitem.server = PlayerData.server;\r\n            getitem.start = \"\";\r\n            getitem.sources = []\r\n            Session.Send(Route[\"player.protocol.getitemrecords\"], getitem);\r\n        }\r\n    }\r\n\r\n    //-----------------------------系统和个人邮件相关---------------------------------------\r\n    private updateLeftMailsList() {\r\n        this.scroller.content.removeAllChildren();\r\n        let datas = [];\r\n        this.systemList = []\r\n        this.playerList = []\r\n        PlayerData.mails.forEach((data) => {\r\n            if (this.seleteIndex == 0) {\r\n                if (!data.senderPlayerId || data.senderPlayerId.length < 1) {\r\n                    datas.push(data)\r\n                    this.systemList.push(data);\r\n                }\r\n            } else {\r\n                if (data.senderPlayerId && data.senderPlayerId.length >= 1) {\r\n                    datas.push(data)\r\n                    this.playerList.push(data);\r\n                }\r\n            }\r\n        })\r\n        datas.sort((a: SPlayerMailData, b: SPlayerMailData) => {\r\n            let a_reward = a.attachments.length > 0 ? 1 : 0\r\n            let b_reward = b.attachments.length > 0 ? 1 : 0\r\n\r\n            let a_read = a.isRead ? 0 : 1;\r\n            let b_read = b.isRead ? 0 : 1;\r\n\r\n            let a_num = a.isAttachmentClaimed ? 0 : 1;\r\n            let b_num = b.isAttachmentClaimed ? 0 : 1;\r\n\r\n            let a_sort = a_reward + a_num\r\n            let b_sort = b_reward + b_num\r\n            if (a_sort == b_sort) {\r\n                if (a_read == b_read) {\r\n                    return b.time - a.time;\r\n                }\r\n                return b_read - a_read\r\n            }\r\n            return b_sort - a_sort;\r\n\r\n        })\r\n        this.leftEmpty.active = datas.length <= 0;\r\n        this.leftContentNode.active = datas.length > 0;\r\n        for (const iterator of datas) {\r\n            let item = instantiate(this.clone_item)\r\n            this.updateMailItem(item, iterator);\r\n            this.scroller.content.addChild(item)\r\n        }\r\n\r\n    }\r\n\r\n    private async updateMailItem(item: Node, data: SPlayerMailData) {\r\n        let title = data.title.length > 10 ? data.title.slice(0, 10) + \"...\" : data.title\r\n        item.getChildByName(`title`).getComponent(Label).string = title;\r\n        let time = DateUtils.timeElapsedSince(data.time * 1000);\r\n        let str = \"\";\r\n        if (time.days > 0) {\r\n            str = `${time.days}天前`\r\n        } else if (time.hours > 0) {\r\n            str = `${time.hours}小时前`\r\n        } else if (time.minutes > 0) {\r\n            str = `${time.minutes}分前`\r\n        } else if (time.seconds > 0) {\r\n            str = `${time.seconds}秒前`\r\n        }\r\n        item[\"mail_id\"] = data.id;\r\n        item.getChildByName(\"time\").getComponent(Label).string = `${str}`;\r\n        let mailIcon = item.getChildByName(`mailIcon`).getComponent(Sprite);\r\n        let state = item.getChildByName(`state`).getComponent(Label);\r\n        state.string = \"\";\r\n        let mask = item.getChildByName(\"mask\");\r\n        mask.active = false;\r\n        let url = path.join(folder_mail, `redIcon`, \"spriteFrame\");\r\n        if (data.isAttachmentClaimed) {\r\n            state.string = `已领取`;\r\n            mask.active = true;\r\n        } else {\r\n            if (data.attachments && data.attachments.length > 0) {\r\n                state.string = `未领取`;\r\n                state.color = new Color().fromHEX(\"#27633C\")\r\n                if (data.isRead) {\r\n                    url = path.join(folder_mail, `redIcon`, \"spriteFrame\")\r\n                } else {\r\n                    url = path.join(folder_mail, `unRedIcon`, \"spriteFrame\")\r\n                }\r\n            } else {\r\n                if (data.isRead) {\r\n                    url = path.join(folder_mail, `redIcon`, \"spriteFrame\")\r\n                    mask.active = true;\r\n                } else {\r\n                    url = path.join(folder_mail, `unRedIcon`, \"spriteFrame\")\r\n                }\r\n            }\r\n        }\r\n        mailIcon.spriteFrame = await ResMgr.LoadResAbSub(url, SpriteFrame);\r\n\r\n        item.off(Input.EventType.TOUCH_END)\r\n        item.on(Input.EventType.TOUCH_END, () => {\r\n            this.onSelect(data.id);\r\n            this.scroller.content.children.forEach((node) => {\r\n                node.getComponent(Toggle).isChecked = false;\r\n            })\r\n            item.getComponent(Toggle).isChecked = true;\r\n        }, this);\r\n        this.checkPage(data);\r\n    }\r\n\r\n    protected onSelect(id: string) {\r\n        let info = new Req[\"mail.protocol.readmail\"]();\r\n        info.mailId = id;           // 邮件读取状态筛选条件: 0-所有邮件, 1-已读邮件, 2-未读邮件\r\n        Session.Send(Route[\"mail.protocol.readmail\"], info)\r\n    }\r\n\r\n    /**刷新邮件内容 */\r\n    private updateMailContent(data: SPlayerMailData) {\r\n        if (data) {\r\n            this.scroller.content.children.forEach((node) => {\r\n                if (node[\"mail_id\"] == data.id) {\r\n                    this.updateMailItem(node, data)\r\n                }\r\n            })\r\n        }\r\n        let mail_content = this.MailContent.getComponent(MailContent);\r\n        if (!mail_content) mail_content = this.MailContent.addComponent(MailContent);\r\n        mail_content.flush(data)\r\n    }\r\n\r\n    private onDeleteAll() {\r\n        let delet_data = new Req[\"mail.protocol.deletemails\"]();\r\n        delet_data.mailIds = [];\r\n        Session.Send(Route[\"mail.protocol.deletemails\"], delet_data);\r\n    }\r\n\r\n    private onClaimAll() {\r\n        let get_mail = new Req[\"mail.protocol.claimmailsattachment\"]();\r\n        get_mail.mailIds = [];\r\n        Session.Send(Route[\"mail.protocol.claimmailsattachment\"], get_mail)\r\n    }\r\n\r\n    private checkPage(data: SPlayerMailData) {\r\n        let list = []\r\n        if (this.seleteIndex == 3) {\r\n            list = this.mailLogDatas;\r\n        } else if (this.seleteIndex == 0) {\r\n            list = this.systemList;\r\n        } else {\r\n            list = this.playerList;\r\n        }\r\n        if (!data.is_last && list[list.length - 1] == data) {\r\n            data.is_last = true;\r\n            this.onRefershItem()\r\n        }\r\n    }\r\n\r\n    //------------------------------发送邮件相关------------------------\r\n    private updatePlayerData(info: proto.base.IPlayerShowInfo) {\r\n        console.log(info)\r\n        this.playerInfo = info;\r\n        this.playerNode.active = true;\r\n        this.playerName.string = info.nickName;\r\n        this.playerGuide.string = \"公会：无\";\r\n        this.lv.string = info.playerId;\r\n        this.uid.string = info.playerId;\r\n        ResMgr.LoadResAbSub(path.join(\"sheets/default/icon1\", \"spriteFrame\"), SpriteFrame, res => {\r\n            this.icon.spriteFrame = res;\r\n        })\r\n    }\r\n\r\n    /**赠送物品 */\r\n    private onSendGift() {\r\n        this.MailSendContent.node.active = true;\r\n        let mail_send_panel = this.MailSendContent.getComponent(MailSendContent);\r\n        if (!mail_send_panel) mail_send_panel = this.MailSendContent.addComponent(MailSendContent)\r\n        let close_back = () => {\r\n            this.MailSendContent.node.active = false;\r\n            this.send.active = true;\r\n        }\r\n        mail_send_panel.onShow(this.playerInfo, close_back.bind(this))\r\n        this.send.active = false;\r\n\r\n    }\r\n\r\n    private onSerch() {\r\n        if (this.editBox.string) {\r\n            if (this.editBox.string == PlayerData.player.playerId) return Tips.Show(`无法搜索自己的ID`);\r\n            let data = new Req[\"user.protocol.searchuser\"]();\r\n            data.uid = this.editBox.string;\r\n            // this.editBox.string = ``;\r\n            Session.Send(Route[\"user.protocol.searchuser\"], data);\r\n        } else {\r\n            Tips.Show(`请输入玩家ID！`);\r\n        }\r\n    }\r\n\r\n    //----------------------------------------转增记录相关--------------------\r\n\r\n    private updateMailLogList(data: proto.base.IPlayerItemRecord[]) {\r\n        this.logScroller.UpdateDatas(data)\r\n    }\r\n\r\n    private async updateMailLogItem(item: Node, data: proto.base.IPlayerItemRecord) {\r\n        let bag_item = item.getChildByName(\"item\")\r\n        let is_get = item.getChildByName(\"is_get\").getComponent(Sprite);\r\n        let source = item.getChildByName(\"source\").getComponent(Label);\r\n        let time = item.getChildByName(\"time\").getComponent(Label);\r\n        let incom = item.getChildByName(\"incom\").getComponent(Label);\r\n        let datetime = DateUtils.TimestampToDate(data.time * 1000)\r\n        let m = parseInt(datetime[1]) < 10 ? `0${datetime[1]}` : `${datetime[1]}`;\r\n        let d = parseInt(datetime[2]) < 10 ? `0${datetime[2]}` : `${datetime[2]}`;\r\n        let h = parseInt(datetime[3]) < 10 ? `0${datetime[3]}` : `${datetime[3]}`;\r\n        let min = parseInt(datetime[4]) < 10 ? `0${datetime[4]}` : `${datetime[4]}`;\r\n        let s = parseInt(datetime[5]) < 10 ? `0${datetime[5]}` : `${datetime[5]}`;\r\n        time.string = datetime[0] + \"-\" + m + \"-\" + d + \"  \" + h + \":\" + min + \":\" + s;\r\n        let cfg_item = CfgMgr.Getitem(data.itemId);\r\n        let rate = cfg_item.Itemtpye == ItemType.money ? 10000 : 1;\r\n        let is_Add = data.source == \"GiveRecv\"\r\n        source.string = data.playerId;\r\n        incom.string = is_Add ? \"+\" + data.count / rate : \"\" + data.count / rate;\r\n        incom.color = is_Add ? new Color().fromHEX(\"#498127\") : new Color().fromHEX(\"#AD5858\")\r\n        let icon_name = is_Add ? \"get\" : \"send\"\r\n        is_get.spriteFrame = await ResMgr.LoadResAbSub(path.join(\"sheets/mails\", icon_name, \"spriteFrame\"), SpriteFrame);\r\n        let itemData = ItemUtil.CreateThing(ThingTypeName.Item, cfg_item.Items, 0)\r\n        let bagItem = bag_item.getComponent(BagItem);\r\n        if (!bagItem) bagItem = bag_item.addComponent(BagItem)\r\n        bagItem.setThing(itemData)\r\n\r\n        // this.checkPage(data);\r\n    }\r\n\r\n\r\n    protected onHide(...args: any[]): void {\r\n        EventMgr.off(Evt_Mail_Add, this.onRefershItem, this);\r\n        EventMgr.emit(Evt_Show_Scene, js.getClassByName(this));\r\n        this.scroller.content.children.forEach((node) => {\r\n            node.getComponent(Toggle).isChecked = false;\r\n        })\r\n    }\r\n}\r\n\r\n"]}