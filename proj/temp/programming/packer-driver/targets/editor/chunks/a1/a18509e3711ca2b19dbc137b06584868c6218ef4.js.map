{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/friend/FriendModule.ts"],"names":["FrienModule","EventMgr","Evt_GetDownLineInfo","Ret","Route","Session","Tips","constructor","on","GetDownlines","BindUpline","GetIncomesReq","GetAgentInfoReq","data","console","log","friend_data","decode","emit","friends","bind_data","res","code","Show","UnbindUpline"],"mappings":";;;wFAMaA,W;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAJJC,MAAAA,Q,iBAAAA,Q;AAAgEC,MAAAA,mB,iBAAAA,mB;;AAChEC,MAAAA,G,iBAAAA,G;AAAKC,MAAAA,K,iBAAAA,K;;AACLC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,I,iBAAAA,I;;;;;;;6BACIN,W,GAAN,MAAMA,WAAN,CAAkB;AACrBO,QAAAA,WAAW,GAAG;AACV;AACA;AACA;AACA;AAAA;AAAA,kCAAQC,EAAR,CAAW;AAAA;AAAA,8BAAM,0BAAN,CAAX,EAA8C,KAAKC,YAAnD,EAAiE,IAAjE,EAJU,CAKV;;AACA;AAAA;AAAA,kCAAQD,EAAR,CAAW;AAAA;AAAA,8BAAM,0BAAN,CAAX,EAA8C,KAAKE,UAAnD,EAA+D,IAA/D,EANU,CAOV;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAKH;AAED;;;AAEQC,QAAAA,aAAa,GAAE,CACnB;AACA;AACA;AACA;AACA;AAGH;;AAEOC,QAAAA,eAAe,GAAE,CACrB;AACA;AACA;AACA;AACA;AACH,SAzCoB,CA4CrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AACQH,QAAAA,YAAY,CAACI,IAAD,EAAY;AAC5BC,UAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;AACA,cAAIG,WAAW,GAAG;AAAA;AAAA,0BAAI,0BAAJ,EAAgCC,MAAhC,CAAuCJ,IAAvC,CAAlB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYC,WAAZ;AACA;AAAA;AAAA,oCAASE,IAAT;AAAA;AAAA,0DAAmCF,WAAW,CAACG,OAA/C,EAJ4B,CAK5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SAtGoB,CAwGrB;AACA;AACA;AACA;;AAEA;;;AACQT,QAAAA,UAAU,CAACG,IAAD,EAAO;AACrBC,UAAAA,OAAO,CAACC,GAAR,CAAYF,IAAZ;AACA,cAAIO,SAAS,GAAG;AAAA;AAAA,0BAAI,0BAAJ,EAAgCH,MAAhC,CAAuCJ,IAAvC,CAAhB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYK,SAAZ;;AACA,cAAIA,SAAS,CAACC,GAAV,CAAcC,IAAd,IAAsB,GAA1B,EAA+B;AAC3B;AAAA;AAAA,8BAAKC,IAAL,CAAU,MAAV,EAD2B,CAE3B;AACA;AACA;AACA;AACA;AACA;AACH,WARD,MAQO;AACH;AAAA;AAAA,8BAAKA,IAAL,CAAU,MAAV;AACH;AACJ;AAED;;;AACQC,QAAAA,YAAY,CAACX,IAAD,EAAO,CACvB;AACA;AACA;AACA;AACA;AACA;AACH,SAvIoB,CAyIrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AA9MqB,O","sourcesContent":["\r\nimport { CfgMgr, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { EventMgr, Evt_CloseFriendBindOrUnbindPanel, Evt_GetContactInfo, Evt_GetDownLineInfo, Evt_GetIncomeRecords, Evt_GetIncommons, Evt_GetRandomDownline, Evt_GetUPLineInfo, Evt_SetAssistRole, Evt_UpdateFriendAssistRole } from \"../../manager/EventMgr\";\r\nimport { Ret, Route } from \"../../net/Protocol\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { Tips } from \"../common/Tips\";\r\nexport class FrienModule {\r\n    constructor() {\r\n        // Session.on(MsgTypeRet.GetAgentInfoRet, this.GetAgentInfo, this);\r\n        // Session.on(MsgTypeRet.GetIncomesRet, this.GetIncomes, this);\r\n        // Session.on(MsgTypeRet.IncomeRet, this.IncomeResponse, this);\r\n        Session.on(Route[\"user.protocol.getfriends\"], this.GetDownlines, this);\r\n        // Session.on(MsgTypeRet.GetUplineInfoRet, this.GetUplineInfo, this);\r\n        Session.on(Route[\"user.protocol.bindfriend\"], this.BindUpline, this);\r\n        // Session.on(MsgTypeRet.UnbindUplineRet, this.UnbindUpline, this);\r\n        // Session.on(MsgTypeRet.GetContactInfoRet, this.GetContactInfo, this);\r\n        // Session.on(MsgTypeRet.GetIncomeRecordsRet, this.GetIncomeRecords, this);\r\n\r\n        // Session.on(MsgTypeRet.SetAssistRoleRet, this.SetAssistRole, this);\r\n        // Session.on(MsgTypeRet.GetAssistRolesRet, this.GetAssistRole, this);\r\n        // Session.on(MsgTypeRet.UnlockAssistRoleSlotRet, this.UnlockAssistRoleSlot, this);\r\n        // Session.on(MsgTypeRet.CollectAssistIncomeRet, this.CollectAssistIncome, this);\r\n        // Session.on(MsgTypeRet.SetAssistRoleUsageFeeRet, this.SetAssistRoleUsageFee, this);\r\n        \r\n\r\n        \r\n\r\n    }\r\n\r\n    /**请求数据 */\r\n\r\n    private GetIncomesReq(){\r\n        // let incomeData = {\r\n        //     type: MsgTypeSend.GetIncomesRequest,\r\n        //     data: {},\r\n        // }\r\n        // Session.Send(incomeData);\r\n\r\n       \r\n    }\r\n\r\n    private GetAgentInfoReq(){\r\n        // let friendData = {\r\n        //     type: MsgTypeSend.GetAgentInfoRequest,\r\n        //     data: {},\r\n        // }\r\n        // Session.Send(friendData);\r\n    }\r\n\r\n\r\n    // /**玩家上线好友以收益信息 */\r\n    // private GetAgentInfo(data: SGetAgentInfo) {\r\n    //     let role_data = PlayerData.GetRoles()\r\n    //     if(data.assist_roles && data.assist_roles.length > 0){\r\n    //         for (let index = 0; index < role_data.length; index++) {\r\n    //             let is_has = false\r\n    //             const element  = role_data[index];\r\n    //             for (let index = 0; index < data.assist_roles.length; index++) {\r\n    //                 const assist_roles_element = data.assist_roles[index];\r\n    //                 if(assist_roles_element.role_id == element.id){\r\n    //                     element.is_assisting = true;\r\n    //                     is_has = true;\r\n    //                     break;\r\n    //                 }     \r\n    //             }\r\n    //             if(!is_has){\r\n    //                 element.is_assisting = false;\r\n    //             }\r\n    //         }\r\n    //     }else{\r\n    //         for (let index = 0; index < role_data.length; index++) {          \r\n    //             const element  = role_data[index];          \r\n    //             element.is_assisting = false;\r\n    //         }\r\n    //     }\r\n\r\n    //     EventMgr.emit(Evt_GetIncommons, data)\r\n    // }\r\n\r\n    // /**收益列表 */\r\n    // private GetIncomes(data: SGetIncomes) {\r\n    //     EventMgr.emit(Evt_GetIncommons, data)\r\n    // }\r\n\r\n    // /**领取收益 */\r\n    // private IncomeResponse(data) {\r\n    //     if (data.amount) {\r\n    //         this.GetIncomesReq();\r\n    //         this.GetAgentInfoReq();\r\n    //         let reward: SThing[] = [{ type: ThingType.ThingTypeCurrency, currency: {type: 3, value: data.amount} }]\r\n    //         RewardTips.Show(reward)\r\n    //     }\r\n    // }\r\n\r\n    /**获取下线好友 */\r\n    private GetDownlines(data: any) {\r\n        console.log(data);\r\n        let friend_data = Ret[\"user.protocol.getfriends\"].decode(data);\r\n        console.log(friend_data);\r\n        EventMgr.emit(Evt_GetDownLineInfo, friend_data.friends);\r\n        // if(data.include_role){\r\n        //     //好友的助战角色列表\r\n        //     // EventMgr.emit(Evt_UpdateFriendAssistRole, data);\r\n        // }else{\r\n        //     //好友列表\r\n        //     EventMgr.emit(Evt_GetDownLineInfo, data);\r\n        //     // EventMgr.emit(Evt_GetRandomDownline, data);\r\n        // }\r\n    }\r\n\r\n    // /**上线好友信息 */\r\n    // private GetUplineInfo(data) {\r\n    //     EventMgr.emit(Evt_GetUPLineInfo, data)\r\n    // }\r\n\r\n    /**添加上线 */\r\n    private BindUpline(data) {\r\n        console.log(data);\r\n        let bind_data = Ret[\"user.protocol.bindfriend\"].decode(data);\r\n        console.log(bind_data);\r\n        if (bind_data.res.code == 200) {\r\n            Tips.Show(\"添加成功\")\r\n            // let upLineData = {\r\n            //     type: MsgTypeSend.GetUplineInfoRequest,\r\n            //     data: {},\r\n            // }\r\n            // Session.Send(upLineData);\r\n            // EventMgr.emit(Evt_CloseFriendBindOrUnbindPanel)\r\n        } else {\r\n            Tips.Show(\"添加失败\")\r\n        }\r\n    }\r\n\r\n    /**解绑上线 */\r\n    private UnbindUpline(data) {\r\n        // let upLineData = {\r\n        //     type: MsgTypeSend.GetUplineInfoRequest,\r\n        //     data: {},\r\n        // }\r\n        // Session.Send(upLineData);\r\n        // EventMgr.emit(Evt_CloseFriendBindOrUnbindPanel)\r\n    }\r\n\r\n    // /**好友联系方式 */\r\n    // private GetContactInfo(data) {\r\n    //     let datas: SGetContactInfo;\r\n    //     if (data.player_id != \"\") {\r\n    //         datas = data;\r\n    //     } else {\r\n    //         datas = { player_id: \"1211\", name: \"hahah\", wechat_id: \"110\", qq_id: \"120\", };\r\n    //     }\r\n    //     EventMgr.emit(Evt_GetContactInfo, datas);\r\n    // }\r\n\r\n    // /**收益记录 */\r\n    // private GetIncomeRecords(data:SIncomeRecords){\r\n    //     EventMgr.emit(Evt_GetIncomeRecords, data);\r\n    // }\r\n\r\n    // /**设置角色助战 */\r\n    // private SetAssistRole(data:{fee:number, role_id:string, slot:number, canceled_role:string}) {\r\n    //     if(data){\r\n    //         this.updeteInfo();\r\n    //         // if(data.role_id && data.canceled_role == \"\"){\r\n    //         //     let role = PlayerData.GetRoleById(data.role_id)\r\n    //         //     role.is_assisting = true;\r\n    //         // }else{\r\n    //         //     let role = PlayerData.GetRoleById(data.canceled_role)\r\n    //         //     role.is_assisting = false;\r\n    //         // }\r\n    //         EventMgr.emit(Evt_SetAssistRole,data);       \r\n    //     }else{\r\n    //         Tips.Show(\"助战失败\")\r\n    //     }\r\n    // }\r\n\r\n    // /**获取助战角色列表 */\r\n    // private GetAssistRole(data:{assistRoles:SAssistRoleInfo[]}) {\r\n    //     console.log(\"获取助战角色列表\", data)\r\n    //     if(data && data.assistRoles){\r\n    //         EventMgr.emit(Evt_UpdateFriendAssistRole, data);\r\n    //     }\r\n    // }\r\n\r\n    // /**空位解锁 */\r\n    // private UnlockAssistRoleSlot(data){\r\n    //    this.updeteInfo();\r\n    //     console.log(\"空位解锁\", data)\r\n\r\n    // }\r\n\r\n    //  /**领取助战奖励 */\r\n    //  private CollectAssistIncome(data){\r\n    //     // let count = parseInt(formatDecimal(data.amount, 2));\r\n    //     let reward: SThing[] = [{ type: ThingType.ThingTypeCurrency, currency: {type: 0, value: data.collected_amount} }]\r\n    //     RewardTips.Show(reward)\r\n    //     console.log(\"领取助战奖励\", reward)\r\n\r\n    // }\r\n\r\n    // /**设置助战费用 */\r\n    // private SetAssistRoleUsageFee(){\r\n    //     this.updeteInfo();\r\n    // }\r\n\r\n    // /**解锁/助战/取消助战 后刷新数据 */\r\n    // private updeteInfo(){\r\n    //     let friendData = {\r\n    //         type: MsgTypeSend.GetAgentInfoRequest,\r\n    //         data: {},\r\n    //     }\r\n    //     Session.Send(friendData);\r\n    // }\r\n\r\n\r\n}"]}