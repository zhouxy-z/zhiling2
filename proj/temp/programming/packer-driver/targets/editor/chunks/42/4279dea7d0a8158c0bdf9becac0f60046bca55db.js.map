{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/mail/MailSendPanel.ts"],"names":["MailSendPanel","Button","EditBox","Input","Label","RichText","Sprite","SpriteFrame","find","js","path","EventMgr","Evt_SendMail","Session","AutoScroller","ResMgr","folder_item","Panel","CfgMgr","PlayerData","Tips","Req","Route","prefab","head","nameLab","uidLab","homlandLab","giftBtn","data","haveLabel","costLabel","allLabel","surePanel","surePanelLabel","inputPassword","RichText2","name_title","open_btn","ListScrollView","cost_price_label","all_price_label","have_price_icon","cost_price_icon","all_price_icon","navBtns","MailCost","select_id","cfg_item","reg","RegExp","onLoad","CloseBy","SetHandle","updateItem","bind","node","on","onSelectItem","children","concat","EventType","TEXT_CHANGED","onEditBoxChanged","onBntEvent","editBox","str","indexStr","i","string","length","charAt","test","CLICK","onOpen","onShowSurePanel","EDITING_DID_ENDED","onEditEnd","onTextChanged","TOUCH_END","active","onSendGift","is_open","scaleY","setScale","has_count","GetItemCount","min_str","max_str","name","Getitem","Items","ItemName","count","Number","cost_count","Show","GiveLimitMin","GiveLimitMax","nickName","items_list","createMap","id","toString","items","receiverId","playerId","Send","item_count","Math","ceil","keepNumbersAndOneDot","result","replace","firstDotIndex","indexOf","substring","onShow","Hide","cost","flush","initMsg","list_item_data","GetCanSenditem","UpdateDatas","SelectFirst","item","item_data","label","getChildByName","getComponent","index","console","log","updateItemInfo","icon","Icon","LoadResAbSub","join","res","spriteFrame","onHide","args","off"],"mappings":"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","sourcesContent":["import { Button, EditBox, Input, Label, Node, RichText, Sprite, SpriteFrame, Toggle, find, js, path} from \"cc\";\r\nimport { EventMgr, Evt_SendMail } from \"../../manager/EventMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { ResMgr, folder_item } from \"../../manager/ResMgr\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { CfgMgr, ItemGive, StdItem } from \"../../manager/CfgMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { Tips } from \"../common/Tips\";\r\nimport { Req, Route } from \"../../net/Protocol\";\r\nimport  base from \"../../net/proto/BaseUtils\";\r\n\r\n\r\nexport class MailSendPanel extends Panel {\r\n    protected prefab: string = \"prefabs/mail/MailSendPanel\";\r\n\r\n    protected head: Node;\r\n    protected nameLab: Label;\r\n    protected uidLab: Label;\r\n    protected homlandLab: Label;\r\n    protected EditBox: EditBox;\r\n    protected giftBtn: Node;\r\n    private data: base.IPlayerShowInfo = null;\r\n    private haveLabel: Label;\r\n    private costLabel: Label;\r\n    private allLabel: Label;\r\n    private surePanel: Node;\r\n    private surePanelLabel: RichText;\r\n    private inputPassword:EditBox;\r\n    private RichText: RichText;\r\n    private RichText2: RichText;\r\n    private name_title: Label;\r\n    private open_btn: Button;\r\n    private ListScrollView: AutoScroller;\r\n    private cost_price_label: Label;\r\n    private all_price_label: Label;\r\n    private have_price_icon: Sprite;\r\n    private cost_price_icon: Sprite;\r\n    private all_price_icon: Sprite;\r\n    private navBtns: Node[];\r\n\r\n\r\n\r\n    private MailCost = 0;\r\n    private select_id:number;\r\n    private cfg_item: ItemGive;\r\n    private reg: RegExp = new RegExp(/^[0-9]*$/); //判断是否是数字。\r\n    protected onLoad() {\r\n        this.CloseBy(\"mask\");\r\n        this.CloseBy(\"spriteFrame/Close\");\r\n        this.head = this.find(`spriteFrame/headInfo`);\r\n        this.nameLab = this.find(`spriteFrame/msg/role_name`, Label);\r\n        this.uidLab = this.find(`spriteFrame/msg/uid`, Label);\r\n        this.homlandLab = this.find(`spriteFrame/msg/homeLand`, Label);\r\n        this.giftBtn = this.find(`spriteFrame/giftBtn`);\r\n        this.haveLabel = this.find(`spriteFrame/msg/have/PriceLayout/Price`, Label);\r\n        this.have_price_icon = this.find(`spriteFrame/msg/have/PriceLayout/money_icon`, Sprite);\r\n        this.costLabel = this.find(`spriteFrame/msg/cost/PriceLayout/Price`, Label);\r\n        this.cost_price_icon = this.find(`spriteFrame/msg/cost/PriceLayout/money_icon`, Sprite);\r\n        this.cost_price_label = this.find(`spriteFrame/msg/cost/priceLabel`, Label);\r\n        this.allLabel = this.find(`spriteFrame/msg/all/PriceLayout/Price`, Label);\r\n        this.all_price_icon = this.find(`spriteFrame/msg/all/PriceLayout/money_icon`, Sprite);\r\n        this.all_price_label = this.find(`spriteFrame/msg/all/priceLabel`, Label);\r\n        this.EditBox = this.find(`spriteFrame/msg/sendMsg/editboxBg/EditBox`, EditBox);\r\n        this.surePanel = this.find(`surePanel`);\r\n        this.surePanelLabel = this.find(`surePanel/spriteFrame/MidBg/lab`, RichText);\r\n        this.inputPassword = this.find(`surePanel/spriteFrame/inputBg/inputPassword`, EditBox);\r\n        this.RichText = this.find(`spriteFrame/RichText`, RichText);\r\n        this.RichText2 = this.find(`spriteFrame/RichText2`, RichText);\r\n        this.name_title = this.find(`spriteFrame/msg/sendMsg/nameLayout/name`, Label);\r\n        this.open_btn = this.find(`spriteFrame/msg/sendMsg/nameLayout/openBtn`, Button);\r\n        this.ListScrollView = this.find(`spriteFrame/msg/ListScrollView`, AutoScroller);\r\n        this.ListScrollView.SetHandle(this.updateItem.bind(this));\r\n        this.ListScrollView.node.on('select', this.onSelectItem, this)\r\n        this.navBtns = this.find(\"spriteFrame/msg/sendMsg/nav\").children.concat();\r\n        this.inputPassword.node.on(EditBox.EventType.TEXT_CHANGED, this.onEditBoxChanged, this);\r\n        this.onBntEvent()\r\n    }\r\n    private onEditBoxChanged(editBox: EditBox): void {\r\n        let str = \"\";\r\n        let indexStr: string;\r\n        for (let i = 0; i < editBox.string.length; i++) {\r\n            indexStr = editBox.string.charAt(i);\r\n            if (this.reg.test(indexStr)) {\r\n                str += editBox.string.charAt(i);\r\n            }\r\n        }\r\n        editBox.string = str;\r\n    }\r\n    private onBntEvent() {\r\n        this.open_btn.node.on(Button.EventType.CLICK, this.onOpen, this);\r\n        this.giftBtn.on(Button.EventType.CLICK, this.onShowSurePanel, this);\r\n        this.EditBox.node.on(EditBox.EventType.EDITING_DID_ENDED, this.onEditEnd, this);\r\n        this.EditBox.node.on(EditBox.EventType.TEXT_CHANGED, this.onTextChanged, this);\r\n        find(`spriteFrame/Close`, this.surePanel).on(Input.EventType.TOUCH_END, () => { this.surePanel.active = false }, this);\r\n        find(`spriteFrame/closeBtn`, this.surePanel).on(Input.EventType.TOUCH_END, () => { this.surePanel.active = false }, this);\r\n        find(`spriteFrame/sureBtn`, this.surePanel).on(Input.EventType.TOUCH_END, this.onSendGift, this);\r\n    }\r\n\r\n    private onOpen(){\r\n        let is_open = this.ListScrollView.node.active;\r\n        let scaleY = is_open ? -1 : 1;\r\n        this.ListScrollView.node.active = !is_open\r\n        this.open_btn.node.setScale(1, scaleY)\r\n    }\r\n\r\n    private onShowSurePanel() {\r\n        this.inputPassword.string = \"\";\r\n        let has_count =  PlayerData.GetItemCount(1)\r\n        let min_str:string = \"ItemMin\";\r\n        let max_str:string = \"ItemMax\";\r\n        let name = CfgMgr.Getitem(this.cfg_item.Items).ItemName\r\n\r\n        // if(!PlayerData.roleInfo.is_password){\r\n        //     SettingPasswordPanel.Show();\r\n        //     return;\r\n        // }\r\n\r\n        let count = Number(this.EditBox.string);\r\n        let cost_count =  count;\r\n        if (!count || count < 1) {\r\n            return Tips.Show(`请输入要赠送的货币数量！`);\r\n        }\r\n        if (count < this.cfg_item.GiveLimitMin) {\r\n            return Tips.Show(`未达最小起赠值`);\r\n        }\r\n        if (count > this.cfg_item.GiveLimitMax) {\r\n            return Tips.Show(`要赠送的超过上限，最多赠送${ this.cfg_item.GiveLimitMax}，请检查后重试！`);\r\n        }\r\n\r\n        if (cost_count > has_count) {\r\n            return Tips.Show(name +`不足,请检查后重试！`);\r\n        }\r\n        this.surePanel.active = true;\r\n        this.surePanelLabel.string = `将发送<color=#C36316 >${this.EditBox.string}</color>个${name}给玩家<color=#0C8EAA>${this.data.nickName}</color>\\n是否确认赠送？`;\r\n    }\r\n\r\n    private onSendGift() {\r\n        // if(!this.inputPassword.string || this.inputPassword.string.length < 1){\r\n        //     MsgPanel.Show(\"请先输入二级密码\");\r\n        //     return;\r\n        // }\r\n        let items_list: { [key: string]: number } = js.createMap();\r\n        let id = this.cfg_item.Items.toString()\r\n        items_list[id] =  Number(this.EditBox.string);\r\n        let data = new Req[\"logic.protocol.sendgivemail\"]();\r\n        data.items = items_list     \r\n        data.receiverId = this.data.playerId;\r\n        Session.Send(Route[\"logic.protocol.sendgivemail\"],data)\r\n\r\n    }\r\n\r\n    private onEditEnd() {\r\n        let count = Number(this.EditBox.string);\r\n        let item_count = PlayerData.GetItemCount(this.select_id)\r\n        this.costLabel.string = `${Math.ceil(count)}`;\r\n        this.allLabel.string = `${Math.ceil(item_count - count)}`;\r\n        \r\n    }\r\n\r\n    private onTextChanged() {\r\n        let count = Number(this.keepNumbersAndOneDot(this.EditBox.string));\r\n        this.EditBox.string = `${Math.ceil((count) * 100) / 100}`;\r\n    }\r\n\r\n    private keepNumbersAndOneDot(str) {\r\n        // 使用正则表达式来提取所有数字和小数点\r\n        let result = str.replace(/[^0-9.]/g, '');\r\n\r\n        // 找到第一个小数点的位置\r\n        let firstDotIndex = result.indexOf('.');\r\n\r\n        // 如果找到了小数点，移除其后的所有小数点\r\n        if (firstDotIndex !== -1) {\r\n            result = result.substring(0, firstDotIndex + 1) + result.substring(firstDotIndex + 1).replace(/\\./g, '');\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected onShow(): void {\r\n        EventMgr.on(Evt_SendMail, this.Hide, this);\r\n        this.costLabel.string = `${0}`;\r\n        this.allLabel.string = `${0}`;\r\n        this.EditBox.string = ``;\r\n        this.surePanel.active = false;\r\n        // console.log(\"is_has_rights\", is_has_rights);\r\n        let cost = 0\r\n        // if (PlayerData.GetIsActivateRights(StdEquityId.Id_3) || PlayerData.GetIsActivateRights(StdEquityId.Id_4)) {\r\n        //     this.MailCost = CfgMgr.getEquityListById(StdEquityId.Id_3).Value;     \r\n        // } else {\r\n        //     this.MailCost = CfgMgr.GetCommon(StdCommonType.Mail).MailCost;\r\n        // }\r\n        cost = this.MailCost\r\n        // let is_has_guild_rights =  PlayerData.GetMyGuildPrivilegeById(GuildEquityId.GuildEquity_1);\r\n        // console.log(is_has_guild_rights)\r\n        // this.MailCost = is_has_guild_rights ? 0 : this.MailCost;\r\n        // let str = is_has_guild_rights ? \"（<color=#DD6E24>0%</color>公会职位减免）\" : \"\"\r\n        // this.RichText.string = `<color=#DD6E24>${CfgMgr.GetCommon(StdCommonType.Mail).Min}</color><color=#849AA7>起赠，额外消耗赠送数量的</color><color=#DD6E24>${cost * 100}%</color><color=#849AA7>${str}作为损耗</color>`;\r\n        // this.RichText2.string = `</color><color=#849AA7>赠送成功好友需要在</color><color=#DD6E24>个人邮件内</color><color=#849AA7>领取</color>`;\r\n    }\r\n\r\n    public flush(data: base.IPlayerShowInfo): void {\r\n        this.data = data;\r\n        this.initMsg();\r\n        this.EditBox.string = \"\";\r\n        this.cost_price_label.string = \"赠送数量\";\r\n        this.all_price_label.string =  \"剩余数量\"; \r\n        this.open_btn.node.active = true;\r\n        this.ListScrollView.node.active = false;\r\n        this.RichText.node.active = false\r\n        this.RichText2.node.active = true;\r\n        this.onOpen();\r\n        let list_item_data = CfgMgr.GetCanSenditem();\r\n        this.ListScrollView.UpdateDatas(list_item_data)\r\n        this.ListScrollView.SelectFirst();\r\n    }\r\n\r\n    private initMsg() {\r\n        this.nameLab.string = this.data.nickName;\r\n        this.uidLab.string = `UID:${this.data.playerId}`;\r\n        // let homeLandMsg = CfgMgr.GetHomeLandInit(this.data.homeland_id);\r\n        // if (homeLandMsg) {\r\n        //     this.homlandLab.string = homeLandMsg.Desc[0];\r\n        // }\r\n    }\r\n\r\n    private updateItem(item: Node, data: ItemGive) {   \r\n        let item_data = CfgMgr.Getitem(data.Items);\r\n        let label = item.getChildByName(\"label\").getComponent(Label);\r\n        label.string = item_data.ItemName;\r\n        item[\"data\"] = data;\r\n    }\r\n\r\n    private onSelectItem(index: number, item: Node){\r\n        console.log(item[\"data\"]);\r\n        let item_data:ItemGive = item[\"data\"];\r\n        this.select_id = item_data.Items;\r\n        this.cfg_item = item_data;\r\n        this.updateItemInfo();\r\n       \r\n        this.EditBox.string = \"\";\r\n    }\r\n\r\n    private updateItemInfo(){  \r\n        let icon:string = \"\"\r\n        let name:string = \"\"\r\n        let item = CfgMgr.Getitem(this.select_id);\r\n        icon = item.Icon;\r\n        name = item.ItemName;\r\n        let item_count = PlayerData.GetItemCount(this.select_id);\r\n        this.haveLabel.string = item_count + \"\"; \r\n       \r\n        this.name_title.string = \"赠送\" + name;\r\n        this.costLabel.string = 0 + \"\";\r\n        this.allLabel.string = 0 + \"\";\r\n        ResMgr.LoadResAbSub(path.join(folder_item, icon, \"spriteFrame\"),SpriteFrame,res=>{\r\n            this.have_price_icon.spriteFrame = res;\r\n            this.all_price_icon.spriteFrame = res;\r\n            this.cost_price_icon.spriteFrame = res;\r\n        })\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n        EventMgr.off(Evt_SendMail, this.Hide, this);\r\n    }\r\n\r\n}\r\n"]}