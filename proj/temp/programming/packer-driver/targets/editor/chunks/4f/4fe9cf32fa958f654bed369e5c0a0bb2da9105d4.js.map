{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/shop/ShopItem.ts"],"names":["Label","Sprite","SpriteFrame","_decorator","path","AsyncComponent","BagItem","CfgMgr","ResMgr","folder_item","ccclass","property","disallowMultiple","requireComponent","ShopItem","data","limtNumLab","item","disCout","costImg","costLab","overtime","onLoad","node","getChildByPath","getComponent","addComponent","SetData","hasLoad","loadSub","std","GetCommShopItem","id","Discount","parent","active","string","toString","GoodAmount","count","stdcost","url","join","Getitem","CostID","Icon","spriteFrame","LoadResAbSub","CostNumber","setThing","sellThings"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAoBA,MAAAA,K,OAAAA,K;AAAaC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,I,OAAAA,I;;AACzDC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,M,iBAAAA,M;AAAQC,MAAAA,W,iBAAAA,W;;;;;;;;;OAEX;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA,gBAArB;AAAuCC,QAAAA;AAAvC,O,GAA4DV,U;;0BAIrDW,Q,WAFZJ,OAAO,CAAC,UAAD,C,UACPE,gBAAgB,CAAC,IAAD,C,+BADjB,MAEaE,QAFb;AAAA;AAAA,4CAE6C;AAAA;AAAA;AAAA,eAC/BC,IAD+B;AAAA,eAE/BC,UAF+B;AAAA,eAG/BC,IAH+B;AAAA,eAI/BC,OAJ+B;AAAA,eAK/BC,OAL+B;AAAA,eAM/BC,OAN+B;AAAA,eAO/BC,QAP+B;AAAA;;AAQ/BC,QAAAA,MAAM,GAAG;AACf,eAAKN,UAAL,GAAkB,KAAKO,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,YAAvC,CAAoDzB,KAApD,CAAlB;AACA,eAAKiB,IAAL,GAAY,KAAKM,IAAL,CAAUC,cAAV,CAAyB,MAAzB,EAAiCE,YAAjC;AAAA;AAAA,iCAAZ;AACA,eAAKR,OAAL,GAAe,KAAKK,IAAL,CAAUC,cAAV,CAAyB,mBAAzB,EAA8CC,YAA9C,CAA2DzB,KAA3D,CAAf;AACA,eAAKmB,OAAL,GAAe,KAAKI,IAAL,CAAUC,cAAV,CAAyB,qBAAzB,EAAgDC,YAAhD,CAA6DxB,MAA7D,CAAf;AACA,eAAKmB,OAAL,GAAe,KAAKG,IAAL,CAAUC,cAAV,CAAyB,qBAAzB,EAAgDC,YAAhD,CAA6DzB,KAA7D,CAAf;AACA,eAAKqB,QAAL,GAAgB,KAAKE,IAAL,CAAUC,cAAV,CAAyB,UAAzB,CAAhB;AACA,gBAAMF,MAAN;AACH;;AAEY,cAAPK,OAAO,CAACZ,IAAD,EAA6B;AACtC,cAAI,CAACA,IAAL,EAAW;AACX,eAAKA,IAAL,GAAYA,IAAZ;AACA,cAAI,CAAC,KAAKa,OAAV,EAAmB,MAAM,KAAKC,OAAX;AACnB,cAAIC,GAAG,GAAG;AAAA;AAAA,gCAAOC,eAAP,CAAuB,KAAKhB,IAAL,CAAUiB,EAAjC,CAAV;AACA,cAAI,CAACF,GAAL,EAAU,OAL4B,CAMtC;;AACA,cAAIA,GAAG,CAACG,QAAJ,GAAe,CAAnB,EAAsB;AAClB,iBAAKf,OAAL,CAAaK,IAAb,CAAkBW,MAAlB,CAAyBC,MAAzB,GAAkC,IAAlC;AACA,iBAAKjB,OAAL,CAAakB,MAAb,GAAsBN,GAAG,CAACG,QAAJ,CAAaI,QAAb,EAAtB;AACH,WAHD,MAGO;AACH,iBAAKnB,OAAL,CAAaK,IAAb,CAAkBW,MAAlB,CAAyBC,MAAzB,GAAkC,KAAlC;AACH,WAZqC,CAatC;;;AACA,cAAIL,GAAG,CAACQ,UAAJ,GAAiB,CAArB,EAAwB;AACpB,iBAAKjB,QAAL,CAAcc,MAAd,GAAuB,KAAvB;AACA,iBAAKnB,UAAL,CAAgBO,IAAhB,CAAqBY,MAArB,GAA8B,IAA9B;AACA,iBAAKnB,UAAL,CAAgBoB,MAAhB,GAA0B,MAAKrB,IAAI,CAACwB,KAAM,IAAGT,GAAG,CAACQ,UAAW,EAA5D;AACH,WAJD,MAIO;AACH,iBAAKjB,QAAL,CAAcc,MAAd,GAAuB,IAAvB;AACA,iBAAKnB,UAAL,CAAgBO,IAAhB,CAAqBY,MAArB,GAA8B,KAA9B;AACH;;AACD,cAAIK,OAAO,GAAG;AAAA;AAAA,gCAAOT,eAAP,CAAuBhB,IAAI,CAACiB,EAA5B,CAAd;AACA,cAAIS,GAAG,GAAGrC,IAAI,CAACsC,IAAL;AAAA;AAAA,0CAAuB;AAAA;AAAA,gCAAOC,OAAP,CAAeH,OAAO,CAACI,MAAR,CAAe,CAAf,CAAf,EAAkCC,IAAzD,EAA+D,aAA/D,CAAV;AACA,eAAK1B,OAAL,CAAa2B,WAAb,GAA2B,MAAM;AAAA;AAAA,gCAAOC,YAAP,CAAoBN,GAApB,EAAyBvC,WAAzB,CAAjC;AACA,eAAKkB,OAAL,CAAagB,MAAb,GAAsBI,OAAO,CAACQ,UAAR,CAAmB,CAAnB,EAAsBX,QAAtB,EAAtB;AACA,eAAKpB,IAAL,CAAUgC,QAAV,CAAmBlC,IAAI,CAACmC,UAAL,CAAgB,CAAhB,CAAnB;AACH;;AA7CwC,O","sourcesContent":["import { Component, Label, Node, Sprite, SpriteFrame, _decorator, path } from \"cc\";\r\nimport { AsyncComponent } from \"../common/AsyncComponent\";\r\nimport { BagItem } from \"../bag/BagItem\";\r\nimport proto from \"../../net/Protocol\";\r\nimport { CfgMgr } from \"../../manager/CfgMgr\";\r\nimport { ResMgr, folder_item } from \"../../manager/ResMgr\";\r\n\r\nconst { ccclass, property, disallowMultiple, requireComponent } = _decorator;\r\n\r\n@ccclass('ShopItem')\r\n@disallowMultiple(true)\r\nexport class ShopItem extends AsyncComponent {\r\n    protected data: proto.base.IShopItem;\r\n    protected limtNumLab: Label;\r\n    protected item: BagItem;\r\n    protected disCout: Label;\r\n    protected costImg: Sprite;\r\n    protected costLab: Label;\r\n    protected overtime: Node;\r\n    protected onLoad() {\r\n        this.limtNumLab = this.node.getChildByPath(\"limtNumLab\").getComponent(Label);\r\n        this.item = this.node.getChildByPath(\"item\").addComponent(BagItem);\r\n        this.disCout = this.node.getChildByPath(\"disCont/disNumLab\").getComponent(Label);\r\n        this.costImg = this.node.getChildByPath(\"consumeItem/costImg\").getComponent(Sprite);\r\n        this.costLab = this.node.getChildByPath(\"consumeItem/costLab\").getComponent(Label);\r\n        this.overtime = this.node.getChildByPath(\"overtime\");\r\n        super.onLoad();\r\n    }\r\n\r\n    async SetData(data: proto.base.IShopItem) {\r\n        if (!data) return;\r\n        this.data = data;\r\n        if (!this.hasLoad) await this.loadSub;\r\n        let std = CfgMgr.GetCommShopItem(this.data.id);\r\n        if (!std) return;\r\n        // 折扣\r\n        if (std.Discount > 0) {\r\n            this.disCout.node.parent.active = true;\r\n            this.disCout.string = std.Discount.toString();\r\n        } else {\r\n            this.disCout.node.parent.active = false;\r\n        }\r\n        // 剩余数量\r\n        if (std.GoodAmount > 0) {\r\n            this.overtime.active = false;\r\n            this.limtNumLab.node.active = true;\r\n            this.limtNumLab.string = `数量：${data.count}/${std.GoodAmount}`;\r\n        } else {\r\n            this.overtime.active = true;\r\n            this.limtNumLab.node.active = false;\r\n        }\r\n        let stdcost = CfgMgr.GetCommShopItem(data.id);\r\n        let url = path.join(folder_item, CfgMgr.Getitem(stdcost.CostID[0]).Icon, \"spriteFrame\");\r\n        this.costImg.spriteFrame = await ResMgr.LoadResAbSub(url, SpriteFrame);\r\n        this.costLab.string = stdcost.CostNumber[0].toString();\r\n        this.item.setThing(data.sellThings[0]);\r\n    }\r\n}"]}