{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/fight/opOutput/Out_CardTerrainState.ts"],"names":["Out_CardTerrainState","BattleBaseComp","battleDataMgr","BattleRoundOperationState","start","data","card","curRoundRevealPlayerId","scene","FlushRevealPlayer","isPlayerA","FlushRoundBtnStrState","PlaceRound","FlushRound","round","roomData","roundMax","finalValue","ShowCard","isExit","playerId","terrainData","getPlayerTerrainFormIdx","area","addPower","power","cardMul","oldPower","getPlayerTerrainTotalPow","FlushAreaPower","exit","console","error","reset","EndRound"],"mappings":";;;wFAQaA,oB;;;;;;;;;;;;;;;;;;;;;;;;;;AAPJC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,yB,iBAAAA,yB;;;;;;;AAET;AACA;AACA;sCACaH,oB,GAAN,MAAMA,oBAAN;AAAA;AAAA,4CAAmG;AAEjF,cAALI,KAAK,GAAkB;AACnC,cAAI,KAAKC,IAAL,IAAa,KAAKA,IAAL,CAAUC,IAA3B,EAAiC;AAC7B,gBAAI;AAAA;AAAA,gDAAcC,sBAAd,IAAwC,EAA5C,EAAgD;AAC5C,mBAAKC,KAAL,CAAWC,iBAAX,CAA6B;AAAA;AAAA,kDAAcC,SAAd,CAAwB;AAAA;AAAA,kDAAcH,sBAAtC,CAA7B;AACH;;AAED,iBAAKC,KAAL,CAAWG,qBAAX,CAAiC;AAAA;AAAA,wEAA0BC,UAA3D;AACA,iBAAKJ,KAAL,CAAWK,UAAX,CAAsB,KAAKC,KAA3B,EAAkC;AAAA;AAAA,gDAAcC,QAAd,CAAuBC,QAAvB,CAAgCC,UAAlE;AACA,kBAAM,KAAKT,KAAL,CAAWU,QAAX,CAAoB,KAAKb,IAAL,CAAUC,IAA9B,CAAN;AACA,gBAAI,KAAKa,MAAT,EAAiB,OARY,CAS7B;;AACA,gBAAIC,QAAgB,GAAG,KAAKf,IAAL,CAAUC,IAAV,CAAec,QAAtC;AACA,gBAAIC,WAAoD,GAAG;AAAA;AAAA,gDAAcC,uBAAd,CAAsCF,QAAtC,EAAgD,KAAKf,IAAL,CAAUC,IAAV,CAAeiB,IAA/D,CAA3D;AACA,gBAAIC,QAAgB,GAAG,KAAKnB,IAAL,CAAUC,IAAV,CAAemB,KAAf,GAAuB,KAAKpB,IAAL,CAAUC,IAAV,CAAemB,KAAf,CAAqBR,UAArB,GAAkCI,WAAW,CAACK,OAAZ,CAAoBT,UAA7E,GAAyF,CAAhH,CAZ6B,CAYqF;;AAClH,gBAAIU,QAAgB,GAAG;AAAA;AAAA,gDAAcC,wBAAd,CAAuCR,QAAvC,EAAiD,KAAKf,IAAL,CAAUC,IAAV,CAAeiB,IAAhE,CAAvB,CAb6B,CAagE;;AAC7F,iBAAKf,KAAL,CAAWqB,cAAX,CAA0B;AAAA;AAAA,gDAAcnB,SAAd,CAAwBU,QAAxB,CAA1B,EAA6D,KAAKf,IAAL,CAAUC,IAAV,CAAeiB,IAA5E,EAAkFI,QAAQ,GAAGH,QAA7F;AACA,iBAAKM,IAAL;AACH,WAhBD,MAgBO;AACHC,YAAAA,OAAO,CAACC,KAAR,CAAc,gBAAd;AACA,iBAAKF,IAAL;AACH;AACJ;;AAESG,QAAAA,KAAK,GAAS;AACpB;AAAA;AAAA,8CAAc1B,sBAAd,GAAuC,EAAvC;AACA,eAAKC,KAAL,CAAWC,iBAAX,CAA6B,IAA7B;AACA,eAAKD,KAAL,CAAWG,qBAAX,CAAiC;AAAA;AAAA,sEAA0BuB,QAA3D;AACH;;AA7BqG,O","sourcesContent":["import proto from \"../../../net/Protocol\";\r\nimport { BattleBaseComp } from \"../../battle/BattleBaseComp\";\r\nimport { battleDataMgr } from \"../../battle/BattleDataMgr\";\r\nimport { BattleRoundOperationState } from \"../../player/PlayerStruct\";\r\n\r\n/**\r\n * 卡牌在地形上的状态改变（由盖牌到显示）\r\n */\r\nexport class Out_CardTerrainState extends BattleBaseComp<proto.base.IBattleRoomOpOutput_CardTerrainState> {\r\n\r\n    protected async start(): Promise<void> {\r\n        if (this.data && this.data.card) {\r\n            if (battleDataMgr.curRoundRevealPlayerId != \"\") {\r\n                this.scene.FlushRevealPlayer(battleDataMgr.isPlayerA(battleDataMgr.curRoundRevealPlayerId));\r\n            }\r\n\r\n            this.scene.FlushRoundBtnStrState(BattleRoundOperationState.PlaceRound);\r\n            this.scene.FlushRound(this.round, battleDataMgr.roomData.roundMax.finalValue);\r\n            await this.scene.ShowCard(this.data.card);\r\n            if (this.isExit) return;\r\n            // await Second(2)\r\n            let playerId: string = this.data.card.playerId;\r\n            let terrainData: proto.base.IBattleRoomTerrainPlayerData = battleDataMgr.getPlayerTerrainFormIdx(playerId, this.data.card.area);\r\n            let addPower: number = this.data.card.power ? this.data.card.power.finalValue * terrainData.cardMul.finalValue: 0;//增加战力\r\n            let oldPower: number = battleDataMgr.getPlayerTerrainTotalPow(playerId, this.data.card.area);//旧战力\r\n            this.scene.FlushAreaPower(battleDataMgr.isPlayerA(playerId), this.data.card.area, oldPower + addPower);\r\n            this.exit();\r\n        } else {\r\n            console.error(\"卡牌在地形上改变状态数据为空\");\r\n            this.exit();\r\n        }\r\n    }\r\n\r\n    protected reset(): void {\r\n        battleDataMgr.curRoundRevealPlayerId = \"\";\r\n        this.scene.FlushRevealPlayer(null);\r\n        this.scene.FlushRoundBtnStrState(BattleRoundOperationState.EndRound);\r\n    }\r\n}"]}