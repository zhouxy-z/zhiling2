{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/rights/BagItem%20copy.ts"],"names":["Label","Sprite","SpriteFrame","_decorator","path","CfgMgr","ThingType","ThingTypeName","ResMgr","folder_card","folder_item","folder_money","Utils","AsyncComponent","ccclass","property","disallowMultiple","requireComponent","BagItem","bg","icon","label","nameLab","thing","onLoad","hasLoad","node","getChildByPath","getComponent","scale","x","setScale","setThing","data","loadSub","item","stdItem","Getitem","id","spriteFrame","LoadResAbSub","Quality","join","Icon","string","formatNumber","count","ItemName","card","stdCard","GetCard","cardId","quality","CardBody","CardName","setItem","itemType","itemId","url","equipment","playerexp","std","battlecard","deliver","GetBattleCardDeliver","CardID","CardQuality","toString"],"mappings":"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","sourcesContent":["import { Component, Label, Sprite, SpriteFrame, _decorator, path } from \"cc\";\r\nimport { CfgMgr, ItemType, StdItem, ThingType, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { ResMgr, folder_card, folder_item, folder_money } from \"../../manager/ResMgr\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport proto from \"../../net/Protocol\";\r\nimport { AsyncComponent } from \"../common/AsyncComponent\";\r\n\r\nconst { ccclass, property, disallowMultiple, requireComponent } = _decorator;\r\n\r\n@ccclass('BagItem')\r\n@disallowMultiple(true)\r\nexport class BagItem extends AsyncComponent {\r\n    protected bg: Sprite;\r\n    protected icon: Sprite;\r\n    protected label: Label;\r\n    protected nameLab: Label;\r\n\r\n    private thing: proto.base.IThing;\r\n\r\n    protected onLoad(): void {\r\n        this.hasLoad = true;\r\n        this.bg = this.node.getChildByPath(\"bg\").getComponent(Sprite);\r\n        this.icon = this.node.getChildByPath(\"icon\").getComponent(Sprite);\r\n        this.label = this.node.getChildByPath(\"label\").getComponent(Label);\r\n        this.nameLab = this.node.getChildByPath(\"nameLab\").getComponent(Label);\r\n        if (this.icon.node.scale.x == 1) {\r\n            this.icon.node.setScale(0.6, 0.6, 0.6);\r\n        }\r\n        super.onLoad();\r\n    }\r\n\r\n    async setThing(data: proto.base.IThing) {\r\n        if (!this.hasLoad) await this.loadSub;\r\n        this.thing = data;\r\n        if (this.thing.item) {\r\n            let stdItem = CfgMgr.Getitem(this.thing.item.id);\r\n            this.bg.spriteFrame = await ResMgr.LoadResAbSub(\"sheets/bag/Quality\" + stdItem.Quality + \"/spriteFrame\", SpriteFrame);\r\n            this.icon.spriteFrame = await ResMgr.LoadResAbSub(path.join(folder_item, stdItem.Icon, \"spriteFrame\"), SpriteFrame);\r\n            this.label.string = Utils.formatNumber(this.thing.item.count);\r\n            this.nameLab.string = stdItem.ItemName;\r\n        } else if (this.thing.card) {\r\n            let stdCard = CfgMgr.GetCard(this.thing.card.cardId);\r\n            this.bg.spriteFrame = await ResMgr.LoadResAbSub(\"sheets/bag/Quality\" + data.card.quality + \"/spriteFrame\", SpriteFrame);\r\n            this.icon.spriteFrame = await ResMgr.LoadResAbSub(path.join(folder_card, stdCard.CardBody, \"spriteFrame\"), SpriteFrame);\r\n            this.label.string = stdCard.CardName;\r\n            this.nameLab.string = \"\"\r\n        }\r\n    }\r\n\r\n    async setItem(itemType?: number, itemId?: number, count?: number) {\r\n        if (!this.hasLoad) await this.loadSub;\r\n        let url: string;\r\n        if (!itemType) {\r\n            this.bg.spriteFrame = await ResMgr.LoadResAbSub(\"sheets/bag/Quality1/spriteFrame\", SpriteFrame);\r\n            url = path.join(folder_money, \"货币0\" + itemId, \"spriteFrame\");\r\n            this.nameLab.string = \"\";\r\n        } else if (itemType == ThingType.item || itemType == ThingType.equipment || itemType == ThingType.playerexp) {\r\n            let std = CfgMgr.Getitem(itemId);\r\n            this.bg.spriteFrame = await ResMgr.LoadResAbSub(\"sheets/bag/Quality\" + std.Quality + \"/spriteFrame\", SpriteFrame);\r\n            url = path.join(folder_item, std.Icon, \"spriteFrame\");\r\n            this.nameLab.string = std.ItemName;\r\n        } else if (itemType == ThingType.battlecard) {\r\n            let deliver = CfgMgr.GetBattleCardDeliver(itemId);\r\n            let stdCard = CfgMgr.GetCard(deliver.CardID);\r\n            this.bg.spriteFrame = await ResMgr.LoadResAbSub(\"sheets/bag/Quality\" + deliver.CardQuality + \"/spriteFrame\", SpriteFrame);\r\n            this.icon.spriteFrame = await ResMgr.LoadResAbSub(path.join(folder_card, stdCard.CardBody, \"spriteFrame\"), SpriteFrame);\r\n            this.label.string = stdCard.CardName;\r\n            this.nameLab.string = \"\"\r\n        }\r\n        this.icon.spriteFrame = await ResMgr.LoadResAbSub(url, SpriteFrame);\r\n        this.label.string = count.toString();\r\n        ThingTypeName\r\n    }\r\n}"]}