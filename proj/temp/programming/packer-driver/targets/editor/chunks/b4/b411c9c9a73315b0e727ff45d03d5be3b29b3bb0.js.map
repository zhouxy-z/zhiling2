{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/mail/MailSendContent.ts"],"names":["MailSendContent","Button","Component","EditBox","Label","RichText","Sprite","SpriteFrame","js","path","Session","AutoScroller","ResMgr","folder_item","CfgMgr","ItemType","ThingTypeName","PlayerData","Tips","BagItem","ItemUtil","Req","Route","EventMgr","Evt_Item_Change","Utils","MsgPanel","close","head","nameLab","playerGuide","giftBtn","haveLabel","costLabel","allLabel","surePanel","surePanelLabel","inputPassword","tipsLab","item","item_name","open_btn","ListScrollView","cost_price_icon","all_price_icon","sureBtn","closeBtn","data","select_id","cfg_item","reg","RegExp","closeCallBack","itemData","cost_item_cfg","sendCount","MailCost","minCost","rate","item_rate","$loadSub","complete","hasLoad","loadSub","thisObj","Promise","resolve","reject","onLoad","node","getChildByPath","getComponent","getChildByName","SetHandle","updateItem","bind","on","onSelectItem","onBntEvent","EventType","CLICK","onHide","onShowSurePanel","onSendGift","active","EDITING_DID_ENDED","onEditEnd","TEXT_CHANGED","onTextChanged","off","updateItemCount","onShow","close_back","string","nickName","Clean","list_item_data","GetCanSenditem","UpdateDatas","SelectFirst","updateItemInfo","cfg","Getitem","Items","count","GetItemCount","bag_item","addComponent","item_data","CreateThing","Item","setThing","index","FeeItemID","Itemtpye","money","GiveLimitMin","GiveFeeRate","GiveFeeBase","ItemName","item_count","LoadResAbSub","join","Icon","res","spriteFrame","Number","cost","GiveFeeMin","ToFixed","test","Show","cost_item_num","name","GiveLimitMax","has_count","items_list","createMap","id","toString","items","receiverId","playerId","Send","args"],"mappings":"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","sourcesContent":["import { Button, Component, EditBox, Input, Label, Layout, Node, RichText, ScrollView, Sprite, SpriteFrame, Toggle, find, js, path} from \"cc\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { ResMgr, folder_item } from \"../../manager/ResMgr\";\r\nimport { CfgMgr, ItemGive, ItemType, StdItem, ThingName, ThingTypeName } from \"../../manager/CfgMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { Tips } from \"../common/Tips\";\r\nimport { BagItem } from \"../bag/BagItem\";\r\nimport { ItemUtil } from \"../../utils/ItemUtils\";\r\nimport proto, { Req, Route } from \"../../net/Protocol\";\r\nimport { EventMgr, Evt_Item_Change } from \"../../manager/EventMgr\";\r\nimport { Utils } from \"../../utils/Utils\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\n\r\n\r\nexport class MailSendContent extends Component {\r\n\r\n    private close: Button;\r\n    protected head: Node;\r\n    protected nameLab: Label;\r\n    protected playerGuide: Label;\r\n    protected EditBox: EditBox;\r\n    protected giftBtn: Node;\r\n    private haveLabel: Label;\r\n    private costLabel: Label;\r\n    private allLabel: Label;\r\n    private surePanel: Node;\r\n    private surePanelLabel: RichText;\r\n    private inputPassword:EditBox;\r\n    private tipsLab: Label;\r\n    private item:Node;\r\n    private item_name: Label\r\n  \r\n    private open_btn: Button;\r\n    private ListScrollView: AutoScroller;\r\n  \r\n    private cost_price_icon: Sprite;\r\n    private all_price_icon: Sprite;\r\n    private sureBtn: Button;\r\n    private closeBtn: Button;\r\n\r\n    \r\n    private data:proto.base.IPlayerShowInfo\r\n    \r\n    private select_id:number;\r\n    private cfg_item: ItemGive;\r\n    private reg: RegExp = new RegExp(/^[0-9]*$/); //判断是否是数字。\r\n    private closeCallBack:Function;\r\n    \r\n    private itemData: StdItem;\r\n    private cost_item_cfg:StdItem\r\n    \r\n    //发送给后端的数量\r\n    private sendCount = 0;\r\n    //手续费\r\n    private MailCost = 0;\r\n    //最小手续费\r\n    private minCost = 0;\r\n    //货币比率\r\n    private rate = 1;\r\n    //道具比率\r\n    private item_rate = 1;\r\n\r\n    protected $loadSub: Promise<any>;\r\n    protected complete: Function;\r\n    protected hasLoad = false;\r\n\r\n    protected get loadSub() {\r\n        if (this.$loadSub) return this.$loadSub;\r\n        let thisObj = this;\r\n        this.$loadSub = new Promise((resolve, reject) => {\r\n            thisObj.complete = resolve;\r\n        });\r\n        return this.$loadSub;\r\n    }\r\n\r\n    protected onLoad() {\r\n        this.hasLoad = true;\r\n        this.close = this.node.getChildByPath(`titleBg/Close`).getComponent(Button);\r\n        this.head = this.node.getChildByPath(`playerNode/headInfo`);\r\n        this.item = this.node.getChildByName(`item`);\r\n        this.nameLab = this.node.getChildByPath(`playerNode/role_name`).getComponent(Label);\r\n        this.playerGuide = this.node.getChildByPath(`playerNode/playerGuide`).getComponent(Label);\r\n        this.giftBtn = this.node.getChildByName(`giftBtn`);\r\n        this.haveLabel = this.node.getChildByName(`Price`).getComponent(Label);\r\n        this.costLabel = this.node.getChildByPath(`cost/Price`).getComponent(Label);\r\n        this.cost_price_icon = this.node.getChildByPath(`cost/money_icon`).getComponent(Sprite);\r\n        this.item_name = this.node.getChildByName(`item_name`).getComponent(Label);\r\n        this.allLabel = this.node.getChildByPath(`all/Price`).getComponent(Label);\r\n        this.all_price_icon = this.node.getChildByPath(`all/money_icon`).getComponent(Sprite);\r\n        this.EditBox = this.node.getChildByPath(`editboxBg/EditBox`).getComponent(EditBox);   \r\n        this.tipsLab = this.node.getChildByName(`tipsLab`).getComponent(Label);  \r\n        this.ListScrollView = this.node.getChildByPath(`playerNode/Node/ListScrollView`).getComponent(AutoScroller);\r\n        this.ListScrollView.SetHandle(this.updateItem.bind(this));\r\n        this.ListScrollView.node.on('select', this.onSelectItem, this)\r\n\r\n        this.surePanel = this.node.getChildByName(`surePanel`)\r\n        this.surePanelLabel = this.node.getChildByPath(`surePanel/spriteFrame/lab`).getComponent(RichText);\r\n        this.inputPassword = this.node.getChildByPath(`surePanel/spriteFrame/inputBg/inputPassword`).getComponent(EditBox);\r\n        this.sureBtn = this.node.getChildByPath(`surePanel/spriteFrame/sureBtn`).getComponent(Button);\r\n        this.closeBtn = this.node.getChildByPath(`surePanel/spriteFrame/closeBtn`).getComponent(Button);\r\n        this.onBntEvent()\r\n    }\r\n\r\n    private onBntEvent() {\r\n        this.close.node.on(Button.EventType.CLICK, this.onHide, this);\r\n        this.giftBtn.on(Button.EventType.CLICK, this.onShowSurePanel, this);\r\n        this.sureBtn.node.on(Button.EventType.CLICK, this.onSendGift, this);\r\n        this.closeBtn.node.on(Button.EventType.CLICK, () => { this.surePanel.active = false }, this);\r\n        this.EditBox.node.on(EditBox.EventType.EDITING_DID_ENDED, this.onEditEnd, this);\r\n        this.EditBox.node.on(EditBox.EventType.TEXT_CHANGED, this.onTextChanged, this);\r\n        EventMgr.off(Evt_Item_Change, this.updateItemCount, this)\r\n        EventMgr.on(Evt_Item_Change, this.updateItemCount, this)\r\n    }\r\n\r\n    public async onShow(data: proto.base.IPlayerShowInfo, close_back:Function) {\r\n        if (!this.hasLoad) await this.loadSub;\r\n        this.data = data\r\n        this.nameLab.string = data.nickName;\r\n        this.playerGuide.string = \"公会：无\";\r\n        this.closeCallBack = close_back;\r\n        this.costLabel.string = `${0}`;\r\n        this.allLabel.string = `${0}`;\r\n        this.EditBox.string = ``;\r\n        this.ListScrollView.Clean();\r\n        let list_item_data = PlayerData.GetCanSenditem();\r\n        this.ListScrollView.UpdateDatas(list_item_data)\r\n        this.ListScrollView.SelectFirst();\r\n        this.surePanel.active = false  \r\n    }\r\n\r\n    private updateItemCount(){\r\n        let list_item_data = PlayerData.GetCanSenditem();\r\n        this.ListScrollView.UpdateDatas(list_item_data)\r\n        this.updateItemInfo()\r\n    }\r\n\r\n    private updateItem(item: Node, data: ItemGive) {\r\n        if(!data) return\r\n        let cfg = CfgMgr.Getitem(data.Items);\r\n        let count = PlayerData.GetItemCount(cfg.Items)\r\n        let bag_item = item.getComponent(BagItem)\r\n        if(!bag_item) bag_item = item.addComponent(BagItem)\r\n        let item_data = ItemUtil.CreateThing(ThingTypeName.Item, cfg.Items, count)\r\n        item[\"data\"] = data;\r\n        bag_item.setThing(item_data)\r\n    }\r\n\r\n    private onSelectItem(index: number, item: Node){\r\n        let item_data:ItemGive = item[\"data\"];\r\n        this.select_id = item_data.Items;\r\n        this.cfg_item = item_data;\r\n        this.updateItemInfo();\r\n        this.EditBox.string = \"\";\r\n    }\r\n\r\n    private updateItemInfo(){  \r\n        let item = CfgMgr.Getitem(this.select_id);\r\n        this.cost_item_cfg = CfgMgr.Getitem(this.cfg_item.FeeItemID);\r\n        this.itemData = item;\r\n        this.rate = 1;\r\n        this.tipsLab.string = \"最小赠送数量：\" + (this.itemData.Itemtpye == ItemType.money ? this.cfg_item.GiveLimitMin / 10000 : this.cfg_item.GiveLimitMin);\r\n        if(this.cost_item_cfg.Itemtpye == ItemType.money && this.itemData.Itemtpye != ItemType.money){\r\n            this.rate = 10000;\r\n        }\r\n        this.MailCost = this.cfg_item.GiveFeeRate / this.cfg_item.GiveFeeBase / this.rate;\r\n\r\n        this.item_name.string = item.ItemName\r\n        let item_count = PlayerData.GetItemCount(this.select_id);\r\n        this.haveLabel.string = \"已拥有\" + item_count; \r\n       \r\n        this.costLabel.string = this.MailCost + \"\";\r\n        this.allLabel.string = 0 + \"\";\r\n        this.EditBox.string = \"\";\r\n        ResMgr.LoadResAbSub(path.join(folder_item, this.cost_item_cfg.Icon, \"spriteFrame\"),SpriteFrame,res=>{\r\n            // this.have_price_icon.spriteFrame = res;\r\n            this.all_price_icon.spriteFrame = res;\r\n            this.cost_price_icon.spriteFrame = res;\r\n        })\r\n\r\n      \r\n        let bag_item = this.item.getComponent(BagItem)\r\n        if(!bag_item) bag_item = this.item.addComponent(BagItem)\r\n        let item_data = ItemUtil.CreateThing(ThingTypeName.Item, item.Items, 0)\r\n        bag_item.setThing(item_data)\r\n\r\n    }\r\n\r\n\r\n    private onEditEnd() {\r\n        if(this.EditBox.string == \"\") return;\r\n        this.sendCount = Number(this.EditBox.string);\r\n        let cost = this.sendCount * this.MailCost\r\n        if(this.itemData.Itemtpye == ItemType.money){\r\n            this.sendCount =  this.sendCount * 10000;\r\n            cost = this.sendCount * this.MailCost / 10000\r\n        }\r\n        this.minCost = cost > this.cfg_item.GiveFeeMin / 10000 ? cost : this.cfg_item.GiveFeeMin / 10000\r\n        this.costLabel.string = `${this.MailCost}`;\r\n        this.allLabel.string = `${Utils.ToFixed(this.minCost, 4)}`;\r\n        \r\n    }\r\n\r\n    private onTextChanged() {\r\n        // let count = Number(this.keepNumbersAndOneDot(this.EditBox.string));\r\n        // console.log(this.reg.test(this.EditBox.string), this.EditBox.string)\r\n        if(!this.reg.test(this.EditBox.string)){\r\n            MsgPanel.Show(\"输入有误\")\r\n            this.EditBox.string = \"\"\r\n            return \r\n        }\r\n        // this.EditBox.string = `${Math.ceil(parseFloat(this.EditBox.string))}`;\r\n    }\r\n\r\n    // private keepNumbersAndOneDot(str) {\r\n    //     // 使用正则表达式来提取所有数字和小数点\r\n    //     let result = str.replace(/[^0-9.]/g, '');\r\n\r\n    //     // 找到第一个小数点的位置\r\n    //     let firstDotIndex = result.indexOf('.');\r\n\r\n    //     // 如果找到了小数点，移除其后的所有小数点\r\n    //     if (firstDotIndex !== -1) {\r\n    //         result = result.substring(0, firstDotIndex + 1) + result.substring(firstDotIndex + 1).replace(/\\./g, '');\r\n    //     }\r\n\r\n    //     return result;\r\n    // }\r\n\r\n    private onShowSurePanel() {\r\n        this.inputPassword.string = \"\";\r\n        let cost_item_num =  PlayerData.GetItemCount(this.cfg_item.FeeItemID)\r\n        let name = this.itemData.ItemName\r\n\r\n        // if(!PlayerData.roleInfo.is_password){\r\n        //     SettingPasswordPanel.Show();\r\n        //     return;\r\n        // }\r\n        let rate = 1\r\n        if(this.itemData.Itemtpye == ItemType.money){\r\n            rate = 10000\r\n        }\r\n        let count = this.sendCount;\r\n        if (!count || count < 1) {\r\n            return Tips.Show(`请输入要赠送的物品数量！`);\r\n        }\r\n        if (count < this.cfg_item.GiveLimitMin) {\r\n            return Tips.Show(`未达最小起赠值，最少赠送${ this.cfg_item.GiveLimitMin / rate}，请检查后重试！`);\r\n        }\r\n        if (count > this.cfg_item.GiveLimitMax) {\r\n            return Tips.Show(`要赠送的超过上限，最多赠送${ this.cfg_item.GiveLimitMax / rate}，请检查后重试！`);\r\n        }\r\n        if(this.minCost > cost_item_num){\r\n            return Tips.Show(\"手续费不足\");\r\n        }\r\n\r\n        if(this.cfg_item.FeeItemID == this.cfg_item.Items){\r\n            if (count / rate + this.minCost > cost_item_num) {\r\n                return Tips.Show(name +`不足,请检查后重试！`);\r\n            }\r\n        }else{\r\n            let has_count = PlayerData.GetItemCount(this.cfg_item.Items)\r\n            if(this.cost_item_cfg.Itemtpye == ItemType.money){\r\n                if (count / rate > has_count) {\r\n                    return Tips.Show(name +`不足,请检查后重试！`);\r\n                }\r\n                \r\n            }else{\r\n                if (count > has_count) {\r\n                    return Tips.Show(name +`不足,请检查后重试！`);\r\n                }\r\n            }\r\n        }\r\n\r\n        this.surePanel.active = true;\r\n        this.surePanelLabel.string = `将发送<color=#C36316 >${this.EditBox.string}</color>个${name}给玩家<color=#5A74AF>${this.data.nickName}</color>\\n是否确认赠送？`;\r\n    }\r\n\r\n\r\n    private onSendGift() {\r\n        let items_list: { [key: string]: number } = js.createMap();\r\n        let id = this.cfg_item.Items.toString()\r\n        this.sendCount = Number(this.EditBox.string);\r\n        if(this.itemData.Itemtpye == ItemType.money){\r\n            this.sendCount = Number(this.EditBox.string) * 10000;\r\n        }\r\n        items_list[id] =  this.sendCount\r\n        let data = new Req[\"logic.protocol.sendgivemail\"]();\r\n        data.items = items_list\r\n        data.receiverId = this.data.playerId;\r\n        Session.Send(Route[\"logic.protocol.sendgivemail\"], data)\r\n\r\n    }\r\n\r\n\r\n    private onHide(...args: any[]): void {\r\n        // EventMgr.off(Evt_SendMail, this.Hide, this);\r\n        if(this.closeCallBack){\r\n            this.closeCallBack();\r\n            this.closeCallBack = null;\r\n        }\r\n    }\r\n\r\n}\r\n"]}