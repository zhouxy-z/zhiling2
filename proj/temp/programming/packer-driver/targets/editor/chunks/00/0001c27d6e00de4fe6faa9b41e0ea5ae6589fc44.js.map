{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/shop/ShopCommPage.ts"],"names":["ShopCommPage","Button","Label","path","sp","Sprite","SpriteFrame","tween","Tween","UIOpacity","Vec3","ShopBasePage","ShopBuyPanel","ResMgr","ShopRefreshPanel","AutoScroller","CfgMgr","PlayerData","ShopCommItem","titleImg","effect","shopList","timeCont","timeLab","refreshBtn","refreshBtnLab","stdShopIndex","shopData","noneListCont","shopDatas","isPlayListEffect","tempTime","loop","onLoad","node","getChildByPath","getComponent","getChildByName","Skeleton","SetHandle","updateShopItem","bind","on","onShopSelect","EventType","CLICK","onRefreshClcik","update","dt","onShow","onHide","UpdateShow","data","GetShopIndex","ShopGroupId","ShopType","url","join","TitleImgRes","LoadResAbSub","res","spriteFrame","shopId","ID","GetCommShopData","stdShop","GetShop","active","IsCanManualRefresh","soldOut","normal","adItemList","lists","shopItems","adShopItems","concat","index","length","shopItem","std_s","GetCommShopItem","id","GoodAmount","count","push","sort","shopSort","UpdateDatas","a","b","stdA","stdB","order","updateOnShow","opacity","stopAllByTarget","position","to","start","setAnimation","setCompleteListener","std","RefreshThingType","Show","item","addComponent","SetData"],"mappings":"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","sourcesContent":["import { Button, Component, game, Label, Node, path, sp, Sprite, SpriteFrame, tween, Tween, UIOpacity, Vec3 } from \"cc\";\r\nimport { ShopBasePage } from \"./ShopPageBase\";\r\nimport { DateUtils } from \"../../utils/DateUtils\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { ShopBuyPanel } from \"./ShopBuyPanel\";\r\nimport { ResMgr } from \"../../manager/ResMgr\";\r\n\r\nimport { ShopRefreshPanel } from \"./ShopRefreshPanel\";\r\nimport { AutoScroller } from \"../../component/AutoScroller\";\r\nimport { CfgMgr, StdShop, StdShopCommodity, StdShopIndex } from \"../../manager/CfgMgr\";\r\nimport { SShopContent, SShopItem } from \"../player/PlayerStruct\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { ShopCommItem } from \"./ShopCommItem\";\r\nimport proto from \"../../net/Protocol\";\r\n\r\n\r\n\r\nexport class ShopCommPage extends ShopBasePage {\r\n    protected titleImg: Sprite;\r\n    protected effect: sp.Skeleton;\r\n    protected shopList: AutoScroller;\r\n    protected timeCont: Node;\r\n    protected timeLab: Label;\r\n    protected refreshBtn: Button;\r\n    protected refreshBtnLab: Label;\r\n    protected stdShopIndex: StdShopIndex;\r\n    protected shopData: proto.base.IShopContent;\r\n    protected noneListCont: Node;\r\n    protected shopDatas: proto.base.IShopItem[];\r\n    private isPlayListEffect: boolean = true;\r\n    protected onLoad(): void {\r\n        this.titleImg = this.node.getChildByPath(\"titleCont/titleImg\").getComponent(Sprite);\r\n        this.effect = this.node.getChildByName(\"effectCont\").getComponent(sp.Skeleton);\r\n        this.noneListCont = this.node.getChildByName(\"noneListCont\");\r\n        this.shopList = this.node.getChildByName(\"shopList\").getComponent(AutoScroller);\r\n        this.shopList.SetHandle(this.updateShopItem.bind(this));\r\n        this.shopList.node.on('select', this.onShopSelect, this);\r\n        this.timeCont = this.node.getChildByPath(\"timeCont\");\r\n        this.timeLab = this.node.getChildByPath(\"timeCont/timeLab\").getComponent(Label);\r\n        this.refreshBtn = this.node.getChildByPath(\"timeCont/refreshBtn\").getComponent(Button);\r\n        this.refreshBtnLab = this.node.getChildByPath(\"timeCont/refreshBtn/refreshBtnLab\").getComponent(Label);\r\n        this.refreshBtn.node.on(Button.EventType.CLICK, this.onRefreshClcik, this);\r\n        super.onLoad();\r\n    }\r\n    private tempTime: number = 0;\r\n    protected update(dt: number): void {\r\n        if (this.shopData) {\r\n\r\n            // let residueTime: number = Math.max(Math.floor(this.shopData.refresh_time - PlayerData.GetServerTime()), 0);\r\n        //     this.timeLab.string = \"刷新时间：\" + DateUtils.FormatTime(residueTime, \"%{hh}:%{mm}:%{ss}\");\r\n        //     if (residueTime <= 0) {\r\n        //         if (this.tempTime <= 0) {\r\n        //             this.tempTime = 1;\r\n        //             Session.Send({ type: MsgTypeSend.ShopGetIndex, data: { shop_index_id: [this.stdShopIndex.ID] } });\r\n        //         } else {\r\n        //             this.tempTime -= dt;\r\n        //         }\r\n\r\n        //     } else {\r\n        //         this.tempTime = 1;\r\n        //     }\r\n        // } else {\r\n\r\n        //     this.timeLab.string = \"刷新时间：--:--:--\";\r\n        }\r\n    }\r\n\r\n    onShow(): void {\r\n        super.onShow();\r\n        this.isPlayListEffect = true;\r\n\r\n    }\r\n\r\n    onHide(): void {\r\n        super.onHide();\r\n        this.isPlayListEffect = false;\r\n    }\r\n\r\n    protected UpdateShow(): void {\r\n        if(!this.data) return;\r\n        this.stdShopIndex = CfgMgr.GetShopIndex(this.data.ShopGroupId, this.data.ShopType);\r\n        let url = path.join(\"sheets/shop\", this.stdShopIndex.TitleImgRes, \"spriteFrame\");\r\n        ResMgr.LoadResAbSub(url, SpriteFrame, res => {\r\n            this.titleImg.spriteFrame = res;\r\n        });\r\n        this.shopId = this.stdShopIndex.ID;\r\n        this.shopData = PlayerData.GetCommShopData(this.shopId);\r\n        if(!this.shopData) return;\r\n        let stdShop: StdShop = CfgMgr.GetShop(this.shopData.shopId);\r\n        this.refreshBtn.node.active = stdShop.IsCanManualRefresh > 0;\r\n        if (this.shopData) {\r\n            this.noneListCont.active = false;\r\n        } else {\r\n            this.noneListCont.active = true;\r\n        }\r\n        let soldOut: proto.base.IShopItem[] = [];\r\n        let normal: proto.base.IShopItem[] = [];\r\n        let adItemList: proto.base.IShopItem[] = [];\r\n        if (this.shopData) {\r\n            let lists: proto.base.IShopItem[] = this.shopData.shopItems;\r\n            adItemList = this.shopData.adShopItems ? this.shopData.adShopItems.concat() : [];\r\n            for (let index = 0; index < lists.length; index++) {\r\n                let shopItem: proto.base.IShopItem = lists[index];\r\n                let std_s: StdShopCommodity = CfgMgr.GetCommShopItem(shopItem.id);\r\n                // console.log(std_s, shopItem.id)\r\n                if (std_s && std_s.GoodAmount > 0 && shopItem.count < 1) {             \r\n                    soldOut.push(shopItem);\r\n                } else {\r\n                    normal.push(shopItem);\r\n                }\r\n            }\r\n        }\r\n        soldOut.sort(this.shopSort);\r\n        normal.sort(this.shopSort);\r\n        this.shopDatas = normal.concat(soldOut);\r\n        this.shopDatas = adItemList.concat(this.shopDatas);\r\n        this.shopList.UpdateDatas(this.shopDatas);\r\n        if (this.isPlayListEffect) {\r\n            // NodeTrickleOutEffect(this.shopList.children, 0.2);\r\n            this.isPlayListEffect = false;\r\n        }\r\n    }\r\n    private shopSort(a: proto.base.IShopItem, b: proto.base.IShopItem): number {\r\n        let stdA: StdShopCommodity = CfgMgr.GetCommShopItem(a.id);\r\n        let stdB: StdShopCommodity = CfgMgr.GetCommShopItem(b.id);\r\n        return b.order - a.order;\r\n    }\r\n    protected updateOnShow(): void {\r\n        let opacity: UIOpacity = this.titleImg.node.getComponent(UIOpacity);\r\n        Tween.stopAllByTarget(opacity);\r\n        Tween.stopAllByTarget(this.titleImg.node);\r\n        this.titleImg.node.position = new Vec3(-80, 0, 0);\r\n        opacity.opacity = 100;\r\n        tween(this.titleImg.node)\r\n            .to(0.2, { position: new Vec3(0, 0, 0) })\r\n            .start();\r\n        tween(opacity)\r\n            .to(0.3, { opacity: 255 })\r\n            .start();\r\n        this.effect.setAnimation(0, \"Start\", false);\r\n        this.effect.setCompleteListener(() => {\r\n            this.effect.setAnimation(0, \"Loop\", true);\r\n        });\r\n    }\r\n\r\n    private onRefreshClcik(): void {\r\n        if (this.shopData) {\r\n            let std: StdShop = CfgMgr.GetShop(this.shopData.shopId);\r\n            if (std.RefreshThingType && std.RefreshThingType) {\r\n                ShopRefreshPanel.Show(std, this.shopId);\r\n            } else {\r\n                // Session.Send({ type: MsgTypeSend.ShopManualRefresh, data: { shop_index_id: this.shopId } });\r\n            }\r\n        }\r\n    }\r\n\r\n    protected updateShopItem(item: Node, data: SShopItem, index: number) {\r\n        let shopItem = item.getComponent(ShopCommItem);\r\n        if (!shopItem) shopItem = item.addComponent(ShopCommItem);\r\n        shopItem.SetData(data, this.shopData.shopId);\r\n        \r\n    }\r\n    private loop = 0;\r\n    private async onShopSelect(index: number, item: Node): Promise<void> {\r\n        let shopData = this.shopDatas[index];\r\n        // let std = CfgMgr.GetCommShopItem(shopData.id);\r\n        // if (shopData.isAdItem) {\r\n        //     let stdShop: StdShop = CfgMgr.GetShop(this.shopData.shop_id);\r\n        //     if (stdShop.AdId > 0) {\r\n        //         let adData: SAdvister = PlayerData.GetAdvisterData(stdShop.AdId);\r\n        //         if (adData.count <= 0) {\r\n        //             MsgPanel.Show(\"今日广告奖励次数已达上限\");\r\n        //             return;\r\n        //         }\r\n        //         if (game.totalTime < adData.cdEndTime) {\r\n        //             MsgPanel.Show(\"冷却中，请稍后！\");\r\n        //             return;\r\n        //         }\r\n        //         if (this.loop) return;\r\n        //         this.loop = game.totalTime;\r\n        //         if(PlayerData.GetIsActivateRights(StdEquityId.Id_9) || PlayerData.GetIsActivateRights(StdEquityId.Id_10)){\r\n        //             AdHelper.JumpAd(stdShop.AdId, \"\")\r\n        //         }else{\r\n        //             console.log(\"AdHelper---> rewardAdId2:\", GameSet.globalCfg.ad_channel.rewardAdId2);\r\n        //             let action, errorCode, errorMsg;\r\n        //             if (Math.abs(GameSet.globalCfg.ad_channel.rewardAdId2) == 1) {\r\n        //                 [action, errorCode, errorMsg] = await AdHelper.rewardAd(getAdcfg().rewardAdId2, stdShop.AdId, \"\");\r\n        //             } else {\r\n        //                 [action, errorCode, errorMsg] = await AdHelper.rewardQbAd(getQbAdCfg().rewardAdId2, stdShop.AdId, \"\");\r\n        //             }\r\n        //             if (action == \"onLoadFailed\") {\r\n        //                 Tips.Show(\"广告加载失败，请稍后再试！\");\r\n                        \r\n        //                 if (Math.abs(GameSet.globalCfg.ad_channel.rewardAdId2) == 1) {\r\n        //                     if (GameSet.globalCfg.ad_channel.rewardAdId2 > 0) GameSet.globalCfg.ad_channel.rewardAdId2 = 2;\r\n        //                     Tips.Show(\"广告加载失败，请稍后再试！\");\r\n        //                 } else {\r\n        //                     if (GameSet.globalCfg.ad_channel.rewardAdId2 > 0) GameSet.globalCfg.ad_channel.rewardAdId2 = 1;\r\n        //                     Tips.Show(\"广告展示失败，请稍后再试！\");\r\n        //                 }\r\n        //             }\r\n        //             this.loop = undefined;\r\n        //             PlayerData.SetAdvisterCd(stdShop.AdId);\r\n        //         }\r\n        //     }\r\n        // } else {\r\n        //     if (std.GoodAmount > 0 && shopData.count < 1) {\r\n        //         MsgPanel.Show(\"道具已售馨\");\r\n        //         return;\r\n        //     }\r\n        //     if (std.LimitBuyTime > 0 && shopData.expiration_time - PlayerData.GetServerTime() <= 0) {\r\n        //         MsgPanel.Show(\"道具已超出时间，无法继续兑换\");\r\n        //         return;\r\n        //     }\r\n\r\n\r\n            ShopBuyPanel.Show(this.shopId, shopData);\r\n        // }\r\n\r\n    }\r\n}"]}