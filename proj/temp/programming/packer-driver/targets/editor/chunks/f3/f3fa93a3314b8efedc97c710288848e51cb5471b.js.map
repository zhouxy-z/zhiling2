{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/mail/MailModule.ts"],"names":["MailModule","EventMgr","Evt_DelMail","Evt_Get_Mail_Log_Updata","Evt_Mail_Update","Evt_PlayerDataInfo_Update","Evt_ReadMail","Evt_SendMail","Session","Tips","PlayerData","RewardTips","Md5Utils","Req","Ret","Route","MsgPanel","constructor","on","NewMailPush","onMailPush","onReadMailList","onReadMail","onClaimMailAttachments","onDeleteMail","onClaimAllMailAttachments","onPlayerInfo","onSendCurrency","ongetitemrecords","data","pushData","decode","console","log","getmails","readFlag","start","limit","containsMode","Send","data_list","mails","length","mail","mailmap","id","senderPlayerId","player","playerId","push","curMail","find","item","total","mail_start_id","findIndex","emit","read_data","updateMailsData","get_data","res","code","Show","attachments","mail_data","type","i","isRead","isAttachmentClaimed","content","delete_data","deletedMailIds","indexOf","splice","gets_data","things","reward_data","getMailReward","player_data","info","send_data","setpassword","password","hash","info_data","records"],"mappings":"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","sourcesContent":["\r\nimport { EventMgr, Evt_DelMail, Evt_Get_Mail_Log_Updata, Evt_Get_Mail_Reward_Updata, Evt_Mail_Add, Evt_Mail_Update, Evt_PlayerDataInfo_Update, Evt_ReadMail, Evt_SendMail } from \"../../manager/EventMgr\";\r\nimport { Session } from \"../../net/Session\";\r\nimport { Tips } from \"../common/Tips\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { RewardTips } from \"../common/RewardTips\";\r\nimport { Md5Utils } from \"../../utils/Md5Utils\";\r\nimport { Req, Ret, Route } from \"../../net/Protocol\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\n\r\nexport class MailModule {\r\n\r\n    constructor() {\r\n        Session.on(Route.NewMailPush, this.onMailPush, this);\r\n        Session.on(Route[\"mail.protocol.getmails\"], this.onReadMailList, this);\r\n        Session.on(Route[\"mail.protocol.readmail\"], this.onReadMail, this);\r\n        Session.on(Route[\"mail.protocol.claimmailattachment\"], this.onClaimMailAttachments, this);\r\n        Session.on(Route[\"mail.protocol.deletemails\"], this.onDeleteMail, this);\r\n        Session.on(Route[\"mail.protocol.claimmailsattachment\"], this.onClaimAllMailAttachments, this);\r\n        Session.on(Route[\"user.protocol.searchuser\"], this.onPlayerInfo, this);\r\n        Session.on(Route[\"logic.protocol.sendgivemail\"], this.onSendCurrency, this);\r\n        Session.on(Route[\"player.protocol.getitemrecords\"], this.ongetitemrecords, this)\r\n    }\r\n\r\n    /**\r\n     * 新邮件\r\n     * @param data \r\n     */\r\n    protected onMailPush(data) {\r\n        let pushData = Ret.NewMailPush.decode(data)\r\n        console.log(\"推送新邮件\",pushData);\r\n        let getmails = new Req[\"mail.protocol.getmails\"]();\r\n        getmails.readFlag = 0;\r\n        getmails.start = \"\";\r\n        getmails.limit = 9999;\r\n        getmails.containsMode = 0\r\n        Session.Send(Route[\"mail.protocol.getmails\"],getmails);\r\n    }\r\n\r\n    /**接收邮件列表 */\r\n    protected onReadMailList(data: any) {\r\n        let data_list = Ret[\"mail.protocol.getmails\"].decode(data)\r\n        console.log(\"接收邮件列表\",data_list)\r\n        if (data_list.mails && data_list.mails.length > 0){           \r\n                for (let mail of data_list.mails) {\r\n                    if (!PlayerData.mailmap[mail.id] && mail.senderPlayerId != PlayerData.player.playerId) {\r\n                        PlayerData.mailmap[mail.id] = mail;\r\n                        PlayerData.mails.push(mail);\r\n                    }else {\r\n                        let curMail = PlayerData.mails.find(item => item.id === mail.id) || null;\r\n                        curMail = mail;\r\n                    }\r\n                }    \r\n                if(data_list.total){\r\n                    PlayerData.mail_start_id = [];\r\n                    PlayerData.mail_start_id.push(\"\")\r\n                }\r\n                if(PlayerData.mail_start_id.findIndex(id => id == data_list.mails[data_list.mails.length -1].id) == -1){\r\n                    PlayerData.mail_start_id.push(data_list.mails[data_list.mails.length -1].id);\r\n                } \r\n        }\r\n        EventMgr.emit(Evt_Mail_Update);\r\n    }\r\n\r\n    /**读取邮件内容 */\r\n    protected onReadMail(data:any) {\r\n        let read_data = Ret[\"mail.protocol.readmail\"].decode(data)\r\n        console.log(\"读取邮件\",read_data)\r\n        this.updateMailsData(read_data, 1)\r\n        \r\n    }\r\n\r\n    /**提取附件 */\r\n    protected onClaimMailAttachments(data) {\r\n        let get_data = Ret[\"mail.protocol.claimmailattachment\"].decode(data);\r\n        console.log(\"提取附件\",get_data);\r\n        if(get_data.res.code == 200){\r\n            RewardTips.Show(get_data.mail.attachments);\r\n            this.updateMailsData(get_data, 2)\r\n        }else{\r\n            MsgPanel.Show(\"邮件领取失败\")\r\n        }\r\n    }\r\n\r\n    private updateMailsData(mail_data, type){\r\n        for (let i = 0; i < PlayerData.mails.length; i++) {\r\n            let mail = PlayerData.mails[i];\r\n            if (mail.id == mail_data.mail.id) {\r\n                PlayerData.mails[i] = mail_data.mail;\r\n                if(type == 1){\r\n                    PlayerData.mails[i].isRead = true;\r\n                }else if(type == 2){\r\n                    PlayerData.mails[i].isAttachmentClaimed = true;\r\n                }\r\n                PlayerData.mails[i].content = mail_data.mail.content;\r\n                EventMgr.emit(Evt_ReadMail,  PlayerData.mails[i]);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**删除邮件 */\r\n    protected onDeleteMail(data) {\r\n        let delete_data = Ret[\"mail.protocol.deletemails\"].decode(data);\r\n        console.log(\"删除邮件\",delete_data);\r\n        if(delete_data.deletedMailIds.length > 0){\r\n            for (let i = PlayerData.mails.length - 1; i >= 0; i--) {\r\n                let mail = PlayerData.mails[i];\r\n                if (delete_data.deletedMailIds.indexOf(mail.id) != -1) {\r\n                    PlayerData.mails.splice(i, 1);\r\n                    delete PlayerData.mailmap[mail.id];\r\n                    EventMgr.emit(Evt_DelMail);\r\n                }\r\n            }\r\n            MsgPanel.Show(\"删除成功\")\r\n        }else{\r\n            MsgPanel.Show(\"没有可删除邮件\")\r\n        }\r\n        // EventMgr.emit(Evt_ReadMail);\r\n        \r\n    }\r\n\r\n    /**提取所有附件 */\r\n    protected onClaimAllMailAttachments(data) {\r\n        let gets_data = Ret[\"mail.protocol.claimmailsattachment\"].decode(data);\r\n        console.log(\"提取所有附件\",gets_data);\r\n        if (gets_data.things && gets_data.things.length > 0) {\r\n            for (let i = 0; i < PlayerData.mails.length; i++) {\r\n                let mail = PlayerData.mails[i];\r\n                mail.isRead = true;\r\n                mail.isAttachmentClaimed = true;\r\n            }\r\n            let reward_data = PlayerData.getMailReward(gets_data.things);\r\n            RewardTips.Show(reward_data);\r\n        } else {\r\n            Tips.Show(`没有可领取邮件!`)\r\n        }\r\n        EventMgr.emit(Evt_DelMail);\r\n    }\r\n\r\n    /**邮件玩家查询 */\r\n    protected onPlayerInfo(data) {\r\n        let player_data = Ret[\"user.protocol.searchuser\"].decode(data)\r\n        console.log(player_data)\r\n        if (player_data.info){\r\n            // MailPlayerPanel.Show(player_data.info);\r\n            EventMgr.emit(Evt_PlayerDataInfo_Update, player_data.info)\r\n        }else{\r\n            Tips.Show(`没找到指定玩家，请检查后重试！`);\r\n        }\r\n    }\r\n\r\n    /**发送五彩石邮件回调 */\r\n    protected onSendCurrency(data) {\r\n        let send_data = Ret[\"logic.protocol.sendgivemail\"].decode(data);\r\n        console.log(send_data);\r\n        if(send_data.res.code == 1107){\r\n            let setpassword = new Req[\"user.protocol.passwordset\"]();\r\n            setpassword.password = Md5Utils.hash(Md5Utils.hash(\"1234567\"));\r\n            Session.Send(Route[\"user.protocol.passwordset\"], setpassword);\r\n        }else if(send_data.res.code == 200){\r\n            EventMgr.emit(Evt_SendMail);\r\n            Tips.Show(`发送成功`)\r\n        }else if(send_data.res.code == 1304){\r\n            Tips.Show(`发送失败, 超出每日赠送上限`)\r\n        }else{\r\n            Tips.Show(`发送失败`)\r\n        }\r\n    }\r\n\r\n    /**邮件赠送接收物品查询返回 */\r\n    private ongetitemrecords(data:any){\r\n        let info_data = Ret[\"player.protocol.getitemrecords\"].decode(data);\r\n        console.log(info_data);\r\n        EventMgr.emit(Evt_Get_Mail_Log_Updata, info_data.records)\r\n    }\r\n\r\n}"]}