{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/module/userInfo/UserInfoPanel.ts"],"names":["UserInfoPanel","Button","Label","Toggle","MsgPanel","UserEditInfoPanel","Panel","HeadItem","PlayerData","UserHeadPanel","prefab","head","changeHeadBtn","nameLab","editNameBtn","uidLab","copyUidBtn","hideToggle","weiXinNumLab","weiXinBtn","weiXinBtnLab","qqNumLab","qqBtn","qqBtnLab","_playerData","onLoad","find","addComponent","CloseBy","node","on","EventType","CLICK","onBtnClick","TOGGLE","onToggleChange","flush","playerData","updateData","updateView","onShow","onHide","args","isOwn","onUserDataChange","activeInHierarchy","Hide","t","isChecked","Show","btn","weiXinStr","qqStr","isHide","active","interactable","myWeChat","contactWechat","myQQ","contactQq","string","nickName","playerId","toString","player"],"mappings":";;;+KAaaA,a;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAbJC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,K,OAAAA,K;AAAeC,MAAAA,M,OAAAA,M;;AAGvBC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,iB,iBAAAA,iB;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,a,iBAAAA,a;;;;;;;;;+BAIIT,a,GAAN,MAAMA,aAAN;AAAA;AAAA,0BAAkC;AAAA;AAAA;AAAA,eAC3BU,MAD2B,GACV,gCADU;AAAA,eAE7BC,IAF6B;AAAA,eAG7BC,aAH6B;AAAA,eAI7BC,OAJ6B;AAAA,eAK7BC,WAL6B;AAAA,eAM7BC,MAN6B;AAAA,eAO7BC,UAP6B;AAAA,eAQ7BC,UAR6B;AAAA,eAS7BC,YAT6B;AAAA,eAU7BC,SAV6B;AAAA,eAW7BC,YAX6B;AAAA,eAY7BC,QAZ6B;AAAA,eAa7BC,KAb6B;AAAA,eAc7BC,QAd6B;AAAA,eAe7BC,WAf6B;AAAA;;AAgB3BC,QAAAA,MAAM,GAAS;AACrB,eAAKd,IAAL,GAAY,KAAKe,IAAL,CAAU,UAAV,EAAsBC,YAAtB;AAAA;AAAA,mCAAZ;AACA,eAAKf,aAAL,GAAqB,KAAKc,IAAL,CAAU,eAAV,EAA2BzB,MAA3B,CAArB;AACA,eAAKY,OAAL,GAAe,KAAKa,IAAL,CAAU,kBAAV,EAA8BxB,KAA9B,CAAf;AACA,eAAKY,WAAL,GAAmB,KAAKY,IAAL,CAAU,sBAAV,EAAkCzB,MAAlC,CAAnB;AACA,eAAKc,MAAL,GAAc,KAAKW,IAAL,CAAU,gBAAV,EAA4BxB,KAA5B,CAAd;AACA,eAAKc,UAAL,GAAkB,KAAKU,IAAL,CAAU,oBAAV,EAAgCzB,MAAhC,CAAlB;AACA,eAAKgB,UAAL,GAAkB,KAAKS,IAAL,CAAU,YAAV,EAAwBvB,MAAxB,CAAlB;AACA,eAAKe,YAAL,GAAoB,KAAKQ,IAAL,CAAU,yBAAV,EAAqCxB,KAArC,CAApB;AACA,eAAKiB,SAAL,GAAiB,KAAKO,IAAL,CAAU,sBAAV,EAAkCzB,MAAlC,CAAjB;AACA,eAAKmB,YAAL,GAAoB,KAAKM,IAAL,CAAU,mCAAV,EAA+CxB,KAA/C,CAApB;AACA,eAAKmB,QAAL,GAAgB,KAAKK,IAAL,CAAU,iBAAV,EAA6BxB,KAA7B,CAAhB;AACA,eAAKoB,KAAL,GAAa,KAAKI,IAAL,CAAU,cAAV,EAA0BzB,MAA1B,CAAb;AACA,eAAKsB,QAAL,GAAgB,KAAKG,IAAL,CAAU,uBAAV,EAAmCxB,KAAnC,CAAhB;AACA,eAAK0B,OAAL,CAAa,MAAb;AACA,eAAKhB,aAAL,CAAmBiB,IAAnB,CAAwBC,EAAxB,CAA2B7B,MAAM,CAAC8B,SAAP,CAAiBC,KAA5C,EAAmD,KAAKC,UAAxD,EAAoE,IAApE;AACA,eAAKnB,WAAL,CAAiBe,IAAjB,CAAsBC,EAAtB,CAAyB7B,MAAM,CAAC8B,SAAP,CAAiBC,KAA1C,EAAiD,KAAKC,UAAtD,EAAkE,IAAlE;AACA,eAAKjB,UAAL,CAAgBa,IAAhB,CAAqBC,EAArB,CAAwB7B,MAAM,CAAC8B,SAAP,CAAiBC,KAAzC,EAAgD,KAAKC,UAArD,EAAiE,IAAjE;AACA,eAAKd,SAAL,CAAeU,IAAf,CAAoBC,EAApB,CAAuB7B,MAAM,CAAC8B,SAAP,CAAiBC,KAAxC,EAA+C,KAAKC,UAApD,EAAgE,IAAhE;AACA,eAAKX,KAAL,CAAWO,IAAX,CAAgBC,EAAhB,CAAmB7B,MAAM,CAAC8B,SAAP,CAAiBC,KAApC,EAA2C,KAAKC,UAAhD,EAA4D,IAA5D;AACA,eAAKhB,UAAL,CAAgBY,IAAhB,CAAqBC,EAArB,CAAwB3B,MAAM,CAAC4B,SAAP,CAAiBG,MAAzC,EAAiD,KAAKC,cAAtD,EAAsE,IAAtE;AACH;;AACMC,QAAAA,KAAK,CAACC,UAAoC,GAAG,IAAxC,EAAoD;AAC5D,eAAKb,WAAL,GAAmBa,UAAnB;AACA,eAAKC,UAAL,GAF4D,CAI5D;;AACA,eAAKC,UAAL;AACH;;AAESC,QAAAA,MAAM,GAAS,CACrB;AACH;;AAESC,QAAAA,MAAM,CAAC,GAAGC,IAAJ,EAAuB,CACnC;AACH;;AACOJ,QAAAA,UAAU,GAAO;AACrB,cAAG,CAAC,KAAKd,WAAN,IAAqB,KAAKmB,KAA7B,EAAmC,CAC/B;AACA;AACA;AACA;AACA;AACA;AACH;AACJ;;AACOC,QAAAA,gBAAgB,GAAO;AAC3B,cAAG,CAAC,KAAKf,IAAL,CAAUgB,iBAAd,EAAiC;AACjC;AAAA;AAAA,sDAAkBC,IAAlB;AACA,eAAKR,UAAL;AACA,eAAKC,UAAL;AACH;;AACOJ,QAAAA,cAAc,CAACY,CAAD,EAAe;AACjC,eAAK9B,UAAL,CAAgB+B,SAAhB,GAA4B,KAA5B;AACA;AAAA;AAAA,oCAASC,IAAT,CAAc,UAAd;AACH;;AACOhB,QAAAA,UAAU,CAACiB,GAAD,EAAiB;AAC/B,kBAAOA,GAAP;AACI,iBAAK,KAAKtC,aAAV;AACI;AAAA;AAAA,kDAAcqC,IAAd,GADJ,CAEI;AACA;AACA;AACA;;AACA;;AACJ,iBAAK,KAAKnC,WAAV;AAEI;AAAA;AAAA,0DAAkBmC,IAAlB,CAAuB,CAAvB;AACA;;AACJ,iBAAK,KAAKjC,UAAV;AACI;AACA;AACA;AACA;AACA;AACA;AACA;;AACJ,iBAAK,KAAKG,SAAV;AACI;AAAA;AAAA,0DAAkB8B,IAAlB,CAAuB,CAAvB;AACA;;AACJ,iBAAK,KAAK3B,KAAV;AACI;AAAA;AAAA,0DAAkB2B,IAAlB,CAAuB,CAAvB;AACA;AAzBR;AA2BH;;AACOV,QAAAA,UAAU,GAAO;AACrB,cAAIY,SAAgB,GAAG,KAAvB;AACA,cAAIC,KAAY,GAAG,KAAnB;AACA,cAAIC,MAAc,GAAG,IAArB,CAHqB,CAGK;AAC1B;;AACA,cAAG,KAAKV,KAAR,EAAc;AACVU,YAAAA,MAAM,GAAG,IAAT;AACA,iBAAKpC,UAAL,CAAgBY,IAAhB,CAAqByB,MAArB,GAA8B,IAA9B;AACA,iBAAKrC,UAAL,CAAgB+B,SAAhB,GAA4B,KAA5B;AACA,iBAAKlC,WAAL,CAAiBe,IAAjB,CAAsByB,MAAtB,GAA+B,IAA/B;AACA,iBAAK1C,aAAL,CAAmBiB,IAAnB,CAAwByB,MAAxB,GAAiC,IAAjC;AACA,iBAAKrC,UAAL,CAAgBsC,YAAhB,GAA+B,IAA/B;AACA,gBAAIC,QAAe,GAAG,KAAKhC,WAAL,CAAiBiC,aAAjB,IAAkC,EAAxD;AACA,gBAAIC,IAAW,GAAG,KAAKlC,WAAL,CAAiBmC,SAAjB,IAA8B,EAAhD;;AACA,gBAAGH,QAAH,EAAY;AACRL,cAAAA,SAAS,GAAGK,QAAZ;AACH;;AACD,gBAAGE,IAAH,EAAQ;AACJN,cAAAA,KAAK,GAAGM,IAAR;AACH;;AACD,iBAAKtC,YAAL,CAAkBwC,MAAlB,GAA2B,IAA3B;AACA,iBAAKrC,QAAL,CAAcqC,MAAd,GAAuB,IAAvB;AACA,iBAAKzC,SAAL,CAAeU,IAAf,CAAoByB,MAApB,GAA6B,IAA7B;AACA,iBAAKhC,KAAL,CAAWO,IAAX,CAAgByB,MAAhB,GAAyB,IAAzB;AACH,WAnBD,MAmBK;AACDD,YAAAA,MAAM,GAAG,IAAT;AACA,iBAAKpC,UAAL,CAAgBY,IAAhB,CAAqByB,MAArB,GAA8B,KAA9B;AACA,iBAAKxC,WAAL,CAAiBe,IAAjB,CAAsByB,MAAtB,GAA+B,KAA/B;AACA,iBAAKlC,YAAL,CAAkBwC,MAAlB,GAA2B,IAA3B;AACA,iBAAKrC,QAAL,CAAcqC,MAAd,GAAuB,IAAvB;;AACA,gBAAGP,MAAH,EAAU;AACND,cAAAA,KAAK,GAAG,UAAR;AACAD,cAAAA,SAAS,GAAG,UAAZ;AACA,mBAAKhC,SAAL,CAAeU,IAAf,CAAoByB,MAApB,GAA6B,KAA7B;AACA,mBAAKhC,KAAL,CAAWO,IAAX,CAAgByB,MAAhB,GAAyB,KAAzB;AACH,aALD,MAKK;AACD,mBAAKnC,SAAL,CAAeU,IAAf,CAAoByB,MAApB,GAA6B,IAA7B;AACA,mBAAKhC,KAAL,CAAWO,IAAX,CAAgByB,MAAhB,GAAyB,IAAzB;AACH;;AACD,iBAAK1C,aAAL,CAAmBiB,IAAnB,CAAwByB,MAAxB,GAAiC,KAAjC;AACA,iBAAKrC,UAAL,CAAgBsC,YAAhB,GAA+B,KAA/B;AACH;;AAED,eAAK1C,OAAL,CAAa+C,MAAb,GAAsB,KAAKpC,WAAL,CAAiBqC,QAAvC;AACA,eAAK9C,MAAL,CAAY6C,MAAZ,GAAqB,KAAKpC,WAAL,CAAiBsC,QAAjB,CAA0BC,QAA1B,EAArB;AACA,cAAG,KAAKvC,WAAL,CAAiBiC,aAApB,EAAmCN,SAAS,GAAG,KAAK3B,WAAL,CAAiBiC,aAA7B;AACnC,cAAG,KAAKjC,WAAL,CAAiBmC,SAApB,EAA+BP,KAAK,GAAG,KAAK5B,WAAL,CAAiBmC,SAAzB;AAC/B,eAAKzC,YAAL,CAAkB0C,MAAlB,GAA2BT,SAA3B;AACA,eAAK9B,QAAL,CAAcuC,MAAd,GAAuBR,KAAvB;AACH;AACD;AACJ;AACA;;;AACqB,YAALT,KAAK,GAAU;AACvB,iBAAO,KAAKnB,WAAL,CAAiBsC,QAAjB,IAA6B;AAAA;AAAA,wCAAWE,MAAX,CAAkBF,QAAtD;AACH;;AA7JoC,O","sourcesContent":["import { Button, Label, Sprite, Toggle } from \"cc\";\r\n\r\nimport LocalStorage from \"../../utils/LocalStorage\";\r\nimport { MsgPanel } from \"../common/MsgPanel\";\r\nimport { UserEditInfoPanel } from \"./UserEditInfoPanel\";\r\nimport { Panel } from \"../../manager/GameRoot\";\r\nimport { HeadItem } from \"../common/HeadItem\";\r\nimport { EventMgr } from \"../../manager/EventMgr\";\r\nimport { PlayerData } from \"../player/PlayerData\";\r\nimport { UserHeadPanel } from \"./UserHeadPanel\";\r\nimport proto from \"../../net/Protocol\";\r\n\r\n\r\nexport class UserInfoPanel extends Panel {\r\n    protected prefab: string = \"prefabs/userInfo/UserInfoPanel\";\r\n    private head:HeadItem;\r\n    private changeHeadBtn:Button;\r\n    private nameLab:Label;\r\n    private editNameBtn:Button;\r\n    private uidLab:Label;\r\n    private copyUidBtn:Button;\r\n    private hideToggle:Toggle;\r\n    private weiXinNumLab:Label;\r\n    private weiXinBtn:Button;\r\n    private weiXinBtnLab:Label;\r\n    private qqNumLab:Label;\r\n    private qqBtn:Button;\r\n    private qqBtnLab:Label;\r\n    private _playerData:proto.base.PlayerShowInfo;\r\n    protected onLoad(): void {\r\n        this.head = this.find('HeadItem').addComponent(HeadItem);\r\n        this.changeHeadBtn = this.find(\"changeHeadBtn\", Button);\r\n        this.nameLab = this.find(\"nameCont/nameLab\", Label);\r\n        this.editNameBtn = this.find(\"nameCont/editNameBtn\", Button);\r\n        this.uidLab = this.find(\"UIDCont/uidLab\", Label);\r\n        this.copyUidBtn = this.find(\"UIDCont/copyUidBtn\", Button);\r\n        this.hideToggle = this.find(\"hideToggle\", Toggle);\r\n        this.weiXinNumLab = this.find(\"weiXinCont/weiXinNumLab\", Label);\r\n        this.weiXinBtn = this.find(\"weiXinCont/weiXinBtn\", Button);\r\n        this.weiXinBtnLab = this.find(\"weiXinCont/weiXinBtn/weiXinBtnLab\", Label);\r\n        this.qqNumLab = this.find(\"qqCont/qqNumLab\", Label);\r\n        this.qqBtn = this.find(\"qqCont/qqBtn\", Button);\r\n        this.qqBtnLab = this.find(\"qqCont/qqBtn/qqBtnLab\", Label);\r\n        this.CloseBy(\"mask\");\r\n        this.changeHeadBtn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.editNameBtn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.copyUidBtn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.weiXinBtn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.qqBtn.node.on(Button.EventType.CLICK, this.onBtnClick, this);\r\n        this.hideToggle.node.on(Toggle.EventType.TOGGLE, this.onToggleChange, this);\r\n    }\r\n    public flush(playerData:proto.base.PlayerShowInfo = null): void {\r\n        this._playerData = playerData;\r\n        this.updateData();\r\n        \r\n        // this.head.SetData(this._playerData);\r\n        this.updateView();\r\n    }\r\n    \r\n    protected onShow(): void {\r\n        // EventMgr.on(Evt_PlayerBaseInfoChange, this.onUserDataChange, this);\r\n    }\r\n\r\n    protected onHide(...args: any[]): void {\r\n        // EventMgr.off(Evt_PlayerBaseInfoChange, this.onUserDataChange, this);\r\n    }\r\n    private updateData():void{\r\n        if(!this._playerData || this.isOwn){\r\n            // this._playerData = {\r\n            //     playerId:PlayerData.player.playerId,\r\n            //     nickName: PlayerData.user.info.nickName,\r\n            //     contactWechat: PlayerData.user.info.contactWechat,\r\n            //     contactQq: PlayerData.user.info.contactQq,\r\n            // };\r\n        }\r\n    }\r\n    private onUserDataChange():void{\r\n        if(!this.node.activeInHierarchy) return;\r\n        UserEditInfoPanel.Hide();\r\n        this.updateData();\r\n        this.updateView();\r\n    }\r\n    private onToggleChange(t:Toggle):void{\r\n        this.hideToggle.isChecked = false;\r\n        MsgPanel.Show(\"暂不支持隐藏显示\");\r\n    }\r\n    private onBtnClick(btn:Button):void{\r\n        switch(btn){\r\n            case this.changeHeadBtn:\r\n                UserHeadPanel.Show();\r\n                // if(this.isOwn){\r\n                //     MsgPanel.Show(\"功能暂未开启\");\r\n                //     return;\r\n                // }\r\n                break;\r\n            case this.editNameBtn:\r\n                \r\n                UserEditInfoPanel.Show(1);\r\n                break;\r\n            case this.copyUidBtn:\r\n                // let uidStr:string = this.uidLab.string;\r\n                // CopyToClip(uidStr, (desc: string) => {\r\n                //     if (desc != undefined || desc != null) {\r\n                //         MsgPanel.Show(\"已复制到粘贴板\");\r\n                //     }\r\n                // });\r\n                break;\r\n            case this.weiXinBtn:\r\n                UserEditInfoPanel.Show(2);\r\n                break;\r\n            case this.qqBtn:\r\n                UserEditInfoPanel.Show(3);\r\n                break;\r\n        }\r\n    }\r\n    private updateView():void{\r\n        let weiXinStr:string = \"未设置\";\r\n        let qqStr:string = \"未设置\";\r\n        let isHide:boolean = true;//是否隐藏联系方式\r\n        //查看自己\r\n        if(this.isOwn){\r\n            isHide = true;\r\n            this.hideToggle.node.active = true;\r\n            this.hideToggle.isChecked = false;\r\n            this.editNameBtn.node.active = true;\r\n            this.changeHeadBtn.node.active = true;\r\n            this.hideToggle.interactable = true;\r\n            let myWeChat:string = this._playerData.contactWechat || \"\";\r\n            let myQQ:string = this._playerData.contactQq || \"\";\r\n            if(myWeChat){\r\n                weiXinStr = myWeChat;\r\n            }\r\n            if(myQQ){\r\n                qqStr = myQQ;\r\n            }\r\n            this.weiXinBtnLab.string = \"编辑\";\r\n            this.qqBtnLab.string = \"编辑\";\r\n            this.weiXinBtn.node.active = true;\r\n            this.qqBtn.node.active = true;\r\n        }else{\r\n            isHide = true;\r\n            this.hideToggle.node.active = false;\r\n            this.editNameBtn.node.active = false;\r\n            this.weiXinBtnLab.string = \"复制\";\r\n            this.qqBtnLab.string = \"复制\";\r\n            if(isHide){\r\n                qqStr = \"********\";\r\n                weiXinStr = \"********\";\r\n                this.weiXinBtn.node.active = false;\r\n                this.qqBtn.node.active = false;\r\n            }else{\r\n                this.weiXinBtn.node.active = true;\r\n                this.qqBtn.node.active = true;\r\n            }\r\n            this.changeHeadBtn.node.active = false;\r\n            this.hideToggle.interactable = false;\r\n        }\r\n        \r\n        this.nameLab.string = this._playerData.nickName;\r\n        this.uidLab.string = this._playerData.playerId.toString();\r\n        if(this._playerData.contactWechat) weiXinStr = this._playerData.contactWechat;\r\n        if(this._playerData.contactQq) qqStr = this._playerData.contactQq;\r\n        this.weiXinNumLab.string = weiXinStr;\r\n        this.qqNumLab.string = qqStr;\r\n    }\r\n    /**\r\n     * 是否自己\r\n     */\r\n    private get isOwn():boolean{\r\n        return this._playerData.playerId == PlayerData.player.playerId;\r\n    }\r\n}"]}