{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/utils/Bezier.ts"],"names":["Bezier","Vec3","v3","vs","receive","v","poolv","indexOf","push","length","pool","update","t","undefined","forEach","value","pop","set","temp","prev","i","lerp","craeteCurve","start","end","radio","dis","distance","h","tv1","multiplyScalar","tv2","add","tv3","bezier","clone","create","ctrls","ratio","c"],"mappings":"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","sourcesContent":["import { Vec3, geometry, v3 } from \"cc\";\r\n\r\nexport class Bezier {\r\n    protected static poolv: Vec3[] = [];\r\n    protected static pool: Bezier[] = [];\r\n\r\n    protected static tv1: Vec3 = v3();\r\n    protected static tv2: Vec3 = v3();\r\n    protected static tv3: Vec3 = v3();\r\n    protected static v = v3(0, 1, 0);\r\n\r\n    protected vs: Vec3[] = [];\r\n\r\n    receive() {\r\n        for (let v of this.vs) {\r\n            if (Bezier.poolv.indexOf(v) == -1) Bezier.poolv.push(v);\r\n        }\r\n        this.vs.length = 0;\r\n        if (Bezier.pool.indexOf(this) == -1) Bezier.pool.push(this);\r\n    }\r\n\r\n    /**\r\n     * 计算\r\n     * @param t \r\n     * @returns \r\n     */\r\n    update(t: number) {\r\n        if (this.vs.length <= 2) return undefined;\r\n        let vs: Vec3[] = [];\r\n        this.vs.forEach(value => { vs.push((Bezier.poolv.pop() || v3()).set(value)) });\r\n        while (vs.length > 1) {\r\n            let temp = [];\r\n            let prev: Vec3 = this.vs[0];\r\n            for (let i = 1; i < vs.length; i++) {\r\n                let v = Bezier.poolv.pop() || v3();\r\n                Vec3.lerp(v, prev, vs[i], t);\r\n                temp.push(v);\r\n                Bezier.poolv.push(vs[i]);\r\n                prev = vs[i];\r\n            }\r\n            vs.length = 0;\r\n            vs = temp;\r\n        }\r\n        // console.log(\"update\", vs[0].toString());\r\n        return vs[0];\r\n    }\r\n\r\n    /**\r\n     * 抛物线\r\n     * @param start \r\n     * @param end \r\n     * @param radio \r\n     */\r\n    static craeteCurve(start: Vec3, end: Vec3, radio: number) {\r\n        let dis = Vec3.distance(start, end);\r\n        let h = dis * radio;\r\n        Vec3.lerp(this.tv1, start, end, 0.5);\r\n        Vec3.multiplyScalar(this.tv2, this.v, h);\r\n        Vec3.add(this.tv3, this.tv1, this.tv2);\r\n        let bezier = this.pool.length ? this.pool.pop() : new Bezier();\r\n        bezier.vs.push(Bezier.poolv.length ? Bezier.poolv.pop().set(start) : Vec3.clone(start));\r\n        bezier.vs.push(Bezier.poolv.length ? Bezier.poolv.pop().set(this.tv3) : Vec3.clone(this.tv3));\r\n        bezier.vs.push(Bezier.poolv.length ? Bezier.poolv.pop().set(end) : Vec3.clone(end));\r\n        // console.log(\"bezier\", start.toString(), end.toString(), bezier.vs[1].toString());\r\n        return bezier;\r\n    }\r\n\r\n    /**\r\n     * 创建贝塞尔\r\n     * @param start \r\n     * @param end \r\n     * @param ctrls \r\n     */\r\n    static create(start: Vec3, end: Vec3, ctrls: Vec3[]) {\r\n        let ratio = Vec3.distance(start, end) / Vec3.distance(ctrls[0], ctrls[ctrls.length - 1]);\r\n        let bezier = this.pool.length ? this.pool.pop() : new Bezier();\r\n        bezier.vs.push(start);\r\n        let prev: Vec3 = ctrls[0];\r\n        for (let i = 1; i < ctrls.length - 1; i++) {\r\n            let v = ctrls[i];\r\n            let c = Bezier.poolv.length ? Bezier.poolv.pop() : v3();\r\n            Vec3.lerp(c, prev, v, ratio);\r\n            bezier.vs.push(c);\r\n        }\r\n        bezier.vs.push(end);\r\n        return bezier;\r\n    }\r\n}"]}