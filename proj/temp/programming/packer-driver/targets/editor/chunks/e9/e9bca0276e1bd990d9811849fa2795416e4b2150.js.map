{"version":3,"sources":["file:///D:/plants_client/trunk/proj/assets/scripts/component/AutoScroller.ts"],"names":["Component","Event","EventTouch","Input","Layout","Node","ScrollView","Toggle","UITransform","_decorator","instantiate","Second","ccclass","property","disallowMultiple","requireComponent","AutoScroller","scroller","createItem","updateItem","datas","itemPool","itemTransForm","original","startX","startY","showing","type","contentW","contentH","spaceX","spaceY","paddingLeft","paddingRight","paddingTop","paddingDown","selectIndex","isMoveSub","_initSpaceX","canSelect","onLoad","getComponent","content","contentTrans","ins","width","height","children","length","position","x","y","trans","parent","removeChild","layout","paddingBottom","spacingX","spacingY","enabled","vertical","horizontal","Type","HORIZONTAL","VERTICAL","child","push","removeAllChildren","node","on","flush","apply","nestedCall","event","captureListeners","eventPhase","CAPTURING_PHASE","call","EventType","TOUCH_MOVE","e","target","propagationStopped","start","getStartLocation","curre","getLocation","isMoveX","Math","abs","isMoveY","TOUCH_END","TOUCH_CANCEL","UpdateDatas","SelectFirst","t","ScrollToHead","onSelect","SelectLast","ScrollToLast","scrollToTop","scrollToLeft","scrollToBottom","scrollToRight","ScrollNext","ScrollPrev","SetHandle","craeteItem","box","getBoundingBoxTo","getWorldMatrix","xMin","anchorX","contentSize","yMax","anchorY","Clean","item","itemSize","wide","len","max","setContentSize","col","getGridCol","row","ceil","k","undefined","itemW","floor","GetSelectIndex","reflush","getSpaceX","setSpaceX","value","getWide","CanSelect","toggle","getItem","index","pop","hasEventListener","isChecked","emit","nx","ny","GRID","setPosition","reset","leftX","topY","rightX","xMax","downY","yMin","views","hide","end","i","addChild","isDel","receiveItem","ScrollToIndex","transform"],"mappings":"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","sourcesContent":["import { Component, Event, EventTouch, Input, Layout, Node, NodeEventType, ScrollView, Size, Toggle, UITransform, Vec2, Vec3, _decorator, instantiate, v2, v3 } from \"cc\";\r\nimport { Second } from \"../utils/Utils\";\r\n\r\nconst { ccclass, property, disallowMultiple, requireComponent } = _decorator;\r\n\r\n@ccclass('AutoScroller')\r\n@disallowMultiple(true)\r\n@requireComponent(ScrollView)\r\nexport class AutoScroller extends Component {\r\n\r\n    private scroller: ScrollView;\r\n    private createItem: () => Node;\r\n    public updateItem: (item: Node, data: any, index: number) => void;\r\n    private datas: any[];\r\n    private itemPool: Node[] = [];\r\n    private itemTransForm: UITransform;\r\n    private original: Node;\r\n    private startX: number;\r\n    private startY: number;\r\n    private showing: { [pos: string]: Node } = {};\r\n    private type: number;\r\n    private contentW: number = 0;\r\n    private contentH: number = 0;\r\n    private spaceX: number = 10;\r\n    private spaceY: number = 10;\r\n    private paddingLeft: number = 0;\r\n    private paddingRight: number = 0;\r\n    private paddingTop: number = 0;\r\n    private paddingDown: number = 0;\r\n    private selectIndex: number;\r\n    private isMoveSub: boolean = false;\r\n    protected onLoad(): void {\r\n        let scroller = this.getComponent(ScrollView);\r\n        if (!scroller || !scroller.content) throw \"滚动组件必须指定一个Content\";\r\n        let contentTrans = scroller.content.getComponent(UITransform);\r\n        let ins = this;\r\n        ins.scroller = scroller;\r\n        ins.contentW = contentTrans.width;\r\n        ins.contentH = contentTrans.height;\r\n        if (this.scroller.content.children.length) {\r\n            this.original = this.scroller.content.children[0];\r\n            ins.startX = ins.original.position.x;\r\n            ins.startY = ins.original.position.y;\r\n            var trans = ins.original.getComponent(UITransform);\r\n            ins.original.parent.removeChild(ins.original);\r\n            ins.itemTransForm = trans;\r\n        }\r\n\r\n        let layout = scroller.content.getComponent(Layout);\r\n        if (layout) {\r\n            // Layout.Type.VERTICAL\r\n            ins.type = layout.type;\r\n            ins.paddingTop = layout.paddingTop;\r\n            ins.paddingDown = layout.paddingBottom;\r\n            ins.paddingLeft = layout.paddingLeft;\r\n            ins.paddingRight = layout.paddingRight;\r\n            ins.spaceX = layout.spacingX;\r\n            ins.spaceY = layout.spacingY;\r\n            layout.enabled = false;\r\n        } else {\r\n            if (!scroller.vertical && scroller.horizontal) {\r\n                ins.type = Layout.Type.HORIZONTAL;\r\n            } else {\r\n                ins.type = Layout.Type.VERTICAL;\r\n            }\r\n        }\r\n        for (let child of scroller.content.children) {\r\n            ins.itemPool.push(child);\r\n        }\r\n        scroller.content.removeAllChildren();\r\n\r\n        scroller.node.on(\"scrolling\", () => {\r\n            ins.flush.apply(ins);\r\n        }, ins);\r\n\r\n\r\n        /**解决表嵌表处理*/\r\n        let nestedCall = scroller[\"_hasNestedViewGroup\"];\r\n        scroller[\"_hasNestedViewGroup\"] = function (event: EventTouch, captureListeners?: Node[]) {\r\n            if (event.eventPhase !== Event.CAPTURING_PHASE) return false;\r\n            if (!ins.isMoveSub) return false;\r\n            return nestedCall.call(this, event, captureListeners);\r\n        };\r\n\r\n        scroller.node.on(Node.EventType.TOUCH_MOVE, function (e: EventTouch) {\r\n            if (e.target != scroller.node) {\r\n                if (ins.isMoveSub) return;\r\n                e.propagationStopped = true;\r\n                let start = e.getStartLocation();\r\n                let curre = e.getLocation();\r\n                let isMoveX = Math.abs(start.x - curre.x) > 7;\r\n                let isMoveY = Math.abs(start.y - curre.y) > 7;\r\n                if (scroller[\"horizontal\"] && !isMoveX && isMoveY) {\r\n                    ins.isMoveSub = true;\r\n                } else if (scroller[\"vertical\"] && !isMoveY && isMoveX) {\r\n                    ins.isMoveSub = true;\r\n                }\r\n                //console.log(\"是否滚动子表----->\" + ins.isMoveSub)\r\n            }\r\n        }, ins, true);\r\n        scroller.node.on(Node.EventType.TOUCH_END, function () { ins.isMoveSub = false }, ins, true);\r\n        scroller.node.on(Node.EventType.TOUCH_CANCEL, function () { ins.isMoveSub = false }, ins, true);\r\n        /**解决表嵌表处理*/\r\n\r\n\r\n        if (this.datas && (this.original || this.createItem)) {\r\n            this.UpdateDatas(this.datas);\r\n        }\r\n\r\n    }\r\n    /**\r\n     * 选择第一个\r\n     */\r\n    async SelectFirst(t: number = 0.1) {\r\n        this.ScrollToHead(t);\r\n        await Second(t);\r\n        let children = this.scroller.content.children;\r\n        for (let child of children) {\r\n            if (child['$$index'] == 0) {\r\n                this.onSelect(child);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n    async SelectLast(t: number = 0.1) {\r\n        this.ScrollToLast(t);\r\n        await Second(t);\r\n        let children = this.scroller.content.children;\r\n        for (let child of children) {\r\n            if (child['$$index'] == this.datas.length - 1) {\r\n                this.onSelect(child);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    ScrollToHead(t: number = 0.1) {\r\n        if (!this.scroller) return;\r\n        if (this.scroller.vertical) {\r\n            this.scroller.scrollToTop(t);\r\n        } else {\r\n            this.scroller.scrollToLeft(t);\r\n        }\r\n    }\r\n    ScrollToLast(t: number = 0.1) {\r\n        if (!this.scroller) return;\r\n        if (this.scroller.vertical) {\r\n            this.scroller.scrollToBottom(t);\r\n        } else {\r\n            this.scroller.scrollToRight(t);\r\n        }\r\n    }\r\n    ScrollNext(t: number = 1) {\r\n        this.scroller.scrollToRight(t);\r\n    }\r\n    ScrollPrev(t: number = 1) {\r\n        this.scroller.scrollToLeft(t);\r\n    }\r\n\r\n    SetHandle(updateItem: (item: Node, data: any, index?: number) => void, craeteItem?: () => Node) {\r\n        this.updateItem = updateItem;\r\n        if (craeteItem) {\r\n            this.createItem = craeteItem;\r\n            if (!this.original) {\r\n                var trans = craeteItem().getComponent(UITransform);\r\n                let box = this.scroller.getComponent(UITransform).getBoundingBoxTo(this.scroller.content.getWorldMatrix());\r\n                this.startX = box.xMin + trans.anchorX * trans.contentSize.width;\r\n                this.startY = box.yMax - (1 - trans.anchorY) * trans.contentSize.height;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清理列表，并使用null对象初始所有item\r\n     */\r\n    Clean() {\r\n        this.UpdateDatas([]);\r\n        for (let item of this.itemPool) {\r\n            this.updateItem?.(item, null, -1);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 更新数据\r\n     * @param datas \r\n     * @returns \r\n     */\r\n    UpdateDatas(datas: any[]) {\r\n        this.datas = datas;\r\n        if (!this.datas) {\r\n            debugger;\r\n            return;\r\n        }\r\n        if (!this.scroller) return;\r\n        let trans = this.scroller.content.getComponent(UITransform);\r\n        let itemSize = this.itemTransForm.contentSize;\r\n        let wide: number;\r\n        let len: number = datas.length;\r\n        if (this.type == Layout.Type.VERTICAL) {\r\n            wide = Math.max(len * (itemSize.height + this.spaceY) - this.spaceY, 0);\r\n            trans.setContentSize(this.contentW, wide + this.paddingTop + this.paddingDown);\r\n        } else if (this.type == Layout.Type.HORIZONTAL) {\r\n            wide = Math.max(len * (itemSize.width + this.spaceX) - this.spaceX, 0);\r\n            trans.setContentSize(wide + this.paddingLeft + this.paddingRight, this.contentH);\r\n        } else {\r\n            let col = this.getGridCol(itemSize.width);\r\n            let row = Math.ceil(len / col);\r\n            wide = Math.max(row * (itemSize.height + this.spaceY) - this.spaceY, 0);\r\n            trans.setContentSize(this.contentW + this.paddingLeft + this.paddingRight, wide + this.paddingTop + this.paddingDown);\r\n        }\r\n        for (let k in this.showing) this.showing[k][\"$$index\"] = undefined;\r\n        this.flush(true);\r\n    }\r\n    private getGridCol(itemW: number): number {\r\n        return Math.floor((this.contentW + this.spaceX) / (itemW + this.spaceX));\r\n    }\r\n    GetSelectIndex() { return this.selectIndex; }\r\n    reflush() { this.flush(true) }\r\n    get children() {\r\n        return this.scroller.content.children;\r\n    }\r\n\r\n    protected _initSpaceX: number = 0;\r\n    getSpaceX() {\r\n        if (!this._initSpaceX) this._initSpaceX = this.spaceX;\r\n        return this._initSpaceX;\r\n    }\r\n    setSpaceX(value: number) {\r\n        this.spaceX = value;\r\n    }\r\n    getWide() {\r\n        if (this.original) return this.original.getComponent(UITransform).contentSize;\r\n        return this.scroller.content.children[0].getComponent(UITransform).contentSize;\r\n    }\r\n\r\n    private canSelect = true;\r\n    CanSelect(value: boolean) {\r\n        this.canSelect = value;\r\n        let children = this.scroller.content.children;\r\n        for (let child of children) {\r\n            let toggle = child.getComponent(Toggle);\r\n            if (toggle) toggle.enabled = value;\r\n        }\r\n    }\r\n\r\n    private getItem(index: any): Node {\r\n        let item: Node;\r\n        if (this.showing[index]) {\r\n            item = this.showing[index];\r\n        } else if (this.itemPool.length) {\r\n            item = this.itemPool.pop();\r\n            if (!item.hasEventListener(Input.EventType.TOUCH_END, this.onSelect, this)) {\r\n                item.on(Input.EventType.TOUCH_END, this.onSelect, this);\r\n            }\r\n        } else if (this.original) {\r\n            //console.error(\"-------->创建Item\")\r\n            item = instantiate(this.original);\r\n            item.on(Input.EventType.TOUCH_END, this.onSelect, this);\r\n        } else {\r\n            item = this.createItem();\r\n            item.on(Input.EventType.TOUCH_END, this.onSelect, this);\r\n        }\r\n        let toggle = item.getComponent(Toggle);\r\n        if (toggle) {\r\n            if (!this.canSelect) toggle.isChecked = false;\r\n            toggle.enabled = this.canSelect;\r\n        }\r\n        return item;\r\n    }\r\n    private onSelect(e: EventTouch | Node) {\r\n        let item: Node;\r\n        if (e instanceof EventTouch) {\r\n            item = e.target;\r\n        } else {\r\n            item = e;\r\n        }\r\n        this.selectIndex = item[\"$$index\"];\r\n        if (item != undefined) {\r\n            this.node.emit(\"select\", item[\"$$index\"], item, this.datas[item[\"$$index\"]]);\r\n        }\r\n    }\r\n\r\n    private layout(item: Node, nx: number, ny: number) {\r\n        let trans = item.getComponent(UITransform);\r\n        let x = this.startX + nx * (trans.contentSize.width + this.spaceX);\r\n        let y = this.startY - ny * (trans.contentSize.height + this.spaceY);\r\n        if (this.type == Layout.Type.HORIZONTAL || this.type == Layout.Type.GRID) x += this.paddingLeft;\r\n        if (this.type == Layout.Type.VERTICAL || this.type == Layout.Type.GRID) y -= this.paddingTop;\r\n        item.setPosition(x, y, 0);\r\n    }\r\n\r\n    private flush(reset: boolean = false) {\r\n        if (!this.datas) return;\r\n        var trans = this.scroller.getComponent(UITransform);\r\n        let box = trans.getBoundingBoxTo(this.scroller.content.getWorldMatrix());\r\n        let leftX = box.xMin, topY = box.yMax;\r\n        let rightX = box.xMax, downY = box.yMin;\r\n        // Logger.log(\"box\", rightX - leftX);\r\n        let views = {};\r\n        let itemSize = this.itemTransForm.contentSize;\r\n        if (this.type == Layout.Type.VERTICAL) {\r\n            let hide = itemSize.height + this.spaceY;\r\n            let start = Math.floor(Math.max(0, this.startY - topY) / hide);\r\n            let end = Math.ceil(Math.max(0, this.startY - downY) / hide);\r\n            // Logger.log(\"flush\", start, end);\r\n            for (let i = start; i <= end; i++) {\r\n                if (i >= this.datas.length) break;\r\n                let item = this.getItem(i);\r\n                if (item['$$index'] != i || reset) this.updateItem?.(item, this.datas[i], i);\r\n                item['$$index'] = i;\r\n                this.scroller.content.addChild(item);\r\n                this.layout(item, 0, i);\r\n                views[i + ''] = item;\r\n                this.showing[i + ''] = item;\r\n            }\r\n        } else if (this.type == Layout.Type.HORIZONTAL) {\r\n            let wide = itemSize.width + this.spaceX;\r\n            let start = Math.floor(Math.max(0, leftX - this.startX) / wide);\r\n            let end = Math.ceil(Math.max(0, rightX - this.startX) / wide);\r\n            // Logger.log(\"flush\", start, end);\r\n            for (let i = start; i <= end; i++) {\r\n                if (i >= this.datas.length) break;\r\n                let item = this.getItem(i);\r\n                if (item['$$index'] != i || reset) this.updateItem?.(item, this.datas[i], i);\r\n                item['$$index'] = i;\r\n                this.scroller.content.addChild(item);\r\n                this.layout(item, i, 0);\r\n                views[i + ''] = item;\r\n                this.showing[i + ''] = item;\r\n            }\r\n        } else if (this.type == Layout.Type.GRID) {\r\n            let hide = itemSize.height + this.spaceY;\r\n            let start = Math.floor(Math.max(0, this.startY - topY) / hide);\r\n            let end = Math.ceil(Math.max(0, this.startY - downY) / hide);\r\n            let col = this.getGridCol(itemSize.width);\r\n            let i = start * col;\r\n            for (let y = start; y <= end; y++) {\r\n                for (let x = 0; x < col; x++) {\r\n                    if (i >= this.datas.length) break;\r\n                    // Logger.log(\"flush\", i, x, y);\r\n                    let item = this.getItem(i);\r\n                    if (item['$$index'] != i || reset) this.updateItem?.(item, this.datas[i], i);\r\n                    item['$$index'] = i;\r\n                    this.scroller.content.addChild(item);\r\n                    this.layout(item, x, y);\r\n                    views[i + ''] = item;\r\n                    this.showing[i + ''] = item;\r\n                    i++;\r\n                }\r\n                if (i >= this.datas.length) break;\r\n            }\r\n        }\r\n        for (let k in this.showing) {\r\n            if (!views[k]) {\r\n                let isDel: boolean = this.receiveItem(this.showing[k]);\r\n                if (isDel) delete this.showing[k];\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    private receiveItem(item: Node): boolean {\r\n        //console.error(\"-------->回收Item\")\r\n        /**增加滚动边界判断（因为滚动到边界item被回收掉了无法派发touch-end导致滚动列表不触发回弹） */\r\n        if (this.scroller[\"_isOutOfBoundary\"]()) return false;\r\n        if (item.parent) item.parent.removeChild(item);\r\n        item[\"$$index\"] = undefined;\r\n        this.itemPool.push(item);\r\n        return true;\r\n    }\r\n\r\n    // 滑动到指定的位置\r\n    ScrollToIndex(index: number) {\r\n\r\n        for (let k in this.showing) {\r\n            let isDel: boolean = this.receiveItem(this.showing[k]);\r\n            if (isDel) delete this.showing[k];\r\n        }\r\n\r\n        var trans = this.scroller.getComponent(UITransform);\r\n        let box = trans.getBoundingBoxTo(this.scroller.content.getWorldMatrix());\r\n\r\n        let views = {};\r\n        let itemSize = this.itemTransForm.contentSize;\r\n        if (this.type == Layout.Type.VERTICAL) {\r\n            let hide = itemSize.height + this.spaceY;\r\n            let start = index;\r\n            let end = start + Math.ceil((box.yMax - box.yMin) / hide);\r\n            for (let i = start; i <= end; i++) {\r\n                if (i >= this.datas.length) break;\r\n                let item = this.getItem(i);\r\n                if (item['$$index'] != i) this.updateItem?.(item, this.datas[i], i);\r\n                item['$$index'] = i;\r\n                this.scroller.content.addChild(item);\r\n                this.layout(item, 0, i);\r\n                views[i + ''] = item;\r\n                this.showing[i + ''] = item;\r\n            }\r\n            let transform = this.scroller.content.getComponent(UITransform);\r\n\r\n            this.scroller.content.setPosition(0, index * hide + this.contentH * (transform.anchorY - 0.5));\r\n        }\r\n        /* else if (this.type == Layout.Type.HORIZONTAL) {\r\n            let width = itemSize.width + this.spaceX;\r\n            let start = index;\r\n            let end =  start + Math.ceil((box.xMax - box.xMin) / width);\r\n            this.scroller.content.setPosition(0, 0);\r\n            for (let i = start; i <= end; i++) {\r\n                if (i >= this.datas.length) break;\r\n                let item = this.getItem(i);\r\n                if (item['$$index'] != i) this.updateItem?.(item, this.datas[i], i);\r\n                item['$$index'] = i;\r\n                this.scroller.content.addChild(item);\r\n                this.layout(item, i, 0);\r\n                views[i + ''] = item;\r\n                this.showing[i + ''] = item;\r\n            }\r\n\r\n            this.scroller.content.setPosition(index * width, 0);\r\n        } */\r\n\r\n    }\r\n}\r\n"]}